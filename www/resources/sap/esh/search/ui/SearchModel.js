/*!
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/base/Log","./error/ErrorHandler","sap/m/MessageBox","sap/esh/search/ui/SearchHelper","sap/esh/search/ui/SearchResultListFormatter","sap/esh/search/ui/SearchFacetsFormatter","sap/esh/search/ui/SearchTabStripsFormatter","sap/esh/search/ui/suggestions/SuggestionHandler","sap/esh/search/ui/SearchConfiguration","sap/esh/search/ui/personalization/PersonalizationStorage","sap/esh/search/ui/eventlogging/EventLogger","sap/esh/search/ui/SearchUrlParser","sap/esh/search/ui/cFLPUtil","sap/esh/search/ui/usercategories/UserCategoryManager","sap/ushell/System","sap/esh/search/ui/i18n",],function(L,E,M,S,c,d,f,g,h,P,l,m,n,U,o){("use strict");var p;sap.esh.search.ui.searchModels={};sap.esh.search.ui.getModelSingleton=function(a,i){i=i||"default";if(!sap.esh.search.ui.searchModels[i]){sap.esh.search.ui.searchModels[i]=new sap.esh.search.ui.SearchModel({configuration:a,});}return sap.esh.search.ui.searchModels[i];};var q=sap.ui.model.json.JSONModel.extend("sap.esh.search.ui.SearchModel",{constructor:function(a){var t=this;a=a||{};sap.ui.model.json.JSONModel.prototype.constructor.apply(t,[]);t.config=h.create(a.configuration);t.setSizeLimit(1000);t.suggestionHandler=new g({model:this,});t.errorHandler=new sap.esh.search.ui.error.ErrorHandler({model:this,});t.searchApplications=S.refuseOutdatedRequests(t.searchApplications,"search");t.pageSize=this.config.pageSize||10;t.appTopDefault=20;t.boTopDefault=t.pageSize;t.setProperty("/isQueryInvalidated",true);t.setProperty("/isBusy",false);t.setProperty("/busyDelay",0);t.setProperty("/tableColumns",[]);t.setProperty("/tableSortableColumns",[]);t.setProperty("/tableResults",[]);t.setProperty("/results",[]);t.setProperty("/appResults",[]);t.setProperty("/boResults",[]);t.setProperty("/origBoResults",[]);t.setProperty("/count",0);t.setProperty("/countText","");t.setProperty("/boCount",0);t.setProperty("/appCount",0);t.setProperty("/facets",[]);t.setProperty("/dataSources",[t.allDataSource,t.appDataSource]);t.setProperty("/appSearchDataSource",null);t.setProperty("/currentPersoServiceProvider",null);t.setProperty("/businessObjSearchEnabled",true);t.setProperty("/initializingObjSearch",false);t.setProperty("/suggestions",[]);t.setProperty("/resultToDisplay",t.config.defaultResultViewType||S.loadResultViewType());t.setProperty("/displaySwitchVisibility",false);t.setProperty("/documentTitle","Search");t.setProperty("/top",t.boTopDefault);t.setProperty("/orderBy",{});t.setProperty("/facetVisibility",false);t.setProperty("/focusIndex",0);t.setProperty("/errors",[]);t.setProperty("/isErrorPopovered",false);this.setProperty("/nlqSuccess",false);this.setProperty("/nlqDescription","");this.setProperty("/firstSearchWasExecuted",false);t.setProperty("/multiSelectionAvailable",false);t.setProperty("/multiSelectionEnabled",false);t.setProperty("/multiSelection/actions",[]);t.setProperty("/multiSelectionSelected",false);t.setProperty("/multiSelectionObjects",[]);t.setProperty("/singleSelectionSelected",false);t.setProperty("/inputHelpSelectedItems",null);t.setProperty("/inputHelp",null);t.setProperty("/config",t.config);t.setProperty("/searchInLabel","");t.setProperty("/searchInIcon","sap-icon://none");if(a.searchModel&&a.searchModel._initBusinessObjSearchProm){t._initBusinessObjSearchProm=a.searchModel._initBusinessObjSearchProm;t.oFacetFormatter=new d(t);}t.subscribers=[];t.initBusinessObjSearch();t.searchUrlParser=new m({model:this,});t.userCategoryManagerDeferred=null;},createSina:function(){var s=jQuery.Deferred();sap.ui.require(["sap/esh/search/ui/sinaNexTS/sina/sinaFactory"],function(a){if(!this.config.searchBusinessObjects){a.createAsync("dummy").then(function(b){s.resolve(b);},function(e){s.reject(e);});return;}var t=[];if(window.location.href.indexOf("demo/FioriLaunchpad.")!==-1){t=["sample"];}else{t=["abap_odata","inav2","dummy",];}n.readCFlpConfiguration(t).then(function(t){if(this.config.sinaConfiguration){t=[this.config.sinaConfiguration];}for(var _=0,b=t;_<b.length;_++){var e=b[_];var i=L.getLogger("sap.esh.search.ui.eshclient");e.logTarget=i;e.logLevel=i.getLevel();}a.createByTrialAsync(t).then(function(j){s.resolve(j);},function(j){s.reject(j);});}.bind(this));}.bind(this));return s;},initBusinessObjSearch:function(){var t=this;if(t._initBusinessObjSearchProm){return t._initBusinessObjSearchProm;}t.setProperty("/initializingObjSearch",true);t.setProperty("/isBusy",true);var a={label:sap.esh.search.ui.resources.i18n.getText("genericLoading"),labelPlural:sap.esh.search.ui.resources.i18n.getText("genericLoading"),enabled:false,id:"$$Loading$$",};t.setProperty("/dataSource",a);t.setProperty("/dataSources",[a]);t._initBusinessObjSearchProm=P.create(this.config.personalizationStorage).then(function(b){t.personalizationStorage=b;t.initFacetVisibility();return t.createSina();}).then(function(s){t.sinaNext=s;return U.create({sina:s,personalizationStorage:t.personalizationStorage,});}).then(function(u){t.userCategoryManager=u;t.eventLogger=l.newInstance({sinaNext:t.sinaNext,});t.eventLogger.logEvent({type:t.eventLogger.SESSION_START,});if(t.sinaNext.provider.id!=="abap_odata"){t.config.userDefinedDatasources=false;t.userCategoryManager.setFavActive(false);}t.createAllAndAppDataSource();if(t.userCategoryManager.isFavActive()){t.setProperty("/defaultDataSource",t.userCategoryManager.getCategory("MyFavorites"));}else{t.setProperty("/defaultDataSource",t.allDataSource);}if(t.config.defaultSearchScopeApps||t.config.searchScopeWithoutAll){t.setProperty("/defaultDataSource",t.appDataSource);}if(t.config.defaultDataSource){t.setProperty("/defaultDataSource",t.sinaNext.getDataSource(t.config.defaultDataSource));}if(t.sinaNext.provider.id==="dummy"){t.setProperty("/defaultDataSource",t.appDataSource);t.setProperty("/businessObjSearchEnabled",false);t.config.searchBusinessObjects=false;t.setFacetVisibility(false,false);}if(t.sinaNext.provider.id==="inav2"&&t.config.isUshell){sap.ushell.Container.addRemoteSystem(new o({alias:"ENTERPRISE_SEARCH",platform:"abap",baseUrl:"/ENTERPRISE_SEARCH",}));}t.setProperty("/uiFilter",t.sinaNext.createFilter());t.loadDataSources();t.resetDataSource(false);t.resetFilterConditions(false);t.query=t.sinaNext.createSearchQuery();if(t.config.multiSelect){t.query.setMultiSelectFacets(true);}t.oFacetFormatter=new d(t);t.tabStripFormatter=new f.Formatter(t.allDataSource);t.dataSourceTree=t.tabStripFormatter.tree;t.setProperty("/initializingObjSearch",false);t.setProperty("/isBusy",false);},function(e){t.errorHandler.onError(e);return jQuery.Deferred().reject;}).then(function(){t.config.initAsync(t);});return t._initBusinessObjSearchProm;},initFacetVisibility:function(){if(typeof this.config.facetVisibility!=="undefined"){this.setFacetVisibility(this.config.facetVisibility,false);return;}var a=false;try{a=this.personalizationStorage.getItem("search-facet-panel-button-state");}catch(e){}this.setFacetVisibility(a,false);},isBusinessObjSearchConfigured:function(){try{var a=window["sap-ushell-config"].renderers.fiori2.componentData.config;return a.searchBusinessObjects!=="hidden";}catch(e){return true;}},isBusinessObjSearchEnabled:function(){return this.getProperty("/businessObjSearchEnabled");},setProperty:function(a){var t=this;try{var r=sap.ui.model.json.JSONModel.prototype.setProperty.apply(this,arguments);switch(a){case"/boResults":case"/appResults":t.calculateResultList();break;case"/appCount":case"/boCount":r=t.setProperty("/count",t.getProperty("/appCount")+t.getProperty("/boCount"));break;case"/count":r=t.setProperty("/countText",t._calculateCountText());break;default:break;}return r;}catch(e){t.errorHandler.onError(e);}},_calculateCountText:function(){var t=this;var a=t.getProperty("/count");if(a>0){if(t.getProperty("/nlqSuccess")){return t.getProperty("/nlqDescription");}if(typeof a!=="number"){return"";}var b=S.formatInteger(a);if(t.getProperty("/searchInLabel")){return((t.getProperty("/searchInLabel")||sap.esh.search.ui.resources.i18n.getText("results"))+" ("+b+")");}return sap.esh.search.ui.resources.i18n.getText("results")+" ("+b+")";}return"";},getPersonalizationStorageInstance:function(){return this.personalizationStorage;},getSearchBoxTerm:function(){return this.getProperty("/uiFilter/searchTerm")||"";},setSearchBoxTerm:function(s,a){var t=this;var b=s.replace(/^\s+/,"");this.setProperty("/uiFilter/searchTerm",b);this.calculateSearchButtonStatus();if(b.length===0){return;}if(a||a===undefined){t._firePerspectiveQuery();}},getLastSearchTerm:function(){return this.query.getSearchTerm();},setFacetVisibility:function(v,a){if(sap.ui.Device.system.phone){v=false;}this.setProperty("/facetVisibility",v);try{this.personalizationStorage.setItem("search-facet-panel-button-state",v);}catch(e){}if(a||a===undefined){this._firePerspectiveQuery({preserveFormerResults:true,});}},getFacetVisibility:function(){return this.getProperty("/facetVisibility");},getTop:function(){return this.getProperty("/top");},setTop:function(t,a){this.setProperty("/top",t);if(a||a===undefined){this._firePerspectiveQuery({preserveFormerResults:true,});}},resetTop:function(){this.setProperty("/focusIndex",0);if(this.isAppCategory()){this.setTop(this.appTopDefault,false);}else{this.setTop(this.boTopDefault,false);}},getOrderBy:function(){return this.getProperty("/orderBy");},setOrderBy:function(a,b){this.setProperty("/orderBy",a);if(b||b===undefined){this._firePerspectiveQuery({preserveFormerResults:true,});}},resetOrderBy:function(a){this.setProperty("/orderBy",{});if(a||a===undefined){this._firePerspectiveQuery({preserveFormerResults:true,});}},isEqualOrderBy:function(a,b){if(!a.orderBy){return b.length===0;}if(b.length!==1){return false;}var e=b[0];if(e.id!==a.orderBy){return false;}if(a.sortOrder==="ASC"){return e.order===this.sinaNext.SortOrder.Ascending;}return e.order===this.sinaNext.SortOrder.Descending;},isPersSearchScopeActive:function(){return this.persSearchScopeActive;},getDocumentTitle:function(){var s=this.getSearchBoxTerm();var a=this.getDataSource().labelPlural||this.getDataSource().label;var t;if(this.getDataSource()===this.allDataSource){t=sap.esh.search.ui.resources.i18n.getText("searchTileTitleProposalAll",[s,]);}else{t=sap.esh.search.ui.resources.i18n.getText("searchTileTitleProposal",[s,a,]);}return t;},resetQuery:function(){if(this.getProperty("/initializingObjSearch")){return;}S.hasher.reset();this.resetTop();this.setSearchBoxTerm("");this.resetDataSource(false);this.resetFilterConditions(false);this.query.resetConditions();this.query.setSearchTerm("random-jgfhfdskjghrtekjhg");this.setProperty("/facets",[]);this.setProperty("/results",[]);this.setProperty("/appResults",[]);this.setProperty("/boResults",[]);this.setProperty("/origBoResults",[]);this.setProperty("/count",0);this.setProperty("/boCount",0);this.setProperty("/appCount",0);},createAllAndAppDataSource:function(){this.allDataSource=this.sinaNext.getAllDataSource();this.allDataSource.label=sap.esh.search.ui.resources.i18n.getText("label_all");this.allDataSource.labelPlural=sap.esh.search.ui.resources.i18n.getText("label_all");this.appDataSource=this.sinaNext._createDataSource({id:"$$APPS$$",label:sap.esh.search.ui.resources.i18n.getText("label_apps"),labelPlural:sap.esh.search.ui.resources.i18n.getText("label_apps"),type:this.sinaNext.DataSourceType.Category,});},getUserCategoryManager:function(){if(this.userCategoryManagerDeferred){return this.userCategoryManagerDeferred;}this.userCategoryManagerDeferred=this.initBusinessObjSearch().then(function(){return this.userCategoryManager;}.bind(this));return this.userCategoryManagerDeferred;},loadDataSources:function(){var t=this;var a=this.sinaNext.getBusinessObjectDataSources();a=a.slice();var b=[];a.forEach(function(e){if(!e.usage.appSearch){b.push(e);}else{t.setProperty("/appSearchDataSource",e);}});if(t.userCategoryManager.isFavActive()){b.splice(0,0,t.userCategoryManager.getCategory("MyFavorites"));t.favDataSource=t.userCategoryManager.getCategory("MyFavorites");}if(!this.config.odataProvider&&this.config.isUshell){b.splice(0,0,this.appDataSource);if(!this.config.searchScopeWithoutAll){b.splice(0,0,this.allDataSource);}}else{b.splice(0,0,this.allDataSource);}this.setProperty("/dataSources",b);this.setProperty("/searchTermPlaceholder",this.calculatePlaceholder());},resetDataSource:function(a){this.setDataSource(this.getDefaultDataSource(),a);},isAllCategory:function(){var a=this.getProperty("/uiFilter/dataSource");return a===this.allDataSource;},isOtherCategory:function(){var a=this.getProperty("/uiFilter/dataSource");return a.type===this.sinaNext.DataSourceType.Category&&!this.isAllCategory();},isAppCategory:function(){var a=this.getProperty("/uiFilter/dataSource");return a===this.appDataSource;},getDataSource:function(){return this.getProperty("/uiFilter/dataSource");},getDefaultDataSource:function(){return this.getProperty("/defaultDataSource");},setDataSource:function(a,b,r){if(this.getDataSource()!==a){this.eventLogger.logEvent({type:this.eventLogger.DATASOURCE_CHANGE,dataSourceId:a.id,});}this.updateDataSourceList(a);this.getProperty("/uiFilter").setDataSource(a);if(r||r===undefined){this.resetTop();}this.setProperty("/searchTermPlaceholder",this.calculatePlaceholder());this.calculateSearchButtonStatus();if(b||b===undefined){this._firePerspectiveQuery();}},notifyFilterChanged:function(){jQuery.each(this.aBindings,function(i,b){if(b.sPath==="/uiFilter/rootCondition"){b.checkUpdate(true);}});},addFilterCondition:function(a,b){var u=this.getProperty("/uiFilter");if(typeof this.config.cleanUpSpaceFilters==="function"){this.config.cleanUpSpaceFilters(this,a);}if(a.attribute||a.conditions){u.autoInsertCondition(a);}else{this.setDataSource(a,false);}if(b||b===undefined){this._firePerspectiveQuery({preserveFormerResults:false,});}this.notifyFilterChanged();},removeFilterCondition:function(a,b){if(a.attribute||a.conditions){this.getProperty("/uiFilter").autoRemoveCondition(a);}else{this.setDataSource(a,false);}if(b||b===undefined){this._firePerspectiveQuery({preserveFormerResults:true,});}this.notifyFilterChanged();},resetFilterConditions:function(a){this.getProperty("/uiFilter").resetConditions();if(a||a===undefined){this._firePerspectiveQuery();}this.notifyFilterChanged();},setFilter:function(a){this.setDataSource(a.dataSource,false);this.setSearchBoxTerm(a.searchTerm,false);var u=this.getProperty("/uiFilter");u.setRootCondition(a.rootCondition);this._firePerspectiveQuery();},doSuggestion:function(){this.suggestionHandler.doSuggestion(this.getProperty("/uiFilter").clone());},abortSuggestions:function(){this.suggestionHandler.abortSuggestions();},autoSelectAppSuggestion:function(a){return this.suggestionHandler.autoSelectAppSuggestion(a);},_firePerspectiveQuery:function(a,b){var t=this;return this.initBusinessObjSearch().then(function(){return t._doFirePerspectiveQuery(a,b);});},_doFirePerspectiveQuery:function(a,b){var t=this;var e,i;if(jQuery.isPlainObject(a)){e=a.deserialization;i=a.preserveFormerResults;}else{e=a||undefined;i=b||undefined;}var u=this.getProperty("/uiFilter");if(u.equals(this.query.filter)&&this.getTop()===this.query.top&&this.isEqualOrderBy(this.getOrderBy(),this.query.sortOrder)&&this.getCalculateFacetsFlag()===this.query.calculateFacets&&!this.getProperty("/isQueryInvalidated")){return jQuery.Deferred().resolve();}if(S.getUrlParameter("nlq")==="true"){this.query.setNlq(true);}if((this.query.filter.dataSource&&u.dataSource!==this.query.filter.dataSource)||(this.query.filter.searchTerm&&u.searchTerm!==this.query.filter.searchTerm)){this.resetOrderBy(false);}if(this.query.filter.dataSource&&u.dataSource!==this.query.filter.dataSource){this.oFacetFormatter.handleDataSourceChanged();}if(!e&&!i){if(!u.equals(this.query.filter)){this.resetTop();}}if(u.searchTerm!==this.query.filter.searchTerm||!u.rootCondition.equals(this.query.filter.rootCondition)){this.tabStripFormatter.invalidate(this.getDataSource());}if(this.getProperty("/isQueryInvalidated")===true){this.query.resetResultSet();this.setProperty("/isQueryInvalidated",false);}this.query.setFilter(this.getProperty("/uiFilter").clone());this.query.setTop(this.getTop());this.query.setSortOrder(this.assembleSortOrder());this.query.setCalculateFacets(this.getCalculateFacetsFlag());this.setProperty("/queryFilter",this.query.filter);this._notifySubscribers("ESHSearchStarted");sap.ui.getCore().getEventBus().publish("ESHSearchStarted");if(e){this.setProperty("/busyDelay",0);}else{this.setProperty("/busyDelay",600);}this.setProperty("/isBusy",true);this.abortSuggestions();this.calculateVisibility();this.updateSearchURLSilently(e);this.eventLogger.logEvent({type:this.eventLogger.SEARCH_REQUEST,searchTerm:this.getProperty("/uiFilter/searchTerm"),dataSourceKey:this.getProperty("/uiFilter/dataSource").id,});return jQuery.when.apply(null,[this.normalSearch(i),this.appSearch()]).then(function(){t.setProperty("/tabStrips",t.tabStripFormatter.format(t.getDataSource(),t.perspective,t));return t.oFacetFormatter.getFacets(t.getDataSource(),t.perspective,t).catch(function(j){return t.errorHandler.onErrorDeferred(j);}).then(function(j){if(j&&j.length>0){j[0].change=jQuery.sap.now();t.setProperty("/facets",j);}});}).catch(function(j){return t.errorHandler.onErrorDeferred(j);}).always(function(){if(t.config&&t.config.browserTitleOverwritten===true){document.title=t.getDocumentTitle();}t._notifySubscribers("ESHSearchFinished");sap.ui.getCore().getEventBus().publish("ESHSearchFinished");t.setProperty("/isBusy",false);t.setProperty("/firstSearchWasExecuted",true);t.notifyFilterChanged();t.updateMultiSelectionSelected();});},assembleSortOrder:function(){var a=this.getOrderBy();if(!a.orderBy){return[];}var b=this.sinaNext.SortOrder.Ascending;if(a.sortOrder==="DESC"){b=this.sinaNext.SortOrder.Descending;}return[{id:a.orderBy,order:b,},];},getCalculateFacetsFlag:function(){if(this.getDataSource().type===this.sinaNext.DataSourceType.Category||this.getFacetVisibility()){return true;}return false;},appSearch:function(){if(this.config.bNoAppSearch===true){return jQuery.when(true);}var t=this;this.setProperty("/appResults",[]);this.setProperty("/appCount",0);if(!this.isAllCategory()&&!this.isAppCategory()){return jQuery.when(true);}var a=this.query.filter.dataSource===this.allDataSource?this.appTopDefault:this.query.top;return this.searchApplications(this.query.filter.searchTerm,a,0).then(function(r){t.setProperty("/appCount",r.totalResults);t.setProperty("/appResults",r.getElements());},function(e){return t.errorHandler.onErrorDeferred(e);});},searchApplications:function(s,t,a){return sap.ushell.Container.getService("Search").queryApplications({searchTerm:s,top:t,skip:a,});},normalSearch:function(a){var t=this;if(!a){t.resetAndDisableMultiSelection();}if(!t.isBusinessObjSearchEnabled()||t.isAppCategory()){this.setProperty("/boResults",[]);this.setProperty("/origBoResults",[]);this.setProperty("/boCount",0);this.setProperty("/nlqSuccess",false);this.setProperty("/nlqDescription","");return jQuery.when(true);}var Q=jQuery.Deferred();var s=function(b){t.perspective=b;t.setProperty("/nlqSuccess",false);if(b.nlqSuccess){t.setProperty("/nlqSuccess",true);t.setProperty("/nlqDescription",b.title);}t._afterSearchPrepareResultList(t.perspective).then(function(){Q.resolve();});};t.setDataSource(t.getDataSource(),false,false);t.query.setCalculateFacets(t.getCalculateFacetsFlag());t.query.getResultSetAsync().then(function(r){var b=(r);return s(b);},function(e){return t.errorHandler.onErrorDeferred(e);});return Q;},_prepareTableResults:function(r){var t=this;var i,j,k;var e=[];var s=this.sinaNext.dataSourceMap[this.getDataSource().id].attributesMetadata;for(i=0;i<s.length;i++){if(s[i].usage.Detail&&s[i].groups.length===0&&s[i].type!=="GeoJson"&&s[i].id.match(/latitude|longitude/i)==null&&s[i].type!==t.sinaNext.AttributeType.ImageUrl){e.push(s[i]);}}var u=function(a,b){if(a.usage.Detail.displayOrder<b.usage.Detail.displayOrder){return-1;}if(a.usage.Detail.displayOrder>b.usage.Detail.displayOrder){return 1;}return 0;};e.sort(u);var v=r;var w="\u2013";for(i=0;i<r.length;i++){v[i].cells=[];for(j=0;j<e.length;j++){v[i].cells[j]={};}}for(i=0;i<r.length;i++){var x=r[i].itemattributes;for(j=0;j<e.length;j++){for(k=0;k<x.length;k++){if(e[j].id===x[k].key){if(x[k].iconUrl){v[i].cells[j]={value:x[k].value===undefined||x[k].value===null||x[k].value.trim().length===0?w:x[k].value,icon:x[k].iconUrl,};}else{v[i].cells[j]={value:x[k].value===undefined||x[k].value===null||x[k].value.trim().length===0?w:x[k].value,};}}}}if(r[i].hasTitleDescription){v[i].cells.unshift({value:r[i].titleDescription===undefined||r[i].titleDescription===null||r[i].titleDescription.trim().length===0?w:r[i].titleDescription,});}v[i].cells.unshift({value:r[i].title===undefined||r[i].title===null||r[i].title.trim().length===0?w:r[i].title,uri:r[i].uri,titleNavigation:r[i].titleNavigation,isTitle:true,titleIconUrl:r[i].titleIconUrl,titleInfoIconUrl:r[i].titleInfoIconUrl,});if(r[i].navigationObjects!==undefined&&r[i].navigationObjects.length>0){v[i].cells.push({value:sap.esh.search.ui.resources.i18n.getText("intents"),navigationObjects:r[i].navigationObjects,isRelatedApps:true,});}if(t.config.extendTableColumn){var y={idAttribute:r[i].additionalAttributes.idAttribute,favoriteUserId:r[i].additionalAttributes.favoriteUserId,};v[i].cells.push(t.config.extendTableColumn.assembleCell(y));}}t.setProperty("/tableResults",v);var z=[];var A=[];for(i=0;i<e.length;i++){if(e[i].id.match(/latitude|longitude/i)==null&&e[i].type!==t.sinaNext.AttributeType.ImageUrl){z.push({name:e[i].label,attributeId:e[i].id,});}}if(r[0].hasTitleDescription){var B=r[0].titleDescriptionLabel+" ("+sap.esh.search.ui.resources.i18n.getText("titleDescription")+")";z.unshift({name:B,attributeId:"SEARCH_TABLE_TITLE_DESCRIPTION_COLUMN",});}var C={};if(t.config.titleColumnName&&t.config.titleColumnName!==""){C.name=sap.esh.search.ui.resources.i18n.getText(t.config.titleColumnName);}else{C.name=t.getDataSource().label;}C.attributeId="SEARCH_TABLE_TITLE_COLUMN";if(t.config.titleColumnWidth&&t.config.titleColumnWidth!==""){C.width=t.config.titleColumnWidth;}z.unshift(C);var D=v[0].cells.length-1;if(v[0].cells[D].isRelatedApps){z.push({name:sap.esh.search.ui.resources.i18n.getText("intents"),attributeId:"SEARCH_APPS_AS_ID",});}if(t.config.extendTableColumn){z.push(t.config.extendTableColumn.column);}for(i=0;i<z.length;i++){z[i].key="searchColumnKey"+i;z[i].index=i;}t.setProperty("/tableColumns",z);for(i=0;i<s.length;i++){var F=s[i];if(F.isSortable){A.push({name:F.label,key:"searchSortableColumnKey"+i,attributeId:F.id,selected:t.getProperty("/orderBy").orderBy===F.id,});}}var G=function(a,b){if(a.name<b.name){return-1;}if(a.name>b.name){return 1;}return 0;};A.sort(G);A.unshift({name:sap.esh.search.ui.resources.i18n.getText("defaultRank"),key:"searchSortableColumnKeyDefault",attributeId:"",selected:jQuery.isEmptyObject(t.getProperty("/orderBy")),});t.setProperty("/tableSortableColumns",A);},_afterSearchPrepareResultList:function(s){var t=this;var i;t.setProperty("/boResults",[]);t.setProperty("/origBoResults",s.items);t.setProperty("/boCount",0);var a=new c(t);var b=a.format(s,t.query.filter.searchTerm);var e;var j=[];var k=[];for(i=0;i<b.length;i++){e=b[i];j.push(e.dataSource);k.push({isDocumentConnector:e.isDocumentConnector,});}var r=t.config.loadCustomModulesForDataSourcesAsync(j,k);var u=$.Deferred();Promise.all([Promise.resolve(s),r]).then(function(v){var s=v[0];if(!t.isAllCategory()&&!t.isOtherCategory()&&!t.isAppCategory()&&s.totalCount>0){if(s.items[0].titleDescriptionAttributes.length>0){b.forEach(function(w){w.hasTitleDescription=true;});}t._prepareTableResults(b);}if(t.config&&typeof t.config.setSearchInLabelIconBindings==="function"){t.config.setSearchInLabelIconBindings(t,s.facets);}t.setProperty("/boCount",s.totalCount);t.setProperty("/boResults",b);t.enableOrDisableMultiSelection();u.resolve();});return u.promise();},resetAndDisableMultiSelection:function(){this.setProperty("/multiSelectionAvailable",false);this.setProperty("/multiSelectionEnabled",false);this.setProperty("/multiSelectionSelected",false);this.setProperty("/singleSelectionSelected",false);},enableOrDisableMultiSelection:function(){if(this.config.enableMultiSelectionResultItems){this.setProperty("/multiSelectionAvailable",true);this.setProperty("/multiSelectionEnabled",true);return;}var a=this.getDataSource();var b=this.config.getDataSourceConfig(a);var s=new b.searchResultListSelectionHandlerControl();if(s){this.setProperty("/multiSelectionAvailable",s.isMultiSelectionAvailable());}else{this.setProperty("/multiSelectionAvailable",false);}},updateMultiSelectionSelected:function(){var r=this.getProperty("/results");var a=0;var b=[];for(var i=0;i<r.length;i++){if(r[i].selected){a++;b.push(r[i]);}}if(a>0){this.setProperty("/multiSelectionSelected",true);this.setProperty("/multiSelectionObjects",b);}else{this.setProperty("/multiSelectionSelected",false);this.setProperty("/multiSelectionObjects",[]);}if(a===1){this.setProperty("/singleSelectionSelected",true);}else{this.setProperty("/singleSelectionSelected",false);}this.config.selectionChange(this);},_endWith:function(s,a){return s.indexOf(a,s.length-a.length)!==-1;},calculatePlaceholder:function(){var t=this;if(t.isAllCategory()||t.config.bPlaceHolderFixedValue===true){return sap.esh.search.ui.resources.i18n.getText("search");}return sap.esh.search.ui.resources.i18n.getText("searchInPlaceholder",[t.getDataSource().labelPlural,]);},updateDataSourceList:function(a){var b=this.getProperty("/dataSources");if(!this.config.searchScopeWithoutAll){while(b.length>0&&b[0]!==this.allDataSource){b.shift();}}if(a===this.allDataSource||a===this.appDataSource){return;}if(a&&a.id){if(a.id.indexOf("~")>=0){return;}}for(var i=0;i<b.length;++i){var e=b[i];if(e===a){return;}}b.unshift(a);this.setProperty("/dataSources",b);},invalidateQuery:function(){S.hasher.reset();this.setProperty("/isQueryInvalidated",true);},autoStartApp:function(){var t=this;if(t.getProperty("/appCount")&&t.getProperty("/appCount")===1&&t.getProperty("/count")&&t.getProperty("/count")===1){var a=t.getProperty("/appResults");if(a&&a.length>0&&a[0]&&a[0].url&&t.getProperty("/uiFilter/searchTerm")&&a[0].tooltip&&t.getProperty("/uiFilter/searchTerm").toLowerCase().trim()===a[0].tooltip.toLowerCase().trim()){if(a[0].url[0]==="#"){window.location.href=a[0].url;}else{window.open(a[0].url,"_blank","noopener,noreferrer");}}}},getResultToDisplay:function(){return this.getProperty("/resultToDisplay");},setResultToDisplay:function(t){this.setProperty("/resultToDisplay",t);S.saveResultViewType(t);},calculateVisibility:function(){var t=this;if(t.isAppCategory()){t.setResultToDisplay("appSearchResult");t.setProperty("/displaySwitchVisibility",false);}else if(t.isAllCategory()||t.isOtherCategory()){t.setResultToDisplay("searchResultList");t.setProperty("/displaySwitchVisibility",false);}else{var r=t.getResultToDisplay();if(!(r==="searchResultList"||r==="searchResultTable"||r==="searchResultGrid"||r==="searchResultMap")){t.setResultToDisplay(t.config.defaultResultViewType||S.loadResultViewType());}t.setProperty("/displaySwitchVisibility",true);}},calculateSearchButtonStatus:function(){if(this.getDataSource()===this.getProperty("/defaultDataSource")&&this.getSearchBoxTerm().length===0){this.setProperty("/searchButtonStatus","close");}else{this.setProperty("/searchButtonStatus","search");}},calculateResultList:function(){var t=this;var r=[];var b=t.getProperty("/boResults");if(b&&b.length){r.push.apply(r,b);}var a=t.getProperty("/appResults");if(a&&a.length>0){var e={type:"appcontainer",tiles:a,};if(r.length>0){if(r.length>3){r.splice(3,0,e);}else{r.push(e);}}else{r=[e];}}sap.ui.model.json.JSONModel.prototype.setProperty.apply(this,["/results",r]);},pushUIMessage:function(e){e.title=e.title==="[object Object]"?sap.esh.search.ui.resources.i18n.getText("searchError"):e.title;e.type=e.type!==undefined?e.type:sap.ui.core.MessageType.Error;var a=this.getProperty("/errors");a.push(e);this.setProperty("/errors",a);},updateSearchURLSilently:function(a){if(a||this.preventUpdateURL){S.hasher.init();}else{var H=this.renderSearchURL();if(this.config.updateUrl){S.hasher.setHash(H);}}},renderSearchURL:function(){return this.searchUrlParser.render();},parseURL:function(){this.searchUrlParser.parse();},subscribe:function(e,F,a){this.subscribers.push({sEventId:e||"",fnFunction:F,oListener:a||this,});},unsubscribe:function(e,F,a){e=e||"";a=a||this;for(var i=0;i<this.subscribers.length;i++){var s=this.subscribers[i];if(s.sEventId===e&&s.fnFunction===F&&s.oListener===a){this.subscribers.splice(i,1);}}},_notifySubscribers:function(e){for(var i=0;i<this.subscribers.length;i++){var s=this.subscribers[i];if(s.sEventId===e){s.fnFunction.apply(s.oListener,[e]);}}},});q.injectSearchShellHelper=function(_){p=p||_;};return q;});
