/*!
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["./SearchResultSetFormatter","./SuggestionResultSetFormatter","./MetadataFormatter","./SearchResultTableExtend","../uri/CharMapper","../sinaNexTS/sina/LogicalOperator","../sinaNexTS/sina/ComparisonOperator","../sinaNexTS/sina/ComplexCondition","../sinaNexTS/sina/SimpleCondition","sap/m/Label","sap/m/ListMode","sap/m/Column","sap/m/ColumnListItem","sap/m/TableSelectDialog","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/ui/core/TextDirection",],function(S,a,M,b,C,L,c,d,e,f,g,h,j,T,k,F,l,J,m){"use strict";var n=new C(["#","%"]);var q=[];var o=new d.ComplexCondition({operator:L.LogicalOperator.Or,});var s=new e.SimpleCondition({operator:c.ComparisonOperator.Eq,attribute:"technical_type",value:"DWC_REMOTE_TABLE",});o.addCondition(s);var p=new e.SimpleCondition({operator:c.Eq,attribute:"technical_type",value:"DWC_LOCAL_TABLE",});o.addCondition(p);var r=new e.SimpleCondition({operator:c.Eq,attribute:"technical_type",value:"DWC_VIEW",});o.addCondition(r);var t=new e.SimpleCondition({operator:c.Eq,attribute:"technical_type",value:"DWC_ERMODEL",});o.addCondition(t);var u=new e.SimpleCondition({operator:c.Eq,attribute:"technical_type",value:"DWC_DATAFLOW",});o.addCondition(u);var v=new e.SimpleCondition({operator:c.Eq,attribute:"technical_type",value:"DWC_IDT",});o.addCondition(v);var w=new e.SimpleCondition({operator:c.Eq,attribute:"kind",value:"sap.dis.dataflow",});o.addCondition(w);var x=new e.SimpleCondition({operator:c.Eq,attribute:"kind",value:"sap.dwc.dac",});o.addCondition(x);var y={searchOnStart:false,defaultDataSource:"SEARCH_DESIGN",quickSelectDataSources:q,displayNoResultsPageBackButton:false,displayNoResultsPageSearchAllButton:false,displayFacetPanelInCaseOfNoResults:true,facetVisibility:true,browserTitleOverwritten:false,assembleFilteredDataSources:function(i){var z;var A="";if(y.dwcUser&&y.dwcUser.name){A=y.dwcUser.name;}z=i.getDataSource("SEARCH_DESIGN");z.label=sap.esh.search.ui.resources.i18n.getText("all");z.icon="sap-icon://world";q.push(z);var B=new Date();B.setMonth(B.getMonth()-1);z=i.createDataSource({id:"recent",label:sap.esh.search.ui.resources.i18n.getText("collectionRecentObjects"),icon:"sap-icon://history",type:i.DataSourceType.BusinessObject,subType:i.DataSourceSubType.Filtered,dataSource:i.dataSourceMap["SEARCH_DESIGN"],filterCondition:i.createComplexCondition({operator:i.LogicalOperator.And,conditions:[i.createSimpleCondition({attribute:"last_accessed",operator:i.ComparisonOperator.Gt,value:B,}),i.createSimpleCondition({attribute:"last_accessed",operator:i.ComparisonOperator.Lt,value:"$$now$$",}),],}),});q.push(z);z=i.createDataSource({id:"myobjects",label:sap.esh.search.ui.resources.i18n.getText("collectionMyObjects"),icon:"sap-icon://switch-classes",type:i.DataSourceType.BusinessObject,subType:i.DataSourceSubType.Filtered,dataSource:i.dataSourceMap["SEARCH_DESIGN"],filterCondition:i.createSimpleCondition({attribute:"creator",operator:i.ComparisonOperator.Eq,value:A,}),});q.push(z);z=i.createDataSource({id:"shared",label:sap.esh.search.ui.resources.i18n.getText("collectionShared"),icon:"sap-icon://share-2",type:i.DataSourceType.BusinessObject,subType:i.DataSourceSubType.Filtered,dataSource:i.dataSourceMap["SEARCH_DESIGN"],filterCondition:i.createSimpleCondition({attribute:"shared_with_space_name",operator:i.ComparisonOperator.Ne,value:"NULL",}),});q.push(z);z=i.createDataSource({id:"favorites",label:sap.esh.search.ui.resources.i18n.getText("collectionFavorites"),icon:"sap-icon://favorite",type:i.DataSourceType.BusinessObject,subType:i.DataSourceSubType.Filtered,dataSource:i.dataSourceMap["SEARCH_DESIGN"],filterCondition:i.createSimpleCondition({attribute:"favorites_user_id",operator:i.ComparisonOperator.Eq,value:A,}),});q.push(z);},hideListView:true,gridView:true,enableMultiSelectionResultItems:true,pageSize:30,layoutUseResponsiveSplitter:true,facetPanelWidthInPercent:18,searchFilterBarShowWithFacets:true,searchBarDoNotHideForNoResults:true,layoutWithoutPage:true,defaultResultViewType:"searchResultTable",updateUrl:true,beforeNavigation:function(i){i.invalidateQuery();},parseSearchUrlParameters:function(U){if(U&&U.filter){U.filter=n.unmap(U.filter);}return U;},renderSearchUrl:function(i){return("#/repositoryexplorer&/rex/search?top="+i.top+"&filter="+i.filter);},isSearchUrl:function(i){return i.indexOf("#/repositoryexplorer")===0;},titleColumnName:"businessName",titleColumnWidth:"16rem",extendTableColumn:b.extendTableColumn,boSuggestions:true,searchInAttibuteFacetPostion:{space_description:1,},cleanUpSpaceFilters:function(i,z){var A=i.getProperty("/uiFilter");if(z){if(z.attribute==="space_description"){A.rootCondition.removeAttributeConditions("space_description");A.dataSource=this.quickSelectDataSources[0];i.setProperty("/searchTermPlaceholder",i.calculatePlaceholder());}}else{A.rootCondition.removeAttributeConditions("space_description");}},hasSpaceFiltersOnly:function(i){var z=i.getAttributeConditions("space_description");if(z.length>0){var A=i.clone();A.removeAttributeConditions("space_description");if(!A.hasFilters()){return true;}}return false;},setSearchInLabelIconBindings:function(i){var z=i.getProperty("/uiFilter");var A=z.rootCondition.getAttributeConditions("space_description");var B="";var D="";if(A.length>0){B=A[0].valueLabel||"";D="sap-icon://sac/data-space-management";}else{var E=q.find(function(G){return G.id===z.dataSource.id;});if(E){B=E.label;D=E.icon;}}i.setProperty("/searchInLabel",B);i.setProperty("/searchInIcon",D);},getSearchInFacetListMode:function(i){if(i.dimension==="space_description"){return g.SingleSelectMaster;}},checkAndSetSpaceIcon:function(i,z){if(z==="space_description"){return"sap-icon://sac/data-space-management";}return i;},bNoAppSearch:true,bPlaceHolderFixedValue:true,setQuickSelectDataSourceAllAppearsNotSelected:function(i,z){var A=i.getDomRef().closest(".sapUshellSearchFacetSearchInAttribute");if(!A||!i.getSelectedItem()){return;}var B=z.getDataSource();if(B&&B.id==="SEARCH_DESIGN"){var D="sapUshellSearchFacetQuickSelectDataSource";D=this.id?this.id+"-"+D:D;var E=sap.ui.getCore().byId(D);E.getSelectedItem().getDomRef().classList.remove("sapMLIBSelected");}},showSpaceFacetInShowMoreDialog:function(i){if(i==="space_description"){return false;}return true;},getSpaceFacetId:function(i,I){if(i==="space_description"){return"sapUshellSearchFacetSearchInAttributeSpace";}return I;},openSpaceShowMoreDialog:function(z,A){var B=A.query.filter.clone();B.rootCondition.removeAttributeConditions("space_description");var D=A.sinaNext.createChartQuery({filter:B,dimension:z,top:1000,});return D.getResultSetAsync().then(function(E){var G=A.oFacetFormatter.getDialogFacetsFromChartQuery(E,A,true,z);for(var i=0;i<G.items.length;i++){var H=G.items[i];delete H.filterCondition.sina;}var I=function(){return[new h({hAlign:"Begin",width:"60%",popinDisplay:"Inline",minScreenWidth:"Tablet",demandPopin:true,}),new h({hAlign:"End",width:"30%",popinDisplay:"Inline",minScreenWidth:"Tablet",demandPopin:true,}),];};var K=function(Q){var R=[],U=Q.getParameter("value"),V=Q.getParameter("itemsBinding");if(U!==undefined&&U.length>0){R.push(new F("label",l.Contains,U));}V.filter(R,"Application");};var N=new T("",{title:sap.esh.search.ui.resources.i18n.getText("selectspace"),contentWidth:"30rem",columns:[I()],search:K,liveChange:K,});var O=new J();O.setDefaultBindingMode("OneWay");O.setData(G);N.setModel(O);var P=new j({type:"Active",unread:false,cells:[new f({text:"{label}",}),new f({text:"{value}",}),],});N.attachConfirm(function(Q){var R=Q.getParameter("selectedContexts");if(R&&R.length&&R.length>0){var U=R[0].getObject();A.addFilterCondition(U.filterCondition,false);A.filterChanged=true;A._firePerspectiveQuery();}});N.bindAggregation("items","/items",P);N.open();},function(i){var E=sap.ushell.resources.i18n.getText("searchError");var G=i.message;k.error(G,{icon:k.Icon.NONE,title:E,actions:k.Action.OK,onClose:null,styleClass:"",initialFocus:null,textDirection:m.Inherit,});});},initAsync:function(){},};y.sinaConfiguration={provider:"hana_odata",url:"/dwaas-core/repository/search",metaDataSuffix:"SEARCH_DESIGN",querySuffix:o,odataVersion:"",searchResultSetFormatters:[new S()],suggestionResultSetFormatters:[new a()],metadataFormatters:[new M(y)],initAsync:function(i){y.assembleFilteredDataSources(i);},};return y;});
