/*!
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/m/IconTabFilter","sap/m/Button","./../error/errors","sap/esh/search/ui/controls/SearchFacetQuickSelectDataSource","sap/esh/search/ui/controls/SearchFacetHierarchy","sap/esh/search/ui/controls/SearchFacet","sap/esh/search/ui/controls/SearchFacetTabBar","sap/esh/search/ui/controls/SearchFacetBarChart","sap/esh/search/ui/controls/SearchFacetPieChart",],function(I,B,e,S,a,b,c,d,f){"use strict";c.extend("my.IconTabBar",{renderer:"sap.esh.search.ui.controls.SearchFacetTabBarRenderer",setEshRole:function(){var g=this.getItems();for(var i=0;i<g.length;++i){var h=g[i];var j=h.getContent()[0];j.setEshRole.apply(j,arguments);}},getEshRole:function(){var i=this.getItems();var g=i[0];var h=g.getContent()[0];return h.getEshRole.apply(h,arguments);},attachSelectionChange:function(){},});return sap.ui.core.Control.extend("sap.esh.search.ui.controls.SearchFacetFilter",{metadata:{properties:{title:"string",},aggregations:{facets:{multiple:true,},},},init:function(){this.data("sap-ui-fastnavgroup","true",true);},constructor:function(o){o=jQuery.extend({},{},o);sap.ui.core.Control.prototype.constructor.apply(this,[o]);this.bindAggregation("facets","/facets",function(i,g){var h=g.getObject();var m=g.getModel();var j=m.config;switch(h.facetType){case"attribute":var s="attribute_facet"+i;if(j&&typeof j.getSpaceFacetId==="function"){s=j.getSpaceFacetId(h.dimension,s);}if(j&&j.id){s=j.id+"-"+s;}var l={};l.id="barChart"+arguments[0];var n=new my.IconTabBar(s,{items:[new I({text:sap.esh.search.ui.resources.i18n.getText("facetList"),icon:"sap-icon://list",key:"list"+arguments[0],content:new b("list"+arguments[0]),}),new I({text:sap.esh.search.ui.resources.i18n.getText("facetBarChart"),icon:"sap-icon://horizontal-bar-chart",key:"barChart"+arguments[0],content:new d(l),}),new I({text:sap.esh.search.ui.resources.i18n.getText("facetPieChart"),icon:"sap-icon://pie-chart",key:"pieChart"+arguments[0],content:new f("pieChart"+arguments[0]),}),],});n.addStyleClass("sapUshellSearchFacetIconTabBar");return n;case"datasource":return new b((i?i+"-":"")+"dataSourceFacet");case"quickSelectDataSource":return new S(j&&j.id?j.id+"-sapUshellSearchFacetQuickSelectDataSource":"sapUshellSearchFacetQuickSelectDataSource",{});case"hierarchy":var p="attribute_facet"+i;return new a(p,{});default:{var k=new Error("program error: unknown facet type "+h.facetType);throw new e.UnknownFacetType(k);}}});},fireReset:function(){this.getModel().resetFilterConditions(false);this.getModel().setDataSource(this.getModel().allDataSource,true);},renderer:function(r,C){var g=function(){return function(){var j=sap.ui.getCore().byId($($(this.getDomRef()).closest(".sapUshellSearchFacet")[0]).attr("id"));var F=new sap.esh.search.ui.SearchFacetDialogModel(C.getModel());F.initBusinessObjSearch().then(function(){F.setData(C.getModel().getData());F.config=C.getModel().config;F.sinaNext=C.getModel().sinaNext;F.prepareFacetList();var o=null;if(j&&j.getBindingContext()&&j.getBindingContext().getObject()&&j.getBindingContext().getObject().dimension){o=j.getBindingContext().getObject().dimension;}var D=new sap.esh.search.ui.controls.SearchFacetDialog({selectedAttribute:o,});D.setModel(F);D.setModel(C.getModel(),"searchModel");D.open();var p=C.getParent().getParent().getParent().getParent();p.oFacetDialog=D;C.getModel().eventLogger.logEvent({type:C.getModel().eventLogger.FACET_SHOW_MORE,});});};};r.write("<div");r.writeControlData(C);r.addClass("sapUshellSearchFacetFilter");r.writeClasses();r.write(">");var h=true;for(var i=0,l=C.getFacets().length;i<l;i++){var j=C.getFacets()[i];var k=j.getBindingContext().getObject();switch(k.facetType){case"attribute":j.setEshRole("attribute");j.attachSelectionChange(null,function(){jQuery(C.showAllBtn.getDomRef()).hide();});if(k.position>999){if(h){j.setHeaderText(sap.esh.search.ui.resources.i18n.getText("filterBy"));h=false;}}else{j.setHeaderText(k.title);j.addStyleClass("sapUshellSearchFacetSearchInAttribute");}r.renderControl(j);break;case"datasource":j.setEshRole("datasource");j.addStyleClass("sapUshellSearchFacetDataSource");r.renderControl(j);break;case"quickSelectDataSource":j.setHeaderText(sap.esh.search.ui.resources.i18n.getText("quickSelectDataSourcesHeader"));r.renderControl(j);break;case"hierarchy":if(k.position>999){if(h){j.setHeaderText(sap.esh.search.ui.resources.i18n.getText("filterBy"));h=false;}}else{j.setHeaderText(k.title);j.addStyleClass("sapUshellSearchFacetSearchInAttribute");}r.renderControl(j);break;default:throw"program error: unknown facet type :"+k.facetType;}}if(C.getModel().getDataSource()&&C.getModel().getDataSource().type==="BusinessObject"){var m=C.getModel().oFacetFormatter.hasDialogFacetsFromMetaData(C.getModel());var n=C.getModel().getProperty("/boCount")>0;if(m&&n){r.write("<div>");C.showAllBtn=new B({text:"{showAllFilters}",press:g(),visible:true,});C.showAllBtn.setModel(C.getModel("i18n"));C.showAllBtn.addStyleClass("sapUshellSearchFacetFilterShowAllFilterBtn");r.renderControl(C.showAllBtn);r.write("</div>");}}r.write("</div>");},onAfterRendering:function(){var g=$(".searchFacetFilter .searchFacet").first().find("ul");var h=g.find("li");g.attr("role","tree");h.attr("role","treeitem");},});});
