/*!
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/esh/search/ui/controls/SearchFacetPieChart","sap/base/Log","sap/suite/ui/microchart/ComparisonMicroChart","sap/m/Label","sap/m/IconTabFilter","sap/m/Button","sap/m/Bar","sap/m/BarDesign","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/ResizeHandler","sap/suite/ui/microchart/ComparisonMicroChartData","sap/m/ValueColor","sap/m/ActionSheet","sap/m/PlacementType",],function(S,L,C,a,I,B,b,c,F,d,R,f,V,A,P){"use strict";var m={};jQuery.extend(m,{init:function(e){this.dialog=e;},getBarChartPlaceholder:function(){var t=this;var o;o=new C({height:"90%",width:"100%",colorPalette:"",tooltip:"",});o.addStyleClass("largeChart1barchart");var e=new F("value",d.GT,0);var g={path:"items",factory:function(){var h=new f({title:"{label}",value:"{value}",color:{path:"selected",formatter:function(v){var r=V.Good;if(!v){r=V.Neutral;}return r;},},displayValue:"{valueLabel}",press:function(E){t.dialog.onDetailPageSelectionChangeCharts(E);},});return h;},filters:[e],};o.bindAggregation("data",g);o.setBusyIndicatorDelay(0);return o;},testWhetherPieWedgeOrLabelIsDummy:function(E){var r=false;var l="";var p=0,g=0;try{l=JSON.stringify(E.getParameters().data[0].data).split('"')[3];p=l.match(/\d+/g)[0];g=l.match(/\d+/g)[1];if(l===sap.esh.search.ui.resources.i18n.getText("facetPieChartOverflowText2",[p,g,])){r=true;}else if(l===sap.esh.search.ui.resources.i18n.getText("facetPieChartOverflowText2",[g,p,])){r=true;}}catch(e){}return r;},getPieChartPlaceholder2:function(){var t=this;var o;o=new sap.viz.ui5.controls.VizFrame({width:"100%",vizType:"info/pie",selectData:function(E){if(!t.testWhetherPieWedgeOrLabelIsDummy(E)){t.dialog.onDetailPageSelectionChangeCharts(E);}},deselectData:function(E){if(!t.testWhetherPieWedgeOrLabelIsDummy(E)){t.dialog.onDetailPageSelectionChangeCharts(E);}},});o.attachRenderComplete(function(E){var h=[];var k;var s=this.getBindingContext().getObject().items4pie;if(!s){return o;}for(var i=0;i<s.length;i++){k=s[i];if(k.selected===true){h.push({data:{Label:k.label,},});}}var l={clearSelection:true,};o.vizSelection(h,l);var n,q,r;var u,v,w,x;n=E.getSource().sId;u=$("#"+n+" .v-legend-marker").last();v=$("#"+n+" .v-legend-item").last();if(this.getBindingContext().getObject().items4pie[0].percentageMissingInBigPie>0){w=$("#"+n+" .v-legend-item").length-1;x=$("#"+n+" .v-datapoint-group").children();for(var j=0;j<x.length;j++){r=x[j];q=r.getAttribute("data-id");q=parseInt(q,10);if(q===w){r.remove();break;}}u.attr("fill-opacity","0");u.attr("stroke-opacity","1");u.attr("stroke","black");u.attr("stroke-width","0.5");v.unbind();v.off();}var y=$("#"+n+" .v-background-body");y.unbind();y.off();});o.setVizProperties({legendGroup:{linesOfWrap:0,layout:{maxWidth:0.5,},},title:{visible:false,},interaction:{selectability:{mode:"multiple",},},});o.addStyleClass("largeChart2piechart");var p=new F("pieReady",d.EQ,true);var D=new sap.viz.ui5.data.FlattenedDataset({dimensions:[{name:"Label",value:"{label}",},],measures:[{name:"Value",value:"{valueLabel}",},],data:{path:"items4pie",filters:[p],},});var e=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"size",type:"Measure",values:["Value"],});var g=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"color",type:"Dimension",values:["Label"],});o.setDataset(D);o.addFeed(e);o.addFeed(g);return o;},getPieChartPlaceholder:function(){var t=this;var o;var p={};p.oSearchFacetDialog=t.dialog;o=new S(p);o.addStyleClass("largeChart2piechart");R.register(o,function(e){var s=0;var g=0;if(e.target.firstChild){s=parseInt(window.getComputedStyle(e.target.firstChild,null).getPropertyValue("transform-origin").split(" ")[0],10);g=e.size.width/2-s;e.target.firstChild.style.marginLeft=g+"px";}});return o;},getHeaderWithDropDown:function(t){var e=this;var o=e.getDropDownButton();var l=new a({text:t,});var h=new b({translucent:true,design:c.Header,contentMiddle:[l,o],});h.addStyleClass("sapUshellSearchFacetDialogTabBarHeader");return h;},setDummyTabBarItems:function(o){o.tabBarItems=[new I({text:sap.esh.search.ui.resources.i18n.getText("facetList"),icon:"sap-icon://list",key:"list"+arguments[0],}),new I({text:sap.esh.search.ui.resources.i18n.getText("facetBarChart"),icon:"sap-icon://horizontal-bar-chart",key:"barChart"+arguments[0],}),new I({text:sap.esh.search.ui.resources.i18n.getText("facetPieChart"),icon:"sap-icon://pie-chart",key:"pieChart"+arguments[0],}),];o.chartOnDisplayIndex=0;},getDropDownButton:function(o){var e=[];var g;var D=new B({icon:o.tabBarItems[o.chartOnDisplayIndex].getIcon(),});for(var i=0;i<o.tabBarItems.length;i++){g=new B({text:o.tabBarItems[i].getText(),icon:o.tabBarItems[i].getIcon(),press:function(E){var l,n;n=E.getSource().sId;l=document.getElementById(n).dataset.facetViewIndex;l=parseInt(l,10);o.chartOnDisplayIndex=l;if(o.chartOnDisplayIndex===0){$(".sapUshellSearchFacetDialogSettingsContainer").css("display","block");}else{$(".sapUshellSearchFacetDialogSettingsContainer").css("display","none");}o.chartOnDisplayIndexByFilterArray[o.facetOnDisplayIndex]=l;var p=o.tabBarItems[o.chartOnDisplayIndex].getIcon();D.setIcon(p);var j=o.tabBarItems[o.chartOnDisplayIndex].getText();var k=sap.esh.search.ui.resources.i18n.getText("displayAs",[j]);D.setTooltip(k);var q=$(".sapUshellSearchFacetDialogFacetList")[0];if(q){var r=sap.ui.getCore().byId(q.id);if(!r.getSelectedItem()){r.setSelectedItem(r.getItems()[0]);}r.fireSelectionChange({listItem:r.getSelectedItem(),});}o.controlChartVisibility(o,l);},});g.data("facet-view-index",""+i,true);e.push(g);}var h=new A({showCancelButton:true,buttons:e,placement:P.Bottom,cancelButtonPress:function(){L.info("sap.m.ActionSheet: cancelButton is pressed");},});D.addStyleClass("sapUshellSearchFacetDialogTabBarButton");var j=o.tabBarItems[o.chartOnDisplayIndex].getText();var k=sap.esh.search.ui.resources.i18n.getText("displayAs",[j]);D.setTooltip(k);D.attachPress(function(){h.openBy(this);});return D;},getListContainersForDetailPage:function(){var t,e,p;var r=[];var g=0;var h=440;var s=$(".searchFacetLargeChartContainer");for(var i=0;i<s.length;i++){if(s[i].clientHeight>0){h=s[i].offsetParent.offsetParent.offsetParent.clientHeight;g=i;break;}}var k=$(".searchFacetLargeChartContainer")[g];if(k){var l=sap.ui.getCore().byId(k.id);var o,n,q;n=$(".sapUshellSearchFacetDialogSubheaderToolbar .sapMSF");o=$(".sapUshellSearchFacetDialogSortButton");q=k.firstChild.children;for(var j=0;j<q.length;j++){if(q[j].className){if(q[j].className.match(/sapMList/)){t=q[j];}else if(q[j].className.match(/barchart/)){e=q[j];}else if(q[j].className.match(/piechart/)){p=q[j];}}}r.push(k);r.push(l);r.push(h);r.push(t);r.push(e);r.push(p);r.push(o);r.push(n);}return r;},});return m;});
