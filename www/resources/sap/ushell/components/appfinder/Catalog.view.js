// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/library","sap/ushell/ui/appfinder/AppBox","sap/ushell/ui/appfinder/PinButton","sap/ushell/ui/launchpad/CatalogEntryContainer","sap/ushell/ui/launchpad/CatalogsContainer","sap/ushell/ui/launchpad/Tile","sap/ui/thirdparty/jquery","sap/ui/performance/Measurement","sap/ushell/resources","sap/ushell/ui/launchpad/AccessibilityCustomData","sap/m/List","sap/m/StandardListItem","sap/ui/Device","sap/m/MessagePage","sap/m/Page","sap/m/PageAccessibleLandmarkInfo","sap/m/BusyIndicator","sap/m/SplitApp","sap/ushell/Config","sap/ushell/components/appfinder/VisualizationOrganizerHelper","sap/ushell/renderers/fiori2/AccessKeysHandler","sap/ushell/components/ComponentKeysHandler"],function(c,A,P,C,a,T,q,M,r,b,L,S,D,d,f,g,B,h,i,V,j,k){"use strict";var l=c.AccessibleLandmarkRole;sap.ui.jsview("sap.ushell.components.appfinder.Catalog",{oController:null,oVisualizationOrganizerHelper:V.getInstance(),formatPinButtonTooltip:function(G,o){var t;if(o.path){var e=G?Array.prototype.indexOf.call(G,o.id):-1;t=e!==-1?"removeAssociatedTileFromContextGroup":"addAssociatedTileToContextGroup";return r.i18n.getText(t,o.title);}t=G&&G.length?"EasyAccessMenu_PinButton_Toggled_Tooltip":"EasyAccessMenu_PinButton_UnToggled_Tooltip";return r.i18n.getText(t);},formatPinButtonSelectState:function(e,m,G,s){if(G){var n=e?Array.prototype.indexOf.call(e,s):-1;return n!==-1;}return!!m;},createContent:function(o){var t=this;this.oViewData=this.getViewData();this.parentComponent=this.oViewData.parentComponent;var m=this.parentComponent.getModel();this.setModel(m);this.setModel(this.oViewData.subHeaderModel,"subHeaderModel");this.oVisualizationOrganizerHelper.setModel(m);this.oController=o;function n(e){return((e!==null)&&(e==="1x2"||e==="2x2"))||false;}var p=new P({icon:{path:"id",formatter:this.oVisualizationOrganizerHelper.formatPinButtonIcon},type:{path:"id",formatter:this.oVisualizationOrganizerHelper.formatPinButtonType},selected:{parts:["associatedGroups","associatedGroups/length","/groupContext/path","/groupContext/id"],formatter:this.oVisualizationOrganizerHelper.formatPinButtonSelectState.bind(this)},tooltip:{parts:["associatedGroups","/groupContext","id"],formatter:this.oVisualizationOrganizerHelper.formatPinButtonTooltip.bind(this)},press:[this.oVisualizationOrganizerHelper.onTilePinButtonClick,this]});var s=new P({icon:{path:"id",formatter:this.oVisualizationOrganizerHelper.formatPinButtonIcon},type:{path:"id",formatter:this.oVisualizationOrganizerHelper.formatPinButtonType},selected:{parts:["associatedGroups","associatedGroups/length","/groupContext/path","/groupContext/id"],formatter:this.oVisualizationOrganizerHelper.formatPinButtonSelectState.bind(this)},tooltip:{parts:["associatedGroups","/groupContext","id"],formatter:this.oVisualizationOrganizerHelper.formatPinButtonTooltip.bind(this)},press:[this.oVisualizationOrganizerHelper.onTilePinButtonClick,this]});this.oAppBoxesTemplate=new A({title:"{title}",icon:"{icon}",subtitle:"{subtitle}",url:"{url}",navigationMode:"{navigationMode}",pinButton:s,press:[o.onAppBoxPressed,o]});var u=this.oVisualizationOrganizerHelper.isPinButtonEnabled();s.setVisible(u);s.addCustomData(new b({key:"tabindex",value:"-1",writeToDom:true}));s.addStyleClass("sapUshellPinButton");p.setVisible(u);p.addCustomData(new b({key:"tabindex",value:"-1",writeToDom:true}));p.addStyleClass("sapUshellPinButton");this.oTileTemplate=new T({tileViews:{path:"content",factory:function(I,e){return e.getObject();}},long:{path:"size",formatter:n},tileCatalogId:"{id}",pinButton:p,press:[o.catalogTilePress,o],afterRendering:o.onTileAfterRendering});this.oCatalogSelect=new L("catalogSelect",{visible:"{/enableCatalogSelection}",rememberSelections:true,mode:"SingleSelectMaster",items:{path:"/masterCatalogs",template:new S({type:"Active",title:"{title}"})},showNoData:false,itemPress:[o._handleCatalogListItemPress,o],selectionChange:[o._handleCatalogListItemPress,o]});this.getCatalogSelect=function(){return this.oCatalogSelect;};var v=this.oCatalogSelect.onAfterRendering;if(D.system.desktop){k.getInstance().then(function(H){this.oCatalogSelect.addEventDelegate({onsaptabnext:function(I){try{I.preventDefault();j.setIsFocusHandledByAnotherHandler(true);H.setFocusOnCatalogTile();}catch(e){}},onsapskipforward:function(I){try{I.preventDefault();j.setIsFocusHandledByAnotherHandler(true);H.setFocusOnCatalogTile();}catch(e){}},onsapskipback:function(I){try{I.preventDefault();j.setIsFocusHandledByAnotherHandler(true);var J=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader");if(J.getVisible()){J.focus();}else{H.appFinderFocusMenuButtons(I);}}catch(e){}}});}.bind(this));}if(m.getProperty("/enableHelp")){this.oCatalogSelect.addStyleClass("help-id-catalogCategorySelect");}this.setCategoryFilterSelection=function(e,H){var I=t.getCatalogSelect();var J=I.getItems();var K=e;var N=0;if(!K||K===""){K=r.i18n.getText("all");}J.forEach(function(O,Q){if(O.getTitle()===K){N=Q;I.setSelectedItem(O);}});if(J.length!==0&&H){J[N].focus();}};this.oCatalogSelect.onAfterRendering=function(){var e=t.oController.categoryFilter||r.i18n.getText("all");t.setCategoryFilterSelection(e);if(v){v.apply(this,arguments);}if(!this.getSelectedItem()){this.setSelectedItem(this.getItems()[0]);}setTimeout(function(){var H=q("#catalog-button, #userMenu-button, #sapMenu-button").filter("[tabindex=0]");if(H.length){H.eq(0).focus();}else{q("#catalog-button").focus();}},0);};var w=this.oCatalogSelect._onAfterRenderingPopover;this.oCatalogSelect._onAfterRenderingPopover=function(){if(this._oPopover){this._oPopover.setFollowOf(false);}if(w){w.apply(this,arguments);}};var E=sap.ui.getCore().getEventBus();var x;var U=function(){this.splitApp.toMaster("catalogSelect","show");if(!D.system.phone){x=this._calculateDetailPageId();if(x!==this.splitApp.getCurrentDetailPage().getId()){this.splitApp.toDetail(x);}}}.bind(this);E.subscribe("launchpad","catalogContentLoaded",function(){setTimeout(U,500);},this);E.subscribe("launchpad","afterCatalogSegment",U,this);var y=new C({header:"{title}",customTilesContainer:{path:"customTiles",template:this.oTileTemplate,templateShareable:true},appBoxesContainer:{path:"appBoxes",template:this.oAppBoxesTemplate,templateShareable:true}});this.oMessagePage=new d({visible:true,showHeader:false,text:r.i18n.getText("EasyAccessMenu_NoAppsToDisplayMessagePage_Text"),description:""});this.oCatalogsContainer=new a("catalogTiles",{categoryFilter:"{/categoryFilter}",catalogs:{path:"/catalogs",templateShareable:true,template:y},busy:true}).addStyleClass("sapUiTinyMarginTop");this.oCatalogsContainer.addStyleClass("sapUshellCatalogTileContainer");this.oCatalogsContainer.addEventDelegate({onsaptabprevious:function(e){var H=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader");var I=q(e.srcControl.getDomRef());if(H.getVisible()&&!H.getPressed()&&!I.hasClass("sapUshellPinButton")){e.preventDefault();var J=sap.ui.getCore().byId("appFinderSearch");J.focus();}},onsapskipback:function(e){var H=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader");if(H.getVisible()&&!H.getPressed()){e.preventDefault();H.focus();}}});this.oCatalogsContainer.onAfterRendering=function(){var e=sap.ui.getCore().byId("catalogTilesDetailedPage");if(!this.getBusy()){e.setBusy(false);M.end("FLP:AppFinderLoadingStartToEnd");}else{e.setBusy(true);}q("#catalogTilesDetailedPage-cont").scroll(function(){var H=sap.ui.getCore().byId("catalogTilesDetailedPage");var I=H.getScrollDelegate();var J=I.getScrollTop();var K=I.getMaxScrollTop();if(K-J<=30+3*t.oController.PagingManager.getTileHeight()&&t.oController.bIsInProcess===false){t.oController.bIsInProcess=true;t.oController.allocateNextPage();setTimeout(function(){t.oController.bIsInProcess=false;},0);}});};var z=new f("catalogTilesDetailedPage",{showHeader:false,showFooter:false,showNavButton:false,content:[this.oCatalogsContainer.addStyleClass("sapUshellCatalogPage")],landmarkInfo:new g({contentLabel:r.i18n.getText("appFinderCatalogTitle"),contentRole:l.None,rootRole:l.None})});var F=new f("catalogMessagePage",{showHeader:false,showFooter:false,showNavButton:false,content:[this.oMessagePage]});var G=new B("catalogSelectBusyIndicator",{size:"1rem"});this.splitApp=new h("catalogViewMasterDetail",{masterPages:[G,this.oCatalogSelect],detailPages:[z,F],mode:"{= ${/isPhoneWidth} ? 'HideMode' : 'ShowHideMode'}"});return this.splitApp;},_calculateDetailPageId:function(){var s=this.getModel("subHeaderModel");var e=s.getProperty("/search/searchMode");var t=s.getProperty("/tag/tagMode");var n=!!this.getModel().getProperty("/catalogsNoDataText");var I;if(e||t){I=this.getController().bSearchResults?"catalogTilesDetailedPage":"catalogMessagePage";}else if(n){I="catalogMessagePage";}else{I="catalogTilesDetailedPage";}return I;},getControllerName:function(){return"sap.ushell.components.appfinder.Catalog";}});});
