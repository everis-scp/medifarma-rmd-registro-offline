// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/components/applicationIntegration/elements/model","sap/ushell/components/applicationIntegration/Storage","sap/ushell/components/applicationIntegration/application/BlueBoxHandler","sap/ushell/ui5service/ShellUIService","sap/ushell/components/applicationIntegration/application/Application","sap/ushell/components/applicationIntegration/relatedServices/RelatedServices","sap/ushell/components/applicationIntegration/relatedShellElements/RelatedShellElements","sap/ushell/components/applicationIntegration/configuration/AppMeta","sap/ushell/services/AppConfiguration","sap/ushell/utils","sap/ui/Device","sap/ushell/Config","sap/ushell/ui5service/AppIsolationService","sap/ushell/ApplicationType","sap/ushell/components/applicationIntegration/DelegationBootstrap","sap/base/util/UriParameters","sap/ui/thirdparty/jquery","sap/base/Log"],function(E,S,B,a,A,R,b,c,d,u,D,C,f,g,h,U,q,L){"use strict";function i(){var v,j=["URL"],r,s,k,I={},o,l=false,m={},n={home:{embedded:"embedded-home",headerless:"headerless-home",merged:"blank-home",blank:"blank-home"},app:{minimal:"minimal",app:"app",standalone:"standalone",embedded:"embedded",headerless:"headerless",merged:"merged",home:"home",blank:"blank",lean:"lean"}},w,G=[],p={},t=false,K={FULL:"true",RESTRICTED:"restricted"};this.shellElements=function(){return b;};this.service=function(){return R;};this.isCurrentApp=function(e){return(m.appId===e);};this.isAppWithSimilarShellHashInCache=function(e,F){var x=S.get(e);if(x){if(x.shellHash===F){return true;}return false;}return false;};this.isAppInCache=function(e){return!!S.get(e);};this.normalizeAppId=function(e){var x="-component",y=e.endsWith(x);if(y){return e.substring(0,e.length-x.length);}return e;};this.onComponentCreated=function(e,x,y){var z=y.component,F=this.normalizeAppId(z.getId());if(this.isAppInCache(F)){S.get(F).app=z;this.active(F);}else{m.app=z;if(z.active){z.active();}}};this.onGetMe=function(e,x,y){y.AppLifeCycle=this;};this.store=function(e){var x=S.get(e);if(x){A.store(x);c.store(x.meta);}};this.destroy=function(e,F,x,y){var z=S.get(e),H;function J(){if(F&&F.getUrl){B.deleteStateFul(F.getUrl());}A.destroy(F);b.destroy(F);c.destroy(F);}if(y===undefined){y=false;}this.removeControl(e,y);if(z){H=B.getStateFul(F.getUrl());if(H&&B.isStatefulContainerSupported(H)&&y===false){var M=B.getHandler();M.destroy(H,e);}else{z.container.destroy();B.deleteStateFul(F.getUrl());}S.remove(e);if(x){x.resolve();}}else{var P=F&&F.sendBeforeAppCloseEvent&&F.sendBeforeAppCloseEvent();if(P===undefined){J();if(x){x.resolve();}}else{P.then(function(){J();if(x){x.resolve();}},function(N){J();if(x){x.resolve();}L.error("FLP got a failed response from the iframe for the 'sap.ushell.services.CrossApplicationNavigation.beforeAppCloseEvent' message sent",N,"sap.ushell.components.applicationIntegration.AppLifeCycle.js");});}}};this.restore=function(e){var x=S.get(e);if(x){A.restore(x);R.restore(x.service);c.restore(x.meta);}};this.active=function(e){var x=S.get(e);if(x){A.active(x.app);}};this.handleExitStateful=function(F,e){var x,H=B.getHandler();if(S.get(F)){x=B.getStorageKey(e);if(x&&B.isKeepAliveSupported(e)){return H.store(e,x);}return Promise.resolve();}return H.destroy(e);};this.handleExitApplication=function(F,e,T,x,y){var z=this,H,P,J;if(F&&e){if(e.getUrl()&&B.isStatefulContainerSupported(B.getStateFul(e.getUrl()))){P=this.handleExitStateful(F,e);}else if(S.get(F)){if(R.isBackNavigation()===true&&!y){J=new q.Deferred();this.destroy(F,e,J);P=J.promise();}else{this.store(F);sap.ui.getCore().getEventBus().publish("sap.ushell","appClosed",e);}}else if(e.getIsStateful&&e.getIsStateful()){if(y){P=e.postMessageRequest("sap.gui.triggerCloseSessionImmediately");}}else{H=j.indexOf(e.getApplicationType)>=0;if(this.isAppOfTypeCached(F,H)===false){J=new q.Deferred();this.destroy(F,e,J);P=J.promise();}}if(y===true){if(P===undefined){this.closeKeepAliveRestrictedApps();}else{P.then(function(){z.closeKeepAliveRestrictedApps();});}}if(F.indexOf("Shell-appfinder-component")>0){sap.ui.getCore().getEventBus().publish("sap.ushell","appFinderAfterNavigate");}}sap.ui.getCore().getEventBus().publish("relatedServices","resetBackNavigation");};this.closeKeepAliveRestrictedApps=function(){try{var x=this,y=[];S.forEach(function(z){if(z.value.keepAliveMode===K.RESTRICTED){y.push(z.value);}});y.forEach(function(z){x.destroy(z.appId,z.container,undefined,true);});}catch(e){L.error("Error: sap.ushell.services.appLifeCycle.closeOtherKeepAliveRestrictedApps:"+e);}};this.onAfterNavigate=function(F,e,T,x){var y=T.indexOf("Shell-appfinder-component")>0||T.indexOf("Shell-home-component")>0||T.indexOf("pages-component-container")>0;this.handleExitApplication(F,e,T,x,y);if(y===true){A.setActiveAppContainer(undefined);}if(T){if(S.get(T)){this.restore(T);}else{}}};this.storeApp=function(e,x,T,F,y){if(!this.isAppInCache(e)){if(x.setProperty){x.setProperty("isKeepAlive",true,true);}S.set(e,{service:{},shellHash:F,appId:e,stt:"loading",appRelatedElements:b.getAppRelatedElement(),container:x,meta:d.getMetadata(T),app:undefined,keepAliveMode:y&&(y.globalValue||y.paramValue),appTarget:T});I[F]=e;B.setStorageKey(x,e);return true;}return false;};this.restoreApp=function(e){if(this.isAppInCache(e)){m=S.get(e);if(B.getStorageKey(m.container)){B.setStorageKey(m.container,e);}}};this.isAppOfTypeCached=function(e,x,y){var z;if(!l&&e.indexOf(r)!==-1){return true;}if(!l&&e.indexOf("Shell-appfinder")!==-1){return true;}z=new U(window.location.href).get("sap-keep-alive");if(z===K.FULL||z===K.RESTRICTED){if(y){y.globalValue=z;}return true;}return false;};this.isCachedEnabledAsAppParameter=function(e,T,x){var y;if(T&&T.appCapabilities&&T&&T.appCapabilities.appFrameworkId==="UI5"){return false;}y=e&&e.params&&e.params["sap-keep-alive"];if(y===K.FULL||y===K.RESTRICTED){if(x){x.paramValue=y;}return true;}if(T&&T.url){y=new U(T.url).get("sap-keep-alive");if(y===K.FULL||y===K.RESTRICTED){if(x){x.paramValue=y;}return true;}}return false;};i.prototype._getURLParsing=function(){if(!this._oURLParsing){this._oURLParsing=sap.ushell.Container.getService("URLParsing");}return this._oURLParsing;};this.calculateAppType=function(T){if(T.applicationType==="URL"&&T.additionalInformation&&T.additionalInformation.startsWith("SAPUI5.Component=")){return"SAPUI5";}return T.applicationType;};this.getStatefulCapabilities=function(T){if(T.appCapabilities&&T.appCapabilities&&T.appCapabilities.statefulContainer){return T.appCapabilities.statefulContainer;}return undefined;};this.isNotifyInnerAppRouteChangeEnabled=function(T){if(T.appCapabilities&&T.appCapabilities.notifyInnerAppRouteChange){return true;}return false;};this.isStatefulCapabilityEnabled=function(T){var e=this.getStatefulCapabilities(T);if(e&&(e.enabled===true||e===true)){return true;}return false;};this.isGUICapabilityEnabled=function(T){var e=this.getStatefulCapabilities(T);if(e&&e.protocol==="GUI"){return true;}return false;};this.isFLPCapabilityEnabled=function(T){return!this.isGUICapabilityEnabled(T)&&this.isStatefulCapabilityEnabled(T);};this.isGUIStatefulCapabilityEnabled=function(T){return this.isGUICapabilityEnabled(T)&&this.isStatefulCapabilityEnabled(T);};this.openApp=function(e,T,x,F){var y,z,H=j.indexOf(T.applicationType)>=0,J,M,N={globalValue:undefined,paramValue:undefined};var O="application"+e;y=B.getStateFul(T.url);if(y&&B.isStatefulContainerSupported(y)){if(this.isAppOfTypeCached(O,H,N)||this.isCachedEnabledAsAppParameter(x,T,N)){if(!this.isAppInCache(O)){this.storeApp(O,y,T,F,N);}this.restoreApp(O);}else{m={appId:O,stt:"loading",container:y,meta:d.getMetadata(T),app:undefined};}}else if(this.isAppOfTypeCached(O,H,N)||this.isCachedEnabledAsAppParameter(x,T,N)){if(!this.isAppInCache(O)){y=this.createApplicationContainer(e,T);this.storeApp(O,y,T,F,N);B.set(T.url,y);}this.restoreApp(O);}else if(T.applicationType==="TR"||(T.appCapabilities&&T.appCapabilities.appFrameworkId==="GUI")){y=this.getWebGuiV1StatefulContainer(T.url);if(!y){y=this.createApplicationContainer(e,T);B.set(T.url,y);}m={appId:O,stt:"loading",container:y,meta:d.getMetadata(T),app:undefined};}else{if(y){z=x.semanticObject+"-"+x.action;this.removeApplication(z);}else if(T.applicationType==="URL"||T.applicationType==="TR"){z=x.semanticObject+"-"+x.action;J=B.getById("application-"+z);if(J){M=J.getUrl();B.removeCapabilities(J);this.destroy("application-"+z,J);B.deleteStateFul(M);}}y=this.createApplicationContainer(e,T);B.set(T.url,y);if(B.isCapUT(y,"isFLP")){B.setCapabilities(y,[{service:"sap.ushell.services.appLifeCycle",action:"create"},{service:"sap.ushell.services.appLifeCycle",action:"destroy"}]);}m={appId:O,stt:"loading",container:y,meta:d.getMetadata(T),app:undefined};}};this.getAppMeta=function(){return c;};this.evict=function(e){var x,y=e.value,z=e.key;this.removeControl(z);if(y.container.getUrl&&y.container.getUrl()){x=B.getStateFul(y.container.getUrl());}if(x){var H=B.getHandler();H.destroy(x,z);}else{y.container.destroy();}};this.init=function(e,x,y,z,F,H,J){var M=this,N;if(D.system.phone){N=10;if(J&&J.limit&&J.limit.phone){N=J.limit.phone;}}else if(D.system.tablet){N=10;if(J&&J.limit&&J.limit.tablet){N=J.limit.tablet;}}else if(D.system.desktop){N=15;if(J&&J.limit&&J.limit.desktop){N=J.limit.desktop;}}else{N=10;}h.init(this.registerShellCommunicationHandler,this.postMessageToIframeApp);h.bootstrap();s=new a({scopeObject:F.ownerComponent,scopeType:"component"});o=new f({scopeObject:F.ownerComponent,scopeType:"component"});k=e;v=x;r=y;c.init(r);l=z;B.init({oShellUIService:s,oAppIsolationService:o},J,this);S.init(N,function(P){this.evict(P);}.bind(this));this.registerShellCommunicationHandler({"sap.ushell.services.appLifeCycle":{oRequestCalls:{create:{isActiveOnly:true,distributionType:["URL"],fnResponseHandler:function(P){P.then(function(Q){L.info("sap.ushell.services.appLifeCycle.create:"+Q);}).catch(function(Q){L.error("Error: sap.ushell.services.appLifeCycle.create:"+Q);});}},destroy:{isActiveOnly:true,distributionType:["URL"],fnResponseHandler:function(P){P.then(function(Q){L.info("sap.ushell.services.appLifeCycle.destroy:"+Q);}).catch(function(Q){L.error("Error: sap.ushell.services.appLifeCycle.destroy:"+Q);});}},store:{isActiveOnly:true,distributionType:["URL"],fnResponseHandler:function(P){P.then(function(Q){L.info("sap.ushell.services.appLifeCycle.store:"+Q);}).catch(function(Q){L.error("Error: sap.ushell.services.appLifeCycle.store:"+Q);});}},restore:{isActiveOnly:true,distributionType:["URL"],fnResponseHandler:function(P){P.then(function(Q){L.info("sap.ushell.services.appLifeCycle.restore:"+Q);}).catch(function(Q){L.error("Error: sap.ushell.services.appLifeCycle.restore:"+Q);});}}},oServiceCalls:{subscribe:{executeServiceCallFn:function(P){B.mapCapabilities(P.oContainer,P.oMessageData.body);return new q.Deferred().resolve({}).promise();}},setup:{executeServiceCallFn:function(P){var Q=P.oMessageData&&P.oMessageData.body,T=[],V=P.oContainer.getApplicationType(),W=P.oContainer.getFrameworkId(),X=false;if(Q){if(P.oContainer.getIsKeepAlive()===true&&(V==="GUI"||V==="TR"||V==="WDA"||W==="GUI"||W==="WDA")){X=true;}if(Q.isStateful===true&&!X){T.push({"action":"create","service":"sap.ushell.services.appLifeCycle"});T.push({"action":"destroy","service":"sap.ushell.services.appLifeCycle"});}if(Q.session&&Q.session.bLogoutSupport===true){T.push({"action":"logout","service":"sap.ushell.sessionHandler"});}if(T.length>0){B.mapCapabilities(P.oContainer,T);}}return new q.Deferred().resolve().promise();}}}},"sap.gui":{oServiceCalls:{loadFinished:{executeServiceCallFn:function(P){var Q=P.oContainer.getApplicationType(),T=P.oContainer.getFrameworkId();if((Q==="GUI"||Q==="TR"||T==="GUI")&&P.oContainer.getIsKeepAlive()===false){M.setWebGuiV1StatefulContainer(P.oContainer);P.oContainer.setIsStateful(true);m={appId:P.oContainer.getId(),stt:"loading",container:P.oContainer,meta:undefined,app:undefined};}return new q.Deferred().resolve({}).promise();}}}}});this.registerShellCommunicationHandler({"sap.ushell.eventDelegation":{oRequestCalls:{"registerEventHandler":{isActiveOnly:false,distributionType:["URL"]}},oServiceCalls:{"registerEventHandler":{executeServiceCallFn:function(P){var Q=O(P);return new q.Deferred().resolve(Q).promise();}}}}});function O(P){var Q=P.oMessageData.body.eventSerObj;return M.registerEventHandler(Q);}sap.ui.getCore().getEventBus().subscribe("sap.ushell","appComponentLoaded",this.onComponentCreated,this);sap.ui.getCore().getEventBus().subscribe("sap.ushell","getAppLifeCycle",this.onGetMe,this);b.init(this.getElementsModel(),H);};this.addControl=function(e){v.addCenterViewPort(e);};this.removeControl=function(e,F){var x=B.getById(e),y=B.isStatefulContainerSupported(x);if(!y||F){v.removeCenterViewPort(e,true);}};this.removeApplication=function(e){var x=this.getControl(e);if(x){this.removeControl(x.getId());x.destroy();}};this.getControl=function(e){return v&&(v.getViewPortControl("centerViewPort","application-"+e)||v.getViewPortControl("centerViewPort","applicationShellPage-"+e));};this.getViewPortContainer=function(){return v;};this.navTo=function(e){v.navTo("centerViewPort",e,"show");};this.getCurrentApplication=function(){return m;};this.setApplicationFullWidth=function(e){var x=this.getCurrentApplication();if(x.container){x.container.toggleStyleClass("sapUShellApplicationContainerLimitedWidth",!e);}};this.createComponent=function(e,P){this.shellElements().setDangling(true);return A.createComponent(e,P);};this.getAppContainer=function(e,x,y,z,F){x.shellUIService=s.getInterface();x.appIsolationService=o.getInterface();x.targetNavigationMode=y?"explace":"inplace";this.openApp(e,x,z,F);if(G.length>0){m.container.registerShellCommunicationHandler(G);}if(p.UI5APP){m.container.setIframeHandlers(p.UI5APP);}return m.container;};this.getShellUIService=function(){return s;};this.getAppIsolationService=function(){return o;};this.initShellUIService=function(e){s._attachHierarchyChanged(c.onHierarchyChange.bind(this));s._attachTitleChanged(c.onTitleChange.bind(this));s._attachRelatedAppsChanged(c.onRelatedAppsChange.bind(this));s._attachBackNavigationChanged(e.fnOnBackNavigationChange.bind(this));};this.getElementsModel=function(){return E;};this.activeContainer=function(x){var y=this.getWebGuiV1AllApplicationContainers();y.forEach(function(e){L.info("Deactivating container "+e.getId());e.setActive(false);});B.forEach(function(z){if(z&&z!==x){try{L.info("Deactivating container "+z.getId());z.setActive(false);}catch(e){}}});if(x){L.info("Activating container "+x.getId());x.setActive(true);}};this.showApplicationContainer=function(e){this.navTo(e.getId());if(e.hasStyleClass("sapUShellApplicationContainerShiftedIframe")){e.toggleStyleClass("sapUShellApplicationContainerIframeHidden",false);}else{e.toggleStyleClass("hidden",false);}A.setActiveAppContainer(e);L.info("New application context opened successfully in an existing transaction UI session.");};this.reuseStateFulContainerAndRestore=function(e,T,H,F,x){var y=this,z=I[F];if(B.getStorageKey(e)){B.setStorageKey(e,z);}return H.restore(e,z,x).then(function(){y.showApplicationContainer(e);},function(J){L.error(J&&J.message||J);});};this.reuseStateFulContainer=function(e,x,T,H,F,y){var z=this;I[F]=T;if(B.getStorageKey(e)){B.setStorageKey(e,T);}this.initAppMetaParams();return H.create(e,x,T,y).then(function(){z.showApplicationContainer(e);},function(J){L.error(J&&J.message||J);});};this.initAppMetaParams=function(){if(!this.getAppMeta().getIsHierarchyChanged()){s.setHierarchy();}if(!this.getAppMeta().getIsTitleChanged()){s.setTitle();}if(!this.getAppMeta().getIsRelatedAppsChanged()){s.setRelatedApps();}if(!t){s.setBackNavigation();}};this.reuseApplicationContainer=function(e,x,y){var z=this;return e.setNewApplicationContext(x,y).then(function(){z.navTo(e.getId());if(e.hasStyleClass("sapUShellApplicationContainerShiftedIframe")){e.toggleStyleClass("sapUShellApplicationContainerIframeHidden",false);}else{e.toggleStyleClass("hidden",false);}L.info("New application context opened successfully in an existing transaction UI session.");},function(F){L.error(F&&F.message||F);});};this.createApplicationContainer=function(e,x){return A.createApplicationContainer(e,x);};this.publishNavigationStateEvents=function(e,x,O){var y,z=e.getId?e.getId():"",F=this;var H=d.getMetadata(),J=H.icon,T=H.title;e.addEventDelegate({onAfterRendering:O});y=e.exit;e.exit=function(){if(y){y.apply(this,arguments);}F.getAppMeta()._applyContentDensityByPriority();setTimeout(function(){var M=q.extend(true,{},x);delete M.componentHandle;M.appId=z;M.usageIcon=J;M.usageTitle=T;sap.ui.getCore().getEventBus().publish("sap.ushell","appClosed",M);L.info("app was closed");},0);var P=F._publicEventDataFromResolutionResult(x);sap.ushell.renderers.fiori2.utils.publishExternalEvent("appClosed",P);};};this._publicEventDataFromResolutionResult=function(e){var P={};if(!e){return e;}["applicationType","ui5ComponentName","url","additionalInformation","text"].forEach(function(x){P[x]=e[x];});Object.freeze(P);return P;};this.getInMemoryInstance=function(e,F,x,O){var y="application-"+e,z=S.get(y),H="",N=false,J;if(z){if(O!==null&&O!==undefined&&O!==""){H=O.toLowerCase();N=H.indexOf("shell-home")>=0||H.indexOf("launchpad-openflppage")>=0||H.indexOf("shell-appfinder")>=0;}J=(N&&(typeof x==="string"&&x.length>0));if(z.shellHash===F&&!J){return{isInstanceSupported:true,appId:z.appId,container:z.container};}return{isInstanceSupported:false,appId:z.appId,container:z.container};}return{isInstanceSupported:false,appId:undefined,container:undefined};};this.handleOpenStateful=function(e,x,T,y,z,F,H){var J=B.getHandler();if(S.get(T)&&e===false){this.reuseStateFulContainerAndRestore(y,T,J,F,z);}else{this.reuseStateFulContainer(y,z.url,T,J,F,z);if(x){if(!this.isAppInCache(T)){this.storeApp(T,y,z,F,H);}}}};this.leave=function(e,x){var y=B.isStatefulContainerSupported(e);var z=S.get(x);if(z){R.store(z.service);}if(y){return this.handleExitStateful(x,e);}return Promise.resolve();};this.open=function(e,x,y,T,W,F,M){var z=this,H,J=(this.getWebGuiV1StatefulContainer(T.url)!==undefined),N,O=j.indexOf(T.applicationType)>=0,P="application-"+e,Q,V,X,Y=false,Z,$,_,a1=new q.Deferred(),b1,c1={globalValue:undefined,paramValue:undefined};V=this.isAppOfTypeCached(P,O,c1)||this.isCachedEnabledAsAppParameter(y,T,c1);X=this.calculateAppType(T);Z=g.getDefaultFullWidthSetting(X);H=B.getStateFul(T.url);N=B.isStatefulContainerSupported(H);if(!N){if(m&&P!==m.appId){H=undefined;}Q=S.get("application"+x);if(Q){H=Q.container;if(!N&&V&&H!==undefined){$=true;}}}var d1,e1;d1=T.appCapabilities&&T.appCapabilities.fullWidth;if(Z===true){if(T.fullWidth===false||T.fullWidth==="false"||M.fullWidth===false||M.fullWidth==="false"||d1===false){e1=false;}}else if(T.fullWidth===true||T.fullWidth==="true"||M.fullWidth===true||M.fullWidth==="true"){e1=true;}if(e1===undefined){e1=Z;}if(N){if(!H){H=W(e,M,y,T,x,e1,F);this.restoreApp(H.getId());this.navTo(H.getId());Y=true;}}else if(!J&&H&&!V){_=new q.Deferred();this.destroy(H.getId(),H,_);_.then(function(){H=W(e,M,y,T,x,e1,F);});}else if(!H){H=W(e,M,y,T,x,e1,F);}if(_===undefined){_=new q.Deferred().resolve();}if(H&&H.getDeffedControlCreation){b1=H.getDeffedControlCreation();}else{b1=Promise.resolve();}_.then(function(){b1.then(function(){if(!J&&!N){if($===true){sap.ui.getCore().getEventBus().publish("launchpad","appOpening",T);}z.restoreApp(H.getId());z.navTo(H.getId());if($===true){sap.ui.getCore().getEventBus().publish("sap.ushell","appOpened",T);}}v.switchState("Center");u.setPerformanceMark("FLP -- centerViewPort");z.activeContainer(H);if(N){z.handleOpenStateful(Y,V,"application"+x,H,T,F,c1);}else if(J){z.reuseApplicationContainer(H,"TR",T.url);}a1.resolve();});});return a1.promise();};this.handleControl=function(e,x,y,T,W,F){var z=this,M=d.getMetadata(T),H=v.getCurrentCenterPage?v.getCurrentCenterPage():undefined,J=sap.ui.getCore().byId(H);var P=z.leave(J,H).then(function(){z.open(e,x,y,T,W,F,M);},function(N){L.error(N&&N.message||N);});return P;};this.switchViewState=function(e,x,y){var z=e,F;if(n[e]&&n[e][k]){z=n[e][k];}var H=C.last("/core/shell/model/currentState/stateName")==="home";if(!H&&(!m.appId||!S.get(m.appId))){E.destroyManageQueue();}F=S.get("application"+y);if(F){b.restore(F);}else{b.assignNew(e);}E.switchState(z,x,y);this.shellElements().setDangling(false);this.shellElements().processDangling();if(e==="searchResults"){this.getElementsModel().setProperty("/lastSearchScreen","");if(!window.hasher.getHash().indexOf("Action-search")===0){var J=sap.ui.getCore().getModel("searchModel");window.hasher.setHash("Action-search&/searchTerm="+J.getProperty("/uiFilter/searchTerms")+"&dataSource="+JSON.stringify(J.getProperty("/uiFilter/dataSource").getJson()));}}};this.registerShellCommunicationHandler=function(e){A.registerShellCommunicationHandler(e);};this.registerIframeCommunicationHandler=function(H,T){p[T]=H;};this.postMessageToIframeApp=function(e,x,M,W){function y(O){if(e==="sap.ushell.sessionHandler"&&x==="logout"){if(O&&O.getApplicationType&&",WCF,GUI,TR,WDA,".indexOf(O.getApplicationType())>0){return false;}}return true;}var z,F=A.getActiveAppContainer(),H=false,J=[];if(B.hasIFrame(F)&&(B.isCapabilitySupported(F,e,x)||A.isAppTypeSupported(F,e,x))&&y(F)===true){J.push(A.postMessageToIframeApp(F,e,x,M,W));H=true;}if(!A.isActiveOnly(e,x)){B.forEach(function(O){if(H===true&&O===F){return;}if(B.hasIFrame(O)){if((B.isCapabilitySupported(O,e,x)||A.isAppTypeSupported(O,e,x))&&y(O)===true){J.push(A.postMessageToIframeApp(O,e,x,M,W));}}});}z=A.getResponseHandler(e,x);var N=Promise.all(J);if(z){z(N);}return N;};this.postMessageToIframeAppAccordingToPolicy=function(e,x,M,W,P){var y,z=A.getActiveAppContainer(),F=[];if(B.hasIFrame(z)&&A.isAppTypeSupportedByPolicy(z,P)){F.push(A.postMessageToIframeApp(z,e,x,M,W));}if(!P.isActiveOnly){B.forEach(function(O){if(B.hasIFrame(O)){if(B.isCapabilitySupported(O,e,x)||A.isAppTypeSupported(O,e,x)){F.push(A.postMessageToIframeApp(O,e,x,M,W));}}});}y=A.getResponseHandler(e,x);var H=Promise.all(F);if(y){y(H);}return H;};this.registerTunnels=function(T){h.registerTunnels(T,this.registerShellCommunicationHandler);};this.registerEvents=function(e){h.registerEvents(e,this.registerShellCommunicationHandler);};this.setBackNavigationChanged=function(e){t=e;};this.getBackNavigationChanged=function(){return t;};this.parseStatefulContainerConfiguration=function(){w={};};this.getWebGuiV1StatefulContainer=function(e){var x;if(e){x=B._getBlueBoxCacheKey(e);return w[x];}else{return undefined;}};this.setWebGuiV1StatefulContainer=function(e){var x=e.getUrl(),y;if(x){y=B._getBlueBoxCacheKey(x);w[y]=e;}};this.getWebGuiV1AllApplicationContainers=function(){return Object.keys(w).map(function(e){return w[e];}).filter(function(e){return!!e;});};}return new i();},true);
