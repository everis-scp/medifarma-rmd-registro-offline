sap.ui.define(["sap/ui/base/Object","sap/ui/model/base/ManagedObjectModel","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/suite/ui/generic/template/lib/CRUDActionHandler","sap/suite/ui/generic/template/lib/StatePreserver","sap/base/util/extend","sap/base/util/isEmptyObject","sap/suite/ui/generic/template/genericUtilities/FeError"],function(B,M,c,F,C,S,e,a,b){"use strict";var s="lib.ComponentUtils";var l=new F(s).getLogger();var d={isPreliminary:function(){return false;}};function g(o,f){var t=f.oTemplateContract.mRoutingTree[f.route];var h;var H;var j;var k;var m;var I=false;var L;var n=[];var N=false;var E=[];function p(){return o.getModel("_templPriv");}function q(i){f.oTemplateContract.oNavigationControllerProxy.preloadComponent(i);}function r(){var i=o.getAppComponent();return i.getModel("_templPrivGlobal");}function u(){return t.level;}function v(){var i=f.oTemplateContract.oApplicationProxy.getAncestralNode(t,1);if(i){var T1={};var U1=i.getPath(2,t1());T1.bindingContext=o.getModel().createBindingContext(U1)||o.getModel().getContext(U1);T1.entitySet=i.entitySet;T1.view=i.componentId&&f.oTemplateContract.componentRegistry[i.componentId].oController.getView();T1.componentId=i.componentId;return T1;}return null;}function w(){var i=f.oTemplateContract.oApplicationProxy.getAncestralNode(t,1);if(!i.componentId){q(i.sRouteName);}return i.componentCreated.then(function(o){var T1=f.oTemplateContract.componentRegistry[o.getId()];return T1.viewRegistered.then(function(){return{getText:T1.oControllerUtils.oCommonUtils.getText,getRootExpand:T1.oControllerUtils.oComponentUtils.getRootExpand};});});}function x(){return f.preprocessorsData;}function y(T1){var U1=f.oTemplateContract.oNavigationControllerProxy.getCurrentIdentity();var V1=U1.keys;var W1=[];for(var i=0;i<T1;i++){W1[i]="";}var X1=f.oTemplateContract.oApplicationProxy.fillSiblingKeyPromise(U1.treeNode,V1,W1,"Changes");return X1.then(function(Y1){return{keys:W1,treeNode:Y1};});}function z(){var i=x();if(i&&i.rootContextExpand){return i.rootContextExpand.join(',');}}function A(){return f.oParameterModel;}function D(i,T1,U1){if(typeof U1!=="function"){throw new b(s,"Event handler must be a function");}E.push({template:i,event:T1,handler:U1});}function G(T1,U1,V1){for(var i=E.length;i--;){if(E[i].handler===V1&&E[i].event===U1&&E[i].template===T1){E.splice(i,1);}}}function J(T1,U1,V1){for(var i=0;i<E.length;i++){if(E[i].event===U1&&E[i].template===T1){E[i].handler(V1);}}}function K(i){return i.getMetadata().getName();}function O(){return f.oApplication.isComponentActive(o);}function P(){return f.oNavigationObserver.getProcessFinished(true);}function Q(i,T1){var U1=P();U1.then(function(){if(O()){if(T1){d1(true);}J(K(f.oController),"PageDataLoaded",{context:i});if(i&&z1()){var V1=i.getObject();if(!V1.IsActiveEntity){f.oApplication.getDraftSiblingPromise(i);}}}});}function R(){h.then(function(i){if(i){Q(i);}});}function T(){f.oHeaderLoadingObserver.startProcess();if(!m){var i=new Promise(function(T1){m=T1;});f.oApplication.getBusyHelper().setBusy(i);}}function U(){if(!H){h=new Promise(function(i){H=i;});}}if(t.getPath(3)){U();}else{h=Promise.resolve();}function V(i){l.info("Request header data",i.getSource().getPath(),"Class sap.suite.ui.generic.template.lib.ComponentUtils");I=true;U();if(!o.getComponentContainer().getElementBinding().isSuspended()){T();}}function W(){if(m){m();m=null;}f.oHeaderLoadingObserver.stopProcess();}function X(i){var T1=i.getSource().getBoundContext();if(T1){return T1;}if(o.getComponentContainer().getElementBinding().isSuspended()){T1=null;}else{T1=d;}b1();return T1;}function Y(){f.oTemplateContract.oNavigationControllerProxy.navigationContextNotFound();}function Z(){I=false;if(!k){return;}if(k===d){Y();b1();}else if(!o.getComponentContainer().getElementBinding().isSuspended()){var i=o.getBindingContext();var T1=p1(i);var U1=T1.bIsDraft||N;var V1;if(U1){N=false;V1=T1.bIsCreate?4:2;}else{V1=1;}var W1=p();W1.setProperty("/objectPage/displayMode",V1);var X1=o.getModel("ui");X1.setProperty("/enabled",true);X1.setProperty("/createMode",T1.bIsCreate);X1.setProperty("/editable",U1);(f.methods.updateBindingContext||Function.prototype)(i);if(H){H(k);}}else{return;}H=null;k=null;}function $(i){l.info("Received header data",i.getSource().getPath(),"Class sap.suite.ui.generic.template.lib.ComponentUtils");j();W();if(I){k=X(i);}Z();}function _(i){j();var T1=X(i);if(T1&&T1.isPreliminary()){return;}k=T1;Z();f.oHeaderLoadingObserver.stopProcess();}function a1(i){f.oHeaderLoadingObserver.startProcess();var T1=new Promise(function(U1){j=U1;});U();if(f.methods.beforeRebind){f.methods.beforeRebind(T1);}k=null;t.bindElement(o.getComponentContainer(),i,false,{dataRequested:V,dataReceived:$,change:_});L=i;if(f.methods.afterRebind){f.methods.afterRebind();}}function b1(){U();var i=o.getComponentContainer();i.unbindElement();i.setBindingContext();L=null;k=null;I=false;W();}function c1(){var T1=t1();var U1=(T1.length===n.length);for(var i=0;i<T1.length&&U1;i++){U1=T1[i]===n[i];}n=T1;return!U1;}function d1(i){f.reuseComponentsReady.then(function(T1){for(var U1 in T1){T1[U1].pathUnchangedCallBack(i);}});}function e1(i,T1){var U1=Object.create(null);for(var V1 in i){var W1=i[V1];U1[V1]=T1(W1,V1);}return U1;}function f1(){var i=p();for(var T1 in t.embeddedComponents){var U1=!!t.embeddedComponents[T1].definition.hiddenByDefault;i.setProperty("/generic/embeddedComponents/"+T1+"/hidden",U1);}}function g1(i,T1){var U1=c1();if(U1&&!T1){f1();}if(!i){if(f.routingSpec&&f.routingSpec.noOData){Q(null,U1);}return;}var V1=o.getComponentContainer();if(!V1){return;}var W1=o.getModel("ui");var X1=!!f.nonDraftCreateContext;if(X1){var Y1=V1.getBindingContext();if(Y1===f.nonDraftCreateContext){return;}W1.setProperty("/enabled",true);W1.setProperty("/editable",true);W1.setProperty("/createMode",true);b1();if(H){H(f.nonDraftCreateContext);H=null;}else{h=Promise.resolve(f.nonDraftCreateContext);}R();if(f.methods.beforeRebind){f.methods.beforeRebind(h);}V1.setBindingContext(f.nonDraftCreateContext);Promise.all([f.oViewRenderedPromise,f.viewRegistered]).then(d1.bind(null,true));if(f.methods.afterRebind){f.methods.afterRebind();}}else{var Z1=V1.getElementBinding();if(Z1){if(L===i){if(Z1.isSuspended()){Z1.resume();Z();}if(I){T();}f.oApplication.getBusyHelper().getUnbusy().then(d1.bind(null,U1));if(!T1){R();}if(!T1&&!z1()){W1.setProperty("/editable",false);}W1.setProperty("/enabled",true);return;}else if(!T1){b1();}}W1.setProperty("/enabled",false);W1.setProperty("/editable",false);W1.setProperty("/createMode",false);a1(i);R();}}function h1(i,T1){var U1={};if(i){U1.discardPromise=i;}var V1=o.getModel();if(V1.hasPendingChanges()){var W1=f.oController.getView();W1.setBindingContext(null);V1.resetChanges();W1.setBindingContext();}var X1=o.getModel("ui");if(T1||X1.getProperty("/editable")){delete f.nonDraftCreateContext;if(!i){delete f.nonDraftCreateContext;X1.setProperty("/editable",false);var Y1=p();Y1.setProperty("/objectPage/displayMode",1);}J(K(f.oController),"AfterCancel",U1);}}function i1(i,T1){return z1()?null:f.oTemplateContract.oNavigationControllerProxy.navigateForNonDraftCreate(i,T1);}function j1(i,T1){N=T1;f.oTemplateContract.oNavigationControllerProxy.adaptUrlAfterNonDraftCreateSaved(i);}function k1(i){var T1=o.getComponentContainer().getElementBinding();if(T1){o.getModel().invalidateEntry(T1.getBoundContext());if(T1.isSuspended()){b1();}else{T1.refresh(!i);f.bWithoutAssociationsRefresh=false;}}}function l1(i){i=i||o.getIsRefreshRequired();if(i||!a(f.mRefreshInfos)||f.bWithoutAssociationsRefresh){(f.methods.refreshBinding||Function.prototype)(i,f.mRefreshInfos,f.bWithoutAssociationsRefresh);o.setIsRefreshRequired(false);f.mRefreshInfos=Object.create(null);}d1(i);}function m1(){var i=o.getModel();var T1={canonicalRequest:!f.oTemplateContract.bCreateRequestsCanonical,batchGroupId:"facets",updateAggregatedMessages:true};i.read(L,T1);}function n1(i){if(z1()){var T1=o.getComponentContainer();var U1=T1.getElementBinding();if(U1&&!U1.isSuspended()){U1.suspend();i.catch(function(){U1.resume();});}}}function o1(){var i=o.getComponentContainer();if(f.nonDraftCreateContext){i.setBindingContext();delete f.nonDraftCreateContext;return;}var T1=i.getElementBinding();if(T1&&!T1.isSuspended()){if(f.oTemplateContract.oValidationMessageBinding.getLength()){b1();}else{T1.suspend();}W();}}function p1(i){var T1=u();return f.oApplication.registerContext(i,T1,o.getEntitySet(),t1());}function q1(i){if(i.level<2){return[i.entitySet];}var T1=f.oTemplateContract.mRoutingTree[i.parentRoute];var U1=q1(T1);if(i!==t){U1.push(i.navigationProperty?U1[T1.level-1]+"/"+i.navigationProperty:i.entitySet);}return U1;}function r1(){return t.level<2?[]:q1(t);}function s1(i,T1,U1){var V1;for(V1=t;V1.level>U1;){V1=f.oTemplateContract.mRoutingTree[V1.parentRoute];}var W1=new M(i);W1.bindProperty("/"+T1).attachChange(function(X1){var Y1=X1.getSource().getValue();f.oTemplateContract.oNavigationControllerProxy.setTextForTreeNode(V1,Y1);});V1.contextTargets=V1.contextTargets||[];V1.contextTargets.push(i);}function t1(){return f.oApplication.getCurrentKeys(u());}function u1(i){return f.oApplication.getCommunicationObject(o,i);}function v1(i,T1,U1,V1,W1){f.oTemplateContract.oNavigationControllerProxy.navigateToChild(t,i,U1,T1,V1,W1);}function w1(i,T1,U1){f.oTemplateContract.oNavigationControllerProxy.navigateFromNodeAccordingToContext(t,i,T1,U1);}function x1(){return t.headerTitle;}function y1(i){f.oTemplateContract.oNavigationControllerProxy.setTextForTreeNode(t,i);}function z1(){return t.isDraft;}function A1(){return!(f.routingSpec&&f.routingSpec.noOData);}function B1(){return!f.oTemplateContract.bCreateRequestsCanonical;}function C1(){return h;}function D1(){return f.oTemplateContract.oPaginatorInfo[u()-1];}function E1(i,T1){var U1=u();if(!T1){U1--;}f.oTemplateContract.oPaginatorInfo[U1]=i;}function F1(i,T1){f.reuseComponentsReady.then(function(U1){var V1=T1.getComponentInstance();for(var W1 in U1){if(V1===U1[W1].component){var X1=p();X1.setProperty("/generic/embeddedComponents/"+W1+"/isInVisibleArea",i);return;}}});}function G1(){return f.oStatePreserverPromise.then(function(i){return i.stateChanged();});}f.oStatePreserverPromise=f.reuseComponentsReady.then(function(i){var T1=f.methods.getStatePreserverSettings&&f.methods.getStatePreserverSettings();if(!T1){return{getUrlParameterInfo:function(){return Promise.resolve({});},applyAppState:Function.prototype,stateChanged:Function.prototype};}var U1="sap-iapp-state"+(t.level===0?"":"-"+t.entitySet);var V1=e({appStateName:encodeURI(U1),getCurrentState:function(){var X1=f.methods.getCurrentState?f.methods.getCurrentState():Object.create(null);var Y1=function(Z1,$1){if(Z1.component.stGetCurrentState){var _1=Z1.component.stGetCurrentState();for(var a2 in _1){X1["$embeddedComponent$"+$1.length+"$"+$1+"$"+a2]=_1[a2];}}};e1(i,Y1);return X1;},applyState:function(X1,Y1){var Z1=Object.create(null);var $1=Object.create(null);for(var _1 in X1){if(_1.indexOf("$embeddedComponent$")===0){var a2=_1.substring(19);var b2=a2.indexOf("$");var c2=Number(a2.substring(0,b2));var d2=a2.substring(b2+1,b2+c2+1);var e2=$1[d2];if(!e2){e2=Object.create(null);$1[d2]=e2;}var f2=a2.substring(b2+c2+2);e2[f2]=X1[_1];}else{Z1[_1]=X1[_1];}}(f.methods.applyState||Function.prototype)(Z1,Y1);var g2=function(h2,i2){if(h2.component.stApplyState){h2.component.stApplyState($1[i2]||Object.create(null),Y1);}};Promise.all([f.oViewRenderedPromise,h]).then(e1.bind(null,i,g2));},oComponent:o},T1);var W1=new S(f.oTemplateContract,V1);f.oApplication.registerStateChanger(W1.getAsStateChanger());return W1;});f.oTemplateContract.oStatePreserversAvailablePromise=Promise.all([f.oTemplateContract.oStatePreserversAvailablePromise,f.oStatePreserverPromise]);function H1(){var i=f.oTemplateContract.oFlexibleColumnLayoutHandler;return i?i.getFclProxy(t):{handleDataReceived:t.level?null:Function.prototype,isListAndFirstEntryLoadedOnStartup:t.level?null:Function.prototype,isNextObjectLoadedAfterDelete:Function.prototype};}function I1(){return t.page.component.settings||{};}function J1(){var i=o.getAppComponent().getManifestEntry("sap.ui5");var T1=i.extends&&i.extends.extensions&&i.extends.extensions["sap.ui.controllerExtensions"];T1=T1&&T1[o.getTemplateName()];T1=T1&&T1["sap.ui.generic.app"];return T1&&T1[o.getEntitySet()];}function K1(){var i=o.getAppComponent().getManifestEntry("sap.ui5");var T1=i.extends&&i.extends.extensions&&i.extends.extensions["sap.ui.viewExtensions"];return T1&&T1[o.getTemplateName()];}function L1(i){f.aUnsavedDataCheckFunctions=f.aUnsavedDataCheckFunctions||[];f.aUnsavedDataCheckFunctions.push(i);}function M1(T1,U1){if(f.methods.getTableForChildContext){var V1=p();var W1=V1.getProperty("/generic/currentActiveChildContext");var X1=W1&&f.methods.getTableForChildContext(W1);if(X1){var Y1=X1.getTable();if(c.isMTable(Y1)){var Z1=Y1.getItems();for(var i=0;i<Z1.length;i++){var $1=Z1[i];if($1.getBindingContextPath()===W1){Y1.scrollToIndex(i);break;}}}}}}var N1;function O1(){N1=N1||new C(f.oTemplateContract,f.oController,f.oControllerUtils.oCommonUtils);return N1;}function P1(i){if(f.methods.executeAfterInvokeActionFromExtensionAPI){f.methods.executeAfterInvokeActionFromExtensionAPI(i,f.oControllerUtils.oCommonUtils);}}function Q1(i){if(f.methods.executeBeforeInvokeActionFromExtensionAPI){f.methods.executeBeforeInvokeActionFromExtensionAPI(i,f.oControllerUtils.oCommonUtils);}}function R1(){var i=f.oController.getView();var T1=i.getModel();if(T1.hasPendingChanges(true)){return true;}if(f.aUnsavedDataCheckFunctions){return f.aUnsavedDataCheckFunctions.some(function(U1){return U1();});}return false;}function S1(i){if(f.reactivate&&!i){return;}var T1=f.oController.onLeaveAppExtension&&f.oController.onLeaveAppExtension.apply(f.oController,[i]);f.reactivate=f.reuseComponentsReady.then(function(U1){var V1=Object.create(null);e1(U1,function(W1,X1){var Y1=W1.leaveApp(i);if(Y1&&!i){V1[X1]=Y1;}});return!i&&function(){if(T1){T1();}for(var W1 in V1){V1[W1]();}};});}return{getBusyHelper:function(){return f.oApplication.getBusyHelper();},attach:function(i,T1,U1){D(K(i),T1,U1);},detach:function(i,T1,U1){G(K(i),T1,U1);},fire:function(i,T1,U1){J(K(i),T1,U1);},getPreprocessorsData:x,getRootExpand:z,getParameterModelForTemplating:A,bindComponent:g1,cancelEdit:h1,getNonDraftCreatePromise:i1,adaptUrlAfterNonDraftCreateSaved:j1,refreshBinding:l1,refreshBindingUnconditional:k1,suspendBinding:o1,messagesRefresh:m1,getTemplatePrivateModel:p,getTemplatePrivateGlobalModel:r,registerContext:p1,getViewLevel:u,getMainComponentDetails:v,getMainComponentUtils:w,getBreadCrumbInfo:r1,registerAncestorTitleUpdater:s1,getCurrentKeys:t1,getCommunicationObject:u1,navigateRoute:v1,navigateAccordingToContext:w1,getTitle:x1,setText:y1,onBeforeDraftTransfer:n1,isDraftEnabled:z1,isODataBased:A1,getNoStateMessagesForTables:B1,isComponentActive:O,navigateToDataLoadedFailedPage:Y,getHeaderDataAvailablePromise:C1,getPaginatorInfo:D1,setPaginatorInfo:E1,onVisibilityChangeOfReuseComponent:F1,getNavigationFinishedPromise:P,stateChanged:G1,unbind:b1,getFclProxy:H1,getSettings:I1,getControllerExtensions:J1,getViewExtensions:K1,registerUnsavedDataCheckFunction:L1,layoutChanged:M1,getCRUDActionHandler:O1,executeAfterInvokeActionFromExtensionAPI:P1,executeBeforeInvokeActionFromExtensionAPI:Q1,preloadComponent:q,isComponentDirty:R1,getTargetKeyFromLevel:y,leaveApp:S1};}return B.extend("sap.suite.ui.generic.template.lib.ComponentUtils",{constructor:function(o,f){e(this,g(o,f));}});});
