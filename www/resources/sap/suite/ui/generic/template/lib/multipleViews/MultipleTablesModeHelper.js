sap.ui.define(["sap/ui/base/Object","sap/ui/Device","sap/ui/model/Filter","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/genericUtilities/controlStateWrapperFactory","sap/base/util/extend"],function(B,D,F,t,c,e){"use strict";function h(f,H){if(Array.isArray(f)){var o=true;var a;for(var i=0;i<f.length;i++){var b=h(f[i],H);if(o){if(b===f[i]){continue;}o=false;a=f.slice(0,i);}if(b){a.push(b);}}return o?f:a;}if(f.aFilters){var n=h(f.aFilters,H);if(n===f.aFilters){return f;}if(n.length===0){return null;}if(n.length===1){return n[0];}return new F({filters:n,and:f.bAnd});}return H(f);}function g(C,T,o){var s;var a=T.oComponentUtils.getTemplatePrivateModel();var p=o.pathInTemplatePrivateModel+'/implementingHelper';var I=p+"/ignoredFilters";a.setProperty(p,{ignoredFilters:[]});function G(i,j){return i;}function f(){var i;for(var j in s){var V=s[j];var L=V.smartControl.getEntitySet();if(i&&i!==L){return true;}i=L;}return false;}function b(i,V,j,L){if(j&&L){r(i,j);}var M=o.smartFilterBar;if(!M){return i;}var N=M.getFilters();if(N.length<1){if(!L){a.setProperty(I,[]);V.implementingHelperAttributes.ignoredLabels=[];}return i;}var P=!L&&Object.create(null);N=k(V,N,P);return N.concat(i);}function d(P){var i,j;if(P.indexOf("/")!==-1){i=P.split("/");j=i.pop();}else{j=P;}return j;}function k(V,i,j){var L=V.smartControl;var M=L.getModel().getMetaModel();var N=T.oCommonUtils.getMetaModelEntityType(L);var P=N.navigationProperty;var Q=function(Y){var Z=Y.sPath;var $=false;var _=d(Z);var a1=l(Z,L,M,N,P,V);a1.some(function(b1){var c1;if(b1.name===_){c1=b1["com.sap.vocabularies.UI.v1.Hidden"];$=c1?c1.Bool!=="true":true;return $;}return false;});if($){return Y;}if(j){j[Z]=true;}return null;};var U=h(i,Q);if(j){var W=Object.keys(j);var X=W.map(function(Y){var Z=u(Y,V.smartControl);return Z["sap:label"]||(Z["com.sap.vocabularies.Common.v1.Label"]?Z["com.sap.vocabularies.Common.v1.Label"].String:Z.name);});a.setProperty(I,X);V.implementingHelperAttributes.ignoredLabels=X;}return U;}function l(P,L,M,N,Q,V){var U,W,X,Y,Z;if(P.indexOf("/")!==-1){U=P.split("/");for(var i=0;i<U.length-1;i++){W=U[i];for(var j in Q){if(Q[j].name===W){X=true;break;}}if(!X){return[];}Y=M.getODataAssociationEnd(N,W);N=Y&&M.getODataEntityType(Y.type);Q=N&&N.navigationProperty;}Z=N&&N.property;}else{Z=V.implementingHelperAttributes.entityTypeProperty;}return Z;}function r(L,M){for(var i in M){var N=M[i];for(var j=L.length;j--;j>=0){if(JSON.stringify(L[j])===JSON.stringify(N)){L.splice(j,1);break;}}}}function m(V){var i=T.oCommonUtils.getMetaModelEntityType(V.smartControl);return{entityTypeProperty:i.property,dirtyState:0,activeObjectEnabled:false,controlStateWrapper:c.getControlStateWrapper(V.smartControl)};}function n(i,R,j){s=i;for(var L in s){var V=s[L];V.implementingHelperAttributes=m(V);V.implementingHelperAttributes.controlStateWrapper.attachStateChanged(o.appStateChange);}if(o.smartFilterBar){o.smartFilterBar.attachSearch(function(N){R(3);});}if(o.pathToActiveObjectEnabled){var M=a.bindProperty(o.pathToActiveObjectEnabled);M.attachChange(function(N){var P=j();P.implementingHelperAttributes.activeObjectEnabled=a.getProperty(o.pathToActiveObjectEnabled);});}}function q(i,j){if(!j){return"";}var L="";var M=s[j].text;if(i&&i.length>0){if((D.system.tablet||D.system.phone)&&!D.system.desktop){if(i.length>1){L=T.oCommonUtils.getText("MESSAGE_MULTIPLE_VALUES_S_FORM",[i.join(", "),M]);}else{L=T.oCommonUtils.getText("MESSAGE_SINGLE_VALUE_S_FORM",[i[0],M]);}}else if(i.length>1){L=T.oCommonUtils.getText("MESSAGE_MULTIPLE_VALUES_L_FORM",[i.join(", "),M]);}else{L=T.oCommonUtils.getText("MESSAGE_SINGLE_VALUE_L_FORM",[i[0],M]);}}return L;}function u(P,i){var U;var j=w(i);for(var L in j){U=v(j[L],P);if(U){break;}}return U;}function v(i,P){return i.filter(function(j){return j.name===P;})[0];}function w(i){var P=[];for(var j in s){var V=s[j];if(V.smartControl!==i){P.push(V.implementingHelperAttributes.entityTypeProperty);}}return P;}function O(N){var V=s[N];var i=V.implementingHelperAttributes.ignoredLabels||[];a.setProperty(I,i);if(o.pathToActiveObjectEnabled){a.setProperty(o.pathToActiveObjectEnabled,V.implementingHelperAttributes.activeObjectEnabled);}}function x(i){var j,V;if(i.controlStates){for(var L in s){s[L].implementingHelperAttributes.controlStateWrapper.setState(i.controlStates&&i.controlStates[s[L].smartControl.getId()]);}}else{for(var L in s){j=s[L].smartControl;V=i.tableVariantIds[j.getId()];if(V){j.setCurrentVariantId(V);}}}if(o.pathToActiveObjectEnabled&&i.mEditButtonState){for(var M in s){s[M].implementingHelperAttributes.activeObjectEnabled=!!i.mEditButtonState[M];}}O(i.selectedTab);return i.selectedTab;}function y(i){var j,L,M=Object.create(null);for(j in s){L=s[j].smartControl;M[L.getId()]=s[j].implementingHelperAttributes.controlStateWrapper.getState();}var N={selectedTab:i,controlStates:M};if(o.pathToActiveObjectEnabled){var P=Object.create(null);for(var Q in s){P[Q]=s[Q].implementingHelperAttributes.activeObjectEnabled;}N.mEditButtonState=P;}return N;}function R(i,j,L,M,N,P,Q){var U=function(V){if(V===M&&P){Q(i);return;}var W=s[V];if(W.implementingHelperAttributes.dirtyState>0&&W.implementingHelperAttributes.dirtyState!==i){W.implementingHelperAttributes.dirtyState=3;}else{W.implementingHelperAttributes.dirtyState=i;}};if(j){if(N){j.forEach(U);return;}U(j);return;}for(var V in s){if(!L||L[s[V].smartControl.getEntitySet()]){U(V);}}}function z(){return"multi";}function A(N){var V=s[N];var M=V.implementingHelperAttributes.dirtyState;V.implementingHelperAttributes.dirtyState=0;return M;}function S(V){var i=V.smartControl;var a=T.oComponentUtils.getTemplatePrivateModel();var j=E(i);var L=JSON.parse(j.getValue());if(j){i.removeCustomData(j);}i.addCustomData(new sap.ui.core.CustomData({"key":"activeButtonTableState","value":!L}));a.setProperty("/listReport/activeObjectEnabled",!L);}function E(i){var j;var L=i.getCustomData();for(var M=0;M<L.length;M++){if(L[M].getKey()&&L[M].getKey()==="activeButtonTableState"){j=L[M];break;}}return j;}function H(V){var i=V.smartControl;var a=T.oComponentUtils.getTemplatePrivateModel();var j=a.getProperty("/listReport/activeObjectEnabled");var L=E(i);if(L){i.removeCustomData(L);}i.addCustomData(new sap.ui.core.CustomData({"key":"activeButtonTableState","value":j}));}function J(i,j,P){for(var L in s){var M=s[L].smartControl;if((j||P)&&M.getTable){M.setCurrentVariantId(j||P);}else if((i||P)&&M.getChart){M.setCurrentVariantId(i||P);}}}function K(i){var j=i.getEntitySet();for(var L in s){var V=s[L];var M=V.smartControl;if(M!==i&&M.getEntitySet()===j&&V.implementingHelperAttributes.dirtyState<2){V.implementingHelperAttributes.dirtyState+=2;}}}var k=t.testable(k,"fnCleanupIrrelevantFilters");return{init:n,getCustomDataHost:G,getDefaultShowCounts:f,getFiltersAdaptedFromItem:b,formatMessageStrip:q,onSelectedKeyChanged:O,getContentForIappState:y,getSelectedKeyAndRestoreFromIappState:x,refreshOperation:R,getMode:z,getRefreshMode:A,setActiveButtonState:S,restoreActiveButtonState:H,getActiveButtonStateCustomData:E,setControlVariant:J,refreshSiblingControls:K};}return B.extend("sap.suite.ui.generic.template.lib.multipleViews.MultipleTablesModeHelper",{constructor:function(C,T,o){e(this,g(C,T,o));}});});
