sap.ui.define(["sap/base/util/extend","sap/base/util/deepExtend","sap/ui/model/odata/AnnotationHelper","sap/suite/ui/generic/template/js/StableIdHelper","sap/suite/ui/generic/template/js/staticChecksHelper","sap/suite/ui/generic/template/js/preparationHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger"],function(e,d,A,S,s,p,F){"use strict";var l=new F("ObjectPage.Component").getLogger();function g(c,m,o,D,L){function G(i,K){var R=e({},K);switch(i){case"com.sap.vocabularies.UI.v1.ReferenceFacet":if(!R["com.sap.vocabularies.UI.v1.PartOfPreview"]||R["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool!=="false"){R["com.sap.vocabularies.UI.v1.PartOfPreview"]={Bool:"true"};}break;default:break;}return R;}function f(R){if(!R.getObject().Target){return undefined;}var i=A.resolvePath(m.getContext(R.sPath+"/Target"));return i&&m.getContext(i).getObject();}function E(i){i.subSections=i.subSections||[];if(i.subSections.find(function(K){return i.additionalData.facetId===K.additionalData.facetId;})){return;}var K=e({},i);delete K.subSections;K.blocks=[];i.subSections.push(K);}var M=0;function a(K,O,Q,R){var T=[];var U=["sections","subSections","blocks"];Q=Q||0;var V=m.getObject(K);if(!Array.isArray(V)){return[];}V.forEach(function(W,i){var X={additionalData:{facetId:S.getStableId({type:"ObjectPage",subType:"Facet",sRecordType:W.RecordType,bIsHeaderFacet:O,sAnnotationPath:W.Target&&W.Target.AnnotationPath,sAnnotationId:W.ID&&W.ID.String})},temporaryData:{},annotations:{Facet:{annotation:d({},W)}},metaModelPath:K+"/"+i};X.facetIdAsObject={id:X.additionalData.facetId};X.fallbackIdByEnumerationForRuntime=X.additionalData.facetId||"missingStableId#"+M++;if(W.RecordType==="com.sap.vocabularies.UI.v1.CollectionFacet"){var Y=a(K+"/"+i+"/Facets",O,Q+1,X);if(Q===0&&!X.subSections&&Y.length===0){E(X);}else{var Z=U[Q+1]||"unsupportedNestingLevel";X[Z]=X[Z]||[];X[Z]=X[Z].concat(Y);}}else if(W.RecordType==="com.sap.vocabularies.UI.v1.ReferenceFacet"){X.fallbackIdByAnnotationPathForManifest=S.getStableId({type:"ObjectPage",subType:"Facet",sRecordType:W.RecordType,bIsHeaderFacet:O,sAnnotationPath:W.Target&&W.Target.AnnotationPath});X.annotations.Facet.annotation=G("com.sap.vocabularies.UI.v1.ReferenceFacet",W);var $=e({},X);$.targetAnnotation=f(m.getContext(K+"/"+i));var _;switch(Q){case 0:if(W.Target&&!W.Target.AnnotationPath){return;}_=e({},X);_.blocks=[$];X.subSections=[_];break;case 1:E(R);_=R.subSections.find(function(_){return _.additionalData.facetId===R.additionalData.facetId;});_.blocks.push($);return;case 2:X.targetAnnotation=$.targetAnnotation;R.temporaryData.potentiallySeparateForms=true;break;default:l.warning("UnSupported Nesting of Collectionfacets");break;}}else{l.warning("UnSupported Facet annotation record type: "+W.RecordType);return;}T.push(X);});return T;}var t={};function b(i,K){if(!t[i.entityType]){t[i.entityType]=p.getTargetEntityForQuickView(m,i);}}b(m.getODataEntitySet(L));function h(i){i.multiSelect=i.multiSelect||i.allTableMultiSelect;var T=A.gotoEntitySet(m.getContext(i.metaModelPath+"/Target"));var K=T&&m.getObject(T).name||L;var O=c.getControllerExtensions();var Q=O&&O.Sections&&O.Sections[i.additionalData.facetId]&&O.Sections[i.additionalData.facetId].Actions;var R=p.getNormalizedTableSettings(m,i,D,K,Q,i.targetAnnotation);R.variantManagement=!!(i.tableSettings&&i.tableSettings.variantManagement);if(R.onlyForDelete){R.mode=c.isDraftEnabled()?"{= ${ui>/editable} ? '"+R.mode+"' : 'None'}":"{= ${ui>/editable} ? 'None' : '"+R.mode+"'}";}var U=m.getODataEntitySet(K);if(R&&R.createWithParameterDialog&&R.createWithParameterDialog.fields){s.checkErrorforCreateWithDialog(m.getODataEntityType(U.entityType),R);R.createWithParameterDialog.id=S.getStableId({type:'ObjectPageAction',subType:'CreateWithDialog',sFacet:i.additionalData.facetId});}b(U);return R;}function j(i){return{variantManagement:!!(i.chartSettings&&i.chartSettings.variantManagement),chartTitle:i.targetAnnotation&&i.targetAnnotation.Title};}function I(i){return i.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||i.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation";}function n(T){return!T.apply(this,Array.prototype.slice.apply(arguments,[1]));}function N(i){var K=o.sections&&e({},o.sections[i.additionalData.facetId],o.sections[i.fallbackIdByAnnotationPathForManifest]);e(i,K,i);if(i.targetAnnotation){var O=d({},o,i);switch(i.additionalData.type){case"SmartTable":i.tableSettings=h(O);break;case"SmartChart":i.chartSettings=j(O);break;case"SmartForm":i.temporaryData.content=Array.isArray(i.targetAnnotation)?i.targetAnnotation.filter(n.bind(null,I)):i.targetAnnotation.Data;break;default:break;}}}function k(i){if(i.blocks.length===1&&i.blocks[0].targetAnnotation){var K=i.blocks[0];var O=K.annotations.Facet.annotation.Target.AnnotationPath.split("@")[1].split("#")[0];var Q=i.annotations.Facet.annotation.Label&&i.annotations.Facet.annotation.Label.String;switch(O){case"com.sap.vocabularies.UI.v1.LineItem":return Q!==(K.tableSettings.headerInfo&&K.tableSettings.headerInfo.TypeNamePlural&&K.tableSettings.headerInfo.TypeNamePlural.String);case"com.sap.vocabularies.UI.v1.Chart":return Q!==(K.chartSettings.chartTitle&&K.chartSettings.chartTitle.String);default:return true;}}return true;}function q(i,K){var O={BeforeFacet:{withKey:{section:{type:"ObjectPageSection",subType:"BeforeFacetExtensionSectionWithKey"},subSection:{type:"ObjectPageSection",subType:"BeforeFacetExtensionSubSectionWithKey"}},withoutKey:{section:{type:"ObjectPageSection",subType:"BeforeFacetExtensionSection"},subSection:{type:"ObjectPageSection",subType:"BeforeFacetExtensionSubSection"}}},AfterFacet:{withKey:{section:{type:"ObjectPageSection",subType:"AfterFacetExtensionSectionWithKey"},subSection:{type:"ObjectPageSection",subType:"AfterFacetExtensionSubSectionWithKey"}},withoutKey:{section:{type:"ObjectPageSection",subType:"AfterFacetExtensionSection"},subSection:{type:"ObjectPageSection",subType:"AfterFacetExtensionSubSection"}}}};var Q=O[i][K.sKey?"withKey":"withoutKey"];var R=e({},Q.section);R.sEntitySet=K.sEntitySet;R.sFacet=K.sFacetId;R.sFacetExtensionKey=K.oExtensionDefinition.key||K.sKey;var T=S.getStableId(R);R.type=Q.subSection.type;R.subType=Q.subSection.subType;var U=S.getStableId(R);return{id:T,additionalData:{facetId:K.sFacetId},extensionPointName:K.sExtensionPointName,extensionPointNamePrefix:K.sExtensionPointNamePrefix,subSections:[{id:U,additionalData:{facetId:K.sFacetId},temporaryData:{},extensionPointName:K.sExtensionPointName,extensionPointNamePrefix:K.sExtensionPointNamePrefix,blocks:[]}]};}function r(){var V=c.getViewExtensions()||{};return Object.keys(V).map(function(i){var K=i.split("|");return{sExtensionPointNamePrefix:K[0],sEntitySet:K[1],sFacetId:K[2],sKey:K[3],oExtensionDefinition:V[i],sExtensionPointName:i};}).filter(function(i){return i.sEntitySet===L;});}function u(i){var K=c.getControllerExtensions();return K&&K.Sections&&K.Sections[i]&&K.Sections[i].Actions;}function v(i){var V=r();var R=[];i.forEach(function(K){var O=V.filter(function(T){return T.sFacetId===K.additionalData.facetId&&T.sExtensionPointNamePrefix==="BeforeFacet";});var Q=V.filter(function(T){return T.sFacetId===K.additionalData.facetId&&T.sExtensionPointNamePrefix==="AfterFacet";});R=R.concat(O.map(q.bind(null,"BeforeFacet")));R.push(K);R=R.concat(Q.map(q.bind(null,"AfterFacet")));});return R;}function w(i){var V=r();var K=V.find(function(O){return O.sFacetId===i.additionalData.facetId&&O.sExtensionPointNamePrefix==="SmartFormExtension";});if(K){i.extensionPointName=K.sExtensionPointName;i.extensionPointNamePrefix="SmartFormExtension";i.additionalData.type=i.additionalData.type||"SmartForm";}}function x(i){var T=i.annotations.Facet.annotation.Target&&i.annotations.Facet.annotation.Target.AnnotationPath&&i.annotations.Facet.annotation.Target.AnnotationPath.split("@")[1];T=T&&T.split("#")[0];switch(T){case"com.sap.vocabularies.UI.v1.FieldGroup":case"com.sap.vocabularies.UI.v1.Identification":i.additionalData.type="SmartForm";break;case"com.sap.vocabularies.UI.v1.LineItem":i.additionalData.type="SmartTable";break;case"com.sap.vocabularies.UI.v1.Chart":i.additionalData.type="SmartChart";break;case"com.sap.vocabularies.Communication.v1.Address":i.additionalData.type="Address";break;case"com.sap.vocabularies.Communication.v1.Contact":i.additionalData.type="Contact";break;default:}N(i);w(i);}function y(i){if(i.annotations.Facet.annotation.RecordType!=="com.sap.vocabularies.UI.v1.ReferenceFacet"){return false;}switch(i.additionalData.type){case"SmartForm":if(i.extensionPointName){return true;}if(!i.targetAnnotation||!i.temporaryData.content){return false;}return i.temporaryData.content.find(function(K){return(K.RecordType!=="com.sap.vocabularies.UI.v1.DataFieldForAction"&&K.RecordType!=="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation");});case"SmartTable":case"SmartChart":return i.targetAnnotation||A.isMultiple(m.getContext(i.metaModelPath+"/Target"));default:return i.targetAnnotation;}}function P(i){return i.additionalData.type==="SmartForm";}function z(i){N(i);i.blocks.forEach(x);i.actions=[];i.blocks.forEach(function(Q){if(Q.additionalData.type==="SmartForm"){var R=u(Q.additionalData.facetId);if(R){Object.values(R).forEach(function(V){i.actions.push({id:S.getStableId({type:"ObjectPageAction",subType:"ExtensionAction",sAction:V.id}),text:V.text,press:V.press});});}}if(!Q.targetAnnotation||!Q.temporaryData.content){return;}var T=A.resolvePath(m.getContext(Q.metaModelPath+"/Target"));var U=T+(Q.targetAnnotation.Data?"/Data/":"/");Q.temporaryData.content.forEach(function(V,W){if(!V||!V.Action||(V.RecordType!=="com.sap.vocabularies.UI.v1.DataFieldForAction"&&V.RecordType!=="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation")){return;}var X=S.getStableId({type:"ObjectPage",subType:"DataField",sRecordType:V.RecordType,sSemanticObject:V.SemanticObject&&(V.SemanticObject.String||V.SemanticObject.Path),sAction:V.Action&&(V.Action.String||V.Action.Path)});var Y="._templateEventHandlers.";if(V.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"){var Z=[];Z.push("'"+A.format(m.getContext(U+W+"/Action"))+"'");Z.push("${$source>/text}");var $=(V.InvocationGrouping&&V.InvocationGrouping.EnumMember)||"";Z.push("'"+$+"'");Y+="onCallAction("+Z.join(", ")+")";}else{Y+="onDataFieldForIntentBasedNavigation";var _={semanticObject:A.format(m.getContext(U+W+"/SemanticObject")),action:A.format(m.getContext(U+W+"/Action"))};}i.actions.push({id:S.getStableId({type:"ObjectPageAction",subType:"AnnotatedAction",sFacet:Q.additionalData.facetId,sDataField:X}),press:Y,semanticObject:_&&_.semanticObject,action:_&&_.action,metaModelPath:U+W});});});i.blocks=i.blocks.filter(y);if(i.temporaryData.potentiallySeparateForms&&!i.blocks.every(P)){i.blocks=i.blocks.map(function(Q){if(P(Q)){return{additionalData:{type:Q.additionalData.type,facetId:Q.additionalData.facetId},metaModelPath:Q.metaModelPath,controlProperties:{id:S.getStableId({type:"ObjectPageSection",subType:"SmartForm",sFacet:Q.additionalData.facetId,sIsPartOfPreview:Q.annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool})},aggregations:{groups:[Q]}};}else{return Q;}});i.moreBlocks=i.blocks.filter(function(Q){if(Q.additionalData.type==="SmartForm"){return Q.aggregations.groups[0].annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="false";}else{return Q.annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="false";}});i.blocks=i.blocks.filter(function(Q){if(Q.additionalData.type==="SmartForm"){return Q.aggregations.groups[0].annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="true";}else{return Q.annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="true";}});}else{var K={additionalData:{type:"SmartForm",facetId:i.additionalData.facetId},controlProperties:{id:S.getStableId({type:"ObjectPageSection",subType:"SmartForm",sFacet:i.additionalData.facetId,sIsPartOfPreview:"true"})},aggregations:{groups:i.blocks.filter(function(Q){return P(Q)&&Q.annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="true";})}};var O={additionalData:{type:"SmartForm",facetId:i.additionalData.facetId},controlProperties:{id:S.getStableId({type:"ObjectPageSection",subType:"SmartForm",sFacet:i.additionalData.facetId,sIsPartOfPreview:"false"})},aggregations:{groups:i.blocks.filter(function(Q){return P(Q)&&Q.annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="false";})}};i.moreBlocks=i.blocks.filter(function(Q){return!P(Q)&&Q.annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="false";});i.blocks=i.blocks.filter(function(Q){return!P(Q)&&Q.annotations.Facet.annotation["com.sap.vocabularies.UI.v1.PartOfPreview"].Bool==="true";});if(K.aggregations.groups.length>0){i.blocks.unshift(K);}if(O.aggregations.groups.length>0){i.moreBlocks.unshift(O);}}i.bShowTitle=k(i);}function B(){return true;}function C(i){N(i);i.subSections.forEach(z);i.subSections=i.subSections.filter(B);}function H(){return true;}function J(){var i=m.getMetaContext("/"+L).getPath();var K=a(i+"/com.sap.vocabularies.UI.v1.Facets",false);var O=v(K);O.forEach(C);return O.filter(H);}return{sections:J(),breadCrumb:c.getBreadCrumbInfo(),isSelflinkRequired:true,isIndicatorRequired:true,isSemanticallyConnected:false,targetEntities:t};}return{getTemplateSpecificParameters:g};});
