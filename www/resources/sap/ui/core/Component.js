/*
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['./Manifest','./ComponentMetadata','./Element','sap/base/util/extend','sap/base/util/deepExtend','sap/base/util/merge','sap/ui/base/ManagedObject','sap/ui/base/ManagedObjectRegistry','sap/ui/core/ResizeHandler','sap/ui/thirdparty/URI','sap/ui/performance/trace/Interaction','sap/base/assert','sap/base/Log','sap/base/util/ObjectPath','sap/base/util/UriParameters','sap/base/util/isPlainObject','sap/base/util/LoaderExtensions','sap/ui/VersionInfo','sap/ui/core/mvc/ViewType'],function(M,C,E,a,d,b,c,f,R,U,I,g,L,O,h,j,l,V,n){"use strict";var S={lazy:"lazy",eager:"eager",waitFor:"waitFor"};function o(e){['sap-client','sap-server'].forEach(function(N){if(!e.hasSearch(N)){var v=sap.ui.getCore().getConfiguration().getSAPParam(N);if(v){e.addSearch(N,v);}}});}function p(D,m,e,i){if(e){for(var N in D){if(!m[N]&&e[N]&&e[N].uri){m[N]=i;}}}}function q(m,e,k,i){var D=e.getEntry(k);if(D!==undefined&&!j(D)){return D;}var P,v;if(i&&(P=m.getParent())instanceof C){v=P.getManifestEntry(k,i);}if(v||D){D=d({},v,D);}return D;}function r(e,i){var k=Object.create(Object.getPrototypeOf(e));k._oMetadata=e;k._oManifest=i;for(var m in e){if(!/^(getManifest|getManifestObject|getManifestEntry|getMetadataVersion)$/.test(m)&&typeof e[m]==="function"){k[m]=e[m].bind(e);}}k.getManifest=function(){return i&&i.getJson();};k.getManifestObject=function(){return i;};k.getManifestEntry=function(K,v){return q(e,i,K,v);};k.getMetadataVersion=function(){return 2;};return k;}function s(e,i,T){g(typeof e==="function","fn must be a function");var k=c._sOwnerId;try{c._sOwnerId=i;return e.call(T);}finally{c._sOwnerId=k;}}var t=c.extend("sap.ui.core.Component",{constructor:function(i,m){var e=Array.prototype.slice.call(arguments);if(typeof i!=="string"){m=i;i=undefined;}if(m&&typeof m._metadataProxy==="object"){this._oMetadataProxy=m._metadataProxy;this._oManifest=m._metadataProxy._oManifest;delete m._metadataProxy;this.getMetadata=function(){return this._oMetadataProxy;};}if(m&&typeof m._cacheTokens==="object"){this._mCacheTokens=m._cacheTokens;delete m._cacheTokens;}if(m&&Array.isArray(m._activeTerminologies)){this._aActiveTerminologies=m._activeTerminologies;delete m._activeTerminologies;}if(m&&typeof m._manifestModels==="object"){this._mManifestModels=m._manifestModels;delete m._manifestModels;}else{this._mManifestModels={};}this._mServices={};this._oKeepAliveConfig=this.getManifestEntry("/sap.ui5/keepAlive");if(this._oKeepAliveConfig){this._oKeepAliveConfig.supported=!!this._oKeepAliveConfig.supported;}this._bIsActive=true;this._aDestroyables=[];c.apply(this,e);},metadata:{stereotype:"component","abstract":true,specialSettings:{componentData:'any'},version:"0.0",includes:[],dependencies:{libs:[],components:[],ui5version:""},config:{},customizing:{},library:"sap.ui.core"}},C);f.apply(t,{onDeregister:function(e){E.registry.forEach(function(i){if(i._sapui_candidateForDestroy&&i._sOwnerId===e&&!i.getParent()){L.debug("destroying dangling template "+i+" when destroying the owner component");i.destroy();}});}});t.prototype.getManifest=function(){if(!this._oManifest){return this.getMetadata().getManifest();}else{return this._oManifest.getJson();}};t.prototype.getManifestEntry=function(k){return this._getManifestEntry(k);};t.prototype._getManifestEntry=function(k,m){if(!this._oManifest){return this.getMetadata().getManifestEntry(k,m);}else{return q(this.getMetadata(),this._oManifest,k,m);}};t.prototype.getManifestObject=function(){if(!this._oManifest){return this.getMetadata().getManifestObject();}else{return this._oManifest;}};t.prototype._isVariant=function(){if(this._oManifest){var e=this.getManifestEntry("/sap.ui5/componentName");return e&&e!==this.getManifestEntry("/sap.app/id");}else{return false;}};t.activateCustomizing=function(e){};t.deactivateCustomizing=function(e){};t.getOwnerIdFor=function(e){g(e instanceof c,"oObject must be given and must be a ManagedObject");var i=(e instanceof c)&&e._sOwnerId;return i||undefined;};t.getOwnerComponentFor=function(e){return t.get(t.getOwnerIdFor(e));};t.prototype.runAsOwner=function(e){if(!this.isActive()){throw new Error("Execute 'runAsOwner' on an inactive owner component is not supported. Component: '"+this.getMetadata().getName()+"' with id '"+this.getId()+"'.");}return s(e,this.getId());};t.prototype.getInterface=function(){return this;};t.prototype._initCompositeSupport=function(m){this.oComponentData=m&&m.componentData;if(this._oManifest){this._oManifest.init(this);}else{this.getMetadata().init();}if(this._isVariant()){var e=this._oManifest.getEntry("/sap.app/id");if(e){y(e,this._oManifest.resolveUri("./","manifest"));}}this.initComponentModels();if(this.onWindowError){this._fnWindowErrorHandler=function(i){var k=i.originalEvent;this.onWindowError(k.message,k.filename,k.lineno);}.bind(this);window.addEventListener("error",this._fnWindowErrorHandler);}if(this.onWindowBeforeUnload){this._fnWindowBeforeUnloadHandler=function(i){var v=this.onWindowBeforeUnload.apply(this,arguments);if(typeof(v)==='string'){i.returnValue=v;i.preventDefault();return v;}}.bind(this);window.addEventListener("beforeunload",this._fnWindowBeforeUnloadHandler);}if(this.onWindowUnload){this._fnWindowUnloadHandler=this.onWindowUnload.bind(this);window.addEventListener("unload",this._fnWindowUnloadHandler);}};t.prototype._getDestroyables=function(){if(!this._aDestroyables){L.error("Mandatory super constructor not called for Component: '"+this.getManifestObject().getComponentName()+"'.",null,"sap.ui.support",function(){return{type:"missingSuperConstructor"};});this._aDestroyables=[];}return this._aDestroyables;};t.prototype.destroy=function(){for(var e in this._mServices){if(this._mServices[e].instance){this._mServices[e].instance.destroy();}}delete this._mServices;for(var m in this._mManifestModels){this._mManifestModels[m].destroy();}delete this._mManifestModels;if(this._fnWindowErrorHandler){window.removeEventListener("error",this._fnWindowErrorHandler);delete this._fnWindowErrorHandler;}if(this._fnWindowBeforeUnloadHandler){window.removeEventListener("beforeunload",this._fnWindowBeforeUnloadHandler);delete this._fnWindowBeforeUnloadHandler;}if(this._fnWindowUnloadHandler){window.removeEventListener("unload",this._fnWindowUnloadHandler);delete this._fnWindowUnloadHandler;}if(this._oEventBus){this._oEventBus.destroy();delete this._oEventBus;}function D(v){if(v&&!v._bIsBeingDestroyed){v.destroy();}}var k=this._getDestroyables();for(var i=0;i<k.length;i++){k[i]=k[i].then(D);}c.prototype.destroy.apply(this,arguments);sap.ui.getCore().getMessageManager().unregisterObject(this);if(this._oManifest){this._oManifest.exit(this);delete this._oManifest;}else{this.getMetadata().exit();}return Promise.all(k);};t.prototype.getComponentData=function(){return this.oComponentData;};t.prototype.getEventBus=function(){if(!this._oEventBus){var e=this.getMetadata().getName();L.warning("Synchronous loading of EventBus, due to #getEventBus() call on Component '"+e+"'.","SyncXHR",null,function(){return{type:"SyncXHR",name:e};});var i=sap.ui.requireSync("sap/ui/core/EventBus");this._oEventBus=new i();if(!this.isActive()){this._oEventBus.suspend();}}return this._oEventBus;};t.prototype.isActive=function(){return this._bIsActive;};t.prototype.initComponentModels=function(){var m=this.getMetadata();if(m.isBaseClass()){return;}var e=this._getManifestEntry("/sap.app/dataSources",true)||{};var i=this._getManifestEntry("/sap.ui5/models",true)||{};this._initComponentModels(i,e,this._mCacheTokens);};t.prototype._initComponentModels=function(m,D,e){var i=t._createManifestModelConfigurations({models:m,dataSources:D,component:this,mergeParent:true,cacheTokens:e,activeTerminologies:this.getActiveTerminologies()}),k={},v;if(!i){return;}for(v in i){if(!this._mManifestModels[v]){k[v]=i[v];}}var F=t._createManifestModels(k,this.toString());for(v in F){this._mManifestModels[v]=F[v];}for(v in this._mManifestModels){var G=this._mManifestModels[v];this.setModel(G,v||undefined);}};t.prototype.getService=function(e){if(!this._mServices[e]){this._mServices[e]={};this._mServices[e].promise=new Promise(function(i,k){sap.ui.require(["sap/ui/core/service/ServiceFactoryRegistry"],function(m){var v=this._getManifestEntry("/sap.ui5/services/"+e,true);var D=v&&v.factoryName;if(!D){k(new Error("Service "+e+" not declared!"));return;}var F=m.get(D);if(F){F.createInstance({scopeObject:this,scopeType:"component",settings:v.settings||{}}).then(function(J){if(!this.bIsDestroyed){this._mServices[e].instance=J;this._mServices[e].interface=J.getInterface();i(this._mServices[e].interface);}else{k(new Error("Service "+e+" could not be loaded as its Component was destroyed."));}}.bind(this)).catch(k);}else{var G="The ServiceFactory "+D+" for Service "+e+" not found in ServiceFactoryRegistry!";var H=this._getManifestEntry("/sap.ui5/services/"+e+"/optional",true);if(!H){L.error(G);}k(new Error(G));}}.bind(this),k);}.bind(this));}return this._mServices[e].promise;};function u(e,i){var k=e._getManifestEntry("/sap.ui5/services",true);var m=i?[]:null;if(!k){return m;}var v=Object.keys(k);if(!i&&v.some(function(D){return k[D].startup===S.waitFor;})){throw new Error("The specified component \""+e.getMetadata().getName()+"\" cannot be loaded in sync mode since it has some services declared with \"startup\" set to \"waitFor\"");}return v.reduce(function(P,D){if(k[D].lazy===false||k[D].startup===S.waitFor||k[D].startup===S.eager){var F=e.getService(D);if(k[D].startup===S.waitFor){P.push(F);}}return P;},m);}t.prototype.createComponent=function(v){g((typeof v==='string'&&v)||(typeof v==='object'&&typeof v.usage==='string'&&v.usage),"vUsage either must be a non-empty string or an object with a non-empty usage id");var m={async:true};if(v){var e;if(typeof v==="object"){e=v.usage;["id","async","settings","componentData"].forEach(function(N){if(v[N]!==undefined){m[N]=v[N];}});}else if(typeof v==="string"){e=v;}m=this._enhanceWithUsageConfig(e,m);}var i=t._createComponent(m,this);if(i instanceof Promise){this.registerForDestroy(i);}return i;};t.prototype._enhanceWithUsageConfig=function(e,m){var i=this.getManifestEntry("/sap.ui5/componentUsages/"+e);if(!i){throw new Error("Component usage \""+e+"\" not declared in Component \""+this.getManifestObject().getComponentName()+"\"!");}if(i.activeTerminologies){throw new Error("Terminologies vector can't be used in component usages");}return d(i,m);};t.prototype.getActiveTerminologies=function(){return this._aActiveTerminologies?this._aActiveTerminologies.slice():undefined;};t._createComponent=function(m,e){function i(){if(m.async===true){return t.create(m);}else{return sap.ui.component(m);}}if(e){if(!e.isActive()){throw new Error("Creation of component '"+m.name+"' is not possible due to inactive owner component '"+e.getId()+"'");}return e.runAsOwner(i);}else{return i();}};t._applyCacheToken=function(e,i,m){var k=sap.ui.getCore().getConfiguration();var v=m?"Model":"DataSource";var D=m?"[\"sap.ui5\"][\"models\"]":"[\"sap.app\"][\"dataSources\"]";var F=m&&m["sap-language"]||e.search(true)["sap-language"];var G=m&&m["sap-client"]||e.search(true)["sap-client"];if(!F){L.warning("Component Manifest: Ignoring provided \"sap-context-token="+i.cacheToken+"\" for "+v+" \""+i.dataSource+"\" ("+e.toString()+"). "+"Missing \"sap-language\" URI parameter",D+"[\""+i.dataSource+"\"]",i.componentName);return;}if(!G){L.warning("Component Manifest: Ignoring provided \"sap-context-token="+i.cacheToken+"\" for "+v+" \""+i.dataSource+"\" ("+e.toString()+"). "+"Missing \"sap-client\" URI parameter",D+"[\""+i.dataSource+"\"]",i.componentName);return;}if(G!==k.getSAPParam("sap-client")){L.warning("Component Manifest: Ignoring provided \"sap-context-token="+i.cacheToken+"\" for "+v+" \""+i.dataSource+"\" ("+e.toString()+"). "+"URI parameter \"sap-client="+G+"\" must be identical with configuration \"sap-client="+k.getSAPParam("sap-client")+"\"",D+"[\""+i.dataSource+"\"]",i.componentName);return;}if(e.hasQuery("sap-context-token")&&!e.hasQuery("sap-context-token",i.cacheToken)||m&&m["sap-context-token"]&&m["sap-context-token"]!==i.cacheToken){L.warning("Component Manifest: Overriding existing \"sap-context-token="+(e.query(true)["sap-context-token"]||m["sap-context-token"])+"\" with provided value \""+i.cacheToken+"\" for "+v+" \""+i.dataSource+"\" ("+e.toString()+").",D+"[\""+i.dataSource+"\"]",i.componentName);}if(m){if(e.hasQuery("sap-context-token")){L.warning("Component Manifest: Move existing \"sap-context-token="+e.query(true)["sap-context-token"]+"\" to metadataUrlParams for "+v+" \""+i.dataSource+"\" ("+e.toString()+").",D+"[\""+i.dataSource+"\"]",i.componentName);}e.removeQuery("sap-context-token");m["sap-context-token"]=i.cacheToken;}else{e.setQuery("sap-context-token",i.cacheToken);}};t._createManifestModelConfigurations=function(m){var e=m.component;var v=m.manifest||e.getManifestObject();var D=m.mergeParent;var F=m.cacheTokens||{};var G=e?e.toString():v.getComponentName();var H=sap.ui.getCore().getConfiguration();var J=m.activeTerminologies;if(!m.models){return null;}var K={models:m.models,dataSources:m.dataSources||{},origin:{dataSources:{},models:{}}};if(e&&D){var N=e.getMetadata();while(N instanceof C){var P=N.getManifestObject();var Q=N.getManifestEntry("/sap.app/dataSources");p(K.dataSources,K.origin.dataSources,Q,P);var T=N.getManifestEntry("/sap.ui5/models");p(K.models,K.origin.models,T,P);N=N.getParent();}}var W={};for(var X in K.models){var Y=K.models[X];var Z=false;var $=null;if(typeof Y==='string'){Y={dataSource:Y};}if(Y.dataSource){var a1=K.dataSources&&K.dataSources[Y.dataSource];if(typeof a1==='object'){if(a1.type===undefined){a1.type='OData';}var b1;if(!Y.type){switch(a1.type){case'OData':b1=a1.settings&&a1.settings.odataVersion;if(b1==="4.0"){Y.type='sap.ui.model.odata.v4.ODataModel';}else if(!b1||b1==="2.0"){Y.type='sap.ui.model.odata.v2.ODataModel';}else{L.error('Component Manifest: Provided OData version "'+b1+'" in '+'dataSource "'+Y.dataSource+'" for model "'+X+'" is unknown. '+'Falling back to default model type "sap.ui.model.odata.v2.ODataModel".','["sap.app"]["dataSources"]["'+Y.dataSource+'"]',G);Y.type='sap.ui.model.odata.v2.ODataModel';}break;case'JSON':Y.type='sap.ui.model.json.JSONModel';break;case'XML':Y.type='sap.ui.model.xml.XMLModel';break;default:}}if(Y.type==='sap.ui.model.odata.v4.ODataModel'&&a1.settings&&a1.settings.odataVersion){Y.settings=Y.settings||{};Y.settings.odataVersion=a1.settings.odataVersion;}if(!Y.uri){Y.uri=a1.uri;Z=true;}if(a1.type==='OData'&&a1.settings&&typeof a1.settings.maxAge==="number"){Y.settings=Y.settings||{};Y.settings.headers=Y.settings.headers||{};Y.settings.headers["Cache-Control"]="max-age="+a1.settings.maxAge;}if(a1.type==='OData'&&a1.settings&&a1.settings.annotations){var c1=a1.settings.annotations;for(var i=0;i<c1.length;i++){var d1=c1[i];var e1=K.dataSources[d1];if(!e1){L.error("Component Manifest: ODataAnnotation \""+d1+"\" for dataSource \""+Y.dataSource+"\" could not be found in manifest","[\"sap.app\"][\"dataSources\"][\""+d1+"\"]",G);continue;}if(e1.type!=='ODataAnnotation'){L.error("Component Manifest: dataSource \""+d1+"\" was expected to have type \"ODataAnnotation\" but was \""+e1.type+"\"","[\"sap.app\"][\"dataSources\"][\""+d1+"\"]",G);continue;}if(!e1.uri){L.error("Component Manifest: Missing \"uri\" for ODataAnnotation \""+d1+"\"","[\"sap.app\"][\"dataSources\"][\""+d1+"\"]",G);continue;}var f1=new U(e1.uri);if(Y.type==='sap.ui.model.odata.v2.ODataModel'||Y.type==='sap.ui.model.odata.v4.ODataModel'){var g1=F.dataSources&&F.dataSources[e1.uri];if(g1||Y.type==='sap.ui.model.odata.v2.ODataModel'){["sap-language","sap-client"].forEach(function(u1){if(!f1.hasQuery(u1)&&H.getSAPParam(u1)){f1.setQuery(u1,H.getSAPParam(u1));}});}if(g1){t._applyCacheToken(f1,{cacheToken:g1,componentName:G,dataSource:d1});}}var h1=K.origin.dataSources[c1[i]]||v;var i1=h1._resolveUri(f1).toString();Y.settings=Y.settings||{};Y.settings.annotationURI=Y.settings.annotationURI||[];Y.settings.annotationURI.push(i1);}}}else{L.error("Component Manifest: dataSource \""+Y.dataSource+"\" for model \""+X+"\" not found or invalid","[\"sap.app\"][\"dataSources\"][\""+Y.dataSource+"\"]",G);continue;}}if(!Y.type){L.error("Component Manifest: Missing \"type\" for model \""+X+"\"","[\"sap.ui5\"][\"models\"][\""+X+"\"]",G);continue;}if(Y.type==='sap.ui.model.odata.ODataModel'&&(!Y.settings||Y.settings.json===undefined)){Y.settings=Y.settings||{};Y.settings.json=true;}if(Y.type==="sap.ui.model.resource.ResourceModel"){if(Y.uri&&Y.settings&&Y.settings.bundleUrl){L.warning("Defining both model uri and bundleUrl is not supported. Only model uri will be resolved.");}if(!Y.uri&&Y.settings&&Y.settings.terminologies){if(Y.bundleUrl||Y.settings.bundleUrl){Y.uri=Y.bundleUrl||Y.settings.bundleUrl;delete Y.settings.bundleUrl;}}}if(Y.uri){var j1=new U(Y.uri);var k1=(Z?K.origin.dataSources[Y.dataSource]:K.origin.models[X])||v;j1=k1._resolveUri(j1);if(Y.dataSource){o(j1);if(Y.type==='sap.ui.model.odata.v2.ODataModel'||Y.type==='sap.ui.model.odata.v4.ODataModel'){var l1=K.dataSources&&K.dataSources[Y.dataSource];var m1=F.dataSources&&F.dataSources[l1.uri];$=Y.settings&&Y.settings.metadataUrlParams;var n1=(!$||typeof $['sap-language']==='undefined')&&!j1.hasQuery('sap-language')&&H.getSAPParam('sap-language');if((n1&&Y.type==='sap.ui.model.odata.v2.ODataModel')||m1){Y.settings=Y.settings||{};$=Y.settings.metadataUrlParams=Y.settings.metadataUrlParams||{};if(n1){$['sap-language']=H.getSAPParam('sap-language');}}if(m1){t._applyCacheToken(j1,{cacheToken:m1,componentName:G,dataSource:X},$);}}}Y.uri=j1.toString();}if(Y.uriSettingName===undefined){switch(Y.type){case'sap.ui.model.odata.ODataModel':case'sap.ui.model.odata.v2.ODataModel':case'sap.ui.model.odata.v4.ODataModel':Y.uriSettingName='serviceUrl';break;case'sap.ui.model.resource.ResourceModel':Y.uriSettingName='bundleUrl';break;default:}}var o1;var p1;if(e){p1=e.getComponentData();}else{p1=m.componentData;}o1=p1&&p1.startupParameters&&p1.startupParameters["sap-system"];if(!o1){o1=H.getSAPParam("sap-system");}var q1=false;var r1;if(o1&&["sap.ui.model.odata.ODataModel","sap.ui.model.odata.v2.ODataModel"].indexOf(Y.type)!=-1){q1=true;r1=sap.ui.requireSync("sap/ui/model/odata/ODataUtils");}if(Y.uri){if(q1){Y.preOriginBaseUri=Y.uri.split("?")[0];Y.uri=r1.setOrigin(Y.uri,{alias:o1});Y.postOriginBaseUri=Y.uri.split("?")[0];}if(Y.uriSettingName!==undefined){Y.settings=Y.settings||{};if(!Y.settings[Y.uriSettingName]){Y.settings[Y.uriSettingName]=Y.uri;}}else if(Y.settings){Y.settings=[Y.uri,Y.settings];}else{Y.settings=[Y.uri];}}else if(q1&&Y.uriSettingName!==undefined&&Y.settings&&Y.settings[Y.uriSettingName]){Y.preOriginBaseUri=Y.settings[Y.uriSettingName].split("?")[0];Y.settings[Y.uriSettingName]=r1.setOrigin(Y.settings[Y.uriSettingName],{alias:o1});Y.postOriginUri=Y.settings[Y.uriSettingName].split("?")[0];}if(q1&&Y.settings&&Y.settings.annotationURI){var s1=[].concat(Y.settings.annotationURI);var t1=[];for(var k=0;k<s1.length;k++){t1.push(r1.setAnnotationOrigin(s1[k],{alias:o1,preOriginBaseUri:Y.preOriginBaseUri,postOriginBaseUri:Y.postOriginBaseUri}));}Y.settings.annotationURI=t1;}if(Y.type==='sap.ui.model.resource.ResourceModel'&&Y.settings){if(J){Y.settings.activeTerminologies=J;}v._processResourceConfiguration(Y.settings,undefined,true);}if(Y.settings&&!Array.isArray(Y.settings)){Y.settings=[Y.settings];}W[X]=Y;}if(v.getEntry("/sap.ui5/commands")||(e&&e._getManifestEntry("/sap.ui5/commands",true))){W["$cmd"]={type:'sap.ui.model.json.JSONModel'};}return W;};t._createManifestModels=function(m,e){var i={};for(var k in m){var v=m[k];try{sap.ui.requireSync(v.type.replace(/\./g,"/"));}catch(D){L.error("Component Manifest: Class \""+v.type+"\" for model \""+k+"\" could not be loaded. "+D,"[\"sap.ui5\"][\"models\"][\""+k+"\"]",e);continue;}var F=O.get(v.type);if(!F){L.error("Component Manifest: Class \""+v.type+"\" for model \""+k+"\" could not be found","[\"sap.ui5\"][\"models\"][\""+k+"\"]",e);continue;}var G=[null].concat(v.settings||[]);var H=F.bind.apply(F,G);var J=new H();i[k]=J;}return i;};function w(m,e,i,k){var v={afterManifest:{},afterPreload:{}};var D=b({},m.getEntry("/sap.app/dataSources"));var F=b({},m.getEntry("/sap.ui5/models"));var G=t._createManifestModelConfigurations({models:F,dataSources:D,manifest:m,componentData:e,cacheTokens:i,activeTerminologies:k});var P=h.fromQuery(window.location.search).get("sap-ui-xx-preload-component-models-"+m.getComponentName());var H=P&&P.split(",");for(var J in G){var K=G[J];if(!K.preload&&H&&H.indexOf(J)>-1){K.preload=true;L.warning("FOR TESTING ONLY!!! Activating preload for model \""+J+"\" ("+K.type+")",m.getComponentName(),"sap.ui.core.Component");}if(K.type==="sap.ui.model.resource.ResourceModel"&&Array.isArray(K.settings)&&K.settings.length>0&&K.settings[0].async!==true){v.afterPreload[J]=K;}else if(K.preload){if(sap.ui.loader._.getModuleState(K.type.replace(/\./g,"/")+".js")){v.afterManifest[J]=K;}else{L.warning("Can not preload model \""+J+"\" as required class has not been loaded: \""+K.type+"\"",m.getComponentName(),"sap.ui.core.Component");}}}return v;}function x(e){return sap.ui.require.toUrl(e.replace(/\./g,"/")+"/manifest.json");}function y(m,v){l.registerResourcePath(m.replace(/\./g,"/"),v);}function z(e){var m=[];var k=[];function v(i){if(!i._oManifest){var N=i.getComponentName();var D=x(N);var F=l.loadResource({url:D,dataType:"json",async:true}).catch(function(G){L.error("Failed to load component manifest from \""+D+"\" (component "+N+")! Reason: "+G);return{};});m.push(F);k.push(i);}var P=i.getParent();if(P&&(P instanceof C)&&!P.isBaseClass()){v(P);}}v(e);return Promise.all(m).then(function(D){for(var i=0;i<D.length;i++){if(D[i]){k[i]._applyManifest(D[i]);}}});}t._fnLoadComponentCallback=null;var _=[];Object.defineProperty(t,"_fnOnInstanceCreated",{get:function(){return _[0];},set:function(e){if(typeof e==="function"){_.push(e);}else{_=[];}}});t._fnPreprocessManifest=null;t.create=function(m){if(m==null||typeof m!=="object"){throw new TypeError("Component.create() must be called with a configuration object.");}var P=b({},m);P.async=true;if(P.manifest===undefined){P.manifest=true;}return A(P);};sap.ui.component=function(v){if(!v){throw new Error("sap.ui.component cannot be called without parameter!");}var e=function(i){return{type:"sap.ui.component",name:i};};if(typeof v==='string'){L.warning("Do not use deprecated function 'sap.ui.component' ("+v+") + for Component instance lookup. "+"Use 'Component.get' instead","sap.ui.component",null,e.bind(null,v));return sap.ui.getCore().getComponent(v);}if(v.async){L.info("Do not use deprecated factory function 'sap.ui.component' ("+v["name"]+"). "+"Use 'Component.create' instead","sap.ui.component",null,e.bind(null,v["name"]));}else{L.warning("Do not use synchronous component creation ("+v["name"]+")! "+"Use the new asynchronous factory 'Component.create' instead","sap.ui.component",null,e.bind(null,v["name"]));}return A(v,true);};function A(v,e){var i=t.get(c._sOwnerId);var k=v.activeTerminologies||(i&&i.getActiveTerminologies())||sap.ui.getCore().getConfiguration().getActiveTerminologies();if(!v.asyncHints||!v.asyncHints.cacheTokens){var m=i&&i._mCacheTokens;if(typeof m==="object"){v.asyncHints=v.asyncHints||{};v.asyncHints.cacheTokens=m;}}function D(K,v){return _.map(function(N){return N(K,v);});}function F(K,v){if(v.async){var N=K.rootControlLoaded?K.rootControlLoaded():Promise.resolve();var P=D(K,v);P.push(N);return Promise.all(P);}else{D(K,v);}return K;}function G(K){if(e&&K.getMetadata().isA("sap.ui.core.IAsyncContentCreation")){throw new Error("Do not use deprecated factory function 'sap.ui.component' in combination with IAsyncContentCreation ("+v["name"]+"). "+"Use 'Component.create' instead");}var N=v.name,P=v.id,Q=v.componentData,T=N+'.Component',W=v.settings;var X=new K(a({},W,{id:P,componentData:Q,_cacheTokens:v.asyncHints&&v.asyncHints.cacheTokens,_activeTerminologies:k}));g(X instanceof t,"The specified component \""+T+"\" must be an instance of sap.ui.core.Component!");L.info("Component instance Id = "+X.getId());var Y=X.getMetadata().handleValidation()!==undefined||v.handleValidation;if(Y){if(X.getMetadata().handleValidation()!==undefined){Y=X.getMetadata().handleValidation();}else{Y=v.handleValidation;}sap.ui.getCore().getMessageManager().registerObject(X,Y);}var Z=u(X,v.async);if(v.async){return F(X,v).then(function(){return Promise.all(Z);}).then(function(){return X;});}else{return F(X,v);}}var H=B(v,{failOnError:true,createModels:true,waitFor:v.asyncHints&&v.asyncHints.waitFor,activeTerminologies:k});if(v.async){var J=c._sOwnerId;return H.then(function(K){var N=function(P){var Q=P.getParent();var T=Promise.resolve();if(Q instanceof C){T=T.then(function(){return N(Q);});}return T.then(function(){return P.getManifestObject().loadDependenciesAndIncludes(true);});};return N(K.getMetadata()).then(function(){return s(function(){return G(K);},J);});});}else{return G(H);}}t.load=function(m){var P=b({},m);P.async=true;if(P.manifest===undefined){P.manifest=true;}return B(P,{preloadOnly:P.asyncHints&&P.asyncHints.preloadOnly});};t.get=function(i){return sap.ui.getCore().getComponent(i);};sap.ui.component.load=function(e,F){L.warning("Do not use deprecated function 'sap.ui.component.load'! Use 'Component.load' instead");return B(e,{failOnError:F,preloadOnly:e.asyncHints&&e.asyncHints.preloadOnly});};function B(i,m){var k=m.activeTerminologies,N=i.name,D=i.url,F=sap.ui.getCore().getConfiguration(),G=/^(sync|async)$/.test(F.getComponentPreload()),H=i.manifest,J,K,P,Q,T,W;function X(e,m){var v=JSON.parse(JSON.stringify(e));if(i.async){return Y(v).then(function($){return new M($,m);});}else{return new M(v,m);}}function Y(e){if(typeof t._fnPreprocessManifest==="function"&&e!=null){try{var v=d({},i);return t._fnPreprocessManifest(e,v);}catch($){L.error("Failed to execute flexibility hook for manifest preprocessing.",$);return Promise.reject($);}}else{return Promise.resolve(e);}}g(!D||typeof D==='string',"sUrl must be a string or undefined");if(N&&typeof D==='string'){y(N,D);}I.setStepComponent(N);if(H===undefined){J=i.manifestFirst===undefined?F.getManifestFirst():!!i.manifestFirst;K=i.manifestUrl;}else{if(i.async===undefined){i.async=true;}J=!!H;K=H&&typeof H==='string'?H:undefined;P=H&&typeof H==='object'?X(H,{url:i&&i.altManifestUrl,activeTerminologies:k}):undefined;}if(!P&&K){P=M.load({activeTerminologies:k,manifestUrl:K,componentName:N,processJson:Y,async:i.async,failOnError:true});}if(P&&!i.async){N=P.getComponentName();if(N&&typeof D==='string'){y(N,D);}}if(!(P&&i.async)){if(!N){throw new Error("The name of the component is undefined.");}g(typeof N==='string',"sName must be a string");}if(J&&!P){P=M.load({activeTerminologies:k,manifestUrl:x(N),componentName:N,async:i.async,processJson:Y,failOnError:false});}function Z(){return(N+".Component").replace(/\./g,"/");}function a1(e){var v=N+'.Component';if(!e){var $="The specified component controller '"+v+"' could not be found!";if(m.failOnError){throw new Error($);}else{L.warning($);}}if(P){var m1=r(e.getMetadata(),P);var n1=function(){var o1=Array.prototype.slice.call(arguments);var p1;if(o1.length===0||typeof o1[0]==="object"){p1=o1[0]=o1[0]||{};}else if(typeof o1[0]==="string"){p1=o1[1]=o1[1]||{};}p1._metadataProxy=m1;if(Q){p1._manifestModels=Q;}var q1=Object.create(e.prototype);e.apply(q1,o1);return q1;};n1.getMetadata=function(){return m1;};n1.extend=function(){throw new Error("Extending Components created by Manifest is not supported!");};return n1;}else{return e;}}function b1(v,e){g((typeof v==='string'&&v)||(typeof v==='object'&&typeof v.name==='string'&&v.name),"reference either must be a non-empty string or an object with a non-empty 'name' and an optional 'url' property");if(typeof v==='object'){if(v.url){y(v.name,v.url);}return(v.lazy&&e!==true)?undefined:v.name;}return v;}function c1(v,$){var m1=v+'.Component',n1=sap.ui.getCore().getConfiguration().getDepCache(),o1,p1,q1;if(G&&v!=null&&!sap.ui.loader._.getModuleState(m1.replace(/\./g,"/")+".js")){if($){p1=V._getTransitiveDependencyForComponent(v);if(p1&&!p1.hasOwnPreload){q1=[p1.library];Array.prototype.push.apply(q1,p1.dependencies);return sap.ui.getCore().loadLibraries(q1,{preloadOnly:true});}else{o1=m1.replace(/\./g,"/")+(n1?'-h2-preload.js':'-preload.js');return sap.ui.loader._.loadJSResourceAsync(o1,true);}}try{o1=m1+'-preload';sap.ui.requireSync(o1.replace(/\./g,"/"));}catch(e){L.warning("couldn't preload component from "+o1+": "+((e&&e.message)||e));}}else if($){return Promise.resolve();}}function d1(e,P,v){var $=[];var m1=v?function(w1){$.push(w1);}:function(){};var n1=P.getEntry("/sap.ui5/dependencies/libs");if(n1){var o1=[];for(var p1 in n1){if(!n1[p1].lazy){o1.push(p1);}}if(o1.length>0){L.info("Component \""+e+"\" is loading libraries: \""+o1.join(", ")+"\"");m1(sap.ui.getCore().loadLibraries(o1,{async:v}));}}var q1=P.getEntry("/sap.ui5/extends/component");if(q1){m1(c1(q1,v));}var r1=[];var s1=P.getEntry("/sap.ui5/dependencies/components");if(s1){for(var t1 in s1){if(!s1[t1].lazy){r1.push(t1);}}}var u1=P.getEntry("/sap.ui5/componentUsages");if(u1){for(var v1 in u1){if(u1[v1].lazy===false&&r1.indexOf(u1[v1].name)===-1){r1.push(u1[v1].name);}}}if(r1.length>0){r1.forEach(function(e){m1(c1(e,v));});}return v?Promise.all($):undefined;}if(i.async){var e1=i.asyncHints||{},f1=[],g1=function(e){e=e.then(function(v){return{result:v,rejected:false};},function(v){return{result:v,rejected:true};});return e;},h1=function(e){if(e){f1.push(g1(e));}},i1=function($){return $;},j1,k1;j1=[];if(Array.isArray(e1.preloadBundles)){e1.preloadBundles.forEach(function(v){j1.push(sap.ui.loader._.loadJSResourceAsync(b1(v,true),true));});}if(Array.isArray(e1.libs)){k1=e1.libs.map(b1).filter(i1);j1.push(sap.ui.getCore().loadLibraries(k1,{preloadOnly:true}));}j1=Promise.all(j1);if(k1&&!m.preloadOnly){j1=j1.then(function(){return sap.ui.getCore().loadLibraries(k1);});}h1(j1);if(e1.components){Object.keys(e1.components).forEach(function(e){h1(c1(b1(e1.components[e]),true));});}if(!P){h1(c1(N,true));}else{var l1=[];P=P.then(function(P){var e=P.getComponentName();if(typeof D==='string'){y(e,D);}P.defineResourceRoots();P._preprocess({resolveUI5Urls:true,i18nProperties:l1});return P;});if(m.createModels){h1(P.then(function(P){T=w(P,i.componentData,e1.cacheTokens,k);return P;}).then(function(P){if(Object.keys(T.afterManifest).length>0){Q=t._createManifestModels(T.afterManifest,P.getComponentName());}return P;}));}h1(P.then(function(P){var e=Promise.resolve();if(!P.getEntry("/sap.app/embeddedBy")){e=c1(P.getComponentName(),true);}return e.then(function(){return P._processI18n(true,l1);}).then(function(){if(!m.createModels){return null;}var v=Object.keys(T.afterPreload);if(v.length===0){return null;}return new Promise(function($,m1){sap.ui.require(["sap/ui/model/resource/ResourceModel"],function(n1){$(n1);},m1);}).then(function($){function m1(n1){var o1=T.afterPreload[n1];if(Array.isArray(o1.settings)&&o1.settings.length>0){var p1=o1.settings[0];p1.activeTerminologies=m.activeTerminologies;return $.loadResourceBundle(p1,true).then(function(q1){p1.bundle=q1;delete p1.terminologies;delete p1.activeTerminologies;delete p1.enhanceWith;},function(q1){L.error("Component Manifest: Could not preload ResourceBundle for ResourceModel. "+"The model will be skipped here and tried to be created on Component initialization.","[\"sap.ui5\"][\"models\"][\""+n1+"\"]",P.getComponentName());L.error(q1);delete T.afterPreload[n1];});}else{return Promise.resolve();}}return Promise.all(v.map(m1)).then(function(){if(Object.keys(T.afterPreload).length>0){var n1=t._createManifestModels(T.afterPreload,P.getComponentName());if(!Q){Q={};}for(var o1 in n1){Q[o1]=n1[o1];}}});});});}));W=function(e){if(typeof t._fnLoadComponentCallback==="function"){var v=d({},i);try{return t._fnLoadComponentCallback(v,e);}catch($){L.error("Callback for loading the component \""+e.getComponentName()+"\" run into an error. The callback was skipped and the component loading resumed.",$,"sap.ui.core.Component");}}};}return Promise.all(f1).then(function(v){var e=[],$=false,m1;$=v.some(function(n1){if(n1&&n1.rejected){m1=n1.result;return true;}e.push(n1.result);});if($){return Promise.reject(m1);}return e;}).then(function(v){if(P&&W){return P.then(W).then(function(){return v;});}return v;}).then(function(v){L.debug("Component.load: all promises fulfilled, then "+v);if(P){return P.then(function(e){if(!e._bLoadManifestRequestFailed){P=e;N=P.getComponentName();return d1(N,P,true);}else{P=undefined;return P;}});}else{return v;}}).then(function(){if(m.preloadOnly){return true;}return new Promise(function(e,v){sap.ui.require([Z()],function($){e($);},v);}).then(function(e){var v=e.getMetadata();var N=v.getComponentName();var $=x(N);var m1;if(P&&typeof H!=="object"&&(typeof K==="undefined"||K===$)){v._applyManifest(JSON.parse(JSON.stringify(P.getRawJson())));}m1=z(v);return m1.then(function(){var n1=Promise.resolve();if(!P&&m.activeTerminologies){P=new M(v.getManifestObject().getRawJson(),{process:false,activeTerminologies:k});n1=P._processI18n(true);}return n1.then(a1.bind(undefined,e));});});}).then(function(e){if(!P){return e;}var v=[];var $;var m1=P.getEntry("/sap.ui5/rootView");if(typeof m1==="string"){$="XML";}else if(m1&&typeof m1==="object"&&m1.type){$=m1.type;}if($&&n[$]){var n1="sap/ui/core/mvc/"+n[$]+"View";v.push(n1);}var o1=P.getEntry("/sap.ui5/routing");if(o1&&o1.routes){var p1=P.getEntry("/sap.ui5/routing/config/routerClass")||"sap.ui.core.routing.Router";var q1=p1.replace(/\./g,"/");v.push(q1);}var r1=b({},P.getEntry("/sap.ui5/models"));var s1=b({},P.getEntry("/sap.app/dataSources"));var t1=t._createManifestModelConfigurations({models:r1,dataSources:s1,manifest:P,cacheTokens:e1.cacheTokens,activeTerminologies:k});for(var u1 in t1){if(!t1.hasOwnProperty(u1)){continue;}var v1=t1[u1];if(!v1.type){continue;}var w1=v1.type.replace(/\./g,"/");if(v.indexOf(w1)===-1){v.push(w1);}}if(v.length>0){return Promise.all(v.map(function(w1){return new Promise(function(x1,y1){var z1=false;function A1(B1){if(z1){return;}L.warning("Can not preload module \""+w1+"\". "+"This will most probably cause an error once the module is used later on.",P.getComponentName(),"sap.ui.core.Component");L.warning(B1);z1=true;x1();}sap.ui.require([w1],x1,A1);});})).then(function(){return e;});}else{return e;}}).then(function(e){var v=m.waitFor;if(v){var $=Array.isArray(v)?v:[v];return Promise.all($).then(function(){return e;});}return e;}).catch(function(e){if(Q){for(var N in Q){var v=Q[N];if(v&&typeof v.destroy==="function"){v.destroy();}}}throw e;});}if(P){P.defineResourceRoots();P._preprocess({resolveUI5Urls:true});d1(N,P);}c1(N);return a1(sap.ui.requireSync(Z()));}if(Math.sqrt(2)<1){sap.ui.require(["sap/ui/core/Core"],function(){});}t.prototype.getCommand=function(e){var i,k=this._getManifestEntry("/sap.ui5/commands",true);if(k&&e){i=k[e];}return e?i:k;};t.prototype.deactivate=function(){var e=t.getOwnerComponentFor(this);if(e&&e.isActive()){throw new Error("Component.deactivate must not be called on nested components.");}if(!this.isKeepAliveSupported()){L.warning("Deactivation of component failed. Component '"+this.getId()+"' does not support 'keepAlive'.");return;}if(!this.isActive()){L.warning("Deactivation of component failed. Component '"+this.getId()+"' is already inactive.");return;}this.onOwnerDeactivation();this._bIsActive=false;E.registry.filter(function(i){var k=t.getOwnerIdFor(i);if(k===this.getId()){R.suspend(i.getDomRef());return i.onOwnerDeactivation();}},this);t.registry.filter(function(i){var k=t.getOwnerIdFor(i);if(k===this.getId()){i.deactivate();}},this);if(this._oEventBus){this._oEventBus.suspend();}if(this.getRouter()){this.getRouter().stop();}if(typeof this.onDeactivate==="function"){this.onDeactivate();}};t.prototype.activate=function(){if(!this.isKeepAliveSupported()){L.warning("Activation of component failed. Component '"+this.getId()+"' does not support 'keepAlive'.");return;}if(this.isActive()){L.warning("Activation of component failed. Component '"+this.getId()+"' is already active.");return;}this.onOwnerActivation();this._bIsActive=true;E.registry.forEach(function(e){var i=t.getOwnerIdFor(e);if(i===this.getId()){R.resume(e.getDomRef());return e.onOwnerActivation();}},this);t.registry.forEach(function(e){var i=t.getOwnerIdFor(e);if(i===this.getId()){e.activate();}},this);if(this._oEventBus){this._oEventBus.resume();}if(this.getRouter()){this.getRouter().initialize();}if(typeof this.onActivate==="function"){this.onActivate();}};t.prototype.isKeepAliveSupported=function(){var i=this._oKeepAliveConfig&&this._oKeepAliveConfig.supported;if(i){i=t.registry.filter(function(e){var k=t.getOwnerIdFor(e);if(k===this.getId()){return true;}},this).every(function(e){return e.isKeepAliveSupported();},this);}return!!i;};t.prototype.registerForDestroy=function(e){var D=this._getDestroyables();e=e.then(function(i){D.splice(D.indexOf(e),1);return i;});D.push(e);};return t;});
