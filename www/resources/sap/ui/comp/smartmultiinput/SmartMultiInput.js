/*
 * ! SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Core","sap/m/library","sap/m/List","sap/m/Popover","sap/m/StandardListItem",'sap/m/MultiInput','sap/m/MultiComboBox','sap/m/Token','sap/m/Tokenizer','sap/ui/comp/smartfield/SmartField','sap/ui/comp/odata/MetadataAnalyser',"sap/ui/model/ParseException","sap/ui/model/ValidateException",'sap/ui/model/BindingMode','sap/ui/comp/odata/ODataType','sap/ui/comp/providers/ValueHelpProvider',"sap/ui/comp/util/FormatUtil","sap/ui/core/format/DateFormat","sap/ui/comp/smartfilterbar/FilterProvider","sap/base/Log","sap/base/util/deepEqual","sap/ui/comp/library","sap/ui/core/library","sap/ui/core/ResizeHandler","sap/m/Link","sap/m/Text","sap/m/FlexBox","sap/m/HBox","sap/base/util/isEmptyObject"],function(C,M,L,P,S,a,b,T,c,d,e,f,V,B,O,g,F,D,h,j,k,l,m,R,n,o,p,H,q){"use strict";var r=l.valuehelpdialog.ValueHelpRangeOperation;var s=l.smartfilterbar.DisplayBehaviour;var t=l.smartfield.TextInEditModeSource;var u=m.ValueState;var v=M.PlacementType;var I="-mInput";var w="-mInputTokenizer";var x="-mInputHBox";var y="-mMoreLink";var z=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");var A=d.extend("sap.ui.comp.smartmultiinput.SmartMultiInput",{metadata:{library:"sap.ui.comp",properties:{supportRanges:{type:"boolean",defaultValue:false},supportMultiSelect:{type:"boolean",defaultValue:true},enableODataSelect:{type:"boolean",defaultValue:false},requestAtLeastFields:{type:"string",defaultValue:""},textSeparator:{type:"string",defaultValue:null}},events:{beforeCreate:{allowPreventDefault:true,parameters:{oData:{type:"object"},mParameters:{type:"object"}}},beforeRemove:{allowPreventDefault:true,parameters:{mParameters:{type:"object"}}},tokenUpdate:{parameters:{type:{type:"string"},addedTokens:{type:"sap.m.Token[]"},removedTokens:{type:"sap.m.Token[]"}}},selectionChange:{parameters:{changedItem:{type:"sap.ui.core.Item"},selected:{type:"boolean"}}},selectionFinish:{parameters:{selectedItems:{type:"sap.ui.core.Item[]"}}}}},renderer:function(i,J){d.getMetadata().getRenderer().render(i,J);if(J._oEmptyDash){var K=J.getTokens().length>0?false:true;J._oEmptyDash.setVisible(K);if(K&&J._oMoreLink){J._oMoreLink.setVisible(false);}}}});A.prototype.getTokens=function(){if(this._isReadMode()&&this._oTokenizer){return this._oTokenizer.getTokens();}else if(this._oMultiComboBox&&this._oMultiComboBox.getAggregation("tokenizer")){return this._oMultiComboBox.getAggregation("tokenizer").getTokens();}else if(this._oMultiInput){return this._oMultiInput.getTokens();}return[];};A.prototype.getValue=function(){return this.getTokens();};A.prototype._createMultiInput=function(){var i=this._createAttributes();if(this._oMultiComboBox){this._oMultiComboBox.destroy();this._oMultiComboBox=null;}this._oMultiInput=new a(this.getId()+I,i);this._oMultiInput.attachChange(function(K){this._validateValueOnChange(K.getParameter("value"));},this);if(this.getBindingContext()){this._bindMultiInput();}this._oMultiInput.attachTokenUpdate(function(K){this._validateValueOnChange(this._oMultiInput.getValue());var N=K.getParameters();delete N.id;if(this.getBinding("value").getBindingMode()!=="TwoWay"||!this.getBindingContext()){if(K.getParameter("removedTokens")){K.getParameter("removedTokens").forEach(function(Q){Q.destroy();});}}this.fireTokenUpdate(N);},this);var J={control:this._oMultiInput,onCreate:"_onMultiInputCreate",params:{type:{type:this._getType(),property:this._oFactory._oMetaData.property}}};this._initMultiInputValueHelp(J);return J;};A.prototype._createMultiComboBox=function(){var i=this._createAttributes();this._oMultiComboBox=new b(this.getId()+"mComboBox",i);if(this.getBindingContext()){this._bindMultiComboBox();}else{this._oMultiInput=this._oMultiComboBox._oTokenizer;}this._oMultiComboBox.attachSelectionChange(function(K){var N=K.getParameters();delete N.id;this.fireSelectionChange(N);},this);this._oMultiComboBox.attachSelectionFinish(function(K){var N=K.getParameters();delete N.id;this.oLocalContext=[];this.fireSelectionFinish(N);},this);var J={control:this._oMultiComboBox,onCreate:"_onCreate",params:{type:{type:this._getType(),property:this._oFactory._oMetaData.property},valuehelp:{annotation:this._getValueListAnnotation(),aggregation:"items",noDialog:true,noTypeAhead:true}}};return J;};A.prototype._createAttributes=function(){var N={width:true,textAlign:true,placeholder:true,tooltip:true,name:true,valueState:true,valueStateText:true};var i=this._oFactory.createAttributes(null,this._oFactory._oMetaData.property,N,{event:"change",parameter:"value"});return i;};function E(J){var K=J.getParameter("tokens"),N,Q,i=0,U=[],W=null,X;this._onCancel();if(this.oControl instanceof sap.m.MultiInput){this.oControl.setValue("");var Y=this.oControl.getTokens();var Z=[];var $=[];var a1=[];Y.forEach(function(g1){var h1=K.some(function(j1){return g1.getKey()===j1.getKey();});if(!h1){$.push(g1);}else{var i1=K.filter(function(j1){return g1.getKey()===j1.getKey();})[0];a1.push(i1);}});K.forEach(function(g1){var h1=Y.some(function(i1){return i1.getKey()===g1.getKey();});if(!h1){Z.push(g1);a1.push(g1);}});this.oControl.setTokens(a1);var b1=this.oControl.getParent();if(b1.getBindingContext()&&b1.getBinding("value").getBindingMode()==="TwoWay"){var c1=b1._getModel(),d1=b1._getEntitySetName(),e1=c1._resolveGroup(d1),f1=c1.getDeferredGroups().indexOf(e1.groupId)>=0||c1.getDeferredBatchGroups().indexOf(e1.groupId)>=0;if(!f1&&($.length||Z.length)&&a1.length){b1.setBusyIndicatorDelay(b1.getBusyIndicatorDelay());b1.setBusy(true);}}this.oControl.fireTokenUpdate({type:"tokensChanged",removedTokens:$,addedTokens:Z});i=K.length;while(i--){W=K[i].data("row");if(W){U.push(W);}}}else{if(K[0]){if(this.bIsSingleIntervalRange){N=K[0].data("range");if(N){if(this._sType==="datetime"){X=D.getDateTimeInstance(Object.assign({},this._oDateFormatSettings,{UTC:false}));if(typeof N.value1==="string"){N.value1=new Date(N.value1);}if(N.operation==="BT"){if(typeof N.value2==="string"){N.value2=new Date(N.value2);}Q=X.format(N.value1)+"-"+X.format(N.value2);}else{Q=X.format(N.value1);}}else{if(N.operation==="BT"){Q=N.value1+"-"+N.value2;}else{Q=N.value1;}}}}else{Q=K[0].getKey();}W=K[0].data("row");if(W){U.push(W);}}this.oControl.setValue(Q);this.oControl.fireChange({value:Q,validated:true});}this._calculateAndSetFilterOutputData(U);}function G(i){var J,K,N,Q={};if(i&&this.mOutParams){for(J in this.mOutParams){if(J){K=this.mOutParams[J];if(K!==this.sKey){N=i[K];Q[J]=N;}}}if(Q&&!jQuery.isEmptyObject(Q)){this.fireEvent("valueListChanged",{"changes":Q});}}}A.prototype._initMultiInputValueHelp=function(i){var J=this._getFilterType(this._oFactory._oMetaData.property.property),K={},N=this._getDateFormatSettings(),Q;this._oFactory._getValueHelpDialogTitle(K);if(this._getValueListAnnotation()){i.params.valuehelp={annotation:this._getValueListAnnotation(),aggregation:"suggestionRows",noDialog:false,noTypeAhead:false,supportMultiSelect:this.getSupportMultiSelect(),supportRanges:this.getBindingContext()?false:this.getSupportRanges(),type:J,displayBehaviour:this._getDisplayBehaviour()};}else if(this.getSupportRanges()&&!this.getBindingContext()){Q=new g({fieldName:this._getPropertyName(),preventInitialDataFetchInValueHelpDialog:true,model:this.getModel(),control:this._oMultiInput,title:K.dialogtitle,supportMultiSelect:this.getSupportMultiSelect(),supportRanges:true,type:J,dateFormatSettings:N,isUnrestrictedFilter:this._isTimeType(J),displayBehaviour:this._getDisplayBehaviour()});Q._onOK=E;Q._calculateAndSetODataModelOutputData=G;this._oMultiInput.addValidator(this._validateToken.bind(this));}else{this._oMultiInput.setShowValueHelp(false);this._oMultiInput.addValidator(this._validateToken.bind(this));}};A.prototype._bindMultiInput=function(){var i=this.getBinding("value").getBindingMode();switch(i){case B.OneTime:this._bindMultiInputOneTime();break;case B.OneWay:this._bindMultiInputOneWay();break;case B.TwoWay:default:this._bindMultiInputTwoWay();}};A.prototype._bindMultiInputOneTime=function(){var i=this;this._readNavigationPropertySet().then(function(J){J.results.forEach(function(K){var N=K[i._getPropertyName()];var Q=i._getDescriptionFieldName();var U=Q?K[Q]:"";i._oMultiInput.addToken(i._createToken(N,U));});});};A.prototype._bindMultiInputOneWay=function(){this._bindMultiInputTokens(this._oMultiInput);};A.prototype._bindMultiInputTwoWay=function(){this._bindMultiInputTokens(this._oMultiInput);this._oMultiInput.attachTokenUpdate(function(i){i.getParameter("addedTokens").forEach(this._addToken.bind(this));i.getParameter("removedTokens").forEach(this._removeToken.bind(this));},this);};A.prototype._bindMultiInputTokens=function(i){var N=this._getNavigationPath(),J=this._getSelectExpandParameter();if(!q(J)){i.bindAggregation("tokens",{path:N,parameters:J,factory:this._tokensFactory.bind(this),events:{aggregatedDataStateChange:this._processDataState.bind(this)}});}else{i.bindAggregation("tokens",{path:N,factory:this._tokensFactory.bind(this),events:{aggregatedDataStateChange:this._processDataState.bind(this)}});}};A.prototype._processDataState=function(i){var J=i.getParameter("dataState"),K=this.getBinding("value");if(!J||!J.getChanges().messages){return;}if(K&&K.bIsBeingDestroyed){return;}var N=J.getMessages();if(N.length){var U=false;var Q=N[0];N.forEach(function(W){if(W.getControlIds().indexOf(this.getId())==-1){W.addControlId(this.getId());U=true;}}.bind(this));this.setValueState(Q.getType());this.setValueStateText(Q.getMessage());if(U){C.getMessageManager().getMessageModel().checkUpdate(false,true);}}else{this.setValueState(u.None);this.setValueStateText("");}};A.prototype._getSelectExpandParameter=function(){var i={};if(this.getEnableODataSelect()){i.select=this._addODataSelectParameters();}if(this._oFactory._oMetaData.annotations.text&&this._oFactory._oMetaData.annotations.text.navigationPathHelp){i.expand=this._oFactory._oMetaData.annotations.text.navigationPathHelp;}return i;};A.prototype._addODataSelectParameters=function(i){var J=this._getPropertyName();if(this._getDescriptionFieldName()){J=J+","+this._getDescriptionFieldName();}if(this.getRequestAtLeastFields()){J=J+","+this.getRequestAtLeastFields();}return J;};A.prototype._checkFieldGroups=function(){var i,J,K=this.getMode();if(this.getBindingContext()&&this._oFactory&&this._oFactory._oMeta&&(K==="edit")&&!this._bSideEffects){var N=this._oFactory._oMeta.entitySet,Q=this.getModel().getMetaModel().getODataEntitySet(N),U=this.getModel().getMetaModel().getODataEntityType(Q.entityType);J={entitySet:Q,entityType:U,path:this._getNavigationPath()};i=this._getView();if(i&&J){this._setFieldGroup(J,i);}}};A.prototype._bindMultiComboBox=function(){var i=this.getBinding("value").getBindingMode();switch(i){case B.OneTime:this._bindMultiComboBoxOneTime();break;case B.OneWay:this._bindMultiComboBoxOneWay();break;case B.TwoWay:default:this._bindMultiComboBoxTwoWay();}};A.prototype._bindMultiComboBoxOneTime=function(){var i=this;this._readNavigationPropertySet().then(function(J){var K=J.results.map(function(N){return N[i._getPropertyName()];});i._oMultiComboBox.setSelectedKeys(K);});};A.prototype._bindMultiComboBoxOneWay=function(){this._createAndAttachHelperMultiInput();};A.prototype._bindMultiComboBoxTwoWay=function(){this._createAndAttachHelperMultiInput();this.oLocalContext=[];this._oMultiComboBox.attachSelectionChange(function(i){var J=i.getParameter("selected"),K=i.getParameter("changedItem"),N={},Q,U,W;this.setValueState(u.None);this.setValueStateText("");if(J){N[this._getPropertyName()]=K.getKey();W=K.getBindingContext("list")||K.getBindingContext();Q=W.getProperty();this._getEntityType().key.propertyRef.forEach(function(X){if(Q&&Q[X.name]){N[X.name]=Q[X.name];}});}else{U=this._oMultiInput.getTokens().filter(function(X){return X.getKey()===K.getKey();})[0];}if(J){this.oLocalContext.push(this._createEntity(N));}else{if(U){this._removeEntity(U.getBindingContext());}else{this.oLocalContext.forEach(function(X,Y){if(X.getProperty(this._getPropertyName())===K.getKey()){this._getModel().deleteCreatedEntry(X);this.oLocalContext.splice(Y,1);}}.bind(this));}}},this);};A.prototype._readNavigationPropertySet=function(){var i=this;return new Promise(function(J,K){var N=i.getBindingContext(),Q=i._getModel(),U=i._getNavigationPath();Q.read(U,{context:N,success:function(W){J(W);},error:function(W){i.setValueState(u.Error);i.setValueStateText(W.responseText);K(W);}});});};A.prototype._createAndAttachHelperMultiInput=function(){this._oMultiInput=new a();this._oMultiInput.setBindingContext(this.getBindingContext());this._oMultiInput.setModel(this._getModel());this._bindMultiInputTokens(this._oMultiInput);var i=this._oMultiInput.getBinding("tokens");function J(){var K=this._oMultiInput.getTokens().map(function(N){return N.getKey();});if(this._oMultiComboBox){this._oMultiComboBox.setSelectedKeys(K);}}J.call(this);i.attachChange(J,this);};A.prototype._getReadTokenList=function(){if(!this.oReadTokenList){this.oReadTokenList=new L();this.addDependent(this.oReadTokenList);}return this.oReadTokenList;};A.prototype._getReadTokenListPopover=function(){if(!this.oReadTokenListPopover){this.oReadTokenListPopover=new P({showArrow:true,placement:v.Auto,showHeader:false,contentMinWidth:"auto",content:[this.oReadTokenList]});this.addDependent(this.oReadTokenListPopover);}return this.oReadTokenListPopover;};A.prototype._handleNMoreIndicatorPress=function(){var J=this.getTokens();if(!J){return;}var K=this._getReadTokenList();var N=this._getReadTokenListPopover();K.removeAllItems();for(var i=0,Q=J.length;i<Q;i++){var U=J[i],W=new S({title:U.getText()});K.addItem(W);}if(this._oMoreLink.getDomRef()){N.openBy(this._oMoreLink.getDomRef());}};A.prototype._onResize=function(){if(this._isReadMode()&&this._oTokenizer){this._deregisterResizeHandler();this._oTokenizer.setMaxWidth(this.$().width()+"px");this._oTokenizer.setRenderMode("Narrow");this._oTokenizer.scrollToEnd();this._registerResizeHandler();}};A.prototype.onBeforeRendering=function(){if(d.prototype.onBeforeRendering){d.prototype.onBeforeRendering.apply(this,arguments);}this._deregisterResizeHandler();};A.prototype.onAfterRendering=function(){if(d.prototype.onAfterRendering){d.prototype.onAfterRendering.apply(this,arguments);}if(this.getMode()==="display"&&this.bControlNotRendered){this._oHBox.removeAllItems();this._oMoreLink.setVisible(false);this.getTokens().forEach(function(i){var J=this._generateDisplayText(i.getText());this._oHBox.addItem(J);},this);}this._registerResizeHandler();};A.prototype._registerResizeHandler=function(){if(!this._iResizeHandlerId){this._iResizeHandlerId=R.register(this,this._onResize.bind(this));}};A.prototype._deregisterResizeHandler=function(){if(this._iResizeHandlerId){R.deregister(this._iResizeHandlerId);this._iResizeHandlerId=null;}};A.prototype._createTokenizer=function(){this._oTokenizer=new c(this.getId()+w,{editable:false,visible:false,width:"100%"});this._oHBox=new H(this.getId()+x);this._oMoreLink=new n(this.getId()+y,{press:this._handleNMoreIndicatorPress.bind(this),ariaLabelledBy:this.getId()+"-label"});this._oEmptyDash=new o({text:"–",visible:true});var N=this._getNavigationPath(),i=this._getSelectExpandParameter();if(this.getBindingContext()){this._bindMultiInputTokens(this._oTokenizer);this._oHBox.bindAggregation("items",{path:N,parameters:i,factory:this._textFactory.bind(this)});}else{this.attachInnerControlsCreated(this._mirrorTokensToDisplayTokenizer,this);}var J=new p({height:"100%",items:[this._oEmptyDash,this._oHBox,this._oMoreLink,this._oTokenizer]});return{control:J,onCreate:"_onCreate"};};A.prototype._textFactory=function(i,J){var K=J.getProperty(this._getPropertyName()),N=K instanceof Date?this._formatValue(K):K.toString(),Q=this._getDescriptionFieldName(),U=Q?J.getProperty(Q):"",W=this._getFormattedText(N,U),X;if(this.getDomRef()){this.bControlNotRendered=false;X=this._generateDisplayText(W);}else{this.bControlNotRendered=true;X=new o({text:W});}if(this._oEmptyDash){this._oEmptyDash.setVisible(false);}return X;};A.prototype._generateDisplayText=function(i){var J=this.getDomRef(),K=J.offsetWidth,N=Y("999 "+z.getText("POPOVER_DEFINE_MORE_LINKS")),Q=new o({wrapping:false}),U,W,X;function Y(i){var a1=document.createElement("span");a1.style.whiteSpace="nowrap";a1.innerHTML=i;a1.className="sapMText";J.appendChild(a1);var b1=J.childNodes;var c1=b1[b1.length-1].offsetWidth;J.removeChild(J.childNodes[b1.length-1]);return c1;}if(this._oHBox.getItems().length===0){this._iHBoxWidth=0;this._iHiddenLabelsCount=0;}this._oHBox.getItems().filter(function(a1){return!a1.getVisible();}).forEach(function(a1){this._oHBox.removeItem(a1);}.bind(this));Q.setTooltip(i);i=this._iHBoxWidth===0?i:"\u00a0"+this.getTextSeparator()+"\u00a0"+i;Q.setText(i);var Z=Y(i);this._iHBoxWidth+=Z;if(this._iHiddenLabelsCount===0&&this._iHBoxWidth<=K){this._oMoreLink.setVisible(false);}else{while(this._iHBoxWidth&&this._iHBoxWidth>K-N){this._iHiddenLabelsCount+=1;if(this._oHBox.getItems()[0]){var $=Y(this._oHBox.getItems()[0].getText());this._iHBoxWidth-=$;this._oHBox.removeItem(0);}else{this._iHBoxWidth-=Z;Q.setVisible(false);}}if(this._oHBox.getItems().length===0&&this._iHiddenLabelsCount===1&&!Q.getVisible()){this._iHiddenLabelsCount=0;this._iHBoxWidth+=Z;Q.setVisible(true);Q.setWrapping(true);this._oMoreLink.setVisible(false);}else{if(this._oHBox.getItems().length>0){U=this._oHBox.getItems()[0];U.setText(U.getTooltip());if(this._oHBox.getItems().length-1>0){W=this._oHBox.getItems()[(this._oHBox.getItems().length-1)];X="\u00a0"+this.getTextSeparator()+"\u00a0"+W.getTooltip();W.setText(X);}Q.setText(Q.getText()+"\u00a0"+this.getTextSeparator()+"\u00a0");}else{Q.setText(Q.getTooltip()+"\u00a0"+this.getTextSeparator()+"\u00a0");}this._oMoreLink.setVisible(true);this._oMoreLink.setText(this._iHiddenLabelsCount+" "+z.getText("POPOVER_DEFINE_MORE_LINKS"));}}return Q;};A.prototype._mirrorTokensToDisplayTokenizer=function(){if(this.getMode()==="display"&&typeof this._oMultiInput!=="undefined"){this._oTokenizer.removeAllTokens();this._oHBox.removeAllItems();this._oMoreLink.setVisible(false);this._oMultiInput.getTokens().forEach(function(i){var N=new T({text:i.getText(),key:i.getKey()});this._oTokenizer.addToken(N);var J=this._generateDisplayText(i.getText());this._oHBox.addItem(J);},this);}};A.prototype.getTextSeparator=function(){var i=this.getProperty("textSeparator");if(i){return i;}return z.getText("SMARTMULTIINPUT_SEPARATOR");};A.prototype._tokensFactory=function(i,J){var K;this.setBusy(false);if(this._oFactory){var N=J.getProperty(this._getPropertyName());var Q=N instanceof Date?this._formatValue(N):N.toString();var U=this._getDescriptionFieldName();var W=U?J.getProperty(U):"";K=this._createToken(Q,W,J);}else{K=new T();}return K;};A.prototype._createToken=function(K,i,J){var N=this._getFormattedText(K,i);var Q;Q=new T();Q.setKey(K);Q.setText(N);return Q;};A.prototype._addToken=function(i){var J={},K,N,Q,U=i.data("row"),W=i.data("range");J[this._getPropertyName()]=i.getKey();if(U){this._getEntityType().key.propertyRef.forEach(function(Y){if(U[Y.name]){J[Y.name]=U[Y.name];}});if(this._oFactory._aProviders&&this._oFactory._aProviders[0].mOutParams){var X=this._oFactory._aProviders[0].mOutParams;for(N in X){if(N&&N!==this._getPropertyName()){Q=X[N];J[N]=U[Q];}}}}if(W){J["range"]=W;}this.setValueState(u.None);this.setValueStateText("");K=this._createEntity(J);i.setBindingContext(K);};A.prototype._createEntity=function(i){var J=this._getModel(),K=this._getEntitySetName(),N=J._resolveGroup(K),Q=this._getNavigationPath(),U=this.fireBeforeCreate({oData:i,mParameters:N});N.refreshAfterChange=true;N.context=this.getBindingContext();if(U){N.properties=i;var W=J.createEntry(Q,N);return W;}};A.prototype._removeToken=function(i){this._removeEntity(i.getBindingContext());i.destroy();};A.prototype._removeEntity=function(i){var J=this._getModel(),K=this._getEntitySetName(),N=J._resolveGroup(K),Q=this.fireBeforeRemove({mParameters:N});var U=J.getDeferredGroups().indexOf(N.groupId)>=0||J.getDeferredBatchGroups().indexOf(N.groupId)>=0;if(U&&this._entityHasPendingCreateChange(J,i)){J.deleteCreatedEntry(i);Q=false;}N.refreshAfterChange=true;N.context=i;if(Q){var W="";J.remove(W,N);}};A.prototype._entityHasPendingCreateChange=function(i,J){var K=i.getPendingChanges();var N=i.getKey(J);return!!K[N]&&k(K[N],J.getObject());};A.prototype._getEntityKeyProperties=function(i){var J=this._getModel(),K=J.oMetadata._getEntityTypeByPath(i.getPath()),N={};K.key.propertyRef.forEach(function(Q){var U=Q.name;N[U]=i.getProperty(U);});return N;};A.prototype.checkClientError=function(){if(this.getMode()==="display"){return false;}return!this._validateMultiInput();};A.prototype.getRangeData=function(){var i=this.getTokens(),J=[];i.forEach(function(K){var N;if(K.data("range")){N=K.data("range");}else{N=this._getDefaultTokenRangeData(K);}J.push(N);},this);return J;};A.prototype.setRangeData=function(i){if(!this.getBindingContext()){var J=Array.isArray(i)?i:[i];if(!this._oMultiInput){var K=this.getEditable(),N=this.getEnabled(),Q=this.getContextEditable();this.setEditable(true);this.setEnabled(true);this.setContextEditable(true);this.setEditable(K);this.setEnabled(N);this.setContextEditable(Q);}this._oMultiInput.removeAllTokens();J.forEach(function(U){var W=this._getTokenTextFromRangeData(U);var X=new T({text:W,key:W});X.data("range",U);this._oMultiInput.addToken(X);},this);this._mirrorTokensToDisplayTokenizer();}else{j.warning("setRangeData can only be used without property binding");}};A.prototype._getTokenTextFromRangeData=function(i){var J="";switch(i.operation){case r.EQ:J="="+i.value1;break;case r.GT:J=">"+i.value1;break;case r.GE:J=">="+i.value1;break;case r.LT:J="<"+i.value1;break;case r.LE:J="<="+i.value1;break;case r.Contains:J="*"+i.value1+"*";break;case r.StartsWith:J=i.value1+"*";break;case r.EndsWith:J="*"+i.value1;break;case r.BT:J=i.value1+"...";if(i.value2){J+=i.value2;}break;default:J="";}if(i.exclude&&J!==""){J="!("+J+")";}return J;};A.prototype._getComputedTextInEditModeSource=function(){var i=this.getTextInEditModeSource();if(this.isPropertyInitial("textInEditModeSource")&&this.getMode()==="edit"){i=t.None;}return i;};A.prototype.getFilter=function(){var i=[this._getPropertyName()],J={},K=this.getRangeData(),N;J[this._getPropertyName()]={ranges:K,items:[]};N=h.generateFilters(i,J);return N&&N.length===1&&N[0];};A.prototype._getDefaultTokenRangeData=function(i){var J={exclude:false,operation:r.EQ,value1:this._parseValue(i.getKey()),value2:"",keyField:this._getPropertyName()};return J;};A.prototype._validateToken=function(i){var J=i.text;var K=this._validateValue(J);if(K){var N=new T({key:J,text:J});if(this.getSupportRanges()){var Q=this._getDefaultTokenRangeData(N);N.data("range",Q);N.setText("="+J);}return N;}};A.prototype._validateMultiInput=function(){if(this._oMultiInput.getValueState()!==u.None){return false;}if(this.getRequired()&&this.getTokens().length===0){this.setValueStateText(sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp").getText("VALUEHELPVALDLG_FIELDMESSAGE"));this.setValueState(u.Error);return false;}else{this.setValueState(u.None);this.setValueStateText("");return true;}};A.prototype._validateValueOnChange=function(i){if(i===""){this.setValueState(u.None);this.setValueStateText("");this._validateMultiInput();}else{this._validateValue(i);}};A.prototype._parseValue=function(i){return this._getType().parseValue(i,"string");};A.prototype._formatValue=function(i){return this._getType().formatValue(i,"string");};A.prototype._validateValue=function(i){try{var J=this._parseValue(i);this._getType().validateValue(J);this.setValueState(u.None);this.setValueStateText("");return true;}catch(K){this.setValueState(u.Error);this.setValueStateText(K.message);var N={element:this._oMultiInput,property:"value",type:this._getType(),newValue:i,oldValue:null,exception:K,message:K.message};if(K instanceof f){this.fireParseError(N);}else if(K instanceof V){this.fireValidationError(N);}return false;}};A.prototype._getModel=function(){if(this._oFactory){return this._oFactory._oModel;}};A.prototype._getDateFormatSettings=function(){var i=this.data("dateFormatSettings");if(typeof i==="string"){try{i=JSON.parse(i);}catch(J){}}return i;};A.prototype._getNavigationPath=function(){return this._oFactory._oMetaData.navigationPath;};A.prototype._getDescriptionFieldName=function(){var i=this._oFactory._oMetaData.annotations.text;if(i){if(i.navigationPathHelp){return i.navigationPathHelp+"/"+i.property.property.name;}return i.property.property.name;}};A.prototype._getType=function(){if(!this._oType){var i;if(this._isEdmTimeType()){i=this._getDateFormatSettings();}this._oType=this._oFactory._oTypes.getType(this._oFactory._oMetaData.property,i);}return this._oType;};A.prototype._isEdmTimeType=function(){var i=["Edm.DateTime","Edm.DateTimeOffset","Edm.Time"];return i.indexOf(this._oFactory._oMetaData.property.property.type)>-1;};A.prototype._isTimeType=function(i){var J=["date","datetime","time"];return J.indexOf(i)>-1;};A.prototype._getPropertyName=function(){return this._oFactory._oMetaData.property.property.name;};A.prototype._getEntitySetName=function(){return this._oFactory._oMetaData.entitySet.name;};A.prototype._getEntityType=function(){return this._oFactory._oMetaData.entityType;};A.prototype._getValueListAnnotation=function(){return this._oFactory._oMetaData.annotations.valuelist;};A.prototype._getDisplayBehaviour=function(){var i=this._oFactory._getDisplayBehaviourConfiguration("defaultInputFieldDisplayBehaviour");if(!i||i===s.auto){i=s.descriptionAndId;}return i;};A.prototype._getFormattedText=function(K,i){var J=this._getDisplayBehaviour();return F.getFormattedExpressionFromDisplayBehaviour(J,K,i);};A.prototype._getFilterType=function(i){if(O.isNumeric(i.type)){return"numeric";}else if(i.type==="Edm.DateTime"&&i["sap:display-format"]==="Date"){return"date";}else if(i.type==="Edm.String"){return"string";}else if(i.type==="Edm.Boolean"){return"boolean";}else if(i.type==="Edm.Time"){return"time";}else if(i.type==="Edm.DateTimeOffset"){return"datetime";}return undefined;};A.prototype.setEntitySet=function(){d.prototype.setEntitySet.apply(this,arguments);this.updateBindingContext(false,this._getModel());return this;};A.prototype.bindProperty=function(i,J){d.prototype.bindProperty.apply(this,arguments);if(i==="value"){this.updateBindingContext(false,this._getModel());}return this;};A.prototype._checkComboBox=function(){var i=this._oFactory._oSelector.checkComboBox();return i&&i.combobox;};A.prototype._isReadMode=function(){return!this.getEditable()||!this.getEnabled()||!this.getContextEditable();};function _(){this._onCreate.apply(this,arguments);if(this._aProviders.length>0){this._aProviders[0]._onOK=E;this._aProviders.forEach(function(i){i._calculateAndSetODataModelOutputData=G;});}}A.prototype._init=function(){var i=this;d.prototype._init.apply(this,arguments);if(this._oFactory){this._oFactory._createMultiInput=this._createMultiInput.bind(this);this._oFactory._createMultiComboBox=this._createMultiComboBox.bind(this);this._oFactory._createTokenizer=this._createTokenizer.bind(this);this._oFactory._onMultiInputCreate=_;this._oFactory._oSelector.getCreator=function(){if(i._isReadMode()){return"_createTokenizer";}else if(i._checkComboBox()){return"_createMultiComboBox";}else{return"_createMultiInput";}};}};A.prototype.exit=function(){this._deregisterResizeHandler();if(this._oMultiInput){this._oMultiInput.destroy();}if(this._oMultiComboBox){this._oMultiComboBox.destroy();}if(this._oTokenizer){this._oTokenizer.destroy();}if(this._oHBox){this._oHBox.destroy();}this._oMultiInput=null;this._oMultiComboBox=null;this._oTokenizer=null;this._oHBox=null;d.prototype.exit.apply(this,arguments);};return A;});
