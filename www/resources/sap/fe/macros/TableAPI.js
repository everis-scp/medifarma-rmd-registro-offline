/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/helpers/ClassSupport","sap/fe/core/helpers/PasteHelper","sap/m/MessageBox","sap/ui/Device","sap/base/Log","./MacroAPI","sap/fe/macros/massedit/MassEditHandler","sap/fe/macros/DelegateUtil"],function(C,P,M,D,L,a,b,c){"use strict";var _,d,f,g,h,j,k,l,m,n,q,r,s,t,u,v,w,x,y,z,A,B,E,F,G,H,I,J,K,N,O,Q,R;var S=c.getLocalizedText;var T=b.openMassEditDialog;var U=P.parseDataForTablePaste;var V=C.Event;var W=C.Property;var X=C.MacroContext;var Y=C.EventHandler;var Z=C.APIClass;function $(e,p,i,o){if(!i)return;Object.defineProperty(e,p,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0});}function a1(i,e){if(!(i instanceof e)){throw new TypeError("Cannot call a class as a function");}}function b1(e,p){for(var i=0;i<p.length;i++){var o=p[i];o.enumerable=o.enumerable||false;o.configurable=true;if("value"in o)o.writable=true;Object.defineProperty(e,o.key,o);}}function c1(e,p,i){if(p)b1(e.prototype,p);if(i)b1(e,i);return e;}function d1(e,i){if(typeof i!=="function"&&i!==null){throw new TypeError("Super expression must either be null or a function");}e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:true,configurable:true}});if(i)e1(e,i);}function e1(o,p){e1=Object.setPrototypeOf||function e1(o,p){o.__proto__=p;return o;};return e1(o,p);}function f1(e){return function(){var i=j1(e),o;if(i1()){var p=j1(this).constructor;o=Reflect.construct(i,arguments,p);}else{o=i.apply(this,arguments);}return g1(this,o);};}function g1(e,i){if(i&&(typeof i==="object"||typeof i==="function")){return i;}return h1(e);}function h1(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return e;}function i1(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}function j1(o){j1=Object.setPrototypeOf?Object.getPrototypeOf:function j1(o){return o.__proto__||Object.getPrototypeOf(o);};return j1(o);}function k1(o,e,i){if(e in o){Object.defineProperty(o,e,{value:i,enumerable:true,configurable:true,writable:true});}else{o[e]=i;}return o;}function l1(e,p,i,o,o1){var p1={};Object.keys(o).forEach(function(q1){p1[q1]=o[q1];});p1.enumerable=!!p1.enumerable;p1.configurable=!!p1.configurable;if('value'in p1||p1.initializer){p1.writable=true;}p1=i.slice().reverse().reduce(function(p1,q1){return q1(e,p,p1)||p1;},p1);if(o1&&p1.initializer!==void 0){p1.value=p1.initializer?p1.initializer.call(o1):void 0;p1.initializer=undefined;}if(p1.initializer===void 0){Object.defineProperty(e,p,p1);p1=null;}return p1;}function m1(e,i){throw new Error('Decorating class property failed. Please ensure that '+'proposal-class-properties is enabled and runs after the decorators transform.');}var n1=(_=Z("sap.fe.macros.TableAPI"),d=X(),f=W({type:"boolean"}),g=W({type:"string"}),h=W({type:"boolean",defaultValue:false}),j=W({type:"string",defaultValue:"ResponsiveTable"}),k=W({type:"boolean",defaultValue:true}),l=W({type:"boolean",defaultValue:false}),m=W({type:"boolean",defaultValue:false}),n=W({type:"string"}),q=W({type:"string"}),r=W({type:"boolean",defaultValue:true}),s=W({type:"boolean|string",defaultValue:true}),t=W({type:"string"}),u=W({type:"boolean"}),_(v=(w=(R=function(e){d1(n1,e);var i=f1(n1);function n1(){var o;a1(this,n1);for(var p=arguments.length,o1=new Array(p),p1=0;p1<p;p1++){o1[p1]=arguments[p1];}o=i.call.apply(i,[this].concat(o1));$(h1(o),"tableDefinition",x,h1(o));$(h1(o),"readOnly",y,h1(o));$(h1(o),"id",z,h1(o));$(h1(o),"busy",A,h1(o));$(h1(o),"type",B,h1(o));$(h1(o),"enableExport",E,h1(o));$(h1(o),"enablePaste",F,h1(o));$(h1(o),"enableFullScreen",G,h1(o));$(h1(o),"selectionMode",H,h1(o));$(h1(o),"header",I,h1(o));$(h1(o),"headerVisible",J,h1(o));$(h1(o),"rowPress",K,h1(o));$(h1(o),"personalization",N,h1(o));$(h1(o),"variantManagement",O,h1(o));$(h1(o),"enableDataStateFilter",Q,h1(o));return o;}c1(n1,[{key:"onTableRowPress",value:function q1(o,p,o1,p1){if(o1&&o1.isA("sap.ui.model.odata.v4.Context")&&typeof o1.getProperty("@$ui5.node.isExpanded")==="boolean"){return false;}else{p._routing.navigateForwardToContext(o1,p1);}}},{key:"onInternalDataReceived",value:function p(o){if(o.getParameter("error")){this.getController().messageHandler.showMessageDialog();}}},{key:"onPaste",value:function t1(o,p){var o1=this;if(!this.tableDefinition.control.enablePaste||!this.getModel("ui").getProperty("/isEditable")){return;}var p1=o.getParameter("data"),q1=o.getSource(),r1=q1.data()["enablePaste"];var s1;if(r1===true||r1==="true"){U(p1,q1).then(function(u1){if(u1&&u1.length>0){return p._editFlow.createMultipleDocuments(q1.getRowBinding(),u1,o1.tableDefinition.control.createAtEnd);}}).catch(function(u1){L.error("Error while pasting data",u1);});}else{s1=sap.ui.getCore().getLibraryResourceBundle("sap.fe.core");M.error(s1.getText("T_OP_CONTROLLER_SAPFE_PASTE_DISABLED_MESSAGE"),{title:s1.getText("C_COMMON_SAPFE_ERROR")});}}},{key:"onPasteButtonPressed",value:function r1(){var o=this;var p=sap.ui.getCore().getLibraryResourceBundle("sap.fe.templates"),o1=D.os.name,p1=D.system;var q1=p.getText("T_OP_CONTROLLER_TABLE_PASTE_BUTTON_ACTION_MESSAGE_WINDOWS_DESKTOP");if(p1.phone||p1.tablet&&!p1.combi){q1=p.getText("T_OP_CONTROLLER_TABLE_PASTE_BUTTON_ACTION_MESSAGE_TOUCH_DEVICE");}else if(p1.desktop){switch(o1){case"win":q1=p.getText("T_OP_CONTROLLER_TABLE_PASTE_BUTTON_ACTION_MESSAGE_WINDOWS_DESKTOP");break;case"mac":q1=p.getText("T_OP_CONTROLLER_TABLE_PASTE_BUTTON_ACTION_MESSAGE_IOS_DESKTOP");break;}}M.information(q1,{onClose:function(){if(o.content){var s1;(s1=o.content.getAggregation("_content"))===null||s1===void 0?void 0:s1.applyFocusInfo({preventScroll:true});}}});}},{key:"onBeforeExport",value:function t1(o){var p;var o1=o.getParameters().userExportSettings.splitCells,p1=sap.ui.getCore().getConfiguration().getRTL(),q1=o.getSource(),r1=(p=o.getParameters().exportSettings.workbook)===null||p===void 0?void 0:p.columns,s1=this.tableDefinition.columns;n1.updateExportSettings(r1,s1,q1,o1,p1);}},{key:"onDataStateChange",value:function t1(o){var p=o.getSource();var o1=this.content;var p1=o.getParameter("filteredMessages");var q1=o1.getRowBinding().getCurrentContexts();if(o1.getBindingContext()){if(!p1){var r1=sap.ui.getCore().getMessageManager().getMessageModel().getData().some(function(u1){return q1.some(function(v1){return v1&&u1.target.indexOf(v1.getPath())===0;})||o1.getBindingContext().getPath()+"/"+o1.getRowBinding().getPath()===u1.target;});if(!r1){p.showMessage();}}else{var s1=p.getModel("internal");s1.setProperty("filteredMessages",p1,p.getBindingContext("internal"));}}}},{key:"onMassEditButtonPressed",value:function p1(o,p){var o1=this.content;T(o1,p);}}],[{key:"isDataStateVisible",value:function p1(o,p){var o1=p.getParent();while(!o1.isA("sap.fe.macros.TableAPI")){o1=o1.getParent();}return o1.tableDefinition.enableDataStateFilter;}},{key:"updateExportSettings",value:function r1(o,p,o1,p1,q1){o.forEach(function(s1){var t1=[];p===null||p===void 0?void 0:p.forEach(function(u1){var v1=u1;if(p1){var w1=p.some(function(u1){return u1.unit===s1.property;});var x1=n1._getFieldGroupExportLabel(s1,v1,o1);if(x1){t1.unshift(x1);}var y1=n1._getDataFieldDescriptionLabel(s1,v1,o1,w1);if(y1){t1.unshift(y1);}if(v1.isDataPointFakeTargetProperty&&v1.relativePath===s1.property){s1.property=[s1.property];}}if(v1.exportContactProperty&&u1.propertyInfos){var z1,A1,B1,C1;if(((z1=u1.propertyInfos)===null||z1===void 0?void 0:z1.length)===1&&((A1=u1.propertyInfos)===null||A1===void 0?void 0:A1.toString())===s1.property.toString()){s1.property=v1.exportContactProperty;s1.label=v1.label;}else if(((B1=u1.propertyInfos)===null||B1===void 0?void 0:B1.length)>1&&((C1=v1.propertyInfos)===null||C1===void 0?void 0:C1.some(function(E1){return s1.property.includes(E1);}))&&Array.isArray(s1.property)){var D1;s1.property=(D1=s1.property)===null||D1===void 0?void 0:D1.map(function(E1){var F1;return((F1=v1.propertyInfos)===null||F1===void 0?void 0:F1.some(function(G1){return G1===E1;}))?v1.exportContactProperty:E1;});}}});t1.push(S(s1.label,o1));if(t1.length>1){t1=t1.filter(function(u1,v1){if(t1.indexOf(u1)==v1){return u1;}});}if(q1){t1.reverse();}s1.label=t1.join(" - ");});return o;}},{key:"_getFieldGroupExportLabel",value:function u1(o,p,o1){var p1,q1,r1;if((o.columnId.indexOf("::FieldGroup::")!==-1||((p1=p.exportSettings)===null||p1===void 0?void 0:p1.fieldLabel)&&o.columnId.indexOf("__column")!==-1)&&(((q1=p.propertyInfos)===null||q1===void 0?void 0:q1.includes(o.property))||((r1=p.propertyInfos)===null||r1===void 0?void 0:r1.includes("Property::"+o.property)))){var s1;var t1=((s1=p.exportSettings)===null||s1===void 0?void 0:s1.fieldLabel)||p.label;return S(t1,o1);}}},{key:"_getDataFieldDescriptionLabel",value:function u1(o,p,o1,p1){var q1,r1,s1,t1;if(p.propertyInfos&&((q1=p.propertyInfos)===null||q1===void 0?void 0:q1.length)>1&&!p1&&(((r1=p.propertyInfos)===null||r1===void 0?void 0:r1.includes(o.property))||((s1=p.propertyInfos)===null||s1===void 0?void 0:s1.includes("Property::"+o.property)))&&((t1=p.relativePath)===null||t1===void 0?void 0:t1.indexOf("@com.sap.vocabularies.UI.v1.FieldGroup"))===-1){return S(p.label,o1);}}}]);return n1;}(a),R),(x=l1(w.prototype,"tableDefinition",[d],{configurable:true,enumerable:true,writable:true,initializer:null}),y=l1(w.prototype,"readOnly",[f],{configurable:true,enumerable:true,writable:true,initializer:null}),z=l1(w.prototype,"id",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),A=l1(w.prototype,"busy",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),B=l1(w.prototype,"type",[j],{configurable:true,enumerable:true,writable:true,initializer:null}),E=l1(w.prototype,"enableExport",[k],{configurable:true,enumerable:true,writable:true,initializer:null}),F=l1(w.prototype,"enablePaste",[l],{configurable:true,enumerable:true,writable:true,initializer:null}),G=l1(w.prototype,"enableFullScreen",[m],{configurable:true,enumerable:true,writable:true,initializer:null}),H=l1(w.prototype,"selectionMode",[n],{configurable:true,enumerable:true,writable:true,initializer:null}),I=l1(w.prototype,"header",[q],{configurable:true,enumerable:true,writable:true,initializer:null}),J=l1(w.prototype,"headerVisible",[r],{configurable:true,enumerable:true,writable:true,initializer:null}),K=l1(w.prototype,"rowPress",[V],{configurable:true,enumerable:true,writable:true,initializer:null}),N=l1(w.prototype,"personalization",[s],{configurable:true,enumerable:true,writable:true,initializer:null}),O=l1(w.prototype,"variantManagement",[t],{configurable:true,enumerable:true,writable:true,initializer:null}),Q=l1(w.prototype,"enableDataStateFilter",[u],{configurable:true,enumerable:true,writable:true,initializer:null}),l1(w.prototype,"onTableRowPress",[Y],Object.getOwnPropertyDescriptor(w.prototype,"onTableRowPress"),w.prototype),l1(w.prototype,"onInternalDataReceived",[Y],Object.getOwnPropertyDescriptor(w.prototype,"onInternalDataReceived"),w.prototype),l1(w.prototype,"onPaste",[Y],Object.getOwnPropertyDescriptor(w.prototype,"onPaste"),w.prototype),l1(w.prototype,"onPasteButtonPressed",[Y],Object.getOwnPropertyDescriptor(w.prototype,"onPasteButtonPressed"),w.prototype),l1(w.prototype,"onBeforeExport",[Y],Object.getOwnPropertyDescriptor(w.prototype,"onBeforeExport"),w.prototype),l1(w.prototype,"onDataStateChange",[Y],Object.getOwnPropertyDescriptor(w.prototype,"onDataStateChange"),w.prototype),l1(w.prototype,"onMassEditButtonPressed",[Y],Object.getOwnPropertyDescriptor(w.prototype,"onMassEditButtonPressed"),w.prototype)),w))||v);return n1;},false);
