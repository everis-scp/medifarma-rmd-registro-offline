/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2021 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/core/mvc/ControllerExtension","sap/fe/core/BusyLocker","sap/base/util/UriParameters","sap/base/Log"],function(C,B,U,L){"use strict";var E=C.extend("sap.fe.core.controllerextensions.Placeholder",{enumViewType:{OBJECTPAGE:"ObjectPage",LISTREPORT:"ListReport"},getEnumStartingParams:function(){return{FE_VIEW_CREATED:"FE-VIEW-CREATED",FE_DATA_LOADED:"FE-DATA-LOADED",FE_HEROES_LOADED:"FE-HEROES-LOADED",FE_WORKERS_LOADED:"FE-WORKERS-LOADED",FE_HEROES_WORKERS_LOADED:"FE-HEROES-WORKERS-LOADED",DISABLED:"DISABLED"};},override:{onExit:function(){this.oRouter.detachBeforeRouteMatched(this._fnBeforeRouteMatched);sap.m.NavContainer.addCustomTransition("placeholder",function(f,t,c){sap.m.NavContainer.transitions["show"].to(f,t,c);},sap.m.NavContainer.transitions["show"].back);}},attachRouteMatchers:function(){this._init();var t=this;if(this.isPlaceholderEnabled()){this._fnBeforeRouteMatched=function(e){var d=t.navigateToPlaceholder(t.oAppComponent,t.oRouter,t.oRootContainer,t.oPlaceholders);if(d){var r=t.oAppComponent.getRootControl();B.lock(r);t.oRouter.attachEventOnce("routeMatched",function(){var r=t.oAppComponent.getRootControl();if(B.isLocked(r)){B.unlock(r);}});}};this.oRouter.attachBeforeRouteMatched(this._fnBeforeRouteMatched);}},_init:function(){var t=this;this.oAppComponent=this.base.getAppComponent();this.oRouting=this.oAppComponent._oRouting;this.oRootContainer=this.oAppComponent.getRootContainer();this.oRouter=this.oAppComponent.getRouter();this.oPlaceholders={};this.setPlaceholderMapping({"sap.fe.templates.ListReport":{placeHolderName:"sap.fe.placeholder.view.PlaceholderLR",viewType:this.enumViewType.LISTREPORT},"sap.fe.templates.AnalyticalListPage":{placeHolderName:"sap.fe.placeholder.view.PlaceholderLR",viewType:this.enumViewType.LISTREPORT},"sap.fe.templates.ObjectPage":{placeHolderName:"sap.fe.placeholder.view.PlaceholderOP",viewType:this.enumViewType.OBJECTPAGE}});sap.m.NavContainer.addCustomTransition("placeholder",function(f,T,c){if(f.getController&&f.getController().isPlaceholder&&f.getController().isPlaceholder()){var s=f.getController().getOptions("transition");if(s!==t.getEnumStartingParams().FE_VIEW_CREATED){f.getController().fireEvent("targetPageInsertedInContainer",{targetpage:T});var F=f.getController();var o=f.$().css("z-index");f.$().css("z-index",100);T.removeStyleClass("sapMNavItemHidden");c();var _=function(e){f.$().css("z-index",o);f.addStyleClass("sapMNavItemHidden");F.currentTargetNavigated();p.forEach(function(e){P.detachEvent(e.eventId,e.fn);});p=[];};var p=[];var P=T.getComponentInstance().getRootControl().getController().pageReady;P.attachEvent("pageReady",_);p.push({"eventId":"pageReady","fn":_});var a,b;var i=function(){return new Promise(function(r,d){P.attachEvent("heroesBatchReceived",r);P.attachEvent("pageReady",d);p.push({"eventId":"heroesBatchReceived","fn":r});p.push({"eventId":"pageReady","fn":d});});};var I=function(){return new Promise(function(r,d){P.attachEvent("workersBatchReceived",r);P.attachEvent("pageReady",d);p.push({"eventId":"workersBatchReceived","fn":r});p.push({"eventId":"pageReady","fn":d});});};switch(s){case t.getEnumStartingParams().FE_HEROES_LOADED:a=i();a.then(_).catch(function(){L.info("PlaceHolder : Heroes request not received");});break;case t.getEnumStartingParams().FE_WORKERS_LOADED:b=I();b.then(_).catch(function(){L.info("PlaceHolder : Workers request not received");});break;case t.getEnumStartingParams().FE_HEROES_WORKERS_LOADED:a=i();b=I();Promise.all([a,b]).then(_).catch(function(){L.info("PlaceHolder : Heroes or Workers request not received");});break;default:}}else{var F=f.getController();F.currentTargetNavigated();sap.m.NavContainer.transitions["show"].to(f,T,c);}}else{sap.m.NavContainer.transitions["show"].to(f,T,c);}},sap.m.NavContainer.transitions["show"].back);},isPlaceholderEnabled:function(){var p=false;switch(U.fromQuery(window.location.search).get("sap-ui-xx-placeholder")){case"true":p=true;break;case"false":p=false;break;default:p=window["sap-ushell-config"]&&window["sap-ushell-config"].apps&&window["sap-ushell-config"].apps.placeholder&&window["sap-ushell-config"].apps.placeholder.enabled;}return p;},setPlaceholderMapping:function(m){this.oPlaceholderMapping=m;},getPlaceholderMapping:function(m){return this.oPlaceholderMapping;},createPlaceholderView:function(v){var p=new sap.ui.core.mvc.XMLView({viewName:this.oPlaceholderMapping[v].placeHolderName});return p;},navigateToPlaceholder:function(a,r,R,p){var o=a.getRoutingService();var c=r.getHashChanger().getHash().match(/([^?]*)/)[0];var b=o.getRouteFromHash(r,a);var t=o.getTargetsFromRoute(b,a);var d=this;var D=true;if(c!==this.sPreviousTechnicalPath){t.forEach(function(T,i){if(d.isPlaceholderEnabled()){var P;var e=d.getPlaceholderMapping();if(e[T.name]){switch(e[T.name].viewType){case d.enumViewType.OBJECTPAGE:p.oOP=p.oOP?p.oOP:{};P=p.oOP;break;case d.enumViewType.LISTREPORT:p.oLR=p.oLR?p.oLR:{};P=p.oLR;break;default:break;}D=d.base.displayPlaceholders(T,t,P,R,r)?false:true;}}});}this.sPreviousTechnicalPath=c;return D;}});return E;});
