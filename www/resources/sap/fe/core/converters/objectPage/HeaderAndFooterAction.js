/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["../ManifestSettings","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/helpers/ConfigurableObject","sap/fe/core/helpers/BindingExpression","sap/fe/core/converters/helpers/Key","sap/fe/core/templating/DataModelPathHelper","../helpers/BindingHelper"],function(M,A,C,B,K,D,a){"use strict";var _={};var U=a.UI;var s=a.singletonPathVisitor;var b=a.Draft;var i=D.isPathDeletable;var c=K.KeyHelper;var d=B.ifElse;var e=B.and;var f=B.fn;var g=B.equal;var n=B.not;var h=B.compileBinding;var j=B.annotationExpression;var P=C.Placement;var k=A.getSemanticObjectMapping;var l=A.ButtonType;var m=M.ActionType;function o(w,x){var y,z,E;return((y=w.annotations)===null||y===void 0?void 0:(z=y.UI)===null||z===void 0?void 0:(E=z.Identification)===null||E===void 0?void 0:E.filter(function(F){var G,H,J;if((F===null||F===void 0?void 0:(G=F.annotations)===null||G===void 0?void 0:(H=G.UI)===null||H===void 0?void 0:(J=H.Hidden)===null||J===void 0?void 0:J.valueOf())!==true){var L,N,O,Q,R;if((F===null||F===void 0?void 0:F.$Type)==="com.sap.vocabularies.UI.v1.DataFieldForAction"&&!!F.Determining===x&&(!(F===null||F===void 0?void 0:(L=F.ActionTarget)===null||L===void 0?void 0:L.isBound)||(F===null||F===void 0?void 0:(N=F.ActionTarget)===null||N===void 0?void 0:(O=N.annotations)===null||O===void 0?void 0:(Q=O.Core)===null||Q===void 0?void 0:(R=Q.OperationAvailable)===null||R===void 0?void 0:R.valueOf())!==false)){return true;}}return false;}))||[];}_.getIdentificationDataFieldForActions=o;function p(w,x){var y,z,E;return((y=w.annotations)===null||y===void 0?void 0:(z=y.UI)===null||z===void 0?void 0:(E=z.Identification)===null||E===void 0?void 0:E.filter(function(F){var G,H,J;if((F===null||F===void 0?void 0:(G=F.annotations)===null||G===void 0?void 0:(H=G.UI)===null||H===void 0?void 0:(J=H.Hidden)===null||J===void 0?void 0:J.valueOf())!==true){if((F===null||F===void 0?void 0:F.$Type)==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&!!F.Determining===x){return true;}}return false;}))||[];}var I=["UI.CriticalityType/VeryPositive","UI.CriticalityType/Positive","UI.CriticalityType/Negative","UI.CriticalityType/VeryNegative"];function q(w,x){var y=w.getDataModelObjectPath(),z=y.navigationProperties.map(function(J){return J.name;}),E=j(x,z,undefined,function(J){return s(J,w,z);}),F=w.getManifestWrapper(),G=F.getViewLevel(),H=G>1?U.IsEditable:n(U.IsEditable);return d(x===undefined||x.valueOf()===false,H,e(H,g(E,false)));}_.getDeleteButtonVisibility=q;function r(w,x){var y;var z=w.getEntitySet(),E=z&&((y=z.annotations.Common)===null||y===void 0?void 0:y.DraftRoot)?true:false,F=w.getDataModelObjectPath(),G=F.navigationProperties.map(function(N){return N.name;}),H=j(x,G,undefined,function(N){return s(N,w,G);}),J=n(U.IsEditable);var L=d(x===undefined||x.valueOf()===false,J,e(J,g(H,false)));return d(E,e(L,b.HasNoDraftForCurrentUser),L);}_.getEditButtonVisibility=r;function t(w){var x,y,z,E,F,G,H,J;var L=w.getEntitySet(),N=w.getEntityType(),S=L&&((x=L.annotations)===null||x===void 0?void 0:(y=x.Session)===null||y===void 0?void 0:y.StickySessionSupported),O=L&&((z=L.annotations.Common)===null||z===void 0?void 0:z.DraftRoot),Q=L&&((E=L.annotations)===null||E===void 0?void 0:(F=E.Capabilities)===null||F===void 0?void 0:F.DeleteRestrictions),R=L&&((G=L.annotations.UI)===null||G===void 0?void 0:(H=G.UpdateHidden)===null||H===void 0?void 0:H.valueOf()),T=w.getDataModelObjectPath(),V=i(T),W=V?h(V):V,X=o(w.getEntityType(),false);var Y=X.filter(function(j1){return I.indexOf(j1===null||j1===void 0?void 0:j1.Criticality)>-1;}).map(function(j1){var k1,l1;return{type:m.DataFieldForAction,annotationPath:w.getEntitySetBasedAnnotationPath(j1.fullyQualifiedName),key:c.generateKeyFromDataField(j1),visible:h(n(g(j((k1=j1.annotations)===null||k1===void 0?void 0:(l1=k1.UI)===null||l1===void 0?void 0:l1.Hidden),true))),isNavigable:true};});if(((O===null||O===void 0?void 0:O.EditAction)||(S===null||S===void 0?void 0:S.EditAction))&&R!==true){var Z,$,a1,b1;var c1=(L===null||L===void 0?void 0:(Z=L.annotations.UI)===null||Z===void 0?void 0:($=Z.UpdateHidden)===null||$===void 0?void 0:$.valueOf())!==undefined?L===null||L===void 0?void 0:(a1=L.annotations.UI)===null||a1===void 0?void 0:a1.UpdateHidden:N===null||N===void 0?void 0:(b1=N.annotations.UI)===null||b1===void 0?void 0:b1.UpdateHidden;Y.push({type:m.Primary,key:"EditAction",visible:h(r(w,c1))});}if(W&&W!=="false"||(Q===null||Q===void 0?void 0:(J=Q.Deletable)===null||J===void 0?void 0:J.valueOf())!==false&&W!=="false"){var d1,e1,f1,g1;var h1=(L===null||L===void 0?void 0:(d1=L.annotations.UI)===null||d1===void 0?void 0:(e1=d1.DeleteHidden)===null||e1===void 0?void 0:e1.valueOf())!==undefined?L===null||L===void 0?void 0:(f1=L.annotations.UI)===null||f1===void 0?void 0:f1.DeleteHidden:N===null||N===void 0?void 0:(g1=N.annotations.UI)===null||g1===void 0?void 0:g1.DeleteHidden;Y.push({type:m.Secondary,key:"DeleteAction",visible:h(q(w,h1)),parentEntityDeleteEnabled:W});}if((O===null||O===void 0?void 0:O.EditAction)&&R!==true){Y.push({type:m.SwitchToActiveObject,key:"SwitchToActiveObject"});Y.push({type:m.SwitchToDraftObject,key:"SwitchToDraftObject"});}var i1=p(w.getEntityType(),false);i1.filter(function(j1){return I.indexOf(j1===null||j1===void 0?void 0:j1.Criticality)===-1;}).map(function(j1){var k1,l1,m1,n1,o1,p1,q1;var r1={semanticObjectMapping:j1.Mapping?k(j1.Mapping):[]};if(((k1=j1.RequiresContext)===null||k1===void 0?void 0:k1.valueOf())===true){throw new Error("RequiresContext property should not be true for header IBN action : "+j1.Label);}else if(((l1=j1.Inline)===null||l1===void 0?void 0:l1.valueOf())===true){throw new Error("Inline property should not be true for header IBN action : "+j1.Label);}Y.push({type:m.DataFieldForIntentBasedNavigation,text:(m1=j1.Label)===null||m1===void 0?void 0:m1.toString(),annotationPath:w.getEntitySetBasedAnnotationPath(j1.fullyQualifiedName),buttonType:l.Ghost,visible:h(n(g(j((n1=j1.annotations)===null||n1===void 0?void 0:(o1=n1.UI)===null||o1===void 0?void 0:(p1=o1.Hidden)===null||p1===void 0?void 0:p1.valueOf()),true))),enabled:j1.NavigationAvailable!==undefined?h(g(j((q1=j1.NavigationAvailable)===null||q1===void 0?void 0:q1.valueOf()),true)):true,key:c.generateKeyFromDataField(j1),isNavigable:true,press:h(f("._intentBasedNavigation.navigate",[j(j1.SemanticObject),j(j1.Action),r1])),customData:h({semanticObject:j(j1.SemanticObject),action:j(j1.Action)})});});X.filter(function(j1){return I.indexOf(j1===null||j1===void 0?void 0:j1.Criticality)===-1;}).map(function(j1){var k1,l1;Y.push({type:m.DataFieldForAction,annotationPath:w.getEntitySetBasedAnnotationPath(j1.fullyQualifiedName),key:c.generateKeyFromDataField(j1),visible:h(n(g(j((k1=j1.annotations)===null||k1===void 0?void 0:(l1=k1.UI)===null||l1===void 0?void 0:l1.Hidden),true))),isNavigable:true});});return Y;}_.getHeaderDefaultActions=t;function u(w){var x,y,z;var E=w.getEntityType();var F=((x=E.annotations)===null||x===void 0?void 0:(y=x.UI)===null||y===void 0?void 0:(z=y.Identification)===null||z===void 0?void 0:z.filter(function(G){var H,J,L;return(G===null||G===void 0?void 0:(H=G.annotations)===null||H===void 0?void 0:(J=H.UI)===null||J===void 0?void 0:(L=J.Hidden)===null||L===void 0?void 0:L.valueOf())===true;}))||[];return F.map(function(G){return{type:m.Default,key:c.generateKeyFromDataField(G)};});}_.getHiddenHeaderActions=u;function v(w,x){var y,z,E,F,G,H,J;var L=x.getEntitySet();var N=x.getEntityType();var S=L&&((y=L.annotations)===null||y===void 0?void 0:(z=y.Session)===null||z===void 0?void 0:z.StickySessionSupported),O=L&&(((E=L.annotations.Common)===null||E===void 0?void 0:(F=E.DraftRoot)===null||F===void 0?void 0:F.term)||((G=L.annotations)===null||G===void 0?void 0:(H=G.Session)===null||H===void 0?void 0:(J=H.StickySessionSupported)===null||J===void 0?void 0:J.term)),Q=O==="com.sap.vocabularies.Common.v1.DraftRoot"||S&&(S===null||S===void 0?void 0:S.SaveAction),R=w>1,T=O==="com.sap.vocabularies.Common.v1.DraftRoot"||S&&(S===null||S===void 0?void 0:S.DiscardAction);var V=o(x.getEntityType(),true);var W=V.filter(function(X){return I.indexOf(X===null||X===void 0?void 0:X.Criticality)>-1;}).map(function(X){var Y,Z;return{type:m.DataFieldForAction,annotationPath:x.getEntitySetBasedAnnotationPath(X.fullyQualifiedName),key:c.generateKeyFromDataField(X),visible:h(n(g(j((Y=X.annotations)===null||Y===void 0?void 0:(Z=Y.UI)===null||Z===void 0?void 0:Z.Hidden),true))),isNavigable:true};});if((L===null||L===void 0?void 0:L.entityTypeName)===(N===null||N===void 0?void 0:N.fullyQualifiedName)&&Q){W.push({type:m.Primary,key:"SaveAction"});}if(R){W.push({type:m.DefaultApply,key:"ApplyAction"});}V.filter(function(X){return I.indexOf(X===null||X===void 0?void 0:X.Criticality)===-1;}).map(function(X){var Y,Z;W.push({type:m.DataFieldForAction,annotationPath:x.getEntitySetBasedAnnotationPath(X.fullyQualifiedName),key:c.generateKeyFromDataField(X),visible:h(n(g(j((Y=X.annotations)===null||Y===void 0?void 0:(Z=Y.UI)===null||Z===void 0?void 0:Z.Hidden),true))),isNavigable:true});});if(T){W.push({type:m.Secondary,key:"CancelAction",position:{placement:P.End}});}return W;}_.getFooterDefaultActions=v;return _;},false);
