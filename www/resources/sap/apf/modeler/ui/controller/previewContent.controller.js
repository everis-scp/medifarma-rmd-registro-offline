/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
sap.ui.define(['sap/apf/utils/utils','sap/apf/ui/utils/constants','sap/apf/ui/utils/wrappedChartWithCornerTexts',"sap/ui/thirdparty/jquery"],function(u,a,W,q){'use strict';var r,R,p,c,t,o,s,b;var T=sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION;function _(S){var i=S&&c.getTextPool().get(S),m;if(i!==undefined){m=i.TextElementDescription;}return m;}function d(m){var P=_(R[m]());if(P===undefined){P=_(p[m]());}return P;}function e(D,S){return D.sort(function(m,n){var v,i;for(i=0;i<S.length;i++){if(m[S[i].property]<n[S[i].property]){v=-1;}else if(m[S[i].property]>n[S[i].property]){v=1;}v=v*[1,-1][+!S[i].ascending];if(v!==0){return v;}}});}function f(L,A){var i=q.Deferred();s.getEntityTypeMetadataAsPromise().done(function(m){var P,n,v=[];A.forEach(function(D){if(D.sProperty!==t("none")&&D.sProperty!==""){n=L(D.sProperty);if(n!==undefined){P=c.getTextPool().get(n).TextElementDescription;}else{P=s.getDefaultLabel(m,D.sProperty);}v.push({fieldName:D.sProperty,fieldDesc:P,kind:D.sContext});}});i.resolve(v);});return i.promise();}function g(P){var i=q.Deferred();var m=[];if(P==="properties"&&R.getRepresentationType()===T){f(R.getPropertyTextLabelKey,o.getActualProperties()).done(function(A){m=A;});}else if(P==="dimensions"&&R.getRepresentationType()!==T){s.getEntityTypeMetadataAsPromise().done(function(E){f(R.getDimensionTextLabelKey,o.getActualDimensions().concat(o.getActualLegends())).done(function(A){m=A;});});}else if(P==="measures"&&R.getRepresentationType()!==T){s.getEntityTypeMetadataAsPromise().done(function(E){f(R.getMeasureTextLabelKey,o.getActualMeasures()).done(function(A){m=A;m.forEach(function(n){var v=R.getMeasureDisplayOption(n.fieldName);if(v){n.measureDisplayOption=v;}});});});}i.resolve(m);return i.promise();}function h(){var m=q.Deferred();var S=[],n=[],i=0,v=3;var P=s.getProperties();s.getEntityTypeMetadataAsPromise().done(function(E){var D=s.getDimensionsProperties(E);var M=s.getMeasures(E);var C=R.getRepresentationType();var w=C!==T?Math.pow(v,D.length):7;for(i=0;i<w;i++){var x={};if(C===T){P.forEach(function(y){var z=y+" - "+sap.apf.utils.createRandomNumberString(4);x[y]=z;});}else{D.forEach(function(y,z){var A=y+" - "+(Math.floor(i/Math.pow(v,z))%v+1);x[y]=A;});M.forEach(function(y){var z=sap.apf.utils.createRandomNumberString(4);x[y]=z;});}S.push(x);}n=R.getOrderbySpecifications();if(n&&n.length){S=e(S,n);}m.resolve(S);});return m.promise();}function j(){var i=b.getConstructorOfRepresentationType(R.getRepresentationType());var m=i.replaceAll(".","/");sap.ui.require([m],function(C){return C;});var n=sap.apf.utils.extractFunctionFromModulePathString(i);var P={};P.requiredFilters=[];function v(w){return w;}function E(){}var A={getTextNotHtmlEncoded:v,getTextHtmlEncoded:v,getEventCallback:E,getExits:function(){var w={};return w;},getUiApi:function(){var U={};U.getStepContainer=function(){return undefined;};return U;},createFilter:function(){return{getOperators:function(){return{EQ:true};},getTopAnd:function(){return{addOr:E};},getInternalFilter:function(){return{getProperties:function(){return[];}};}};},createMessageObject:E,putMessage:E,updatePath:E,selectionChanged:E,getActiveStep:function(){return{getSelectedRepresentation:function(){return{bIsAlternateView:true};}};}};g("dimensions").done(function(D){P.dimensions=D;});g("measures").done(function(w){P.measures=w;});g("properties").done(function(w){P.properties=w;});r=new n(A,P);if(r.chartType===T){r.oTableRepresentation.removeEventDelegate();r.oTableRepresentation.onAfterRendering(function(){return;});}var M={getPropertyMetadata:function(w){return{label:w};}};h().done(function(w){r.setData(w,M);});}function k(C){var P=C.byId("idPreviewContentDialog");P.setTitle(t("preview"));P.getEndButton().setText(t("close"));}var l=sap.ui.core.mvc.Controller.extend("sap.apf.modeler.ui.controller.previewContent",{onInit:function(){var C=this;var P=C.byId("idPreviewContentDialog");R=C.getView().getViewData().oRepresentation;p=C.getView().getViewData().oParentStep;c=C.getView().getViewData().oConfigurationHandler;t=C.getView().getViewData().oCoreApi.getText;o=C.getView().getViewData().oRepresentationHandler;s=C.getView().getViewData().oStepPropertyMetadataHandler;b=C.getView().getViewData().oRepresentationTypeHandler;k(C);j();C._drawContent();P.open();},_drawContent:function(){this._drawMainChart();this._drawLikeStepInCarousel();},_drawLikeStepInCarousel:function(){var S=p.getTitleId();var i=_(S);var m={getSelectedRepresentation:function(){return r;}};var C=W.getClonedChart(m);var n={rightLower:d("getRightLowerCornerTextKey"),rightUpper:d("getRightUpperCornerTextKey"),leftLower:d("getLeftLowerCornerTextKey"),leftUpper:d("getLeftUpperCornerTextKey")};var v={mode:"preview",titleText:i,oCornerTexts:n};var w=new W.constructor(null,p,C,v);this._addChart(w.getContent());},_drawMainChart:function(){var S=p.getLongTitleId();var i=c.getTextPool().isInitialTextKey(S);var m=S&&!i?S:p.getTitleId();var M=r.getMainContent(_(m),480,330);var v={interaction:{selectability:{axisLabelSelection:true,legendSelection:true,plotLassoSelection:true,plotStdSelection:true}}};if(M.setVizProperties!==undefined)M.setVizProperties(v);this.byId("idMainChart").addItem(M);},handleCloseButtonOfDialog:function(){var C=this;C.byId("idPreviewContentDialog").close();},handleClose:function(){var C=this;C.byId("idPreviewContentDialog").destroy();C.getView().destroy();},_addChart:function(i){this.byId("idThumbnail").addItem(i);}});return l;},true);
