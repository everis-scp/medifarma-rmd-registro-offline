sap.ui.define(["sap/ui/base/Object","sap/base/util/extend","sap/suite/ui/generic/template/lib/CRUDHelper","sap/m/MessageBox"],function(B,e,C,M){"use strict";function g(t){var o;var O;function d(b,c){o=b;O=c;var w=t.getText("ST_KEEP_DRAFT_MESSAGE");var k=t.getText("ST_KEEP_DRAFT_BTN");var s=t.getText("ST_DISCARD_DRAFT_BTN");var h=t.getText("CANCEL");M.warning(w,{title:t.getText("ST_UNSAVED_CHANGES_TITLE"),actions:[k,s,h],emphasizedAction:k,onClose:function(A){if(A===k){o();}else if(A===s){var j=f().then(o);j.catch(O);}else if(A===h){O();}}});}var D;function f(){var T=t.oAppComponent.getTransactionController();var b=T.getDraftController();var A=t.oApplicationProxy;var c=A.getContextForPath(a());var h=t.oNavigationControllerProxy.getCurrentIdentity();D=C.discardDraft(b,T,A,c).then(function(){t.oViewDependencyHelper.setRootPageToDirty();t.oViewDependencyHelper.unbindChildrenUsingTreeNode(h.treeNode);A.invalidatePaginatorInfo();});return D;}function p(b,n,m,I){var c=function(){b();};var E=t.oNavigationControllerProxy.isDiscardDraftConfirmationNeeded();var h=i();var N;if(m==="NavigateExternal"&&E==="restricted"){N=false;}else{N=(E==="always"||E==="restricted")&&h;}if(N){d(c,n);}else{c();}}function i(){return t.oApplicationProxy.checkIfObjectIsADraftInstance(a());}function a(){var c=t.oNavigationControllerProxy.getCurrentIdentity();var A=t.oApplicationProxy.getAncestralNode(c.treeNode,1);var s=A.getPath(3,c.keys);return s;}function P(b,c,m,n,I){m=m||"LeavePage";var r=new Promise(function(R,h){var j=function(){var r=b();R(r);};var N=function(){c();h();};if(n){p(j,N,m,I);}else{t.oApplicationProxy.performAfterSideEffectExecution(p.bind(null,j,N,m,I),true);}});return r;}return{discardDraft:f,performAfterDiscardOrKeepDraft:P};}return B.extend("sap.suite.ui.generic.template.lib.PageLeaveHandler",{constructor:function(t){e(this,g(t));}});});
