/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['./InputBase','./ComboBoxTextField','./ComboBoxBase','./Tokenizer','./Token','./List','./StandardListItem','./Popover','./GroupHeaderListItem','./library','sap/ui/core/EnabledPropagator','sap/ui/core/IconPool','sap/ui/core/library','sap/ui/Device','sap/ui/core/Item','sap/ui/core/SeparatorItem','sap/ui/core/ResizeHandler','./MultiComboBoxRenderer',"sap/ui/dom/containsOrEquals","sap/m/inputUtils/completeTextSelected","sap/m/inputUtils/inputsDefaultFilter","sap/m/inputUtils/typeAhead","sap/m/inputUtils/ListHelpers","sap/m/inputUtils/filterItems","sap/m/inputUtils/itemsVisibilityHandler","sap/m/inputUtils/selectionRange","sap/m/inputUtils/calculateSelectionStart","sap/m/inputUtils/forwardItemPropertiesToToken","sap/m/inputUtils/getTokenByItem","sap/ui/events/KeyCodes","sap/base/util/deepEqual","sap/base/assert","sap/base/Log","sap/ui/core/Core",'sap/ui/core/InvisibleText',"sap/ui/thirdparty/jquery","sap/ui/dom/jquery/cursorPos","sap/ui/dom/jquery/control"],function(I,C,a,T,b,L,S,P,G,l,E,c,d,D,e,f,R,M,g,h,j,t,k,m,n,s,o,p,q,K,r,u,v,w,x,Q){"use strict";var y=l.ListMode;var V=d.ValueState;var O=d.OpenState;var z=l.TokenizerRenderMode;var A=a.extend("sap.m.MultiComboBox",{metadata:{library:"sap.m",designtime:"sap/m/designtime/MultiComboBox.designtime",properties:{selectedKeys:{type:"string[]",group:"Data",defaultValue:[]},hasSelection:{type:"boolean",visibility:"hidden",defaultValue:false}},associations:{selectedItems:{type:"sap.ui.core.Item",multiple:true,singularName:"selectedItem"}},aggregations:{tokenizer:{type:"sap.m.Tokenizer",multiple:false,visibility:"hidden"}},events:{selectionChange:{parameters:{changedItem:{type:"sap.ui.core.Item"},changedItems:{type:"sap.ui.core.Item[]"},selected:{type:"boolean"},selectAll:{type:"boolean"}}},selectionFinish:{parameters:{selectedItems:{type:"sap.ui.core.Item[]"}}}},dnd:{draggable:false,droppable:true}}});c.insertFontFaceStyle();E.apply(A.prototype,[true]);A.prototype.clone=function(i){var B=a.prototype.clone.apply(this,arguments),F=this._getList();if(F){B.syncPickerContent();}return B;};A.prototype.open=function(){if(!this.isOpen()){this._bPickerIsOpening=true;}this.syncPickerContent();return a.prototype.open.apply(this,arguments);};A.prototype.onsapend=function(i){if(i.isMarked("forwardFocusToParent")){this.focus();}};A.prototype.onsaphome=function(i){if(!this.getFocusDomRef().selectionStart&&this._hasTokens()){T.prototype.onsaphome.apply(this.getAggregation("tokenizer"),arguments);}i.setMarked();};A.prototype.onsapdown=function(i){if(!this.getEnabled()||!this.getEditable()){return;}i.setMarked();i.preventDefault();this.syncPickerContent();if(!this.isOpen()){this._oTraversalItem=this._getNextTraversalItem();if(this._oTraversalItem&&!this.isFocusInTokenizer()&&!this.isComposingCharacter()){this.updateDomValue(this._oTraversalItem.getText());this.selectText(0,this.getValue().length);}return;}if(this.getValueState()!=V.None){this._handleFormattedTextNav();return;}setTimeout(function(){var B=k.getVisibleItems(this.getItems()),F=B[0];F&&k.getListItem(F).focus();}.bind(this),0);};A.prototype.onsapup=function(i){if(!this.getEnabled()||!this.getEditable()){return;}i.setMarked();i.preventDefault();this.syncPickerContent();if(this.isFocusInTokenizer()||this.isOpen()){return;}this._oTraversalItem=this._getPreviousTraversalItem();if(this._oTraversalItem){this.updateDomValue(this._oTraversalItem.getText());this.selectText(0,this.getValue().length);}};A.prototype.isFocusInTokenizer=function(){return Q.contains(this.getAggregation("tokenizer").getFocusDomRef(),document.activeElement);};A.prototype.onsapshow=function(i){this._handleItemToFocus();a.prototype.onsapshow.apply(this,arguments);};A.prototype._handlePopupOpenAndItemsLoad=function(){this._handleItemToFocus();a.prototype._handlePopupOpenAndItemsLoad.apply(this,arguments);};A.prototype._valueStateNavDelegate=function(i,F,B){var H=this.getFocusDomRef();this.oValueStateNavDelegate={onsapdown:function(J){var N=k.getVisibleItems(this.getItems()),U=N.length&&k.getListItem(N[0]);J.preventDefault();U&&U.focus();}.bind(this),onsapup:function(){H.focus();},onsapend:function(J){var N=k.getVisibleItems(this.getItems()),U=N.length&&k.getListItem(N[N.length-1]);J.preventDefault();U&&U.focus();}.bind(this),onfocusout:function(J){i.removeStyleClass("sapMFocusable");if(!i.getDomRef().contains(J.relatedTarget)){B.forEach(function(N){N.getDomRef().setAttribute("tabindex","-1");});}}};return this.oValueStateNavDelegate;};A.prototype._closePickerDelegate={onsaptabnext:function(){this.close();setTimeout(function(){this.closeValueStateMessage();}.bind(this),0);}};A.prototype._formattedTextLinksNav={onsapup:function(){this.focus();},onsapdown:function(){var i=k.getSelectableItems(this.getItems());if(i.length){i[0].focus();}}};A.prototype._handleFormattedTextNav=function(){var i=this.getPicker().getCustomHeader(),B=this.getValueStateLinks(),F=i.getFormattedText(),H=this.oValueStateNavDelegate||this._valueStateNavDelegate(i,F,B),J=B?B[B.length-1]:null,N=B?B[0]:null;if(!i.getDomRef()||i.getDomRef()===document.activeElement){return;}i.getDomRef().setAttribute("tabindex","-1");i.addDelegate(H);i.addStyleClass("sapMFocusable");i.focus();B.forEach(function(U){U.getDomRef().setAttribute("tabindex","0");U.addDelegate(this._formattedTextLinksNav,this);},this);this.oMoveFocusBackToVSHeader=!this.oMoveFocusBackToVSHeader?{onsaptabprevious:function(U){U.preventDefault();i.focus();i.addStyleClass("sapMFocusable");}}:this.oMoveFocusBackToVSHeader;J&&J.addDelegate(this._closePickerDelegate,this);N&&N.addDelegate(this.oMoveFocusBackToVSHeader,this);};A.prototype.onsaphide=A.prototype.onsapshow;A.prototype._selectItemByKey=function(B){var F,H,J,i,N,U,W=this.isOpen();if(!this.getEnabled()||!this.getEditable()){return;}if(B){B.setMarked();}F=this._getUnselectedItems(W?"":this.getValue());for(i=0;i<F.length;i++){U=!(F[i].getKey()===undefined||F[i].getKey()===null)&&!F[i].isA("sap.ui.core.SeparatorItem");if(F[i].getText().toUpperCase()===this.getValue().toUpperCase()&&U){J=F[i];N=true;break;}}if(N){H={item:J,id:J.getId(),key:J.getKey(),fireChangeEvent:true,fireFinishEvent:true,suppressInvalidate:true,listItemUpdated:false};this._bPreventValueRemove=false;if(this.getValue()===""||(typeof this.getValue()==="string"&&J.getText().toLowerCase().startsWith(this.getValue().toLowerCase()))){if(k.getListItem(J).isSelected()){this.setValue('');}else{this.setSelection(H);}}}else{this._bPreventValueRemove=true;}if(B){this.close();}};A.prototype.onsapenter=function(i){var B=this.getAggregation("tokenizer");I.prototype.onsapenter.apply(this,arguments);this._showAlreadySelectedVisualEffect();if(this.getValue()){this._selectItemByKey(i);}if(!this.getEditable()&&B.getHiddenTokensCount()&&i.target===this.getFocusDomRef()){B._togglePopup(B.getTokensPopup());}};A.prototype.onsaptabnext=function(i){var B=this.getValue();if(B){var F=this._getUnselectedItemsStartingText(B);if(F.length===1){this._selectItemByKey(i);}else{this._showWrongValueVisualEffect();}}};A.prototype.onsaptabprevious=A.prototype.onsaptabnext;A.prototype.onsapfocusleave=function(i){var B=this.isPlatformTablet(),F=w.byId(i.relatedControlId),H=F&&F.getFocusDomRef(),J=this.getValue(),N=this.getPicker(),U=this.getAggregation("tokenizer");if(!this._bPickerIsOpening&&(!N||!N.getFocusDomRef()||!H||!Q.contains(N.getFocusDomRef(),H))){this.setValue(null);if(J){this.fireChangeEvent("",{value:J});}if(!Q.contains(this.getDomRef(),document.activeElement)){U.setRenderMode(z.Narrow);}}if(N&&H){if(r(N.getFocusDomRef(),H)&&!B&&!this.isPickerDialog()){this.focus();}}};A.prototype.onfocusin=function(i){var B=this.getPicker();var F=false;var H=B&&B.getFocusDomRef();var J=(B&&B.oPopup.getOpenState())||O.CLOSED;var N=J===O.CLOSING||J===O.CLOSED;var U=this.getPickerType()==="Dropdown";var W=this.getAggregation("tokenizer");if(U){F=H&&Q.contains(H,i.relatedTarget);}if(this.getEditable()&&i.target===this.getDomRef("inner")){W.setRenderMode(z.Loose);}if(i.target===this.getFocusDomRef()){W.hasOneTruncatedToken()&&W.setFirstTokenTruncated(false);this.getEnabled()&&this.addStyleClass("sapMFocus");!N&&F&&this.handleInputValidation(i,false);}if(i.target===this.getOpenArea()&&U&&!this.isPlatformTablet()){this.focus();}if(!this.isOpen()&&this.shouldValueStateMessageBeOpened()){this.openValueStateMessage();}};A.prototype._handleItemTap=function(i){var B=Q(i.target).control(0);if(!B.isA("sap.m.CheckBox")&&!B.isA("sap.m.GroupHeaderListItem")){this._bCheckBoxClicked=false;}};A.prototype._handleItemPress=function(i){if(this.isOpen()&&this._isListInSuggestMode()&&this.getPicker().oPopup.getOpenState()!==O.CLOSING){this.clearFilter();var B=this._getLastSelectedItem();if(B){k.getListItem(B).focus();}}};A.prototype._handleSelectionLiveChange=function(i){if(i.getParameter("selectAll")){return;}var B=i.getParameter("listItem");var F=i.getParameter("listItems");var H=F&&F[F.length-1]||B;var J=this.isPickerDialog()?this.getPickerTextField():this;var N=this._getIsClick()&&!!H;var U=i.getParameter("selected");var W=k.getItemByListItem(this.getItems(),B);var X;if(F&&F.length){X=[];F.forEach(function(Z){if(Z.getType()==="Active"){X.push(k.getItemByListItem(this.getItems(),Z));}},this);}if(B.getType()==="Inactive"){return;}u(W,"The corresponding mapped item was not found on "+this);if(!W){return;}var Y={item:W,items:X,id:W.getId(),key:W.getKey(),selectAll:false,fireChangeEvent:true,suppressInvalidate:true,listItemUpdated:true};if(U){this.fireChangeEvent(W.getText());this.setSelection(Y);}else{this.fireChangeEvent(W.getText());this.removeSelection(Y);}if(this._bCheckBoxClicked){J.setValue(this._sOldInput);if(N&&this.isOpen()&&this.getPicker().oPopup.getOpenState()!==O.CLOSING){H.focus();this._setIsClick(false);}}else{this._bCheckBoxClicked=true;this.setValue("");this.close();}};A.prototype.onkeydown=function(i){var B=this.getEditable(),F=this.getAggregation("tokenizer"),H=F.getTokens().length;a.prototype.onkeydown.apply(this,arguments);if(!this.getEnabled()){return;}if((i.ctrlKey||i.metaKey)&&i.which===K.I&&H){i.preventDefault();if(B){this._togglePopover();}else{this._handleIndicatorPress();}return;}this._bIsPasteEvent=(i.ctrlKey||i.metaKey)&&(i.which===K.V);if(this.getValue().length===0&&(i.ctrlKey||i.metaKey)&&(i.which===K.A)&&this._hasTokens()){F.focus();F.selectAllTokens(true);i.preventDefault();}if(this.isPickerDialog()){this._sOldValue=this.getPickerTextField().getValue();this._iOldCursorPos=Q(this.getFocusDomRef()).cursorPos();}this._bDoTypeAhead=!D.os.android&&(i.which!==K.BACKSPACE)&&(i.which!==K.DELETE);};A.prototype.oninput=function(i){a.prototype.oninput.apply(this,arguments);var B=i.srcControl,F=this.isPickerDialog(),H=F?this.getPickerTextField():this,J=H.getValueState();if(J===V.Error&&this._bAlreadySelected){H.setValueState(this._sInitialValueState);H.setValueStateText(this._sInitialValueStateText);this._bAlreadySelected=false;}if(!this.getEnabled()||!this.getEditable()){return;}this.syncPickerContent();this.handleInputValidation(i,this.isComposingCharacter());if(this._bIsPasteEvent){B.updateDomValue(this._sOldValue||i.target.value||"");return;}if(this.isOpen()){setTimeout(this.highlightList.bind(this,this._sOldInput));}if(this._getItemsShownWithFilter()){this.toggleIconPressedStyle(true);}};A.prototype.filterItems=function(i){return m(this,i.items,i.value,true,false,this.fnFilter||j);};A.prototype.onkeyup=function(i){if(!this.getEnabled()||!this.getEditable()){return;}this._sOldValue=this.getValue();this._iOldCursorPos=Q(this.getFocusDomRef()).cursorPos();};A.prototype._showWrongValueVisualEffect=function(){var i=this._getSuggestionsPopover();var B=this._sInitialValueStateText;var F=this._sInitialValueState;var H=B||this._oRbC.getText("VALUE_STATE_ERROR");var J=this;if(F===V.Error){return;}if(i){i.updateValueState(V.Error,H,true);setTimeout(i.updateValueState.bind(i,J.getValueState(),H,true),1000);}if(!this.isPickerDialog()){this.setValueState(V.Error);this.setValueStateText(this.getValueStateText()||H);setTimeout(this["setValueState"].bind(this,F||V.Error),1000);}this._syncInputWidth(this.getAggregation("tokenizer"));};A.prototype._showAlreadySelectedVisualEffect=function(){var i=this._oRbM.getText("VALUE_STATE_ERROR_ALREADY_SELECTED");if(!this.getValue()){return;}var B=!!this.getSelectedItems().filter(function(F){return F.getText().toLowerCase()===this.getValue().toLowerCase();},this).length;var N=this.getItems().filter(function(F){return F.getText().toLowerCase()===this.getValue().toLowerCase();},this).length;if(B){this._sInitialValueState=this.getValueState();this._sInitialValueStateText=this.getValueStateText();this.setValueStateText(i);this._bAlreadySelected=true;this.setValueState("Error");return;}else if(N){return;}else{this._showWrongValueVisualEffect();}};A.prototype._hasShowSelectedButton=function(){return true;};A.prototype.forwardEventHandlersToSuggPopover=function(i){a.prototype.forwardEventHandlersToSuggPopover.apply(this,arguments);i.setShowSelectedPressHandler(this._filterSelectedItems.bind(this));};A.prototype.configPicker=function(i){var B=this.getRenderer(),F=B.CSS_CLASS_MULTICOMBOBOX;i.setHorizontalScrolling(false).addStyleClass(B.CSS_CLASS_COMBOBOXBASE+"Picker").addStyleClass(F+"Picker").addStyleClass(F+"Picker-CTX").attachBeforeOpen(this.onBeforeOpen,this).attachAfterOpen(this.onAfterOpen,this).attachBeforeClose(this.onBeforeClose,this).attachAfterClose(this.onAfterClose,this).addEventDelegate({onBeforeRendering:this.onBeforeRenderingPicker,onAfterRendering:this.onAfterRenderingPicker},this);};A.prototype._configureList=function(i){var B=10;if(!i){return;}i.setMode(y.MultiSelect);i.setIncludeItemInSelection(true);i.setGrowingThreshold(B);i.attachBrowserEvent("tap",this._handleItemTap,this).attachSelectionChange(this._handleSelectionLiveChange,this).attachItemPress(this._handleItemPress,this);i.addEventDelegate({onAfterRendering:this.onAfterRenderingList,onfocusin:this.onFocusinList},this);};A.prototype._decoratePopupInput=function(i){a.prototype._decoratePopupInput.apply(this,arguments);if(!i||!i.isA(["sap.m.InputBase"])){return;}i.attachSubmit(function(B){var F=i.getValue();if(F){this.setValue(F);this._selectItemByKey();this.setValue(this._sOldInput);this.close();}}.bind(this));i.addEventDelegate({onfocusout:this._handleInputFocusOut},this);return i;};A.prototype.onBeforeRendering=function(){var i=this.getEditable();var B=this.getAggregation("tokenizer");a.prototype.onBeforeRendering.apply(this,arguments);this._bInitialSelectedKeysSettersCompleted=true;B.setEnabled(this.getEnabled());B.setEditable(i);this._updatePopoverBasedOnEditMode(i);if(!this.getItems().length){this._clearTokenizer();}if(this._getList()){this.syncPickerContent(true);}this._deregisterResizeHandler();this._synchronizeSelectedItemAndKey();this.setProperty("hasSelection",!!this.getSelectedItems().length,true);if(!this._bAlreadySelected){this._sInitialValueStateText=this.getValueStateText();}if(this.getValueState()!==V.Error){this._sInitialValueState=this.getValueState();}};A.prototype.syncPickerContent=function(F){var i,B,H=this.getPicker();if(!H){H=this.createPicker(this.getPickerType());this._updateSuggestionsPopoverValueState();F=true;}if(F){B=this._getList();i=this.getEditable()?this.getItems():this.getSelectedItems();this._synchronizeSelectedItemAndKey();B.destroyItems();this._clearTokenizer();this._fillList(i);if(B.getItemNavigation()){this._iFocusedIndex=B.getItemNavigation().getFocusedIndex();}}return H;};A.prototype._registerResizeHandler=function(){u(!this._iResizeHandlerId,"Resize handler already registered");this._iResizeHandlerId=R.register(this,this._onResize.bind(this));};A.prototype._deregisterResizeHandler=function(){if(this._iResizeHandlerId){R.deregister(this._iResizeHandlerId);this._iResizeHandlerId=null;}};A.prototype._onResize=function(){var i=this.getAggregation("tokenizer");i.setMaxWidth(this._calculateSpaceForTokenizer());this._syncInputWidth(i);this._handleNMoreAccessibility();};A.prototype.onBeforeRenderingPicker=function(){var i=this["_onBeforeRendering"+this.getPickerType()];if(i){i.call(this);}};A.prototype.onAfterRenderingPicker=function(){var i=this["_onAfterRendering"+this.getPickerType()];if(i){i.call(this);}};A.prototype.onBeforeOpen=function(){a.prototype.onBeforeOpen.apply(this,arguments);var i=this["_onBeforeOpen"+this.getPickerType()];this.addContent();this._aInitiallySelectedItems=this.getSelectedItems();this._synchronizeSelectedItemAndKey();if(i){i.call(this);}};A.prototype.onAfterOpen=function(){var i=this.getFocusDomRef(),B=this.getValueStateLinks();i&&this.getFocusDomRef().setAttribute("aria-expanded","true");this._bPickerIsOpening=false;if(!this.isPlatformTablet()){this.getPicker().setInitialFocus(this);}B.forEach(function(F){F.addDelegate({onAfterRendering:function(){if(this.getFocusDomRef()){this.getFocusDomRef().setAttribute("tabindex","-1");}}},F);});this.closeValueStateMessage();};A.prototype.onBeforeClose=function(){a.prototype.onBeforeClose.apply(this,arguments);};A.prototype.onAfterClose=function(){var U=!Q.contains(this.getDomRef(),document.activeElement)||this.isPickerDialog(),i=this.getFocusDomRef();i&&this.getFocusDomRef().setAttribute("aria-expanded","false");this.toggleIconPressedStyle(false);this.clearFilter();!this.isComposingCharacter()&&!this._bPreventValueRemove&&this.setValue("");this._sOldValue="";this._sOldInput="";this._getSuggestionsPopover()._sTypedInValue="";if(this.isPickerDialog()){this.getPickerTextField().setValue("");this.getFilterSelectedButton()&&this.getFilterSelectedButton().setPressed(false);}this.fireSelectionFinish({selectedItems:this.getSelectedItems()});this.getAggregation("tokenizer").setRenderMode(U?z.Narrow:z.Loose);if(this.getValueState()==V.Error&&document.activeElement===this.getFocusDomRef()){this.selectText(0,this.getValue().length);}};A.prototype._onBeforeOpenDialog=function(){};A.prototype._onBeforeOpenDropdown=function(){var i=this.getPicker(),B=this.getDomRef(),W;if(B&&i){W=(B.offsetWidth/parseFloat(l.BaseFontSize))+"rem";i.setContentMinWidth(W);}};A.prototype.getFilterSelectedButton=function(){return this._getSuggestionsPopover().getFilterSelectedButton();};A.prototype._filterSelectedItems=function(i,F){var B=i.oSource,H,J,N=this.getPickerTextField()?this.getPickerTextField().getValue():"",U=(B&&B.getPressed&&B.getPressed())||F,W=k.getVisibleItems(this.getItems()),X=this.getItems(),Y=this.getSelectedItems(),Z=null;if(U){W.forEach(function($){J=Y.indexOf($)>-1?true:false;H=k.getListItem($);if(!H){return;}if(H.isA("sap.m.GroupHeaderListItem")){H.setVisible(false);Z=H;}else{H.setVisible(J);if(J&&Z){Z.setVisible(true);}}},this);}else{n(this.getItems(),this.filterItems({value:N,items:X}));}};A.prototype.revertSelection=function(){this.setSelectedItems(this._aInitiallySelectedItems);};A.prototype.setSelection=function(i){var B=this._getList(),N;if(i.item&&this.isItemSelected(i.item)){return;}if(!i.item){return;}if(!i.items||!i.items.length||i.selectAll){N=[i.item];}else{N=i.items;}N.forEach(function(F){if(!i.listItemUpdated&&k.getListItem(F)&&B){B.setSelectedItem(k.getListItem(F),true);}var H=new b({key:F.getKey()});H.setText(F.getText());F.data(k.CSS_CLASS+"Token",H);this.getAggregation("tokenizer").addToken(H);this.addAssociation("selectedItems",F,i.suppressInvalidate);var J=this.getSelectedKeys();var U=this.getKeys([F])[0];if(U===""||J.indexOf(U)===-1){J.push(U);this.setProperty("selectedKeys",J,i.suppressInvalidate);}if(i.fireChangeEvent){this.fireSelectionChange({changedItem:i.item,changedItems:i.items,selectAll:i.selectAll,selected:true});}},this);this.setValue('');if(i.fireFinishEvent){if(!this.isOpen()){this.fireSelectionFinish({selectedItems:this.getSelectedItems()});}}};A.prototype.removeSelection=function(i){var B,F,H;if(i.item&&!this.isItemSelected(i.item)){return;}if(!i.item){return;}if(!i.items||!i.items.length||i.selectAll){B=[i.item];}else{B=i.items;}B.forEach(function(N){this.removeAssociation("selectedItems",N,i.suppressInvalidate);F=this.getSelectedKeys();H=F.indexOf(N.getKey());F.splice(H,1);this.setProperty("selectedKeys",F,i.suppressInvalidate);if(!i.listItemUpdated&&k.getListItem(N)){var J=k.getListItem(N);this._getList().setSelectedItem(J,false);}if(!i.tokenUpdated){var U=q(N);N.data(k.CSS_CLASS+"Token",null);this.getAggregation("tokenizer").removeToken(U);}if(i.fireChangeEvent){this.fireSelectionChange({changedItem:i.item,changedItems:i.items,selectAll:i.selectAll,selected:false});}},this);if(i.fireFinishEvent){if(!this.isOpen()){this.fireSelectionFinish({selectedItems:this.getSelectedItems()});}}};A.prototype._synchronizeSelectedItemAndKey=function(){var B=this.getSelectedKeys();var F=this.getKeys(this.getSelectedItems());if(!B.length){v.info("Info: _synchronizeSelectedItemAndKey() the MultiComboBox control does not contain any item on ",this);return;}for(var i=0,H=null,J=null,N=B.length;i<N;i++){H=B[i];if(F.indexOf(H)>-1){continue;}J=this.getItemByKey(""+H);if(J){this.setSelection({item:J,id:J.getId(),key:J.getKey(),fireChangeEvent:false,suppressInvalidate:true,listItemUpdated:false});}}};A.prototype.updateItems=function(i){var B=function(N){return N&&N.getKey&&N.getKey();},F,H=this.getSelectedItems().map(B),J=this.getSelectedKeys();var U=a.prototype.updateItems.apply(this,arguments);H=this.getSelectedItems().map(B).filter(function(N){return H.indexOf(N)>-1;});F=J.concat(H);this.setSelectedKeys(F);return U;};A.prototype._getSelectedItemsOf=function(B){for(var i=0,F=B.length,H=[];i<F;i++){if(k.getListItem(B[i]).isSelected()){H.push(B[i]);}}return H;};A.prototype._getLastSelectedItem=function(){var i=this.getAggregation("tokenizer").getTokens();var B=i.length?i[i.length-1]:null;if(!B){return null;}return this._getItemByToken(B);};A.prototype._getFocusedListItem=function(){if(!document.activeElement){return null;}var F=w.byId(document.activeElement.id);if(this._getList()&&g(this._getList().getFocusDomRef(),F.getFocusDomRef())){return F;}return null;};A.prototype._getFocusedItem=function(){return k.getItemByListItem(this.getItems(),this._getFocusedListItem());};A.prototype._hasTokens=function(){return this.getAggregation("tokenizer").getTokens().length>0;};A.prototype._decorateListItem=function(i){i.addDelegate({onkeydown:function(B){if((B.ctrlKey||B.metaKey)&&B.which==K.A){B.setMarked();B.preventDefault();var F=k.getSelectableItems(this.getItems()).filter(function(J){return!J.isA("sap.ui.core.SeparatorItem")&&!J.isA("sap.m.GroupHeaderListItem");});var H=this._getSelectedItemsOf(F);if(H.length!==F.length){F.forEach(function(J){this.setSelection({item:J,items:F,selectAll:true,id:J.getId(),key:J.getKey(),fireChangeEvent:true,suppressInvalidate:true,listItemUpdated:false});},this);}else{F.forEach(function(J){this.removeSelection({item:J,items:F,selectAll:true,id:J.getId(),key:J.getKey(),fireChangeEvent:true,suppressInvalidate:true,listItemUpdated:false});},this);}}},onmousedown:function(B){this._setIsClick(true);},onkeyup:function(B){var F=null;if(B.which==K.SPACE&&this.isOpen()&&this._isListInSuggestMode()){this.open();F=this._getLastSelectedItem();if(F){k.getListItem(F).focus();}return;}}},true,this);i.addEventDelegate({onsapbackspace:function(B){B.preventDefault();},onsapshow:function(B){B.setMarked();if(this.isOpen()){this.close();return;}if(this.hasContent()){this.open();}},onsaphide:function(B){this.onsapshow(B);},onsapenter:function(B){B.setMarked();this.close();},onsaphome:function(B){B.setMarked();B.preventDefault();if(this.getValueState()!==V.None){this._handleFormattedTextNav();B.stopPropagation(true);return;}var F=k.getSelectableItems(this.getItems());var H=F[0];k.getListItem(H).focus();},onsapend:function(B){B.setMarked();B.preventDefault();var F=k.getSelectableItems(this.getItems());var H=F[F.length-1];k.getListItem(H).focus();},onsapup:function(B){B.setMarked();B.preventDefault();var F=k.getVisibleItems(this.getItems());var H=F[0];var J=Q(document.activeElement).control()[0];if(J===k.getListItem(H)&&this.getValueState()!==V.None){this._handleFormattedTextNav();B.stopPropagation(true);return;}else if(J===k.getListItem(H)){this.focus();B.stopPropagation(true);}},onfocusin:function(B){this.addStyleClass(this.getRenderer().CSS_CLASS_MULTICOMBOBOX+"Focused");},onfocusout:function(B){this.removeStyleClass(this.getRenderer().CSS_CLASS_MULTICOMBOBOX+"Focused");},onsapfocusleave:function(B){var F=this.getAggregation("picker");var H=w.byId(B.relatedControlId);if(F&&H&&r(F.getFocusDomRef(),H.getFocusDomRef())){if(B.srcControl){B.srcControl.focus();}}},onsaptabnext:function(){this.getPicker().close();},onsaptabprevious:function(){this.getPicker().close();}},this);if(D.support.touch){i.addEventDelegate({ontouchstart:function(B){B.setMark("cancelAutoClose");}});}};A.prototype._handleInputFocusOut=function(){var i=this.isPickerDialog()?this.getPickerTextField():this,U=this._sOldInput||this._sOldValue||"";i.updateDomValue(U);this._bIsPasteEvent=null;};A.prototype.onItemChange=function(i){var B=a.prototype.onItemChange.call(this,i,this.getShowSecondaryValues());var F=i.getParameters();p({item:i.getSource(),propName:F.name,propValue:F.newValue});return B;};A.prototype._handleIndicatorPress=function(){var i,B=this.getAggregation("tokenizer");if(this.getEditable()){this.syncPickerContent();this._filterSelectedItems({},true);this.focus();i=this.getPicker();i.open();}else{B._togglePopup(B.getTokensPopup());}if(this.isPickerDialog()){this.getFilterSelectedButton().setPressed(true);this.bOpenedByKeyboardOrButton=true;}};A.prototype._togglePopover=function(){var i=this.getPicker();if(!i){i=this.syncPickerContent(true);}if(i.isOpen()){i.close();}else{i.open();}};A.prototype._createTokenizer=function(){var i=new T({renderMode:z.Narrow}).attachTokenDelete(this._handleTokenDelete,this);i.getTokensPopup().attachAfterOpen(function(){if(i.hasOneTruncatedToken()){i.setFirstTokenTruncated(false);}}).attachAfterClose(function(){var B=i.getTokens();if(B.length===1&&!B[0].getTruncated()){i.setFirstTokenTruncated(true);}});i.addEventDelegate({onAfterRendering:this._onAfterRenderingTokenizer},this);return i;};A.prototype._onAfterRenderingTokenizer=function(){var i=this.getAggregation("tokenizer");if(this.getEditable()){i.addStyleClass("sapMTokenizerIndicatorDisabled");}else{i.removeStyleClass("sapMTokenizerIndicatorDisabled");}setTimeout(this._syncInputWidth.bind(this,i),0);setTimeout(this._handleNMoreAccessibility.bind(this),0);setTimeout(i["scrollToEnd"].bind(i),0);this._toggleTokenClass();};A.prototype._handleTokenDelete=function(i){var B=i.getParameter("tokens");var F=this.getSelectedItems();this._removeSelection(B);if(F.length!==k.getSelectableItems(this.getItems())){!this.isPickerDialog()&&!this.isFocusInTokenizer()&&this.focus();this.fireChangeEvent("");this.setProperty("hasSelection",!!this.getSelectedItems().length);}};A.prototype._removeSelection=function(i){var B=this.getAggregation("tokenizer");i.forEach(function(F){var H=(F&&this._getItemByToken(F));if(!this.getEditable()||!this.getEnabled()||!H||!this.isItemSelected(H)||!H.getEnabled()||!F.getEditable()){return;}this.removeSelection({item:H,id:H.getId(),key:H.getKey(),tokenUpdated:true,fireChangeEvent:true,fireFinishEvent:true,suppressInvalidate:true});F.destroy();if(this.getSelectedItems().length>0){var i=B.getTokens();i[i.length-1].focus();}else{this.focus();}},this);};A.prototype.onAfterRenderingList=function(){var i=this._getList();var B=document.activeElement===this.getFocusDomRef();if(this.getEditable()&&!B&&i&&i.getItems()[this._iFocusedIndex]){i.getItems()[this._iFocusedIndex].focus();this._iFocusedIndex=null;}};A.prototype.onFocusinList=function(){var i=this._getList();if(this._bListItemNavigationInvalidated&&this._getList().getItemNavigation()){i.getItemNavigation().setSelectedIndex(this._iInitialItemFocus);this._bListItemNavigationInvalidated=false;}this._getSuggestionsPopover().updateListDataAttributes(i);};A.prototype.onAfterRendering=function(){var i=this.getAggregation("tokenizer");a.prototype.onAfterRendering.apply(this,arguments);this._registerResizeHandler();setTimeout(function(){i.setMaxWidth(this._calculateSpaceForTokenizer());}.bind(this),0);};A.prototype.onfocusout=function(i){this.isOpen()&&this._handleInputFocusOut();this.removeStyleClass("sapMFocus");if(this.getValueState()===V.Error&&this.getValueStateText()===this._oRbM.getText("VALUE_STATE_ERROR_ALREADY_SELECTED")){this.setValueState(this._sInitialValueState);this.setValueStateText(this._sInitialValueStateText);}a.prototype.onfocusout.apply(this,arguments);};A.prototype.onpaste=function(i){var B;var F=false;var H=this.getSelectedItems();if(window.clipboardData){B=window.clipboardData.getData("Text");}else{B=i.originalEvent.clipboardData.getData('text/plain');}var J=B.split(/\r\n|\r|\n/g);if(J&&J.length>0){k.getSelectableItems(this.getItems()).filter(function(N){return H.indexOf(N)===-1;}).forEach(function(N){if(J.indexOf(N.getText())>-1){F=true;this.setSelection({item:N,id:N.getId(),key:N.getKey(),fireChangeEvent:true,fireFinishEvent:true,suppressInvalidate:true,listItemUpdated:false});}},this);}if(F){i.stopPropagation();i.preventDefault();}};A.prototype.onsapbackspace=function(i){var B=this.getAggregation("tokenizer");var F=B.getTokens();var H=F.filter(function(J){return J.getSelected();});if(!this.getEnabled()||!this.getEditable()){i.preventDefault();return;}if(this.getCursorPosition()>0||this.getValue().length>0){return;}if(H.length>0){this._removeAllTokens();return;}if(document.activeElement===this.getFocusDomRef()){F[F.length-1]&&F[F.length-1].focus();}i.preventDefault();};A.prototype._removeAllTokens=function(){var i=this.getAggregation("tokenizer");var B=i.getTokens().filter(function(F){return F.getSelected();});if(!B.length){return;}this._removeSelection(B);this.fireChangeEvent("");this.invalidate();};A.prototype.onsapdelete=A.prototype.onsapbackspace;A.prototype.onsapnext=function(i){var B=this.getAggregation("tokenizer");if(i.isMarked()){return;}var F=Q(document.activeElement).control()[0];if(!F){return;}if(F===B||B.$().find(F.$()).length>0&&this.getEditable()){B.scrollToEnd();this.focus();}};A.prototype.onsapprevious=function(i){if(this.getCursorPosition()===0&&!h(this.getFocusDomRef())){if(i.srcControl===this){T.prototype.onsapprevious.apply(this.getAggregation("tokenizer"),arguments);}}};A.prototype.onclick=function(i){var B=this.getEditable(),F=this.getEnabled(),N=i.target.className.indexOf("sapMTokenizerIndicator")>-1;if(B&&F&&N){i.preventDefault();this._handleIndicatorPress();}};A.prototype.ontap=function(i){a.prototype.ontap.apply(this,arguments);var B=this.getOpenArea();if(!this.getEnabled()||!this.getEditable()){return;}i.setMarked();if(this.isPickerDialog()&&B.contains(i.target)){this.open();}};A.prototype.getOpenArea=function(){if(this.isPickerDialog()){return this.getDomRef();}else{return a.prototype.getOpenArea.apply(this,arguments);}};A.prototype._getItemsStartingWithPerTerm=function(i,B){var F=[],H=B?k.getEnabledItems(this.getItems()):k.getSelectableItems(this.getItems()),J=this.fnFilter?this.fnFilter:j;H.forEach(function(N){if(J(i,N)){F.push(N);}},this);return F;};A.prototype._getItemsStartingWith=function(i,B){var F=[],H=B?k.getEnabledItems(this.getItems()):k.getSelectableItems(this.getItems());H.forEach(function(J){if(typeof i==="string"&&i!==""&&J.getText().toLowerCase().startsWith(i.toLowerCase())){F.push(J);}},this);return F;};A.prototype._getUnselectedItemsStartingText=function(i){var B=[];this._getUnselectedItems().forEach(function(F){if(typeof i==="string"&&i!==""&&F.getText().toLowerCase().startsWith(i.toLowerCase())){B.push(F);}},this);return B;};A.prototype.getCursorPosition=function(){return this._$input.cursorPos();};A.prototype._selectPreviousItemsOf=function(i){var B;do{B=true;var F=this._getPreviousVisibleItemOf(i);if(F){var H=k.getListItem(F);if(H){B=k.getListItem(F).getSelected();}}this.setSelection({item:i,id:i.getId(),key:i.getKey(),fireChangeEvent:true,suppressInvalidate:true});i=F;}while(!B);};A.prototype._getNextVisibleItemOf=function(i){var B=k.getSelectableItems(this.getItems());var F=B.indexOf(i)+1;if(F<=0||F>B.length-1){return null;}return B[F];};A.prototype._getPreviousVisibleItemOf=function(i){var B=k.getSelectableItems(this.getItems());var F=B.indexOf(i)-1;if(F<0){return null;}return B[F];};A.prototype._getNextUnselectedItemOf=function(i){var B=this._getUnselectedItems();var F=B.indexOf(i)+1;if(F<=0||F>B.length-1){return null;}return B[F];};A.prototype._getPreviousUnselectedItemOf=function(i){var B=this._getUnselectedItems();var F=B.indexOf(i)-1;if(F<0){return null;}return B[F];};A.prototype._getNextTraversalItem=function(){var i=this.getValue();var B=i?this._getItemsStartingWithPerTerm(i):[];var F=this._getUnselectedItems();if(B.indexOf(this._oTraversalItem)>-1&&this._oTraversalItem.getText()===this.getValue()){return this._getNextUnselectedItemOf(this._oTraversalItem);}if(B.length&&B[0].getText()===this.getValue()){return this._getNextUnselectedItemOf(B[0]);}return B.length?B[0]:F[0];};A.prototype._getPreviousTraversalItem=function(){var i=this.getValue();var B=i?this._getItemsStartingWithPerTerm(i):[];if(B.indexOf(this._oTraversalItem)>-1&&this._oTraversalItem.getText()===this.getValue()){return this._getPreviousUnselectedItemOf(this._oTraversalItem);}if(B.length&&B[B.length-1].getText()===this.getValue()){return this._getPreviousUnselectedItemOf(B[B.length-1]);}if(B.length){return B[B.length-1];}else{var F=this._getUnselectedItems();if(F.length>0){return F[F.length-1];}else{return null;}}};A.prototype.setSelectedItems=function(i){this.removeAllSelectedItems();if(!i||!i.length){return this;}if(!Array.isArray(i)){v.warning("Warning: setSelectedItems() has to be an array of sap.ui.core.Item instances or of valid sap.ui.core.Item IDs",this);return this;}i.forEach(function(B){if(!(B instanceof e)&&(typeof B!=="string")){v.warning("Warning: setSelectedItems() has to be an array of sap.ui.core.Item instances or of valid sap.ui.core.Item IDs",this);return;}if(typeof B==="string"){B=w.byId(B);}this.setSelection({item:B?B:null,id:B?B.getId():"",key:B?B.getKey():"",suppressInvalidate:true});},this);return this;};A.prototype.addSelectedItem=function(i){if(!i){return this;}if(typeof i==="string"){i=w.byId(i);}this.setSelection({item:i?i:null,id:i?i.getId():"",key:i?i.getKey():"",fireChangeEvent:false,suppressInvalidate:true});return this;};A.prototype.removeSelectedItem=function(i){if(!i){return null;}if(typeof i==="string"){i=w.byId(i);}if(!this.isItemSelected(i)){return null;}this.removeSelection({item:i,id:i.getId(),key:i.getKey(),fireChangeEvent:false,suppressInvalidate:true});return i;};A.prototype.removeAllSelectedItems=function(){var i=[];var B=this.getAssociation("selectedItems",[]);B.forEach(function(F){var H=this.removeSelectedItem(F);if(H){i.push(H.getId());}},this);return i;};A.prototype.removeSelectedKeys=function(i){var B,F=[];if(!i||!i.length||!Array.isArray(i)){return F;}i.forEach(function(H){B=this.getItemByKey(H);if(B){this.removeSelection({item:B?B:null,id:B?B.getId():"",key:B?B.getKey():"",fireChangeEvent:false,suppressInvalidate:true});F.push(B);}},this);return F;};A.prototype.setSelectedKeys=function(i){if(this._bInitialSelectedKeysSettersCompleted){this.setProperty("selectedKeys",[],true);this.removeAllSelectedItems();}this.addSelectedKeys(i);this._bInitialSelectedKeysSettersCompleted=true;return this;};A.prototype.addSelectedKeys=function(i){var B,F=[];i=this.validateProperty("selectedKeys",i);i.forEach(function(H){var J=this.getItemByKey(H);if(J){this.addSelectedItem(J);}else if(H!=null){F.push(H);}},this);if(F.length>0){B=this.getProperty("selectedKeys").filter(function(H){return F.indexOf(H)===-1;});F=B.concat(F);this.setProperty("selectedKeys",F,true);}return this;};A.prototype._getUnselectedItems=function(){var i=Q(k.getSelectableItems(this.getItems())).not(this.getSelectedItems()).get();if(!this.isOpen()){return i.filter(function(B){return!B.isA("sap.ui.core.SeparatorItem");});}return i;};A.prototype.getSelectedItems=function(){var i=[],B=this.getAssociation("selectedItems")||[];B.forEach(function(F){var H=w.byId(F);if(H){i.push(H);}},this);return i;};A.prototype.getWidth=function(){return this.getProperty("width")||"100%";};A.prototype._updatePopoverBasedOnEditMode=function(i){var B=this._getList(),F=this._getSuggestionsPopover();if(!B){return;}if(i){F.addContent(B);}};A.prototype._mapItemToListItem=function(i){var B,F,H,J=this.getRenderer();if(!i){return null;}B=k.createListItemFromCoreItem(i,this.getShowSecondaryValues());this._decorateListItem(B);if(i.isA("sap.ui.core.SeparatorItem")){return B;}F=J.CSS_CLASS_MULTICOMBOBOX+"Item";H=(this.isItemSelected(i))?F+"Selected":"";B.addStyleClass(F+" "+H);if(H){var N=new b({key:i.getKey()});N.setText(i.getText());i.data(k.CSS_CLASS+"Token",N);this.getAggregation("tokenizer").addToken(N,true);}this.setSelectable(i,i.getEnabled());return B;};A.prototype.setSelectable=function(i,B){a.prototype.setSelectable.call(this,i,B);var F=q(i);if(F){F.setVisible(B);}};A.prototype._fillList=function(){var B=this._getList();var F=this.getEditable()?this.getItems():this.getSelectedItems();if(!B){return;}B.destroyItems();if(!this._oListItemEnterEventDelegate){this._oListItemEnterEventDelegate={onsapenter:function(N){if(N.srcControl.isSelected()){N.setMarked();}}};}for(var i=0,H,J=F.length;i<J;i++){H=this._mapItemToListItem(F[i]);H.addDelegate(this._oListItemEnterEventDelegate,true,this,true);this._getList().addAggregation("items",H,true);if(this.isItemSelected(F[i])){this._getList().setSelectedItem(H,true);}}};A.prototype.handleInputValidation=function(i,B){var F=i.target.value,H=this.isValueValid(F),J,N,U;var W=i.srcControl;if(!H&&F!==""&&!B){this._handleFieldValidationState(W);return;}U=this._getItemsStartingWith(F,true);if(!B||this._bIsPasteEvent){this._handleTypeAhead(F,U,W);}J=this.getItems();if(this.isPickerDialog()){N=this.getFilterSelectedButton();if(N!=null&&N.getPressed()){N.setPressed(false);}}n(this.getItems(),this.filterItems({value:F,items:J}));this._sOldInput=F;if((!this.getValue()||!H)&&!this.bOpenedByKeyboardOrButton&&!this.isPickerDialog()){this.close();}else{this.open();}};A.prototype.isValueValid=function(i){var B=this._getItemsStartingWith(i,true);var F=this._getItemsStartingWithPerTerm(i,true);return B.length||F.length;};A.prototype._handleTypeAhead=function(i,B,F){var H,J;if(!this._bDoTypeAhead){return;}H=this.getSelectedItems();J=B.filter(function(N){return H.indexOf(N)===-1;});t(i,F,J);};A.prototype._handleFieldValidationState=function(i){if(this._sOldInput&&this.isValueValid(this._sOldInput)){i.updateDomValue(this._sOldInput);}else if(this._sOldValue&&this.isValueValid(this._sOldValue)){i.updateDomValue(this._sOldValue);}else{i.updateDomValue("");}if(this._iOldCursorPos){Q(i.getFocusDomRef()).cursorPos(this._iOldCursorPos);}this._showWrongValueVisualEffect();};A.prototype.init=function(){this._oRb=w.getLibraryResourceBundle("sap.m");a.prototype.init.apply(this,arguments);this._bInitialSelectedKeysSettersCompleted=false;this._bListItemNavigationInvalidated=false;this._iInitialItemFocus=-1;this._bCheckBoxClicked=true;this._bPreventValueRemove=false;this._oTokenizer=this._createTokenizer();this.setAggregation("tokenizer",this._oTokenizer);this._aInitiallySelectedItems=[];this._oRbM=w.getLibraryResourceBundle("sap.m");this._oRbC=w.getLibraryResourceBundle("sap.ui.core");this._fillList();};A.prototype.handleItemRemoval=function(i){this.removeSelection({item:i,id:i?i.getId():"",key:i?i.getKey():"",fireChangeEvent:false,suppressInvalidate:true,listItemUpdated:true});};A.prototype.isItemSelected=function(i){return this.getSelectedItems().indexOf(i)>-1;};A.prototype._clearTokenizer=function(){this.getAggregation("tokenizer").destroyTokens();};A.prototype._toggleTokenClass=function(){this.toggleStyleClass("sapMMultiComboBoxHasToken",this._hasTokens());};A.prototype.exit=function(){a.prototype.exit.apply(this,arguments);this._deregisterResizeHandler();if(this._oTokenizer){this._oTokenizer.destroy();this._oTokenizer=null;}this._oRbC=null;this._oRbM=null;this._oListItemEnterEventDelegate=null;this._sInitialValueState=null;};A.prototype.destroyItems=function(){this.setProperty("selectedKeys",[]);this._clearTokenizer();return this.destroyAggregation("items");};A.prototype._getItemByToken=function(i){return k.getItemBy(this.getItems(),i,"Token");};A.prototype._getItemByValue=function(B){var F=k.getSelectableItems(this.getItems());for(var i=0;i<F.length;i++){if(F[i].getText().toLowerCase()===B.toLowerCase()){return F[i];}}};A.prototype._handleItemToFocus=function(){if(this.isOpen()){return;}this.syncPickerContent();var i,B,F=w.byId(document.activeElement.id),H=this.getSelectedItems(),J=k.getSelectableItems(this.getItems()),N=this._getList(),U=N&&N.getItemNavigation(),W=this.getValue(),X=this.getPicker();if(F&&F.isA("sap.m.Token")){B=this._getItemByToken(F);}else if(W){B=this._getItemByValue(W);}if(!B){B=H.length?k.getItemByListItem(this.getItems(),this._getList().getSelectedItems()[0]):J[0];}i=k.getVisibleItems(this.getItems()).indexOf(B);if(U){U.setSelectedIndex(i);}else{this._bListItemNavigationInvalidated=true;this._iInitialItemFocus=i;}if(!B){X.setInitialFocus(this);}else{X.setInitialFocus(N);}};A.prototype.getAccessibilityInfo=function(){var i=this.getSelectedItems().map(function(F){return F.getText();}).join(" ");var B=a.prototype.getAccessibilityInfo.apply(this,arguments);B.type=w.getLibraryResourceBundle("sap.m").getText("ACC_CTR_TYPE_MULTICOMBO");B.description=((B.description||"")+" "+i).trim();return B;};A.prototype._setIsClick=function(i){this._bIsClick=i;};A.prototype._getIsClick=function(){return this._bIsClick;};A.prototype._calculateSpaceForTokenizer=function(){if(this.getDomRef()){var i,B=this.getDomRef().getBoundingClientRect().width,F=this._calculateIconsSpace(),H=this.$().find(".sapMInputBaseInner"),J=["min-width","padding-right","padding-left"],N=J.reduce(function(U,W){return U+(parseInt(H.css(W))||0);},0);i=B-(F+N);i=i<0?0:i;return i+"px";}else{return null;}};A.prototype._syncInputWidth=function(i){var F=this.getDomRef('inner'),B,H;if(!F||(i&&!i.getDomRef())){return;}H=parseFloat(i.getDomRef().getBoundingClientRect().width.toFixed(2));B=this._calculateIconsSpace();F.style.width='calc(100% - '+parseFloat(B+H)+"px)";};A.prototype._handleNMoreAccessibility=function(){var i=x.getStaticId("sap.m","MULTICOMBOBOX_OPEN_NMORE_POPOVER"),B=this.getAggregation("tokenizer"),F=this.getFocusDomRef(),H=(F&&F.getAttribute("aria-describedby")),J=H?H.split(" "):[],N=J.indexOf(i),U=this.getEnabled(),W=!this.getEditable()&&B&&B.getHiddenTokensCount();if(W&&N===-1){J.push(i);U&&this.getFocusDomRef().setAttribute("aria-keyshortcuts","Enter");}else if(N!==-1&&!W){J.splice(N,1);this.getFocusDomRef().removeAttribute("aria-keyshortcuts");}if(F&&J.length){F.setAttribute("aria-describedby",J.join(" ").trim());}};A.prototype.applyShowItemsFilters=function(){this.syncPickerContent();n(this.getItems(),this.filterItems({value:this.getValue()||"_",items:this.getItems()}));};A.prototype.showItems=function(F){var H=true,i=this.fnFilter;if(typeof F==="function"){this.syncPickerContent();this.setFilterFunction(F||function(){return true;});H=this.filterItems({value:this.getValue()||"_",items:this.getItems()}).items.length>0;this.setFilterFunction(i);}if(H){a.prototype.showItems.apply(this,arguments);}};return A;});
