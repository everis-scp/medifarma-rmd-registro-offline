sap.ui.define(["sap/ui/thirdparty/jquery","sap/ovp/cards/v4/charts/Utils","sap/ui/model/odata/CountMode","sap/ovp/cards/v4/V4AnnotationHelper","sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat","sap/viz/ui5/api/env/Format","sap/viz/ui5/controls/VizTooltip","sap/ovp/cards/CommonUtils","sap/ovp/cards/OVPCardAsAPIUtils","sap/viz/ui5/data/DimensionDefinition","sap/viz/ui5/data/MeasureDefinition","sap/viz/ui5/controls/common/feeds/FeedItem","sap/ui/core/Element","sap/ovp/app/resources","sap/ovp/app/OVPUtils","sap/base/util/each","sap/base/util/merge","sap/ovp/cards/ovpLogger","sap/base/util/isEmptyObject"],function(q,U,C,a,N,D,V,b,c,O,e,M,F,g,h,l,n,o,p,t){"use strict";var u={LABEL_KEY:"sap:label",LABEL_KEY_V4:"com.sap.vocabularies.Common.v1.Label",TEXT_KEY:"sap:text",TEXT_KEY_V4:"com.sap.vocabularies.Common.v1.Text",TEXT_ARRANGEMENT_ANNO:"com.sap.vocabularies.UI.v1.TextArrangement",TYPE_KEY:"$Type",DISPLAY_FORMAT_KEY:"sap:display-format",SEMANTICS_KEY:"sap:semantics",UNIT_KEY:"sap:unit",UNIT_KEY_V4_ISOCurrency:"Org.OData.Measures.V1.ISOCurrency",UNIT_KEY_V4_Unit:"Org.OData.Measures.V1.Unit",CURRENCY_CODE:"currency-code",NAME_KEY:"name",NAME_CAP_KEY:"Name",EDM_TYPE:"type",EDM_INT32:"Edm.Int32",EDM_INT64:"Edm.Int64",SCATTER_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Scatter",BUBBLE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bubble",LINE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Line",COLUMNSTACKED_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/ColumnStacked",VERTICALBULLET_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/VerticalBullet",COLUMN_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Column",BAR_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bar",COMBINATION_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Combination",DONUT_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Donut",V4_ANNOTATION:"annotations"};var w={CARD_WARNING:"OVP-AC: Analytic card: Warning: ",CARD_ERROR:"OVP-AC: Analytic card Error: ",DATA_ANNO_ERROR:"OVP-AC: Analytic card Error:",CARD_ANNO_ERROR:"OVP-AC: Analytic card: Error ",CHART_ANNO_ERROR:"OVP-AC: Analytic card: Error ",INVALID_CHART_ANNO:"OVP-AC: Analytic Cards: Invalid Chart Annotation.",ANALYTICAL_CONFIG_ERROR:"Analytic card configuration error",CACHING_ERROR:"no model defined while caching OdataMetaData",INVALID_MAXITEMS:"maxItems is Invalid. ",NO_DATASET:"OVP-AC: Analytic Cards: Could not obtain dataset.",SORTORDER_WARNING:"SortOrder is present in PresentationVariant, but it is empty or not well formed.",BOOLEAN_ERROR:"Boolean value is not present in PresentationVariant.",IS_MANDATORY:"is mandatory.",IS_MISSING:"is missing.",NOT_WELL_FORMED:"is not found or not well formed)",MISSING_CHARTTYPE:"Missing ChartType in ",CHART_ANNO:"Chart Annotation.",DATA_ANNO:"Data Annotation",CARD_ANNO:"card annotation.",CARD_CONFIG:"card configuration.",CARD_CONFIG_ERROR:"Could not obtain configuration for ",CARD_CONTAINER_ERROR:"Could not obtain card container. ",DATA_UNAVAIALABLE:"No data available.",CONFIG_LOAD_ERROR:"Failed to load config.json. Reason: ",INVALID_CHARTTYPE:"Invalid ChartType given for ",INVALID_CONFIG:"No valid configuration given for ",CONFIG_JSON:"in config.json",ENTER_INTEGER:"Please enter an Integer.",NO_CARD_MODEL:"Could not obtain Cards model.",ANNO_REF:"com.sap.vocabularies.UI.v1 annotation.",INVALID_REDUNDANT:"Invalid/redundant role configured for ",CHART_IS:"chart is/are ",CARD_CONFIG_JSON:"card from config.json",ALLOWED_ROLES:"Allowed role(s) for ",DIMENSIONS_MANDATORY:"DimensionAttributes are mandatory.",MEASURES_MANDATORY:"MeasureAttributes are mandatory.",CARD_LEAST:"card: Enter at least ",CARD_MOST:"card: Enter at most ",FEEDS:"feed(s).",MIN_FEEDS:"Minimum number of feeds required for ",FEEDS_OBTAINED:"card is not configured. Obtained ",FEEDS_REQUIRED:"feed(s), Required: ",INVALID_SEMANTIC_MEASURES:"More than one measure is being semantically coloured",INVALID_IMPROVEMENT_DIR:"No Improvement Direction Found",INVALID_CRITICALITY:"Invalid criticality values",INVALID_DIMMEAS:"Invalid number of Measures or Dimensions",INVALID_FORECAST:"Invalid/Redundant Datapoint or Forecast measure",INVALID_TARGET:"Invalid/Redundant Datapoint or Target measure",ERROR_MISSING_AXISSCALES:"Minimum and Maximum values are mandatory for AxisScale MinMax to work"};var S=["year","yearweek","yearmonth","yearquarter"];var G;var L=new p("OVP.charts.VizAnnotationManager");function y(d,s,f){var i=d.getMetaModel().getObject("/"+s+"/"+f+"@");return i["@com.sap.vocabularies.Common.v1.IsCalendarYear"]||i["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]||i["@com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]||i["@com.sap.vocabularies.Common.v1.IsCalendarYearWeek"];}function z(f,j,v,x,D1,E1,F1){var G1="{";if(!f||!f.getSetting('ovpCardProperties')){L.error(w.ANALYTICAL_CONFIG_ERROR);G1+="}";return G1;}var H1=f.getSetting("dataModel");var I1;if(F1&&F1.$EnumMember){I1=F1.$EnumMember.split("/");if(I1&&(I1[1]!='Donut')&&(D1===undefined)){return null;}}var J1=[];var K1=[];var L1=[];var M1=[];var N1=[];var O1=[];var P1=[];var Q1=v&&v.Parameters;var R1=x&&x.SortOrder;var S1=x&&x.MaxItems,T1=null;var U1;var V1;var W1;var X1=null;var Y1=u.TEXT_KEY;var Z1=u.TEXT_KEY_V4;var $1=u.UNIT_KEY;var _1=u.UNIT_KEY_V4_ISOCurrency;var a2=u.UNIT_KEY_V4_Unit;var b2={};if(S1){T1=S1.Int32?S1.Int32:S1.Int;}if(T1){if(T1==="0"){L.error("OVP-AC: Analytic card Error: maxItems is configured as "+T1);G1+="}";return G1;}if(!/^\d+$/.test(T1)){L.error("OVP-AC: Analytic card Error: maxItems is Invalid. Please enter an Integer.");G1+="}";return G1;}}var c2=f.getSetting('ovpCardProperties'),d2=c2.getProperty('/parameters');var e2=c2.getProperty("/metaModel");var f2=c2.getProperty("/measureAggregate");Q1=Q1||!!d2;if(Q1){var g2=a.resolveParameterizedEntitySet(H1,j,v,d2);G1+="path: '"+g2+"'";}else{G1+="path: '/"+j.$Type.split(".")[1]+"'";}var h2=[];X1=f.getSetting('ovpCardProperties').getProperty("/entitySet");if(!H1||!X1){return G1;}var i2=q1(H1,X1);C1(H1,i2,j.$Type);var j2=f.getSetting('ovpCardProperties').getProperty("/cardLayout");var k2=1,l2;var m2=Y();var n2;var o2;if(D1&&j2&&j2.colSpan&&j2.colSpan>1){l2=j2.colSpan-k2;for(var p2 in m2){if((o2=m2[p2].reference)&&m2[o2]){var q2=o({},m2[o2]);m2[p2]=q2;}if(p2===I1[1]||(m2[p2].time&&m2[p2].time.type===I1[1].toLowerCase())){n2=m2[p2];break;}}var r2=Z(D1,n2,H1,X1);if(r2){n2=n2.time;}else{n2=n2.default;}var s2=f.getSetting('ovpCardProperties').getProperty("/dataStep");if(!s2){if(n2.resize&&n2.resize.hasOwnProperty("dataStep")&&!isNaN(n2.resize.dataStep)){s2=n2.resize.dataStep;}}s2=parseInt(s2,10);if(l2>0&&s2&&!isNaN(s2)){T1=parseInt(T1,10)+s2*l2;}}if(v){var c2=f.getSetting('ovpCardProperties');h2=a.getFilters(c2,v);}if(h2.length>0){G1+=", filters: "+JSON.stringify(h2);}if(R1){var t2=x.SortOrder;if(!t2.length){t2=U.getSortAnnotationCollection(H1,x,j);}if(t2.length<1){L.warning(w.CARD_WARNING+w.SORTORDER_WARNING);}else{var u2="";var v2;var w2;var x2;for(var i=0;i<t2.length;i++){v2=t2[i];x2=v2.Property.PropertyPath;P1.push(x2);if(typeof v2.Descending==="undefined"){w2='true';}else{var g1=v2.Descending.Bool||v2.Descending.Boolean;if(!g1){L.warning(w.CARD_WARNING+w.BOOLEAN_ERROR);w2='true';}else{w2=g1.toLowerCase()==='true'?'true':'false';}}u2=u2+"{path: '"+x2+"',descending: "+w2+"},";}G1+=", sorter: ["+u2.substring(0,u2.length-1)+"]";}}var y2=f.getSetting("ovpCardProperties").getProperty("/entityType");n(E1,function(i,m){U1=m.Measure.$PropertyPath;if(m.DataPoint&&m.DataPoint.AnnotationPath){var d=y2[m.DataPoint.AnnotationPath.substring(1)];if(d.ForecastValue&&(d.ForecastValue.PropertyPath||d.ForecastValue.Path)){var r=(d.ForecastValue.PropertyPath||d.ForecastValue.Path);N1.push((d.ForecastValue.PropertyPath||d.ForecastValue.Path));if(i2&&i2[r]){var s;if(i2[r][_1]){s=i2[r][_1].Path?i2[r][_1].Path:undefined;}else if(i2[r][a2]){s=i2[r][a2].Path?i2[r][a2].Path:undefined;}else if(i2[r][$1]){s=i2[r][$1];}if(s){if((N1?Array.prototype.indexOf.call(N1,s):-1)===-1){N1.push(s);}}}}if(d.TargetValue&&(d.TargetValue.PropertyPath||d.TargetValue.Path)){var E2=(d.TargetValue.PropertyPath||d.TargetValue.Path);N1.push((d.TargetValue.PropertyPath||d.TargetValue.Path));if(i2&&i2[E2]){var s;if(i2[E2][_1]){s=i2[E2][_1].Path?i2[E2][_1].Path:undefined;}else if(i2[E2][a2]){s=i2[E2][a2].Path?i2[E2][a2].Path:undefined;}else if(i2[E2][$1]){s=i2[E2][$1];}if(s){if((N1?Array.prototype.indexOf.call(N1,s):-1)===-1){N1.push(s);}}}}}N1.push(U1);if(i2&&i2[U1]){if(i2[U1][Z1]){if(i2[U1][Z1].String&&U1!=i2[U1][Z1].String){N1.push(i2[U1][Z1].String?i2[U1][Z1].String:U1);}else if(i2[U1][Z1].Path&&U1!=i2[U1][Z1].Path){N1.push(i2[U1][Z1].Path?i2[U1][Z1].Path:U1);}}else if(i2[U1][Y1]&&U1!=i2[U1][Y1]){N1.push(i2[U1][Y1]?i2[U1][Y1]:U1);}}if(i2&&i2[U1]){var s;if(i2[U1][_1]){s=i2[U1][_1].Path?i2[U1][_1].Path:undefined;}else if(i2[U1][a2]){s=i2[U1][a2].Path?i2[U1][a2].Path:undefined;}else if(i2[U1][$1]){s=i2[U1][$1];}if(s){if((N1?Array.prototype.indexOf.call(N1,s):-1)===-1){N1.push(s);}}}});n(D1,function(i,d){U1=d.Dimension.$PropertyPath;J1.push(U1);if(i2&&i2[U1]){if(i2[U1]["annotations"]&&i2[U1]["annotations"]["@"+Z1]){if(typeof i2[U1]["annotations"]["@"+Z1]==='string'&&i2[U1]["annotations"]["@"+Z1]&&U1!=i2[U1]["annotations"]["@"+Z1]){J1.push(i2[U1]["annotations"]["@"+Z1]);}else if(i2[U1]["annotations"]["@"+Z1].$Path&&U1!=i2[U1]["annotations"]["@"+Z1].$Path){W1=i2[U1]["annotations"]["@"+Z1].$Path;var m=W1.split("/");if(m.length>1){V1=A(e2,y2,W1);if(V1!==""){J1.push(W1);K1.push(V1);M1=B(e2,y2,W1);if(M1.length>0){L1=L1.concat(M1);}}}else{J1.push(W1?W1:U1);}}}else if(i2[U1][Y1]&&U1!=i2[U1][Y1]){J1.push(i2[U1][Y1]?i2[U1][Y1]:U1);}}});if(L1.length>0){var k=0;while(k<L1.length){if(J1.indexOf(L1[k])!==-1){L1.splice(k,1);}else{k++;}}}if(N1.length>0){n(N1,function(i,m){b2[m]=true;});}if(J1.length>0){n(J1,function(i,d){b2[d]=true;});}G1+=", parameters: {$apply:'groupby(("+J1.join(",")+"),";G1+="aggregate(";var z2=[];N1.forEach(function(m,i){var s=f2&&f2["Axis"+(i+1)];var d=s?s:"sum";var r=[m," with ",d," as ",m,"Aggregate"].join('');z2.push(r);});G1+=z2.join(',');G1+="))";var A2=e2.getObject("/"+j.$Type);if(A2){var B2=a.getRequestFields(x);if(B2&&B2.length>0){n(B2,function(i,r){if(!b2.hasOwnProperty(r)){b2[r]=true;O1.push(r);}});if(O1.length>0){G1+=","+O1.join(",");}}}if(P1.length>0){var C2=[];n(P1,function(i,s){if(!b2.hasOwnProperty(s)){C2.push(s);}});if(C2.length>0){G1+=","+C2.join(",");}}if(K1.length>0){G1+="'"+","+" expand:'"+K1.join(',');}var D2=a.checkFilterPreference(f.getSetting("ovpCardProperties"));if(D2){G1+="', custom: {cardId: '"+f.getSetting("ovpCardProperties").getProperty("/cardId")+"'}}";}else{G1+="'}";}if(I1&&(I1[1]==='Donut')&&(D1===undefined)){G1+=", length: 1";}else if(I1&&(I1[1]==='Donut')&&(D1)&&T1){G1+=", length: "+(parseInt(T1,10)+1);}else if(T1){G1+=", length: "+T1;}G1+="}";return G1;}z.requiresIContext=true;function A(m,d,s){var f="";var j=s.split("/");if(j.length>1){for(var i=0;i<(j.length-1);i++){var k=m.getODataAssociationEnd(d,j[i]);if(k){d=m.getODataEntityType(k.type);if(f){f=f+"/";}f=f+j[i];}else{return f;}}}return f;}function B(m,d,s){var f=[];var k=[];var r;var v=s.split("/");if(v.length>1){for(var i=0;i<(v.length-1);i++){var x=m.getODataAssociationEnd(d,v[i]);if(x){d=m.getODataEntityType(x.type);if(d){k=d&&d.key&&d.key.propertyRef;for(var j=0;j<k.length;j++){r=v[i]+"/"+k[j].name;f.push(r);}}}}}return f;}function E(m,d){var f=false;var r;if(m.DataPoint&&m.DataPoint.AnnotationPath){var i=d[m.DataPoint.AnnotationPath.substring(1)];if(i&&i.ForecastValue&&(i.ForecastValue.PropertyPath||i.ForecastValue.Path)){f=true;r=m;}}if(f===true){return r;}else{L.warning(w.CARD_WARNING+w.INVALID_FORECAST);return undefined;}}function H(m,d){var f=false;var r;if(m.DataPoint&&m.DataPoint.AnnotationPath){var i=d[m.DataPoint.AnnotationPath.substring(1)];if(i&&i.TargetValue&&(i.TargetValue.PropertyPath||i.TargetValue.Path)){f=true;r=m;}}if(f===true){return r;}else{L.warning(w.CARD_WARNING+w.INVALID_TARGET);return undefined;}}function I(m,d){var f;n(d,function(i,v){if(v.name===m){if(v["com.sap.vocabularies.Common.v1.Label"]){f=v["com.sap.vocabularies.Common.v1.Label"].String?v["com.sap.vocabularies.Common.v1.Label"].String:v["com.sap.vocabularies.Common.v1.Label"].Path;}else if(v["sap:label"]){f=v["sap:label"];}return false;}});return f;}function J(f,d){var j=true;if(d==="line"||d==="column"||d==="bar"){n(f,function(i,v){if((v.getUid()==='valueAxis')||(v.getUid()==='categoryAxis')){if(v.getValues().length!=1){j=false;L.warning(w.CARD_WARNING+w.INVALID_DIMMEAS);return false;}}});}else if(d==="vertical_bullet"){n(f,function(i,v){if((v.getUid()==='actualValues')||(v.getUid()==='categoryAxis')){if(v.getValues().length!=1){j=false;L.warning(w.CARD_WARNING+w.INVALID_DIMMEAS);return false;}}});}if(j===true){return true;}}function K(m,s,v){var d=u.TYPE_KEY;if(!m||!m[s]||!m[s][d]){return v;}var f=["Edm.Int","Edmt.Int16","Edm.Int32","Edm.Int64","Edm.Decimal"];var i=m[s][d];if((f?Array.prototype.indexOf.call(f,i):-1)!==-1){return Number(v);}return v;}function P(d){if(d){return d;}return"";}function Q(r){var d={locale:function(){},format:function(v,f){var i="";if(f){i=f.split('/');}if(i.length>0){var m,s;if(i.length===3){m=Number(i[1]);s=Number(i[2]);if(isNaN(m)){m=-1;}if(isNaN(s)){s=0;}}else{m=2;s=0;}if(i[0]==="axisFormatter"||(i[0]==="ShortFloat")){var j;j=N.getFloatInstance({style:'short',minFractionDigits:m,maxFractionDigits:m?m:1});if(i[0]==="ShortFloat"){j=N.getFloatInstance({style:'short',minFractionDigits:m,maxFractionDigits:m});}if(m===-1){j=N.getFloatInstance({style:'short'});}return j.format(Number(v));}else if(i[0]==="tooltipNoScaleFormatter"){var k=N.getFloatInstance({style:'short',currencyCode:false,shortRefNumber:s,showScale:false,minFractionDigits:m,maxFractionDigits:m});if(m===-1){k=N.getFloatInstance({minFractionDigits:0,currencyCode:false});}return k.format(Number(v));}else if(i[0]==="CURR"){var x=N.getCurrencyInstance({style:'short',currencyCode:false,minFractionDigits:m,maxFractionDigits:m});if(m===-1){x=N.getCurrencyInstance({style:'short',currencyCode:false});}return x.format(Number(v));}else if(i[0].search("%")!==-1){var D1=N.getPercentInstance({style:'short',minFractionDigits:m,maxFractionDigits:m});if(m===-1){D1=N.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1});}v=D1.format(Number(v));return v;}}if(v.constructor===Date){var E1=D.getDateTimeInstance({pattern:f});if(f==="YearMonthDay"){E1=D.getDateInstance({style:"medium"});}if(f==="YearMonth"||f==="MMM"){E1=D.getDateTimeInstance({format:"MMM"});}if(f==="YearQuarter"||f==="Quarter"){E1=D.getDateTimeInstance({format:"QQQ"});}if(f==="YearWeek"||f==="Week"){E1=D.getDateTimeInstance({format:"www"});}if(r&&f==="hh:mm"){var F1=v.toLocaleTimeString();var G1=F1.split(":");v=G1[0]+":"+G1[1];return v;}var H1=r?false:true;v=E1.format(new Date(v),H1);}return v;}};V.numericFormatter(d);}function R(v,f){var d=v.getModel();var k=v.getVizType();if(k!="line"&&k!="bubble"){return;}if(!f){f=k==="line"?"categoryAxis":"valueAxis";}var m=v.getModel('ovpCardProperties').getProperty("/entitySet");if(!d||!m){return;}var r=q1(d,m);var s=v.getFeeds();for(var i=0;i<s.length;i++){if(s[i].getUid()===f){var x=s[i].getValues();if(!x){return;}for(var j=0;j<x.length;j++){if(r[x[j][u.TYPE_KEY]]!="Edm.DateTime"){return;}}v.setVizProperties({categoryAxis:{title:{visible:false}}});return;}}}function T(d,f,i,m,j,k){m=typeof m==="undefined"?false:m;var r=false;var s;if(!d&&m){L.error(j+w.CARD_ERROR+i+w.IS_MANDATORY);return r;}if(!d){L.warning(j+w.CARD_WARNING+i+w.IS_MISSING);r=true;return r;}s=f["@"+d];if(!s||typeof s!=="object"){var v=m?L.error:L.warning;v(j+w.CARD_ERROR+"in "+i+". (@"+d+" "+w.NOT_WELL_FORMED);return r;}if(k&&k==="sap.ovp.cards.v4.charts.analytical.analyticalChart"&&i==="Chart Annotation"&&(!s.ChartType||!s.ChartType.$EnumMember)){L.error(j+w.CARD_ERROR+w.MISSING_CHARTTYPE+w.CHART_ANNO);return r;}r=true;return r;}function W(d){var r=false;if(!d){return r;}var s;var f;var i;var j;var k;var m;var v;var x="";var D1;var E1=d.getView();if(E1){x="["+E1.getId()+"] ";}if(!(D1=d.getCardPropertiesModel())){L.error(x+w.CARD_ERROR+"in "+w.CARD_CONFIG+w.NO_CARD_MODEL);return r;}v=D1.getProperty("/entityType");var F1=d.getMetaModel();var G1=F1.getData().$Annotations[v.$Type];if(!v||t(v)){L.error(x+w.CARD_ERROR+"in "+w.CARD_ANNO);return r;}s=D1.getProperty("/selectionAnnotationPath");f=D1.getProperty("/chartAnnotationPath");j=D1.getProperty("/presentationAnnotationPath");k=D1.getProperty("/identificationAnnotationPath");m=D1.getProperty("/dataPointAnnotationPath");i=D1.getProperty("/contentFragment");r=T(s,G1,"Selection Variant",false,x);r=T(f,G1,"Chart Annotation",true,x,i)&&r;r=T(j,G1,"Presentation Variant",false,x)&&r;r=T(k,G1,"Identification Annotation",true,x)&&r;r=T(m,G1,"Data Point",false,x)&&r;return r;}function X(d,f,v){}function Y(d){return U.getConfig(d);}function Z(d,f,i,j){var r=false;var m;var k;var s;var v;var x;var D1;if(!f.time||t(f.time)){return r;}if(!d){return r;}for(var E1=0;E1<d.length;E1++){if(!d[E1].Dimension||!(k=d[E1].Dimension.$PropertyPath)){return r;}m=q1(i,j);if(m&&m[k]){s=m[k][u.TYPE_KEY];v=m[k][u.DISPLAY_FORMAT_KEY];x=m[k][u.SEMANTICS_KEY];D1=y(i,j,k);}if(s&&s.lastIndexOf("Edm.Date",0)===0){if(s.toLowerCase()==="edm.datetime"){if(v&&v.toLowerCase()==="date"){r=true;}}else{r=true;}}if(s==="Edm.String"&&(D1||x&&S.indexOf(x)>-1)){r=true;}if(r){d.unshift(d.splice(E1,1)[0]);break;}}return r;}function $(i,d,f){var r="";var j=Y(d);var k,m;if(!j){return r;}r=j.default.type;k=i.getSetting("dataModel");m=i.getSetting('ovpCardProperties').getProperty("/entitySet");if(Z(f,j,k,m)){r=j.time.type;}return r;}$.requiresIContext=true;function _(d,j,k){if(!d.length){return;}var m=k==="dimension"?"Dimension":"Measure";var r=[];n(d,function(i,v){if(!v||!v[m]||!v[m].PropertyPath){L.error(w.INVALID_CHART_ANNO);return false;}r.push(v[m].PropertyPath);});var s=q.map(j.feeds,function(f){if(f.type===k){if(f.role){return f.role.split("|");}return[];}});s=q.grep(s,function(f,i){return(s?Array.prototype.indexOf.call(s,f):-1)===i;}).join(", ");L.error(w.CARD_ERROR+w.INVALID_REDUNDANT+k+"(s) "+r.join(", ")+". "+w.ALLOWED_ROLES+j.type+w.CHART_IS+s);}function a1(v,i){var d;if(v){if(v.String){d=v.String;}else if(v.Boolean||v.Bool){d=b1(v);}else{d=c1(v,i);}}return d;}function b1(v,d){if(v&&v.Boolean){if(v.Boolean.toLowerCase()==="true"){return true;}else if(v.Boolean.toLowerCase()==="false"){return false;}}else if(v&&v.Bool){if(v.Bool.toLowerCase()==="true"){return true;}else if(v.Bool.toLowerCase()==="false"){return false;}}return d;}function c1(v,i){var d;if(v){if(v.String){d=Number(v.String);}else if(v.Int){d=Number(v.Int);}else if(v.Decimal){d=Number(v.Decimal);}else if(v.Double){d=Number(v.Double);}else if(v.Single){d=Number(v.Single);}}if(i){var f=N.getFloatInstance({style:'short',minFractionDigits:2,maxFractionDigits:2});if(d){d=f.format(Number(d));}}return d;}function d1(i,d){function f1(D1){if(D1){if(D1.Path){return"{path:'"+D1.Path+"'}";}else{return a1(D1);}}else{return"";}}var v=i[i.measureNames];if(d&&d.CriticalityCalculation&&d.CriticalityCalculation.ImprovementDirection){var s=d.CriticalityCalculation.ImprovementDirection.EnumMember;var f=f1(d.CriticalityCalculation.DeviationRangeLowValue);var j=f1(d.CriticalityCalculation.DeviationRangeHighValue);var k=f1(d.CriticalityCalculation.ToleranceRangeLowValue);var m=f1(d.CriticalityCalculation.ToleranceRangeHighValue);return a._calculateCriticalityState(v,s,f,j,k,m,a.criticalityConstants.StateValues);}else{var r=d.Criticality.EnumMember;var x=r?r.split("/"):[];if(x){return x[1];}}}function e1(d,m,f){var j,k;n(m,function(i,v){if(v["com.sap.vocabularies.Common.v1.Label"]&&v["com.sap.vocabularies.Common.v1.Label"].String===d.measureNames){j=v.name;return false;}else if(v["com.sap.vocabularies.Common.v1.Label"]&&v["com.sap.vocabularies.Common.v1.Label"].Path===d.measureNames){j=v.name;return false;}else if(v["sap:label"]===d.measureNames){j=v.name;return false;}});n(f,function(i,v){if(v.Measure.PropertyPath===j){if(!v.DataPoint||!v.DataPoint.AnnotationPath){return false;}k=v.DataPoint.AnnotationPath;return false;}});return k;}function f1(i,d){if(i){if(i.Path){return i.Path;}else{return a1(i,d);}}else{return"";}}function g1(m,d){function f(s,i){return s&&s.indexOf(i,s.length-i.length)!==-1;}var j=false;n(m,function(i,v){if(v.DataPoint&&v.DataPoint.AnnotationPath){var k=d[v.DataPoint.AnnotationPath.substring(1)];if(k&&k.CriticalityCalculation&&k.CriticalityCalculation.ImprovementDirection&&k.CriticalityCalculation.ImprovementDirection.EnumMember){var s=k.CriticalityCalculation.ImprovementDirection.EnumMember;var r=f1(k.CriticalityCalculation.DeviationRangeLowValue);var x=f1(k.CriticalityCalculation.DeviationRangeHighValue);var D1=f1(k.CriticalityCalculation.ToleranceRangeLowValue);var E1=f1(k.CriticalityCalculation.ToleranceRangeHighValue);if(f(s,"Minimize")||f(s,"Minimizing")){if(E1&&x){j=true;return false;}else{L.warning(w.CARD_WARNING+w.INVALID_CRITICALITY);}}else if(f(s,"Maximize")||f(s,"Maximizing")){if(D1&&r){j=true;return false;}else{L.warning(w.CARD_WARNING+w.INVALID_CRITICALITY);}}else if(f(s,"Target")){if(D1&&r&&E1&&x){j=true;return false;}else{L.warning(w.CARD_WARNING+w.INVALID_CRITICALITY);}}}else if(k&&k.Criticality){j=true;return false;}else{L.warning(w.CARD_WARNING+w.INVALID_IMPROVEMENT_DIR);}}});if(j===true&&m.length>1){L.warning(w.CARD_WARNING+w.INVALID_SEMANTIC_MEASURES);}return j;}function h1(m,d,f,v){function i(I1,J1){return I1&&I1.indexOf(J1,I1.length-J1.length)!==-1;}var r=[null,null];var j=true;var k=m.Measure.PropertyPath;if(f[k]){if(f[k][u.LABEL_KEY_V4]){k=p1(f[k][u.LABEL_KEY_V4].String?f[k][u.LABEL_KEY_V4].String:f[k][u.LABEL_KEY_V4].Path,v,f);}else if(f[k][u.LABEL_KEY]){k=f[k][u.LABEL_KEY];}else if(k){k=k;}}var s=m.DataPoint.AnnotationPath;var x=d[s.substring(1)];if(!x.CriticalityCalculation||!x.CriticalityCalculation.ImprovementDirection||!x.CriticalityCalculation.ImprovementDirection.EnumMember){return r;}var D1=x.CriticalityCalculation.ImprovementDirection.EnumMember;var E1=f1(x.CriticalityCalculation.DeviationRangeLowValue,j);var F1=f1(x.CriticalityCalculation.DeviationRangeHighValue,j);var G1=f1(x.CriticalityCalculation.ToleranceRangeLowValue,j);var H1=f1(x.CriticalityCalculation.ToleranceRangeHighValue,j);if(i(D1,"Minimize")||i(D1,"Minimizing")){if(H1&&F1){r[0]=h.getText("MINIMIZING_LESS",[k,H1]);r[1]=h.getText("MINIMIZING_MORE",[k,F1]);r[2]=h.getText("MINIMIZING_CRITICAL",[H1,k,F1]);}}else if(i(D1,"Maximize")||i(D1,"Maximizing")){if(G1&&E1){r[0]=h.getText("MAXIMISING_MORE",[k,G1]);r[1]=h.getText("MAXIMISING_LESS",[k,E1]);r[2]=h.getText("MAXIMIZING_CRITICAL",[E1,k,G1]);}}else if(i(D1,"Target")){if(G1&&E1&&H1&&F1){r[0]=h.getText("TARGET_BETWEEN",[G1,k,H1]);r[1]=h.getText("TARGET_AROUND",[k,E1,F1]);r[2]=h.getText("TARGET_CRITICAL",[E1,k,G1,H1,F1]);}}return r;}function i1(m,v,d){if(v&&v.DataPoint&&v.DataPoint.AnnotationPath){var f=d[v.DataPoint.AnnotationPath.substring(1)];var i,j;if(f&&f.ValueFormat){i=f.ValueFormat;}else if(f&&f.NumberFormat){i=f.NumberFormat;}if(i&&i.NumberOfFractionalDigits&&i.NumberOfFractionalDigits.Int){j=i.NumberOfFractionalDigits.Int;if(m<Number(j)){m=Number(j);}}}return m;}function j1(m,v,d){if(v&&v.DataPoint&&v.DataPoint.AnnotationPath){var f=d[v.DataPoint.AnnotationPath.substring(1)];var s,i;if(f&&f.ValueFormat){s=f.ValueFormat;}else if(f&&f.NumberFormat){s=f.NumberFormat;}if(s){if(s.ScaleFactor&&s.ScaleFactor.Decimal){i=Number(s.ScaleFactor.Decimal);}else if(s.ScaleFactor&&s.ScaleFactor.Int){i=Number(s.ScaleFactor.Int);}if(!isNaN(i)){if(m===undefined){m=Number(i);}else if(m>Number(i)){m=Number(i);}}}}return m;}function k1(m,s){if(m&&m[s]&&(m[s]["Org.OData.Measures.V1.ISOCurrency"]||(m[s][u.SEMANTICS_KEY]&&m[s][u.SEMANTICS_KEY]===u.CURRENCY_CODE))){return true;}return false;}function l1(m,v,f){if(m[v[f].$PropertyPath].$Type===u.EDM_INT32){return true;}return false;}function m1(m,v,f){if(m[v[f].$PropertyPath].$Type===u.EDM_INT64){return true;}return false;}function n1(d,f,m,r){var s,x,D1,E1,F1;var G1,H1,I1,J1,K1,L1=false;var M1;var N1,O1,P1;var Q1,R1=[],S1=[];var T1;var U1;var V1=r&&r.getView();var W1,X1;var Y1=V1&&V1.getModel("ui");var Z1=Y1&&Y1.getProperty("/chartSettings");s=d.getModel('ovpCardProperties');if(O.checkIfAPIIsUsed(r)){L1=s&&s.getData()&&s.getData().showDataLabel;}F1=Z1?Z1.showDataLabel:L1;G1=d.getVizType();H1=Y();for(var $1 in H1){if((U1=H1[$1].reference)&&H1[U1]){var _1=o({},H1[U1]);H1[$1]=_1;}if(H1[$1].default.type===G1||(H1[$1].time&&H1[$1].time.type===G1)){I1=H1[$1];break;}}if(!I1){L.error(w.CARD_ERROR+"in "+w.CARD_CONFIG+w.CARD_CONFIG_ERROR+G1+" "+w.CARD_CONFIG_JSON);return;}if(!s){L.error(w.CARD_ERROR+"in "+w.CARD_CONFIG+w.NO_CARD_MODEL);return;}var a2=d.getModel();var b2=s.getProperty("/entitySet");if(!a2||!b2){return;}var c2=s.getProperty("/entityType").$Type;var d2=r.getMetaModel().getData().$Annotations[c2];var e2={"property":r.getMetaModel().getObject("/"+c2+"/")};x=l.merge(true,{},d2,e2);if(!x){L.error(w.CARD_ANNO_ERROR+"in "+w.CARD_ANNO);return;}var f2=q1(a2,b2);C1(a2,f2,c2);D1=s.getProperty("/chartAnnotationPath");if(!D1||!(E1=x["@"+D1])){L.error(w.CARD_ANNO_ERROR+"in "+w.CARD_ANNO);return;}if(!(J1=E1.DimensionAttributes)||!J1.length){L.error(w.CHART_ANNO_ERROR+"in "+w.CHART_ANNO+" "+w.DIMENSIONS_MANDATORY);return;}var g2;if(!(K1=E1.MeasureAttributes)||!K1.length){L.error(w.CHART_ANNO_ERROR+"in "+w.CHART_ANNO+" "+w.MEASURES_MANDATORY);return;}else{var h2=K1[0].DataPoint?x[K1[0].DataPoint.AnnotationPath.substring(1)]:null;var i2=h2&&h2.ValueFormat&&h2.ValueFormat.NumberOfFractionalDigits&&h2.ValueFormat.NumberOfFractionalDigits;g2=i2?i2:0;}T1=Z(J1,I1,a2,b2);if(T1){I1=I1.time;}else{I1=I1.default;}var j2=s.getProperty("/ChartProperties")||s.getProperty("/chartProperties");if(s&&s.getProperty("/tabs")&&(j2===undefined)){W1=V1.byId("ovp_card_dropdown");X1=parseInt(W1.getSelectedKey(),10);j2=s.getProperty("/tabs")&&s.getProperty("/tabs")[X1-1]&&(s.getProperty("/tabs")[X1-1]["ChartProperties"]||s.getProperty("/tabs")[X1-1]["chartProperties"]);}var k2=false;var l2=g2>0?"tooltipNoScaleFormatter/"+g2.toString()+"/":'tooltipNoScaleFormatter/-1/';var m2=new b({formatString:l2});m2.connect(d.getVizUid());m2.connect(d.getVizUid());d._oOvpVizFrameTooltip=m2;[I1.dimensions,I1.measures].forEach(function(j,i){var k=i?K1:J1;var v=i?"measure(s)":"dimension(s)";if(j.min&&k.length<j.min){L.error(w.CARD_ERROR+"in "+G1+" "+w.CARD_LEAST+j.min+" "+v);k2=true;}if(j.max&&k.length>j.max){L.error(w.CARD_ERROR+"in "+G1+w.CARD_MOST+j.max+" "+v);k2=true;}});if(k2){return;}var n2=true;if(I1.properties&&I1.properties.hasOwnProperty("hideLabel")&&!I1.properties["hideLabel"]){n2=false;}var o2=true;var p2=false;if(G1==='donut'){p2=true;}d.removeAllAggregation();M1={legend:{isScrollable:false},title:{visible:false},interaction:{noninteractiveMode:o2?false:true,selectability:{legendSelection:p2?true:false,axisLabelSelection:false,mode:'EXCLUSIVE',plotLassoSelection:false,plotStdSelection:true},zoom:{enablement:'disabled'}},plotArea:{window:{start:'firstDataPoint',end:'lastDataPoint'},dataLabel:{visible:F1||p2?true:false,type:'value'},dataPoint:{invalidity:'ignore'},alignment:{vertical:'top'}},categoryAxis:{label:{truncatedLabelRatio:0.15}},general:{groupData:false,showAsUTC:true}};if(I1.properties&&I1.properties.semanticColor===true&&g1(K1,x)){var q2=h.getText("GOOD");var r2=h.getText("BAD");var s2=h.getText("CRITICAL");var t2=h.getText("OTHERS");if(K1.length===1){var u2=h1(K1[0],x,f2,d);var q2=u2[0]||q2,r2=u2[1]||r2,s2=u2[2]||s2,t2=h.getText("OTHERS");}M1.plotArea.dataPointStyle={rules:[{callback:function(i){var j=e1(i,f2,K1);if(!j){return false;}var k=x[j.substring(1)];var v=d1(i,k);if(v===a.criticalityConstants.StateValues.Positive){return true;}else if(v==="Positive"){return true;}},properties:{color:"sapUiChartPaletteSemanticGoodLight1"},"displayName":q2},{callback:function(i){var j=e1(i,f2,K1);if(!j){return false;}var k=x[j.substring(1)];var v=d1(i,k);if(v===a.criticalityConstants.StateValues.Critical){return true;}else if(v==="Critical"){return true;}},properties:{color:"sapUiChartPaletteSemanticCriticalLight1"},"displayName":s2},{callback:function(i){var j=e1(i,f2,K1);if(!j){return false;}var k=x[j.substring(1)];var v=d1(i,k);if(v===a.criticalityConstants.StateValues.Negative){return true;}else if(v==="Negative"){return true;}},properties:{color:"sapUiChartPaletteSemanticBadLight1"},"displayName":r2},{callback:function(i){var j=e1(i,f2,K1);if(!j){return false;}var k=x[j.substring(1)];var v=d1(i,k);if(v===a.criticalityConstants.StateValues.None){return true;}else if(v==="Neutral"){return true;}},properties:{color:"sapUiChartPaletteSemanticNeutralLight1"},"displayName":t2}]};}var v2=s.getProperty("/bEnableStableColors");var w2=s.getProperty("/colorPalette");var x2;var y2=[u.COLUMNSTACKED_CHARTTYPE,u.DONUT_CHARTTYPE,u.COLUMN_CHARTTYPE,u.BAR_CHARTTYPE,u.VERTICALBULLET_CHARTTYPE,u.LINE_CHARTTYPE,u.COMBINATION_CHARTTYPE,u.BUBBLE_CHARTTYPE];if(!v2&&y2.indexOf(E1.ChartType.$EnumMember)>=0&&w2&&Object.keys(w2).length>=2&&Object.keys(w2).length<=4){n(J1,function(i,j){if(j&&j.Role&&j.Role.$EnumMember==="com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Series"){x2=j.Dimension&&j.Dimension.$PropertyPath;return;}});var z2;if(x2){if(f2&&f2[x2]){if(f2[x2][u.LABEL_KEY_V4]){z2=p1(f2[x2][u.LABEL_KEY_V4]?f2[x2][u.LABEL_KEY_V4]:f2[x2][u.LABEL_KEY_V4].Path,d,f2);}else if(f2[x2][u.LABEL_KEY]){z2=f2[x2][u.LABEL_KEY];}else if(x2){z2=x2;}}if(w2 instanceof Array){var A2=w2.map(function(v){return v.color;});var B2=w2.map(function(v){return v.legendText;});var C2=B2[0]!=undefined?B2[0]:h.getText("OTHERS");var D2=B2[1]!=undefined?B2[1]:h.getText("BAD");var E2=B2[2]!=undefined?B2[2]:h.getText("CRITICAL");var F2=B2[3]!=undefined?B2[3]:h.getText("GOOD");}M1.plotArea.dataPointStyle={rules:[{callback:function(i){if(i&&(i[z2]==="3"||i[z2]===3)){if(w2 instanceof Array){if(w2.length<4){return false;}}else if(w2&&!w2.hasOwnProperty(3)){return false;}return true;}},properties:{color:w2 instanceof Array&&A2.length?A2[3]:w2[3]&&w2[3]["color"]},"displayName":F2||w2[3]&&w2[3]["legendText"]},{callback:function(i){if(i&&(i[z2]==="2"||i[z2]===2)){if(w2 instanceof Array){if(w2.length<3){return false;}}else if(w2&&!w2.hasOwnProperty(2)){return false;}return true;}},properties:{color:w2 instanceof Array&&A2.length?A2[2]:w2[2]&&w2[2]["color"]},"displayName":E2||w2[2]&&w2[2]["legendText"]},{callback:function(i){if(i&&(i[z2]==="1"||i[z2]===1)){return true;}},properties:{color:w2 instanceof Array&&A2.length?A2[1]:w2[1]&&w2[1]["color"]},"displayName":D2||w2[1]&&w2[1]["legendText"]},{callback:function(i){if(i&&(i[z2]==="0"||i[z2]===0)){return true;}},properties:{color:w2 instanceof Array&&A2.length?A2[0]:w2[0]&&w2[0]["color"]},"displayName":C2||w2[0]&&w2[0]["legendText"]}]};}}var G2=false;var H2=false;if(E1.ChartType.$EnumMember===u.SCATTER_CHARTTYPE||E1.ChartType.$EnumMember===u.BUBBLE_CHARTTYPE||E1.ChartType.$EnumMember===u.LINE_CHARTTYPE){if(E1&&E1.AxisScaling&&E1.AxisScaling.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"){var I2=E1.AxisScaling;if(I2.AutoScaleBehavior&&I2.AutoScaleBehavior.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisAutoScaleBehaviorType"){var J2=I2.AutoScaleBehavior;if(J2.ZeroAlwaysVisible&&J2.ZeroAlwaysVisible=="true"){M1.plotArea.adjustScale=false;G2=true;}else if(J2.DataScope){M1.plotArea.adjustScale=true;G2=true;}}else if(I2.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"&&I2.ScaleBehavior&&I2.ScaleBehavior.$EnumMember){var K2=I2.ScaleBehavior.$EnumMember;var L2=K2.substring(K2.lastIndexOf('/')+1,K2.length);if(L2=="FixedScale"){H2=true;}}}else if(E1&&E1.AxisScaling&&E1.AxisScaling.$EnumMember){var M2=E1.AxisScaling.$EnumMember.substring(E1.AxisScaling.$EnumMember.lastIndexOf('/')+1,E1.AxisScaling.$EnumMember.length);switch(M2){case"AdjustToDataIncluding0":M1.plotArea.adjustScale=false;G2=true;break;case"AdjustToData":M1.plotArea.adjustScale=true;G2=true;break;case"MinMaxValues":H2=true;break;default:break;}}if(H2){var N2=[];if(E1["MeasureAttributes"][0]&&E1["MeasureAttributes"][0].DataPoint&&E1["MeasureAttributes"][0].DataPoint.AnnotationPath){var O2=E1["MeasureAttributes"][0].DataPoint.AnnotationPath;var P2=O2.substring(O2.lastIndexOf('@')+1,O2.length);if(x&&x[P2]){var Q2=x[P2];if(Q2&&Q2.MaximumValue&&Q2.MaximumValue&&Q2.MinimumValue&&Q2.MinimumValue){N2.push({feed:"valueAxis",max:Q2.MaximumValue,min:Q2.MinimumValue});G2=true;}else{L.error(w.ERROR_MISSING_AXISSCALES);}}}if(E1.ChartType.$EnumMember!==u.LINE_CHARTTYPE&&E1["MeasureAttributes"][1]&&E1["MeasureAttributes"][1].DataPoint&&E1["MeasureAttributes"][1].DataPoint.AnnotationPath){var O2=E1["MeasureAttributes"][1].DataPoint.AnnotationPath;var P2=O2.substring(O2.lastIndexOf('@')+1,O2.length);if(x&&x[P2]){var Q2=x[P2];if(Q2&&Q2.MaximumValue&&Q2.MaximumValue&&Q2.MinimumValue&&Q2.MinimumValue){N2.push({feed:"valueAxis2",max:Q2.MaximumValue,min:Q2.MinimumValue});G2=true;}else{L.error(w.ERROR_MISSING_AXISSCALES);}}}d.setVizScales(N2);}}O1=J1.slice();P1=K1.slice();var R2=0;var S2=0;var T2;var U2;var V2=false;var W2=false;var X2;var Y2=[];var Z2=[],$2=[];if((G1==="column"||G1==="bar"||G1==="vertical_bullet")&&I1.feeds&&(I1.feeds.length>0)){var _2;for(_2=0;_2<I1.feeds.length;_2++){if(I1.feeds[_2].uid==="color"){I1.feeds.splice(_2,1);break;}}for(_2=0;_2<I1.feeds.length;_2++){if(I1.feeds[_2].uid==="categoryAxis"){delete I1.feeds[_2].role;break;}}if(s.getProperty("/colorPalette")){for(_2=0;_2<I1.feeds.length;_2++){if(I1.feeds[_2].uid==="categoryAxis"){I1.feeds[_2].role="Category";break;}}I1.feeds.push({"uid":"color","min":1,"type":"dimension","role":"Series"});}}n(I1.feeds,function(i,v){var h3=v.uid;var i3=[];if(v.type){var j3,k3,l3;if(v.type==="dimension"){j3=J1.length;k3="Dimension";l3="dimensions";N1=O1;Q1=R1;}else{j3=K1.length;k3="Measure";l3="measures";N1=P1;Q1=S1;}var m3=0,n3=j3;if(v.min){m3=m3>v.min?m3:v.min;}if(v.max){n3=n3<v.max?n3:v.max;}if(!v.role){var o3=N1.length;for(var j=0;j<o3&&i3.length<n3;++j){var p3=N1[j];N1.splice(j,1);--o3;--j;i3.push(p3);if(f2[p3[k3].$PropertyPath][u.UNIT_KEY_V4_ISOCurrency]){X2=f2[p3[k3].$PropertyPath][u.UNIT_KEY_V4_ISOCurrency].$Path?f2[p3[k3].$PropertyPath][u.UNIT_KEY_V4_ISOCurrency].$Path:undefined;}else if(f2[p3[k3].$PropertyPath][u.UNIT_KEY_V4_Unit]){X2=f2[p3[k3].$PropertyPath][u.UNIT_KEY_V4_Unit].$Path?f2[p3[k3].$PropertyPath][u.UNIT_KEY_V4_Unit].$Path:undefined;}else if(f2[p3[k3].$PropertyPath][u.UNIT_KEY]){X2=f2[p3[k3].$PropertyPath][u.UNIT_KEY];}if(k1(f2,X2)){V2=true;}else{W2=true;}if(!V2){R2=i1(R2,p3,x);T2=j1(T2,p3,x);}else{S2=i1(S2,p3,x);U2=j1(U2,p3,x);}}}else{var q3=v.role.split("|");n(q3,function(j,J3){if(i3.length===n3){return false;}var o3=N1.length;for(var k=0;k<o3&&i3.length<n3;++k){var p3=N1[k];if(p3&&p3.Role&&p3.Role.$EnumMember&&p3.Role.$EnumMember.split("/")&&p3.Role.$EnumMember.split("/")[1]){var K3=p3.Role.$EnumMember.split("/")[1];if(K3===J3){N1.splice(k,1);--o3;--k;i3.push(p3);if(f2[p3[k3].$PropertyPath][u.UNIT_KEY_V4_ISOCurrency]){X2=f2[p3[k3].$PropertyPath][u.UNIT_KEY_V4_ISOCurrency].$Path?f2[p3[k3].$PropertyPath][u.UNIT_KEY_V4_ISOCurrency].$Path:undefined;}else if(f2[p3[k3].$PropertyPath][u.UNIT_KEY_V4_Unit]){X2=f2[p3[k3].$PropertyPath][u.UNIT_KEY_V4_Unit].$Path?f2[p3[k3].$PropertyPath][u.UNIT_KEY_V4_Unit].$Path:undefined;}else if(f2[p3[k3].$PropertyPath][u.UNIT_KEY]){X2=f2[p3[k3].$PropertyPath][u.UNIT_KEY];}if(k1(f2,X2)){V2=true;}else{W2=true;}if(!V2){R2=i1(R2,p3,x);T2=j1(T2,p3,x);}else{S2=i1(S2,p3,x);U2=j1(U2,p3,x);}}}else if((Q1?Array.prototype.indexOf.call(Q1,p3):-1)===-1){Q1.push(p3);}}});if(i3.length<n3){n(Q1,function(k,p3){var J3;var _2;if((J3=I1[l3].defaultRole)&&((q3?Array.prototype.indexOf.call(q3,J3):-1)!==-1)&&(_2=(N1?Array.prototype.indexOf.call(N1,p3):-1)!==-1)){N1.splice(_2,1);i3.push(p3);if(f2[p3[k3].$PropertyPath][u.UNIT_KEY_V4_ISOCurrency]){X2=f2[p3[k3].$PropertyPath][u.UNIT_KEY_V4_ISOCurrency].$Path?f2[p3[k3].$PropertyPath][u.UNIT_KEY_V4_ISOCurrency].$Path:undefined;}else if(f2[p3[k3].$PropertyPath][u.UNIT_KEY_V4_Unit]){X2=f2[p3[k3].$PropertyPath][u.UNIT_KEY_V4_Unit].$Path?f2[p3[k3].$PropertyPath][u.UNIT_KEY_V4_Unit].$Path:undefined;}else if(f2[p3[k3].$PropertyPath][u.UNIT_KEY]){X2=f2[p3[k3].$PropertyPath][u.UNIT_KEY];}if(k1(f2,X2)){V2=true;}else{W2=true;}if(!V2){R2=i1(R2,p3,x);T2=j1(T2,p3,x);}else{S2=i1(S2,p3,x);U2=j1(U2,p3,x);}if(i3.length===n3){return false;}}});}if(i3.length<m3){L.error(w.CARD_ERROR+w.MIN_FEEDS+G1+" "+w.FEEDS_OBTAINED+i3.length+" "+w.FEEDS_REQUIRED+m3+" "+w.FEEDS);return false;}}if(i3.length){var r3=[];var s3;if(!(s3=d.getDataset())){L.error(w.NO_DATASET);return false;}G=x;n(i3,function(i,p3){if(!p3||!p3[k3]||!p3[k3].$PropertyPath){L.error(w.INVALID_CHART_ANNO);return false;}var k=p3[k3].$PropertyPath;var z2=k;var J3=k;var K3=null;if(f2&&f2[k]){if(f2[k]["annotations"]){if(f2[k]["annotations"]["@"+u.LABEL_KEY_V4]){if(f2[k]["annotations"]["@"+u.LABEL_KEY_V4]instanceof String&&f2[k]["annotations"]["@"+u.LABEL_KEY_V4]){z2=p1(f2[k]["annotations"]["@"+u.LABEL_KEY_V4],d,f2);}else if(f2[k]["annotations"]["@"+u.LABEL_KEY_V4].$Path){z2=f2[k]["annotations"]["@"+u.LABEL_KEY_V4].$Path;}else{z2=f2[k]["annotations"]["@"+u.LABEL_KEY_V4];}}else if(f2[k]["annotations"]["@"+u.LABEL_KEY]){z2=f2[k]["annotations"]["@"+u.LABEL_KEY];}else if(k){z2=k;}if(f2[k]["annotations"]["@"+u.TEXT_KEY_V4]){J3=f2[k]["annotations"]["@"+u.TEXT_KEY_V4]?f2[k]["annotations"]["@"+u.TEXT_KEY_V4]:f2[k]["annotations"]["@"+u.TEXT_KEY_V4].$Path;}else if(f2[k]["annotations"]["@"+u.TEXT_KEY]){J3=f2[k]["annotations"]["@"+u.TEXT_KEY];}}else if(k){J3=k;}K3=f2[k].$Type||null;}var L3;if((K3==="Edm.DateTime"||K3==="Edm.DateTimeOffset")&&J3===k){L3="{path:'"+k+"', formatter: 'sap.ovp.cards.v4.charts.VizAnnotationManager.returnDateFormat'}";}else{if(f2[k]&&f2[k]["annotations"]&&f2[k]["annotations"]["@"+u.TEXT_KEY_V4]&&f2[k]["annotations"]["@"+u.TEXT_KEY_V4+"@"+u.TEXT_ARRANGEMENT_ANNO]){var M3,N3;M3=f2[k]["annotations"]["@"+u.TEXT_KEY_V4+"@"+u.TEXT_ARRANGEMENT_ANNO];N3=M3&&M3.$EnumMember;if(!N3){M3=f2[k]["annotations"]["@"+u.TEXT_KEY_V4]["@"+u.TEXT_ARRANGEMENT_ANNO];N3=M3&&M3.$EnumMember;}if(!N3){var O3=G;M3=O3&&O3["@"+u.TEXT_ARRANGEMENT_ANNO];N3=M3&&M3.$EnumMember;}switch(N3){case"com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst":L3="{"+J3.$Path+"}"+" "+"("+"{"+k+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextLast":L3="{"+k+"}"+" "+"("+"{"+J3.$Path+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly":L3="{"+J3.$Path+"}";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextSeperate":L3="{"+k+"}"+" "+"("+"{"+J3.$Path+"}"+")";break;default:L3="{"+k+"}";break;}}else{L3="{"+J3+"}";}}r3.push(z2);if(k3==="Dimension"){if(h3==="waterfallType"){var P3=new e({name:z2,value:"{"+k+"}"});}else{var P3=new e({name:z2,value:"{"+k+"}",displayValue:L3});}var Q3=f2[k][u.SEMANTICS_KEY];var R3=y(d.getModel(),b2,k);if(T1&&(K3==="Edm.DateTime"||R3||K3==="Edm.DateTimeOffset"||(Q3&&Q3.lastIndexOf("year",0)===0))){P3.setDataType("date");}s3.addDimension(P3);if(($2?Array.prototype.indexOf.call($2,z2):-1)===-1){$2.push(z2);}}else{s3.addMeasure(new M({name:z2,value:"{"+k+"}"}));if(((Z2?Array.prototype.indexOf.call(Z2,z2):-1)===-1)&&(h3!="bubbleWidth")){Z2.push(z2);}}});d.addFeed(new F({'uid':h3,'type':k3,'values':r3}));if(h3==="categoryAxis"){M1[h3]={title:{visible:n2?false:true,text:r3.join(", ")},label:{formatString:V2?'CURR':'axisFormatter',truncatedLabelRatio:0.15}};}else{M1[h3]={title:{visible:n2?false:true,text:r3.join(", ")},label:{formatString:V2?'CURR':'axisFormatter'}};}Y2.push(M1[h3]);if(I1.hasOwnProperty("vizProperties")){var t3=0;var u3=I1.vizProperties.length;var v3;var w3;for(;t3<u3;t3++){if(I1.vizProperties[t3].hasOwnProperty("value")){w3=I1.vizProperties[t3].value;}if(I1.vizProperties[t3].hasOwnProperty("path")){v3=(I1.vizProperties[t3].path).split(".");var x3=v3.length;var y3,z3;var A3;for(var B3=0,A3=v3[0],y3=M1,z3=j2;B3<x3;++B3){if(B3===x3-1){if(z3&&z3.hasOwnProperty(A3)){if(G1==='donut'&&(z3[A3]==="value"||z3[A3]==="percentage")){w3=z3[A3];}else if(G1!='donut'){w3=z3[A3];}}if((G2&&(A3!="adjustScale"))||(!G2&&(A3==="adjustScale"))||(!G2&&(A3!="adjustScale"))){y3[A3]=w3;}break;}y3[A3]=y3[A3]||{};y3=y3[A3];if(z3){z3[A3]=z3[A3]||{};z3=z3[A3];}A3=v3[B3+1];}}}}if(v.hasOwnProperty("vizProperties")){var i=0;var C3=v.vizProperties.length;var D3;var E3;var F3;for(;i<C3;i++){if(v.vizProperties[i].hasOwnProperty("method")){E3=v.vizProperties[i].method;switch(E3){case'count':D3=r3.length;if(v.vizProperties[i].hasOwnProperty("min")&&D3<=v.vizProperties[i].min){D3=v.vizProperties[i].min;}else if(v.vizProperties[i].hasOwnProperty("max")&&D3>=v.vizProperties[i].max){D3=v.vizProperties[i].max;}break;default:break;}}else if(v.vizProperties[i].hasOwnProperty("value")){D3=v.vizProperties[i].value;}if(v.vizProperties[i].hasOwnProperty("path")){F3=(v.vizProperties[i].path).split(".");var G3=F3.length;for(var j=0,H3=F3[0],I3=M1;j<G3;++j){if(j===G3-1){I3[H3]=D3;break;}I3[H3]=I3[H3]||{};I3=I3[H3];H3=F3[j+1];}}}}}}});var a3=d.getFeeds();if(I1.properties&&I1.properties.semanticPattern===true&&J(a3,G1)){n(a3,function(i,v){if(a3[i].getType()==='Measure'&&((a3[i].getUid()==='valueAxis')||(a3[i].getUid()==='actualValues'))){var j;n(K1,function(_2,m3){var n3=I(m3.Measure.$PropertyPath,f2);if(n3===a3[i].getValues()[0]){j=E(m3,x);return false;}});if(j){var k=I(j.Measure.$PropertyPath,f2);var h3=(x[j.DataPoint.AnnotationPath.substring(1)].ForecastValue.PropertyPath||x[j.DataPoint.AnnotationPath.substring(1)].ForecastValue.Path);var i3=I(h3,f2);var j3=h.getText("ACTUAL",[k]);var k3=h.getText("FORECAST",[i3]);M1.plotArea.dataPointStyle={rules:[{dataContext:{MeasureNamesDimension:k},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"line",lineColor:"sapUiChartPaletteSequentialHue1Light1"},displayName:j3},{dataContext:{MeasureNamesDimension:i3},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"dotted",lineColor:"sapUiChartPaletteSequentialHue1Light1",pattern:"diagonalLightStripe"},displayName:k3}]};d.getDataset().addMeasure(new M({name:i3,value:"{"+h3+"}"}));var l3=a3[i].getValues();l3.push(i3);a3[i].setValues(l3);}return false;}});}if(I1.properties&&I1.properties.semanticPattern===true&&J(a3,G1)&&d.getVizType()==="vertical_bullet"){n(a3,function(i,v){if(a3[i].getType()==='Measure'&&((a3[i].getUid()==='valueAxis')||(a3[i].getUid()==='actualValues'))){var j;n(K1,function(_2,i3){var j3=I(i3.Measure.PropertyPath,f2);if(j3===a3[i].getValues()[0]){j=H(i3,x);return false;}});if(j){var k=(x[j.DataPoint.AnnotationPath.substring(1)].TargetValue.PropertyPath||x[j.DataPoint.AnnotationPath.substring(1)].TargetValue.Path);var h3=I(k,f2);d.getDataset().addMeasure(new M({name:h3,value:"{"+k+"}"}));d.addFeed(new F({'uid':"targetValues",'type':"Measure",'values':[h3]}));}return false;}});}if(V2&&W2){L.warning(h.getText("Currency_non_currency_measure"));}n(a3,function(i,k){var v=k.getProperty("type");if(v==="Measure"){var h3=k.getProperty("values");var i3=true;var j3=E1.MeasureAttributes.filter(function(j){var k3=j[v].$PropertyPath;var l3=f2[k3];return Object.keys(l3).length>0&&h3.indexOf(k3)>=0;});n(j3,function(j,k3){if(l1(f2,k3,v)||m1(f2,k3,v)){i3=false;}else{i3=true;return false;}});if(!i3){M1[k.getProperty('uid')]['label']['allowDecimals']=false;}}});var b3;if(U2===undefined){U2="";}if(T2===undefined){T2="";}if(V2){b3=s1(U2,V2);}else{b3=s1(T2,V2);}if(f){f.setScale(b3);}r1(Z2,$2,m);var c3="";n(a3,function(i,j){var k="-1";var v=j.getProperty("type");if(v==="Measure"){var h3=Y2.filter(function(k3){var l3=k3["title"]["text"].split(",").filter(function(m3){if(j.getValues().indexOf(m3.trim())>=0){return true;}else{return false;}});if(l3.length>0){return true;}else{return false;}});if(h3&&h3.length){var i3=j.getValues();if(i3&&i3.length){n(i3,function(i,k3){var l3=k3.trim();var m3=K1.filter(function(q3){if(q3["Measure"]&&q3["Measure"]["PropertyPath"]){var r3=q3["Measure"]["PropertyPath"];if((f2[r3]&&f2[r3][u.LABEL_KEY]===l3)||(f2[r3]&&f2[r3][u.LABEL_KEY_V4]===l3)){return true;}else{return false;}}});if(m3&&m3.length){var n3=m3[0];if(!l1(f2,n3,v)&&!m1(f2,n3,v)){var o3="";if(n3&&n3["DataPoint"]&&n3["DataPoint"]["AnnotationPath"]&&n3["DataPoint"]["AnnotationPath"]){o3=n3["DataPoint"]["AnnotationPath"]&&n3["DataPoint"]["AnnotationPath"].substring(1);if(o3!=""){var p3;p3=x[o3]&&x[o3]["ValueFormat"]&&x[o3]["ValueFormat"]["NumberOfFractionalDigits"]&&x[o3]["ValueFormat"]["NumberOfFractionalDigits"]["Int"];k=p3>k?p3:k;}}}else{k=k<"0"?"0":k;}}});}}if(h3&&h3[0]&&h3[0].label&&h3[0].label.formatString){var j3=h3[0].label.formatString;}c3="";if(V2){if(j3==='CURR'){c3='CURR/'+k.toString()+"/";}else{c3='axisFormatter/'+k.toString()+"/";}}else{c3='axisFormatter/'+k.toString()+"/";}if(h3&&h3[0]){h3[0].label.formatString=c3;}}});if(G1==="vertical_bullet"){M1["valueAxis"]={title:{visible:n2?false:true},label:{formatString:c3}};}var d3="";var e3="";if(V2){d3=S2.toString();e3='CURR/'+S2.toString()+"/";}else{d3=R2.toString();e3='axisFormatter/'+R2.toString()+"/";}if(G1==="donut"||F1){if(G1==="donut"){M1.legendGroup={layout:{height:0.1}};}M1.plotArea.dataLabel.formatString=e3;if(M1.plotArea.dataLabel.type==="percentage"){M1.plotArea.dataLabel.formatString="0.0%/"+d3+"/";}}_(O1,I1,"dimension");_(P1,I1,"measure");if(T1){var f3=J1[0].Dimension.$PropertyPath;var g3=d.getModel().getMetaModel().getObject("/"+b2+"/"+f3+"@");if(g3["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){M1.timeAxis.levels=["year","month"];}else if(g3["@com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){M1.timeAxis.levels=["year","quarter"];}else if(g3["@com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){M1.timeAxis.levels=["year","week"];}else if(g3["@com.sap.vocabularies.Common.v1.IsCalendarYear"]){M1.timeAxis.levels=["year"];}}d.setVizProperties(M1);}function o1(v,d,f,j){if(v&&(v.getVizType()==="bubble"||v.getVizType()==="scatter")){return;}var k,r,s,x;var D1;var E1=u.UNIT_KEY;var F1=u.UNIT_KEY_V4_ISOCurrency;var G1=u.UNIT_KEY_V4_Unit;var H1;var I1=[];if(!(k=v.getModel('ovpCardProperties'))){L.error(w.CARD_ERROR+"in "+w.CARD_CONFIG+w.NO_CARD_MODEL);return;}var J1=v.getModel();var K1=k.getProperty("/entitySet");if(!J1||!K1){return;}r=j[k.getProperty("/entityType").$Type];if(!r){L.error(w.CARD_ANNO_ERROR+"in "+w.CARD_ANNO);return;}var L1=q1(J1,K1);s=k.getProperty("/chartAnnotationPath");if(!s||!(x=r["@"+s])){L.error(w.CARD_ANNO_ERROR+"in "+w.CARD_ANNO);return;}if(!(D1=x.MeasureAttributes)||!D1.length){L.error(w.CHART_ANNO_ERROR+"in "+w.CHART_ANNO+" "+w.MEASURES_MANDATORY);return;}n(D1,function(i,m){H1=m.Measure.$PropertyPath;if(m.DataPoint&&m.DataPoint.AnnotationPath){var U1=r[m.DataPoint.AnnotationPath.substring(1)];if(U1.ForecastValue&&(U1.ForecastValue.PropertyPath||U1.ForecastValue.Path)){I1.push((U1.ForecastValue.PropertyPath||U1.ForecastValue.Path));}}I1.push(H1);});var M1=d?d:null;var N1="";var O1=true;var P1=[];var Q1=v.getFeeds();n(Q1,function(i,m){if(m.getType()==="Measure"){P1=P1.concat(m.getValues());}});if(M1){n(I1,function(i,m){var U1="";if(L1&&L1[m]){if(L1[m][u.LABEL_KEY_V4]){U1=p1(L1[m][u.LABEL_KEY_V4].String?L1[m][u.LABEL_KEY_V4].String:L1[m][u.LABEL_KEY_V4].Path,v,L1);}else if(L1[m][u.LABEL_KEY]){U1=L1[m][u.LABEL_KEY];}else if(m){U1=m;}}if((P1?Array.prototype.indexOf.call(P1,U1):-1)!=-1){if(L1&&L1[m]){var V1;if(L1[m][F1]){V1=L1[m][F1].Path?L1[m][F1].Path:L1[m][F1].String;}else if(L1[m][G1]){V1=L1[m][G1].Path?L1[m][G1].Path:L1[m][G1].String;}else if(L1[m][E1]){V1=L1[m][E1];}if(!V1){O1=false;return false;}if(V1&&L1[V1]){for(var i=0;i<M1.length;i++){var W1=M1[i];if(O1){if(N1&&W1[V1]&&(W1[V1]!="")&&(N1!="")&&(N1!=W1[V1])){O1=false;break;}}N1=W1[V1];}}}}});}var R1="";if(O1){if(N1!=""){R1=h.getText("IN_NO_SCALE",[N1]);R1=" "+R1;}if(f){f.setText(R1);f.data("aria-label",R1,true);var S1=v.data("aria-label");if(S1&&R1&&S1.indexOf(R1)===-1){var T1=S1+R1;v.data("aria-label",T1,true);}}}}function p1(f,v,m){var r;var s;var d;if(f&&f.indexOf("{")===0){f=f.slice(1,-1);if(f.indexOf(">")!=-1){d=f.split(">");r=d[0];s=d[1];}else if(f.indexOf("&gt;")!=-1){d=f.split("&gt;");r=d[0];s=d[1];}try{f=v.getModel(r).getProperty(s);}catch(i){f=m[f][u.LABEL_KEY_V4].String;L.error("Unable to read labels from resource file",i);}}return f;}function q1(m,d){var f=U.cacheODataMetadata(m);if(!f){return undefined;}return f[d];}function r1(m,d,f){var j="",k="",r="";if(f){j=f.getText();}if(m&&(m.length>1)){for(var i=0;i<m.length-1;i++){if(k!=""){k+=", ";}k+=m[i];}k=h.getText("MEAS_DIM_TITLE",[k,m[i]]);}else if(m){k=m[0];}if(d&&(d.length>1)){for(var i=0;i<d.length-1;i++){if(r!=""){r+=", ";}r+=d[i];}r=h.getText("MEAS_DIM_TITLE",[r,d[i]]);}else if(d){r=d[0];}if(f&&(j==="")){j=h.getText("NO_CHART_TITLE",[k,r]);f.setText(j);f.data("aria-label",j,true);}}function s1(m,i){var d=1;var s;if(i){var f=N.getCurrencyInstance({style:'short',currencyCode:false,shortRefNumber:m});s=f.format(Number(d));}else{var j=N.getFloatInstance({style:'short',shortRefNumber:m});s=j.format(Number(d));}var k=s.slice(-1);return k;}function t1(v,d){v.attachSelectData(function(f){var s=l.bCRTLPressed?l.constants.explace:l.constants.inplace;l.bCRTLPressed=false;var m=v.getModel('ovpCardProperties');var D1=v.getModel();var E1=m.getProperty("/entitySet");var F1=q1(D1,E1);var G1=[],H1=[];var I1={},J1={};var K1=v.getDataset().getDimensions();var L1;var M1=m.getProperty("/entityType");var N1=d.getMetaModel().getData()["$Annotations"];for(var i=0;i<K1.length;i++){G1.push(K1[i].getName());}var O1=v.getDataset().getBinding("data").getCurrentContexts().map(function(x){return x.getObject();});if(f.getParameter("data")&&f.getParameter("data")[0]&&f.getParameter("data")[0].data){H1=Object.keys(f.getParameter("data")[0].data);L1=f.getParameter("data")[0].data._context_row_number;var P1=v.getDataset().getBinding("data").getContexts()[L1];var Q1=d.getEntityNavigationEntries(P1)[0];if(O1[L1].$isOthers&&O1[L1].$isOthers===true){var R1={},S1=[];for(var j=0;j<G1.length;j++){for(var k=0;k<H1.length;k++){if(G1[j]===H1[k]){for(var T1 in F1){if(F1.hasOwnProperty(T1)){var U1=F1[T1][u.LABEL_KEY]||F1[T1][u.NAME_KEY]||F1[T1][u.NAME_CAP_KEY];if(U1===H1[k]){S1.push(T1);}}}}}}for(var i=0;i<S1.length;i++){R1[S1[i]]=[];for(var j=0;j<O1.length-1;j++){if(j!=L1){R1[S1[i]].push(O1[j][S1[i]]);}}}var V1={$isOthers:true};var W1={getObject:function(){return V1;},getOtherNavigationDimensions:function(){return R1;}};if(O.checkIfAPIIsUsed(d)){if(d.checkAPINavigation()){c.onContentClicked(W1);}}else{if(Q1){d.doNavigation(W1,Q1,s);}}}else{for(var j=0;j<G1.length;j++){for(var k=0;k<H1.length;k++){if(G1[j]===H1[k]){for(var T1 in F1){if(N1[M1.$Type+"/"+T1]){var U1=(typeof N1[M1.$Type+"/"+T1]["@"+u.LABEL_KEY_V4]==='string'&&N1[M1.$Type+"/"+T1]["@"+u.LABEL_KEY_V4])||N1[M1.$Type+"/"+T1][u.LABEL_KEY]||N1[M1.$Type+"/"+T1][u.NAME_KEY]||N1[M1.$Type+"/"+T1][u.NAME_CAP_KEY]||T1;if(U1.match(/{@i18n>.+}/gi)){var X1=this.getModel("@i18n").getResourceBundle();U1=X1.getText(U1.substring(U1.indexOf(">")+1,U1.length-1));}if(U1===H1[k]){I1[T1]=O1[L1][T1];}}}}for(var T1 in O1[L1]){if(F1.hasOwnProperty(T1)){J1[T1]=O1[L1][T1];}}}}if(I1){n(Object.keys(I1),function(i,T1){var r=F1[T1]&&F1[T1]["annotations"];if(F1[T1]["$Type"]==="Edm.String"){if(F1[T1]["sap:semantics"]==="yearmonth"||(r&&r["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"])){I1[T1]=(I1[T1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYMM"}).format(I1[T1]):I1[T1]);}else if(F1[T1]["sap:semantics"]==="yearquarter"||(r&&r["@com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"])){I1[T1]=(I1[T1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYQ"}).format(I1[T1]):I1[T1]);}else if(F1[T1]["sap:semantics"]==="yearweek"||(r&&r["@com.sap.vocabularies.Common.v1.IsCalendarYearWeek"])){I1[T1]=(I1[T1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYww"}).format(I1[T1]):I1[T1]);}}});}if(J1){n(Object.keys(J1),function(i,T1){var r=F1[T1]&&F1[T1]["annotations"];if(F1[T1]["$Type"]==="Edm.String"){if(F1[T1]["sap:semantics"]==="yearmonth"||(r&&r["@com.sap.vocabularies.Common.v1.IsCalendarYearMonth"])){J1[T1]=(J1[T1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYMM"}).format(J1[T1]):J1[T1]);}else if(F1[T1]["sap:semantics"]==="yearquarter"||(r&&r["@com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"])){J1[T1]=(J1[T1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYQ"}).format(J1[T1]):J1[T1]);}else if(F1[T1]["sap:semantics"]==="yearweek"||(r&&r["@com.sap.vocabularies.Common.v1.IsCalendarYearWeek"])){J1[T1]=(J1[T1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYww"}).format(J1[T1]):J1[T1]);}}});}var Y1=M1[m.getProperty('/presentationAnnotationPath')];if(M1){var Z1=a.getRequestFields(Y1);if(Z1&&Z1.length>0){n(Z1,function(i,r){if(!I1.hasOwnProperty(r)){I1[r]=O1[L1][r];}});}}var W1={getObject:function(){return I1;},getAllData:function(){return J1;}};if(O.checkIfAPIIsUsed(d)){if(d.checkAPINavigation()){c.onContentClicked(W1);}}else{if(Q1){d.doNavigation(W1,Q1,s);}}}}});}function u1(d){if(d.$EnumMember.endsWith("Bubble")){return true;}else{return false;}}function v1(d){var r=false;if(!d||d.constructor!=Array||d.length<1||d[0].constructor!=Object||!d[0].Dimension||!d[0].Dimension.$PropertyPath){L.error(w.CHART_ANNO_ERROR+"in "+w.CHART_ANNO+" "+w.DIMENSIONS_MANDATORY);return r;}r=true;return r;}function w1(m){var r=false;if(!m||m.constructor!=Array||m.length<1||m[0].constructor!=Object||!m[0].Measure||!m[0].Measure.$PropertyPath){L.error(w.CHART_ANNO_ERROR+"in "+w.CHART_ANNO+" "+w.MEASURES_MANDATORY);return r;}r=true;return r;}function x1(d){d=d["$Type"];return d;}function y1(d){if(d&&d.indexOf("#")!=-1){var f=d.split("#");if(f.length>1){return f[1];}}return"";}function z1(d,v){var f=v.getModel('ovpCardProperties');var i=A1(v);var m=+i.itemsLength;var j=+f.getProperty("/dataStep");if(m&&j){var k=d.colSpan-1;if(k>=0){m+=j*k;B1(v,m);}}}function A1(v){var d=v.getModel('ovpCardProperties');var f=d.getProperty("/entityType");var i=d.getProperty("/presentationAnnotationPath");var j=f.hasOwnProperty(i)&&f[i];var m=j&&j.MaxItems;if(m){var k=m.Int32?m.Int32:m.Int;return{itemsLength:+k,dataStep:+d.getProperty("/dataStep")};}}function B1(v,d){var f,j={},k=[];var r=v.getVizType();var s=v.getModel('ovpCardProperties');var x=s.getProperty("/entityType");var D1=s.getProperty("/chartAnnotationPath");var E1=x[D1];var F1=v.getParent();var G1=F1.getBinding("data");j.path=G1.getPath();j.parameters={};if(G1.mParameters&&G1.mParameters.select){j.parameters.select=G1.mParameters.select;}j.filters=G1.aApplicationFilters;j.sorter=G1.aSorters;j.length=(r==="donut")?d+1:d;j.template=new g();F1.bindAggregation("data",j);if(r==="donut"){n(E1.MeasureAttributes,function(i,m){k.push(m.Measure.PropertyPath);});f={};f.path=G1.getPath();f.parameters={};f.parameters.select=k.join(",");f.filters=G1.aApplicationFilters;f.sorter=G1.aSorters;f.length=1;f.template=new g();F1.bindAggregation("aggregateData",f);}F1.updateBindingContext();}function C1(d,m,f){var i=d.getMetaModel().getData().$Annotations;for(var k in m){if(i[f+"/"+k]&&!m[k]["annotations"]){m[k]["annotations"]=i[f+"/"+k];}}}return{constants:u,errorMessages:w,formatItems:z,formatByType:K,returnDateFormat:P,formatChartAxes:Q,hideDateTimeAxis:R,checkExists:T,validateCardConfiguration:W,checkNoData:X,getConfig:Y,hasTimeSemantics:Z,getChartType:$,getPrimitiveValue:a1,formThePathForCriticalityStateCalculation:d1,checkFlag:g1,buildVizAttributes:n1,setChartUoMTitle:o1,getMetadata:q1,getSelectedDataPoint:t1,checkBubbleChart:u1,dimensionAttrCheck:v1,measureAttrCheck:w1,getEntitySet:x1,getAnnotationQualifier:y1,reprioritizeContent:z1,getMaxItems:A1,getLabelFromAnnotationPath:p1};},true);
