/*!
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/model/Sorter"],function(S){"use strict";var m={};var a;m.setSearchAdvancedCondition=function(_){a=_;};jQuery.extend(m,{init:function(d){var t=this;t.POS_FACET_LIST=0;t.POS_TOOLBAR_SEARCHFIELD=0;t.POS_TOOLBAR_TOGGLEBUTTON=1;t.POS_SETTING_CONTAINER=0;t.POS_ATTRIBUTE_LIST_CONTAINER=1;t.POS_ICONTABBAR=0;t.POS_TABBAR_LIST=0;t.POS_TABBAR_CONDITION=1;t.POS_SORTING_SELECT=0;t.POS_SHOWONTOP_CHECKBOX=1;t.POS_ADVANCED_CHECKBOX=0;t.POS_ADVANCED_INPUT_LAYOUT=1;t.POS_ADVANCED_BUTTON=2;t.bResetFilterIsActive=false;var n={decimals:2,};t.oFloatNumberFormat=sap.ui.core.format.NumberFormat.getFloatInstance(n);t.oIntegernumberFormat=sap.ui.core.format.NumberFormat.getIntegerInstance();t.oDateFormatOptions={pattern:"yyyy/MM/dd",UTC:false,};t.oTimestampFormatOptions={pattern:"yyyy-MM-dd HH:mm:ss.SSSSSSS",UTC:true,};t.oDateFormat=sap.ui.core.format.DateFormat.getDateTimeInstance(t.oDateFormatOptions);t.oTimestampFormat=sap.ui.core.format.DateFormat.getDateTimeInstance(t.oTimestampFormatOptions);t.dialog=d;},getFacetList:function(){var t=this;return t.dialog.oSplitContainer.getMasterPages()[0].getContent()[t.POS_FACET_LIST];},updateDetailPage:function(l,f,i){var t=this;var M=t.dialog.getModel();var s=t.dialog.getModel("searchModel");var b=l.getBindingContext().sPath;var o=M.getProperty(b);var d=M.getAttributeDataType(o);var c=this.getFacetList().indexOfAggregation("items",l);var D=t.dialog.oSplitContainer.getDetailPages()[c];var e,g,A,h;if(d==="string"||d==="text"){e=D.getContent()[t.POS_ICONTABBAR].getItems()[t.POS_TABBAR_LIST].getContent()[0].getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER];g=D.getContent()[t.POS_ICONTABBAR].getItems()[t.POS_TABBAR_LIST].getContent()[0].getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0];A=D.getContent()[t.POS_ICONTABBAR].getItems()[t.POS_TABBAR_CONDITION].getContent()[0];h=D.getContent()[t.POS_ICONTABBAR].getItems()[t.POS_TABBAR_LIST].getContent()[0].getContent()[t.POS_SETTING_CONTAINER];}else{e=D.getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER];g=D.getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0];A=D.getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER];h=D.getContent()[t.POS_SETTING_CONTAINER];}var n=D.getId();t.dialog.oSplitContainer.toDetail(n,"show");t.dialog.resetIcons(M,b,t.dialog);e.setBusy(true);var p={sAttribute:o.dimension,sBindingPath:b,sAttributeLimit:1000,bInitialFilters:i,};if(d==="number"){p.sAttributeLimit=20;}if(!M.chartQuery){M.chartQuery=M.sinaNext.createChartQuery({filter:M.getProperty("/uiFilter").clone(),dimension:o.dimension,top:1000,});}t.applyChartQueryFilter(c);if(f){var j=M.sinaNext.createSimpleCondition({attribute:o.dimension,operator:M.sinaNext.ComparisonOperator.Bw,value:f,});if(!t.bResetFilterIsActive){M.chartQuery.filter.autoInsertCondition(j);}}else{if(f===undefined&&(d==="string"||d==="text")){D.getContent()[t.POS_ICONTABBAR].getItems()[t.POS_TABBAR_LIST].getContent()[0].getSubHeader().getContent()[t.POS_TOOLBAR_SEARCHFIELD].setValue("");}}M.chartQuery.filter.searchTerm=s.getSearchBoxTerm();M.facetDialogSingleCall(p).then(function(){var I=M.getProperty(D.getBindingContext().sPath).items;if(A.data("initial")){t.initiateAdvancedConditions(A,I,A.data("dataType"));}var C=h.getItems()[t.POS_SHOWONTOP_CHECKBOX];if(g.getSelectedContexts().length>0){C.setEnabled(true);}t.updateDetailPageListItemsSelected(g,A);t.dialog.updateDetailPageCharts(I,M);});},applyChartQueryFilter:function(e){var t=this;t.dialog.getModel().resetChartQueryFilterConditions();var d=t.dialog.oSplitContainer.getDetailPages();for(var i=0;i<d.length;i++){if(i===e||d[i].getContent().length===0){continue;}var l;if(!d[i].getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER]){l=d[i].getContent()[t.POS_ICONTABBAR].getItems()[t.POS_TABBAR_LIST].getContent()[0].getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0];}else{l=d[i].getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0];}for(var j=0;j<l.getItems().length;j++){var L=l.getItems()[j];var o=L.getBindingContext().getObject();var f=o.filterCondition;if(f.attribute||f.conditions){if(L.getSelected()&&!t.bResetFilterIsActive){t.dialog.getModel().chartQuery.filter.autoInsertCondition(f);}}}t.applyAdvancedCondition(d[i],t.getFacetList().getItems()[i].getBindingContext().getObject(),t.dialog.getModel());}},resetChartQueryFilters:function(){var t=this;t.dialog.getModel().resetChartQueryFilterConditions();var d=t.dialog.oSplitContainer.getDetailPages();for(var i=0;i<d.length;i++){if(d[i].getContent().length===0){continue;}var l;if(!d[i].getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER]){l=d[i].getContent()[t.POS_ICONTABBAR].getItems()[t.POS_TABBAR_LIST].getContent()[0].getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0];}else{l=d[i].getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0];}for(var j=0;j<l.getItems().length;j++){var L=l.getItems()[j];var o=L.getBindingContext().getObject();var f=o.filterCondition;if(f.attribute||f.conditions){if(L.getSelected()){L.setSelected(false);}}}}},applyAdvancedCondition:function(d,f,A){var t=this;var b=t.dialog.getModel();var D,o,k,c,e,g,h,C;if(d.getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER]){var l=d.getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER];D=l.data("dataType");o=l.getContent();switch(D){case"timestamp":case"date":t.oDateTimeFormat=D==="timestamp"?t.oTimestampFormat:t.oDateFormat;for(k=1;k<o.length;k++){c=o[k];e=c.getContent()[t.POS_ADVANCED_CHECKBOX];var i=c.getContent()[t.POS_ADVANCED_INPUT_LAYOUT];if(e.getSelected()&&i.getDateValue()&&i.getSecondDateValue()){var s=new Date(i.getSecondDateValue().getFullYear(),i.getSecondDateValue().getMonth(),i.getSecondDateValue().getDate(),23,59,59);var j=t.oDateTimeFormat.format(i.getDateValue());var n=t.oDateTimeFormat.format(s);g=b.sinaNext.createSimpleCondition({attribute:f.dimension,attributeLabel:f.title,operator:b.sinaNext.ComparisonOperator.Ge,value:D==="timestamp"?i.getDateValue():j,valueLabel:j,});h=b.sinaNext.createSimpleCondition({attribute:f.dimension,attributeLabel:f.title,operator:b.sinaNext.ComparisonOperator.Le,value:D==="timestamp"?s:n,valueLabel:n,});C=b.sinaNext.createComplexCondition({valueLabel:i.getValue(),operator:b.sinaNext.LogicalOperator.And,conditions:[g,h],userDefined:true,});if(!t.bResetFilterIsActive){A.addFilterCondition(C,false);}}}break;case"integer":case"number":t.oNumberFormat=D==="integer"?t.oIntegernumberFormat:t.oFloatNumberFormat;for(k=1;k<o.length;k++){c=o[k];e=c.getContent()[t.POS_ADVANCED_CHECKBOX];var p=c.getContent()[t.POS_ADVANCED_INPUT_LAYOUT].getContent()[0];var q=c.getContent()[t.POS_ADVANCED_INPUT_LAYOUT].getContent()[2];var r=c.getContent()[t.POS_ADVANCED_INPUT_LAYOUT].getContent()[1];var u=t.oNumberFormat.parse(p.getValue());var v=t.oNumberFormat.parse(q.getValue());if(e.getSelected()){if(!isNaN(u)&&!isNaN(v)&&v>=u){g=b.sinaNext.createSimpleCondition({attribute:f.dimension,attributeLabel:f.title,operator:b.sinaNext.ComparisonOperator.Ge,value:u,valueLabel:t.oNumberFormat.format(u),userDefined:true,});h=b.sinaNext.createSimpleCondition({attribute:f.dimension,attributeLabel:f.title,operator:b.sinaNext.ComparisonOperator.Le,value:v,valueLabel:t.oNumberFormat.format(v),userDefined:true,});C=b.sinaNext.createComplexCondition({valueLabel:t.oNumberFormat.format(u)+r.getText()+t.oNumberFormat.format(v),operator:b.sinaNext.LogicalOperator.And,conditions:[g,h],userDefined:true,});if(!t.bResetFilterIsActive){A.addFilterCondition(C,false);}}else{t.dialog.getModel("searchModel").pushError({type:"error",title:sap.esh.search.ui.resources.i18n.getText("filterInputErrorTitle"),description:sap.esh.search.ui.resources.i18n.getText("filterInputError"),});t.dialog.bConditionValidateError=true;}}}break;default:break;}}else{var w=d.getContent()[t.POS_ICONTABBAR].getItems()[t.POS_TABBAR_CONDITION].getContent()[0];D=w.data("dataType");o=w.getContent();var x,y,z,F,O;switch(D){case"string":for(k=0;k<o.length-1;k++){c=o[k];x=c.getContent()[t.POS_ADVANCED_INPUT_LAYOUT].getContent()[0];y=c.getContent()[t.POS_ADVANCED_INPUT_LAYOUT].getContent()[1];z=y.getValue();switch(x.getSelectedKey()){case"eq":O=b.sinaNext.ComparisonOperator.Eq;break;case"ew":O=b.sinaNext.ComparisonOperator.Ew;break;case"bw":O=b.sinaNext.ComparisonOperator.Bw;break;case"co":O=b.sinaNext.ComparisonOperator.Co;break;default:O=b.sinaNext.ComparisonOperator.Eq;break;}if(y.getValue()){F=b.sinaNext.createSimpleCondition({attribute:f.dimension,attributeLabel:f.title,operator:O,value:z,valueLabel:z,userDefined:true,});if(!t.bResetFilterIsActive){A.addFilterCondition(F,false);}}}break;case"text":for(k=0;k<o.length-1;k++){c=o[k];x=c.getContent()[t.POS_ADVANCED_INPUT_LAYOUT].getContent()[0];y=c.getContent()[t.POS_ADVANCED_INPUT_LAYOUT].getContent()[1];z=y.getValue();switch(x.getSelectedKey()){case"co":O=b.sinaNext.ComparisonOperator.Co;break;default:O=b.sinaNext.ComparisonOperator.Eq;}if(y.getValue()){F=b.sinaNext.createSimpleCondition({attribute:f.dimension,attributeLabel:f.title,operator:O,value:z,valueLabel:z,userDefined:true,});if(!t.bResetFilterIsActive){A.addFilterCondition(F,false);}}}break;default:break;}}},initiateAdvancedConditions:function(A,I,t){var b=this;var c,C,o,d,e;for(var i=I.length;i>0;i--){var f=I[i-1];if(f.advanced){c=A.getContent();if(t==="string"||t==="text"){C=c[c.length-2];}else{C=c[c.length-1];}o=C.getContent()[b.POS_ADVANCED_CHECKBOX];o.setSelected(true);d=C.getContent()[b.POS_ADVANCED_INPUT_LAYOUT];switch(t){case"integer":case"number":var g=d.getContent()[0];var h=d.getContent()[2];if(f.filterCondition.conditions){for(var j=0;j<f.filterCondition.conditions.length;j++){var k=f.filterCondition.conditions[j];if(k.operator==="Ge"){g.setValue(k.valueLabel||b.oNumberFormat.format(k.value));}if(k.operator==="Le"){h.setValue(k.valueLabel||b.oNumberFormat.format(k.value));}}}break;case"string":e=f.filterCondition.operator;if(e==="Co"){d.getContent()[0].setSelectedKey("co");}else if(e==="Ew"){d.getContent()[0].setSelectedKey("ew");}else if(e==="Bw"){d.getContent()[0].setSelectedKey("bw");}d.getContent()[1].setValue(f.filterCondition.valueLabel);break;case"text":e=f.filterCondition.operator;if(e==="Co"){d.getContent()[0].setSelectedKey("co");}d.getContent()[1].setValue(f.filterCondition.valueLabel);break;default:d.setValue(f.label);break;}b.insertNewAdvancedCondition(C,t);b.dialog.getModel().changeFilterAdvaced(f,true);}}A.data("initial",false);},updateDetailPageListItemsSelected:function(d,A){var t=this;var D=A.data("dataType");t.sortingAttributeList(d.getParent().getParent());d.getParent().setBusy(false);if(D==="date"||D==="timestamp"||D==="number"||D==="integer"){d.focus();}},removeAdvancedCondition:function(A,l,t){var b=this;var c=A.getContent();var C,I,d;if(t==="string"||t==="text"){for(var i=0;i<c.length-1;i++){C=c[i];I=C.getContent()[b.POS_ADVANCED_INPUT_LAYOUT].getContent()[1];if(I.getProperty("value")){var v=I.getValue();var L=l.getBindingContext().getObject();if(v===L.filterCondition.value){d=i;break;}}}}A.removeContent(d);},sortingAttributeList:function(d){var t=this;var s=d.getContent()[t.POS_SETTING_CONTAINER];var o=s.getItems()[t.POS_SORTING_SELECT].getItems()[0];var c=s.getItems()[t.POS_SHOWONTOP_CHECKBOX];var l=d.getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER].getContent()[0];var D=l.data("dataType");var b=l.getBinding("items");var e=[];if(c.getSelected()){e.push(new S("selected",true,false));}switch(o.getSelectedKey()){case"sortName":e.push(new S("label",false,false));break;case"sortCount":e.push(new S("value",true,false));if(D==="string"||D==="text"){e.push(new S("label",false,false));}break;default:break;}b.sort(e);},insertNewAdvancedCondition:function(A,t){var o=A.getParent();var n=new a({type:t,});if(t==="string"||t==="text"){var i=o.getAggregation("content").length-1;o.insertAggregation("content",n,i);}else{var b=o.indexOfAggregation("content",A);if(b===o.getAggregation("content").length-1){o.addContent(n);}}},deleteAdvancedCondition:function(A){var t=this;var o=A.getParent();var d=A.getParent().getParent().getParent().getParent().getParent();o.removeAggregation("content",A);t.updateCountInfo(d);},updateCountInfo:function(d){var t=this;var M=t.getFacetList();var o=M.getSelectedItem();if(!o){o=M.getItems()[0];}var b=o.getBindingContext().oModel;var s=o.getBindingContext().sPath;var D=b.getProperty(s).dimension;var f=t.dialog.getModel().aFilters;var c=0;for(var j=0;j<f.length;j++){if(!f[j].advanced&&f[j].facetAttribute===D){c++;}}var e=b.getAttributeDataType(b.getProperty(s));var A,g,i,C,h;var k=0;if(e==="string"||e==="text"){A=d.getContent()[t.POS_ICONTABBAR].getItems()[t.POS_TABBAR_CONDITION].getContent()[0];g=A.getContent().length-1;for(i=0;i<g;i++){C=A.getContent()[i];h=C.getContent()[0];if(h.getSelected()){k++;}}}else{A=d.getContent()[t.POS_ATTRIBUTE_LIST_CONTAINER];g=A.getContent().length;for(i=1;i<g;i++){C=A.getContent()[i];h=C.getContent()[0];if(h.getSelected()){k++;}}}var F=b.getProperty(s).facetType;if(F==="attribute"){var l=c+k;b.setProperty(s+"/count",l);t.dialog.resetEnabledForFilterResetButton();}},});return m;});
