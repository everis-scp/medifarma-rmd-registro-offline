/*
 * ! OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./Control","./ActionToolbar","./table/TableSettings","./table/GridTableType","./table/ResponsiveTableType","./table/PropertyHelper","./mixin/FilterIntegrationMixin","./library","sap/m/Text","sap/m/Title","sap/m/ColumnHeaderPopover","sap/m/OverflowToolbar","sap/m/library","sap/ui/core/Core","sap/ui/core/format/NumberFormat","sap/ui/core/dnd/DragDropInfo","sap/ui/core/Item","sap/ui/core/format/ListFormat","sap/ui/events/KeyCodes","sap/ui/model/Sorter","sap/ui/dom/containsOrEquals","sap/base/strings/capitalize","sap/base/util/deepEqual","sap/base/util/Deferred","sap/ui/core/InvisibleMessage","sap/ui/core/InvisibleText","sap/ui/mdc/p13n/subcontroller/ColumnController","sap/ui/mdc/p13n/subcontroller/SortController","sap/ui/mdc/p13n/subcontroller/FilterController","sap/ui/mdc/p13n/subcontroller/GroupController","sap/ui/mdc/p13n/subcontroller/AggregateController","sap/m/ColumnPopoverSelectListItem","sap/m/ColumnPopoverActionItem","sap/ui/mdc/p13n/subcontroller/ColumnWidthController"],function(C,A,T,G,R,P,F,l,a,b,c,O,M,d,N,D,I,L,K,S,e,f,g,h,i,j,k,m,n,o,p,q,r,s){"use strict";var t=l.SelectionMode;var u=l.TableType;var v=l.RowAction;var w=M.ToolbarDesign;var x=M.ToolbarStyle;var y=l.MultiSelectMode;var z="sap.ui.mdc.IFilter";var B=new window.WeakMap();var E=function(a1){if(!B.has(a1)){B.set(a1,{oFilterInfoBar:null});}return B.get(a1);};function H(a1,b1){sap.ui.require(["sap/m/MessageToast"],function(c1){var d1=d.getLibraryResourceBundle("sap.ui.mdc");c1.show(d1.getText(a1,b1));});}var J=C.extend("sap.ui.mdc.Table",{metadata:{library:"sap.ui.mdc",designtime:"sap/ui/mdc/designtime/table/Table.designtime",interfaces:["sap.ui.mdc.IFilterSource","sap.ui.mdc.IxState"],defaultAggregation:"columns",properties:{width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null,invalidate:true},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:null,invalidate:true},rowAction:{type:"sap.ui.mdc.RowAction[]",defaultValue:[]},p13nMode:{type:"sap.ui.mdc.TableP13nMode[]",defaultValue:[]},delegate:{type:"object",defaultValue:{name:"sap/ui/mdc/TableDelegate",payload:{}}},headerLevel:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:sap.ui.core.TitleLevel.Auto},autoBindOnInit:{type:"boolean",group:"Misc",defaultValue:true},header:{type:"string",group:"Misc",defaultValue:null},headerVisible:{type:"boolean",group:"Misc",defaultValue:true},selectionMode:{type:"sap.ui.mdc.SelectionMode",defaultValue:t.None},showRowCount:{type:"boolean",group:"Misc",defaultValue:true},threshold:{type:"int",group:"Appearance",defaultValue:-1},noDataText:{type:"string"},sortConditions:{type:"object"},filterConditions:{type:"object",defaultValue:{}},groupConditions:{type:"object"},aggregateConditions:{type:"object"},enableExport:{type:"boolean",defaultValue:false},busyIndicatorDelay:{type:"int",defaultValue:100},enableColumnResize:{type:"boolean",group:"Behavior",defaultValue:true},showPasteButton:{type:"boolean",group:"Behavior",defaultValue:false},multiSelectMode:{type:"sap.ui.mdc.MultiSelectMode",group:"Behavior",defaultValue:y.Default}},aggregations:{_content:{type:"sap.ui.core.Control",multiple:false,visibility:"hidden"},type:{type:"sap.ui.mdc.table.TableTypeBase",altTypes:["sap.ui.mdc.TableType"],multiple:false},columns:{type:"sap.ui.mdc.table.Column",multiple:true},creationRow:{type:"sap.ui.mdc.table.CreationRow",multiple:false},actions:{type:"sap.ui.core.Control",multiple:true,forwarding:{getter:"_createToolbar",aggregation:"actions"}},variant:{type:"sap.ui.fl.variants.VariantManagement",multiple:false},quickFilter:{type:"sap.ui.core.Control",multiple:false},rowSettings:{type:"sap.ui.mdc.table.RowSettings",multiple:false},dataStateIndicator:{type:"sap.m.plugins.DataStateIndicator",multiple:false}},associations:{filter:{type:z,multiple:false}},events:{rowPress:{parameters:{bindingContext:{type:"sap.ui.model.Context"}}},selectionChange:{parameters:{bindingContext:{type:"sap.ui.model.Context"},selected:{type:"boolean"},selectAll:{type:"boolean"}}},beforeExport:{parameters:{exportSettings:{type:"object"},userExportSettings:{type:"object"}}},paste:{parameters:{data:{type:"string[][]"}}}}},constructor:function(){this._oTableReady=new h();this._oFullInitialize=new h();C.apply(this,arguments);this.bCreated=true;this._doOneTimeOperations();this._initializeContent();},renderer:{apiVersion:2,render:function(a1,b1){a1.openStart("div",b1);a1.class("sapUiMdcTable");a1.style("height",b1.getHeight());a1.style("width",b1.getWidth());a1.openEnd();a1.renderControl(b1.getAggregation("_content"));a1.close("div");}}});var Q=["variant","quickFilter"];F.call(J.prototype);Q.forEach(function(a1){var b1=f(a1),c1="_o"+b1,d1="get"+b1,e1="set"+b1,f1="destroy"+b1;J.prototype[d1]=function(){return this[c1];};J.prototype[f1]=function(){var g1=this[c1];this[e1]();if(g1){g1.destroy();}return this;};J.prototype[e1]=function(g1){this.validateAggregation(a1,g1,false);var h1=this._createToolbar(),i1=g1!==this[c1];if(!g1||i1){h1.removeBetween((this[d1]()));this[c1]=g1;}if(i1&&g1){this._setToolbarBetween(h1);}return this;};});J.prototype.init=function(){C.prototype.init.apply(this,arguments);this._bForceRebind=true;this._updateAdaptation(this.getP13nMode());this.mSkipPropagation={rowSettings:true};};J.prototype.applySettings=function(){C.prototype.applySettings.apply(this,arguments);this.initControlDelegate();};J.prototype._setToolbarBetween=function(a1){[this._oVariant,this._oQuickFilter].forEach(function(b1){if(b1){a1.addBetween(b1);}});};J.prototype.initialized=function(){return this._oTableReady.promise;};J.prototype._fullyInitialized=function(){return this._oFullInitialize.promise;};J.prototype.getDataStateIndicatorPluginOwner=function(a1){a1.setEnableFiltering(false);return this._oTable||this._oFullInitialize.promise;};J.prototype._getStringType=function(a1){var b1,c1=b1=a1||this.getType();if(!c1){b1=u.Table;}else if(typeof c1==="object"){if(c1.isA("sap.ui.mdc.table.ResponsiveTableType")){b1=u.ResponsiveTable;}else{b1=u.Table;}}return b1;};J.prototype._isOfType=function(a1){return this._getStringType()===a1;};J.prototype._updateTypeSettings=function(){var a1=this.getType();if(a1&&typeof a1==="object"){a1.updateTableSettings();}else{if(a1==="ResponsiveTable"){a1=R;}else{a1=G;}a1.updateDefault(this._oTable);}};J.prototype.scrollToIndex=function(a1){return new Promise(function(b1,c1){if(!this._oTable){return c1();}if(typeof a1!=="number"){return c1("The iIndex parameter has to be a number");}if(this._isOfType(u.ResponsiveTable)){this._oTable.scrollToIndex(a1).then(b1).catch(c1);}else{if(a1===-1){a1=this._getRowCount(false);}if(this._oTable._setFirstVisibleRowIndex(a1)){this._oTable.attachEventOnce("rowsUpdated",function(){b1();});}else{b1();}}}.bind(this));};J.prototype.focusRow=function(a1,b1){return this.scrollToIndex(a1).then(function(){return this._oTable._setFocus(a1,b1);}.bind(this));};J.prototype.setType=function(a1){var b1=this._getStringType(a1);var c1=this._getStringType();this.setAggregation("type",a1,true);if(b1===c1&&this._oTable){this._updateTypeSettings();return this;}if(this.bCreated){if(this._oTable){if(c1==="ResponsiveTable"){this._oTable.setHeaderToolbar();}else{this._oTable.removeExtension(this._oToolbar);}this._oTable.destroy("KeepDom");this._oTable=null;this._bTableExists=false;}else{this._onAfterTableCreated();this._onAfterFullInitialization();}if(this._oTemplate){this._oTemplate.destroy();this._oTemplate=null;}this._oTableReady=new h();this._oFullInitialize=new h();this._bFullyInitialized=false;this._initializeContent();}return this;};J.prototype.setRowSettings=function(a1){this.setAggregation("rowSettings",a1,true);if(this._oTable){if(this._isOfType(u.ResponsiveTable)){R.updateRowSettings(this._oTemplate,a1);}else{G.updateRowSettings(this._oTable,a1);}this._bForceRebind=true;this.checkAndRebind();}return this;};J.prototype.setHeaderLevel=function(a1){if(this.getHeaderLevel()===a1){return this;}this.setProperty("headerLevel",a1,true);this._oTitle&&this._oTitle.setLevel(a1);return this;};J.prototype.focus=function(a1){var b1=this.getDomRef();if(this._oTable&&b1&&!e(b1,document.activeElement)){this._oTable.focus();}};J.prototype.setBusy=function(a1){this.setProperty('busy',a1,true);if(this._oTable){this._oTable.setBusy(a1);}return this;};J.prototype.setBusyIndicatorDelay=function(a1){this.setProperty('busyIndicatorDelay',a1,true);if(this._oTable){this._oTable.setBusyIndicatorDelay(a1);}return this;};J.prototype.setSelectionMode=function(a1){var b1=this.getSelectionMode();this.setProperty("selectionMode",a1,true);if(this._oTable&&b1!=this.getSelectionMode()){this._updateSelectionBehavior();}return this;};J.prototype.setMultiSelectMode=function(a1){var b1=this.getMultiSelectMode();this.setProperty("multiSelectMode",a1,true);if(this._oTable&&b1!=this.getMultiSelectMode()){this._updateMultiSelectMode();}return this;};J.prototype.setRowAction=function(a1){var b1=this.getRowAction();this.setProperty("rowAction",a1,true);if(!g(b1.sort(),this.getRowAction().sort())){this._updateRowAction();}return this;};J.prototype.setCreationRow=function(a1){this.setAggregation("creationRow",a1,true);if(a1){a1.update();}return this;};J.prototype.setEnableColumnResize=function(a1){var b1=this.getEnableColumnResize();this.setProperty("enableColumnResize",a1,true);if(a1!==b1){this._updateColumnResizer();this._updateAdaptation(this.getP13nMode());}return this;};J.prototype._onModifications=function(){if(!this._oTable){return;}var a1=this.getCurrentState().xConfig;var b1=a1.aggregations&&a1.aggregations.columns;this.getColumns().forEach(function(c1,d1){var e1=b1&&b1[c1.getDataProperty()]&&b1[c1.getDataProperty()].width;var f1=this._oTable.getColumns()[d1];if(!e1&&f1.getWidth()!==c1.getWidth()){f1.setWidth(c1.getWidth());}else if(e1&&e1!==f1.getWidth()){f1.setWidth(e1);}},this);};J.prototype.setP13nMode=function(a1){var b1=this.getP13nMode();var c1=null;if(a1&&a1.length>1){c1=[];var d1=a1.reduce(function(e1,f1,g1){e1[f1]=true;return e1;},{});if(d1.Column){c1.push("Column");}if(d1.Sort){c1.push("Sort");}if(d1.Filter){c1.push("Filter");}if(d1.Group){c1.push("Group");}if(d1.Aggregate){c1.push("Aggregate");}}else{c1=a1;}this.setProperty("p13nMode",c1,true);this._updateAdaptation(this.getP13nMode());if(!g(b1.sort(),this.getP13nMode().sort())){U(this);}return this;};J.prototype._updateAdaptation=function(a1){var b1={controller:{}};var c1={Column:k,Sort:m,Group:o,Filter:n,Aggregate:p,ColumnWidth:s};a1.forEach(function(d1){var e1=d1;b1.controller[e1]=c1[d1];});if(this.getEnableColumnResize()){b1.controller["ColumnWidth"]=c1["ColumnWidth"];}this.getEngine().registerAdaptation(this,b1);};function U(a1){if(a1._oToolbar){a1._oToolbar.destroyEnd();a1._getP13nButtons().forEach(function(c1){a1._oToolbar.addEnd(c1);});}if(a1._oTable){var b1=a1._oTable.getDragDropConfig()[0];if(b1){b1.setEnabled(a1.getP13nMode().indexOf("Column")>-1);}}if(a1.isFilteringEnabled()){W(a1);}V(a1);}J.prototype.setFilterConditions=function(a1){this.setProperty("filterConditions",a1,true);var b1=this.getInbuiltFilter();if(b1){b1.setFilterConditions(a1);}V(this);return this;};function V(a1){var b1=Y(a1);var c1=Z(a1);var d1=$(a1);if(!b1){return;}if(d1.length===0||!a1.isFilteringEnabled()){var e1=b1.getDomRef();if(e1&&e1.contains(document.activeElement)){a1.focus();}b1.setVisible(false);a1._oTable.removeAriaLabelledBy(c1);return;}a1._fullyInitialized().then(function(){var f1=d1.map(function(j1){return a1.getPropertyHelper().getLabel(j1);});var g1=d.getLibraryResourceBundle("sap.ui.mdc");var h1=L.getInstance();var i1=g1.getText("table.FILTER_INFO",h1.format(f1));if(!b1.getVisible()){b1.setVisible(true);a1._oTable.addAriaLabelledBy(c1);}c1.setText(i1);});}function W(a1){if(!a1._oTable){return;}var b1=Y(a1);if(!b1){b1=X(a1);}if(a1._bMobileTable){if(a1._oTable.getInfoToolbar()!==b1){a1._oTable.setInfoToolbar(b1);}}else if(a1._oTable.indexOfExtension(b1)===-1){a1._oTable.insertExtension(b1,1);}if(b1.getVisible()){a1._oTable.addAriaLabelledBy(Z(a1));}}function X(a1){var b1=a1.getId()+"-filterInfoBar";var c1=E(a1).oFilterInfoBar;if(c1&&!c1.bIsDestroyed){c1.destroy();}c1=new O({id:b1,active:true,design:w.Info,visible:false,content:[new a({id:b1+"-text",wrapping:false})],press:function(){T.showPanel(a1,"Filter",c1);}});c1.focus=function(){if(this.getDomRef()){O.prototype.focus.apply(this,arguments);}else{a1.focus();}};E(a1).oFilterInfoBar=c1;V(a1);return c1;}function Y(a1){var b1=E(a1).oFilterInfoBar;if(b1&&(b1.bIsDestroyed||b1.bIsBeingDestroyed)){return null;}return E(a1).oFilterInfoBar;}function Z(a1){var b1=Y(a1);return b1?b1.getContent()[0]:null;}J.prototype.setThreshold=function(a1){this.setProperty("threshold",a1,true);if(!this._oTable){return this;}a1=this.getThreshold()>-1?this.getThreshold():undefined;if(this._bMobileTable){this._oTable.setGrowingThreshold(a1);}else{this._oTable.setThreshold(a1);}return this;};J.prototype._onFilterProvided=function(a1){this._updateInnerTableNoDataText();};J.prototype._onFilterRemoved=function(a1){this._updateInnerTableNoDataText();};J.prototype._onFiltersChanged=function(a1){if(this.isTableBound()&&a1.getParameter("conditionsBased")){this._oTable.setShowOverlay(true);}};J.prototype._onFilterSearch=function(a1){this._bIgnoreChange=true;this._bAnnounceTableUpdate=true;};J.prototype.setNoDataText=function(a1){this.setProperty("noDataText",a1,true);this._updateInnerTableNoDataText();return this;};J.prototype._updateInnerTableNoDataText=function(){if(!this._oTable){return;}var a1=this._getNoDataText();if(this._bMobileTable){this._oTable.setNoDataText(a1);}else{this._oTable.setNoData(a1);}};J.prototype._getNoDataText=function(){var a1=this.getNoDataText();if(a1){return a1;}var b1=d.getLibraryResourceBundle("sap.ui.mdc");if(!this.isTableBound()){if(this.getFilter()){return b1.getText("table.NO_DATA_WITH_FILTERBAR");}return b1.getText("table.NO_DATA");}return b1.getText("table.NO_RESULTS");};J.prototype._updateRowAction=function(){if(!this._oTable){return;}var a1=this.getRowAction().indexOf(v.Navigation)>-1;var b1=this._bMobileTable?R:G;b1.updateRowAction(this,a1,this._bMobileTable?undefined:this._onRowActionPress);};J.prototype._initializeContent=function(){var a1,b1=this._getStringType();if(this._isOfType(u.ResponsiveTable)){a1=R;}else{a1=G;}var c1=[this.awaitControlDelegate(),a1.loadTableModules()];if(this.isFilteringEnabled()){c1.push(this.retrieveInbuiltFilter());}Promise.all(c1).then(function(){if(this.bIsDestroyed){return;}var d1=this.getControlDelegate();if(d1.preInit){this._pDelegatePreInit=d1.preInit(this);}if(!this._bTableExists&&b1===this._getStringType()){this._bMobileTable=b1==="ResponsiveTable";this._createContent();this._bTableExists=true;}}.bind(this)).catch(function(d1){this._onAfterTableCreated();throw d1;}.bind(this));};J.prototype._doOneTimeOperations=function(){if(!this.bColumnsOrdered){this.bColumnsOrdered=true;this._orderColumns();}};J.prototype._onAfterTableCreated=function(a1){this._oTableReady[a1?"resolve":"reject"](this);};J.prototype._onAfterFullInitialization=function(a1){this._oFullInitialize[a1?"resolve":"reject"](this);};J.prototype._createContent=function(){this._createToolbar();this._createTable();this._updateColumnResizer();this._updateRowAction();this.getColumns().forEach(this._insertInnerColumn,this);this.setAggregation("_content",this._oTable);this._onAfterTableCreated(true);var a1=this.initialized().then(function(){this.initPropertyHelper(P);var b1=this.getCreationRow();if(b1){b1.update();}if(this.getAutoBindOnInit()){this.checkAndRebind();}return this.awaitPropertyHelper();}.bind(this));Promise.all([a1,this._pDelegatePreInit]).then(function(){delete this._pDelegatePreInit;this._bFullyInitialized=true;this._onAfterFullInitialization(true);}.bind(this)).catch(function(b1){this._onAfterFullInitialization();throw b1;}.bind(this));};J.prototype.setHeader=function(a1){this.setProperty("header",a1,true);this._updateHeaderText();this._updateExportState(true);return this;};J.prototype.setHeaderVisible=function(a1){this.setProperty("headerVisible",a1,true);if(this._oTitle){this._oTitle.setWidth(this.getHeaderVisible()?undefined:"0px");}return this;};J.prototype.setShowRowCount=function(a1){this.setProperty("showRowCount",a1,true);this._updateHeaderText();return this;};J.prototype.setEnableExport=function(a1){if(a1!==this.getEnableExport()){this.setProperty("enableExport",a1,true);if(a1&&!this._oExportButton&&this._oToolbar){this._oToolbar.addEnd(this._getExportButton());}else if(this._oExportButton){this._oExportButton.setVisible(a1);}}return this;};J.prototype.setShowPasteButton=function(a1){if((a1=!!a1)==this.getShowPasteButton()){return this;}this.setProperty("showPasteButton",a1,true);if(a1&&!this._oPasteButton&&this._oToolbar){this._oToolbar.insertEnd(this._getPasteButton(),0);}else if(this._oPasteButton){this._oPasteButton.setVisible(a1);}return this;};J.prototype._createToolbar=function(){if(!this._oToolbar){this._oTitle=new b(this.getId()+"-title",{text:this.getHeader(),width:this.getHeaderVisible()?undefined:"0px",level:this.getHeaderLevel()});this._oToolbar=new A(this.getId()+"-toolbar",{design:w.Transparent,style:this._isOfType(u.ResponsiveTable)?x.Standard:x.Clear,begin:[this._oTitle],end:[this._getPasteButton(),this._getP13nButtons(),this._getExportButton()]});}return this._oToolbar;};J.prototype._getVisibleProperties=function(){var a1=[],b1;this.getColumns().forEach(function(c1,d1){b1=c1&&c1.getDataProperty();if(b1){a1.push({name:b1});}});return a1;};J.prototype.getConditions=function(){return this.getInbuiltFilter()?this.getInbuiltFilter().getConditions():[];};J.prototype._getSortedProperties=function(){return this.getSortConditions()?this.getSortConditions().sorters:[];};J.prototype._getGroupedProperties=function(){return this.getGroupConditions()?this.getGroupConditions().groupLevels:[];};J.prototype._getAggregatedProperties=function(){return this.getAggregateConditions()?this.getAggregateConditions():{};};J.prototype._getXConfig=function(){return this.getEngine().readXConfig(this);};function $(a1){var b1=a1.getFilterConditions();return Object.keys(b1).filter(function(c1){return b1[c1].length>0;});}J.prototype.getCurrentState=function(){var a1={};var b1=this.getP13nMode();if(b1.indexOf("Column")>-1){a1.items=this._getVisibleProperties();}if(this.isSortingEnabled()){a1.sorters=this._getSortedProperties();}if(this.isFilteringEnabled()){a1.filter=this.getFilterConditions();}if(this.isGroupingEnabled()){a1.groupLevels=this._getGroupedProperties();}if(this.isAggregationEnabled()){a1.aggregations=this._getAggregatedProperties();}if(this.getEnableColumnResize()){a1.xConfig=this._getXConfig();}return a1;};J.prototype.isFilteringEnabled=function(){return this.getP13nMode().indexOf("Filter")>-1;};J.prototype.isSortingEnabled=function(){return this.getP13nMode().indexOf("Sort")>-1;};J.prototype.isGroupingEnabled=function(){return this.getP13nMode().indexOf("Group")>-1;};J.prototype.isAggregationEnabled=function(){return this.getP13nMode().indexOf("Aggregate")>-1;};J.prototype._getP13nButtons=function(){var a1=this.getP13nMode();var b1=[];var c1=a1.length===1&&a1[0]==="Aggregate";if(a1.length>0&&!c1){b1.push(T["createSettingsButton"](this.getId(),[this._showSettings,this]));}return b1;};J.prototype._getPasteButton=function(){if(this.getShowPasteButton()){if(!this._oPasteButton){this._oPasteButton=T.createPasteButton(this.getId());}return this._oPasteButton;}};J.prototype._getExportButton=function(){if(!this.getEnableExport()){return null;}var a1={fileName:this.getHeader()};if(!this._cachedExportSettings){this._cachedExportSettings=a1;}if(!this._oExportButton){this._oExportButton=T.createExportButton(this.getId(),{"default":[function(){this._onExport(a1);},this],"exportAs":[this._onExportAs,this]});}this._updateExportState();return this._oExportButton;};J.prototype._updateExportState=function(a1){if(this._oExportButton){this._oExportButton.setEnabled(this._getRowCount(false)>0);if(a1&&this._cachedExportSettings){this._cachedExportSettings.fileName=this.getHeader();}}};J.prototype._createExportColumnConfiguration=function(a1){var b1=a1&&a1.splitCells;var c1=this.getColumns();return this._fullyInitialized().then(function(){var d1=this.getPropertyHelper();var e1=[];c1.forEach(function(f1){var g1=d1.getColumnExportSettings(f1,b1);e1=e1.concat(g1);},this);return[e1,d1];}.bind(this));};J.prototype._onExport=function(a1){return this._createExportColumnConfiguration(a1).then(function(b1){var c1=b1[0];var d1=b1[1];if(!c1||!c1.length){sap.ui.require(["sap/m/MessageBox"],function(g1){g1.error(d.getLibraryResourceBundle("sap.ui.mdc").getText("table.NO_COLS_EXPORT"),{styleClass:(this.$()&&this.$().closest(".sapUiSizeCompact").length)?"sapUiSizeCompact":""});}.bind(this));return;}var e1=this._getRowBinding();var f1={workbook:{columns:c1},dataSource:e1,fileName:a1?a1.fileName:this.getHeader()};this._loadExportLibrary().then(function(){sap.ui.require(["sap/ui/export/ExportUtils","sap/ui/export/Spreadsheet"],function(g1,h1){var i1=Promise.resolve();if(a1.includeFilterSettings){i1=g1.parseFilterConfiguration(e1,function(j1){return d1.getLabel(j1);}).then(function(j1){if(j1){f1.workbook.context={metaSheetName:j1.name,metainfo:[j1]};}});}i1.then(function(){var j1={splitCells:false,includeFilterSettings:false};if(a1){j1.splitCells=a1.splitCells;j1.includeFilterSettings=a1.includeFilterSettings;}var k1=new h1(f1);k1.attachBeforeExport(function(l1){var m1=l1.getParameter("exportSettings");this.fireBeforeExport({exportSettings:m1,userExportSettings:j1});},this);k1.build().finally(function(){k1.destroy();});}.bind(this));}.bind(this));}.bind(this));}.bind(this));};J.prototype._onExportAs=function(){var a1=this;this._loadExportLibrary().then(function(){sap.ui.require(['sap/ui/export/ExportUtils'],function(b1){b1.getExportSettingsViaDialog(a1._cachedExportSettings,a1).then(function(c1){a1._cachedExportSettings=c1;a1._onExport(c1);});});});};J.prototype._loadExportLibrary=function(){if(!this._oExportLibLoadPromise){this._oExportLibLoadPromise=d.loadLibrary("sap.ui.export",true);}return this._oExportLibLoadPromise;};J.prototype.onkeydown=function(a1){if(a1.isMarked()){return;}if((a1.metaKey||a1.ctrlKey)&&a1.shiftKey&&a1.which===K.E){if(this.getEnableExport()&&this._oExportButton&&this._oExportButton.getEnabled()){this._onExportAs();a1.setMarked();a1.preventDefault();}}if((a1.metaKey||a1.ctrlKey)&&a1.which===K.COMMA){var b1=d.byId(this.getId()+"-settings");if(b1&&b1.getEnabled()&&b1.getVisible()){b1.firePress();a1.setMarked();a1.preventDefault();}}};J.prototype._createTable=function(){var a1=this.getThreshold()>-1?this.getThreshold():undefined;var b1=this.getRowSettings()?this.getRowSettings().getAllSettings():{};if(this._bMobileTable){this._oTable=R.createTable(this.getId()+"-innerTable",{autoPopinMode:true,contextualWidth:"Auto",growing:true,sticky:["ColumnHeaders","HeaderToolbar","InfoToolbar"],itemPress:[this._onItemPress,this],selectionChange:[this._onSelectionChange,this],growingThreshold:a1,noDataText:this._getNoDataText(),headerToolbar:this._oToolbar,ariaLabelledBy:[this._oTitle]});this._oTemplate=R.createTemplate(this.getId()+"-innerTableRow",b1);this._createColumn=J.prototype._createMobileColumn;this._sAggregation="items";this._oTable.bindRows=this._oTable.bindItems;this._oTable.bActiveHeaders=true;this._oTable.attachEvent("columnPress",this._onResponsiveTableColumnPress,this);}else{this._oTable=G.createTable(this.getId()+"-innerTable",{enableBusyIndicator:true,enableColumnReordering:false,threshold:a1,cellClick:[this._onCellClick,this],noData:this._getNoDataText(),extension:[this._oToolbar],ariaLabelledBy:[this._oTitle],plugins:[G.createMultiSelectionPlugin(this,[this._onRowSelectionChange,this])],columnSelect:[this._onGridTableColumnPress,this],rowSettingsTemplate:b1});this._createColumn=J.prototype._createColumn;this._sAggregation="rows";}this._updateTypeSettings();this._updateSelectionBehavior();this._updateMultiSelectMode();var c1=new D({sourceAggregation:"columns",targetAggregation:"columns",dropPosition:"Between",enabled:this.getP13nMode().indexOf("Column")>-1,drop:[this._onColumnRearrange,this]});c1.bIgnoreMetadataCheck=true;this._oTable.addDragDropConfig(c1);this._oTable.setBusyIndicatorDelay(this.getBusyIndicatorDelay());this._oTable.attachPaste(this._onInnerTablePaste,this);if(this.isFilteringEnabled()){W(this);}};J.prototype._updateColumnResizer=function(){if(!this._oTable){return;}var a1=this.getEnableColumnResize();var b1=this._bMobileTable?R:G;if(a1){b1.enableColumnResizer(this,this._oTable);}else{b1.disableColumnResizer(this,this._oTable);}};J.prototype._updateSelectionBehavior=function(){var a1=this._bMobileTable?R:G;a1.updateSelection(this);};J.prototype._updateMultiSelectMode=function(){if(this._bMobileTable){R.updateMultiSelectMode(this);}};J.prototype._onColumnRearrange=function(a1){var b1=a1.getParameter("draggedControl");var c1=a1.getParameter("droppedControl");if(b1===c1){return;}var d1=a1.getParameter("dropPosition");var e1=this._oTable.indexOfColumn(b1);var f1=this._oTable.indexOfColumn(c1);var g1=f1+(d1=="Before"?0:1)+(e1<f1?-1:0);T.moveColumn(this,e1,g1);};J.prototype._onColumnPress=function(a1){var b1,c1=a1.getParent(),d1,e1=window.matchMedia("(hover:none)").matches&&this._bMobileTable&&this.getEnableColumnResize();b1=c1.indexOfColumn(a1);d1=this.getColumns()[b1];this._fullyInitialized().then(function(){var f1=d.getLibraryResourceBundle("sap.ui.mdc");if(this._oPopover){this._oPopover.destroy();this._oPopover=null;}if(this.isSortingEnabled()){var g1=[],h1=[];this.getPropertyHelper().getSortableProperties(d1.getDataProperty()).forEach(function(n1){g1.push(new I({text:n1.getLabel(),key:n1.getName()}));h1.push(new I({text:n1.getLabel(),key:n1.getName()}));});if(g1.length>0){this._oPopover=new c({items:[new q({items:g1,label:f1.getText("table.SETTINGS_ASCENDING"),icon:"sap-icon://sort-ascending",action:[false,this._onCustomSort,this]}),new q({items:h1,label:f1.getText("table.SETTINGS_DESCENDING"),icon:"sap-icon://sort-descending",action:[true,this._onCustomSort,this]})]});a1.addDependent(this._oPopover);}}var i1=[];var j1=[];var k1=this.getControlDelegate();i1=(k1.addColumnMenuItems&&k1.addColumnMenuItems(this,d1))||[];this.getPropertyHelper().getFilterableProperties(d1.getDataProperty()).forEach(function(n1){j1.push(new I({text:n1.getLabel(),key:n1.getName()}));});if(this.isFilteringEnabled()&&j1.length){var l1=new q({label:f1.getText("table.SETTINGS_FILTER"),icon:"sap-icon://filter",action:[this._showFilter,this]});i1.unshift(l1);}if(e1){var m1=new r({text:f1.getText("table.SETTINGS_RP_RESIZE"),icon:"sap-icon://resize-horizontal",press:[function(){R.startColumnResize(this._oTable,a1);},this]});i1.push(m1);}i1&&i1.forEach(function(n1){n1&&this._createPopover(n1,a1);}.bind(this));this._oPopover&&this._oPopover.openBy(a1);}.bind(this));};J.prototype._createPopover=function(a1,b1){if(this._oPopover){this._oPopover.addItem(a1);}else{this._oPopover=new c({items:a1});b1.addDependent(this._oPopover);}};J.prototype._onCustomSort=function(a1,b1){var c1=a1.getParameter("property");T.createSort(this,c1,b1,true);};J.prototype._onColumnResize=function(a1){var b1=a1.getParameter("column");var c1=a1.getParameter("width");var d1=this._oTable.indexOfColumn(b1);var e1=this.getColumns()[d1];var f1=e1.getDataProperty();T.createColumnWidth(this,f1,c1);};J.prototype._onCustomGroup=function(a1){T.createGroup(this,a1);};J.prototype._onCustomAggregate=function(a1){T.createAggregation(this,a1);};J.prototype._insertInnerColumn=function(a1,b1){if(!this._oTable){return;}var c1=this._createColumn(a1);_(this,a1,c1,b1);this._bForceRebind=true;if(b1===undefined){this._oTable.addColumn(c1);}else{this._oTable.insertColumn(c1,b1);}};J.prototype._orderColumns=function(){var a1,b1=[],c1=this.getColumns();c1.forEach(function(d1){a1=d1.getInitialIndex();if(a1>-1){b1.push({index:a1,column:this.removeColumn(d1)});}},this);b1.sort(function(d1,e1){return d1-e1;});b1.forEach(function(d1){this.insertColumn(d1.column,d1.index);},this);};function _(a1,b1,c1,d1){var e1=b1.getTemplate(true);if(!a1._bMobileTable){var f1=b1.getCreationTemplate(true);[e1,f1].forEach(function(g1){if(!g1){return;}if(g1.setWrapping){g1.setWrapping(false);}if(g1.setRenderWhitespace){g1.setRenderWhitespace(false);}});c1.setTemplate(e1);c1.setCreationTemplate(f1);}else if(d1>=0){a1._oTemplate.insertCell(e1,d1);a1._oTable.getItems().forEach(function(g1){g1.insertAggregation("cells",new j(),d1,true);});}else{a1._oTemplate.addCell(e1);}}J.prototype._createColumn=function(a1){return G.createColumn(a1.getId()+"-innerColumn",{width:a1.getWidth(),minWidth:Math.round(a1.getMinWidth()*parseFloat(M.BaseFontSize)),hAlign:a1.getHAlign(),label:a1.getColumnHeaderControl(this._bMobileTable),resizable:this.getEnableColumnResize(),autoResizable:this.getEnableColumnResize()});};J.prototype._createMobileColumn=function(a1){return R.createColumn(a1.getId()+"-innerColumn",{width:a1.getWidth(),autoPopinWidth:a1.getMinWidth(),hAlign:a1.getHAlign(),header:a1.getColumnHeaderControl(this._bMobileTable),importance:a1.getImportance(),popinDisplay:"Inline"});};J.prototype.moveColumn=function(a1,b1){var c1;this.removeAggregation("columns",a1,true);this.insertAggregation("columns",a1,b1,true);if(this._oTable){c1=this._oTable.removeColumn(a1.getId()+"-innerColumn");this._oTable.insertColumn(c1,b1);if(this._bMobileTable){this._updateColumnTemplate(a1,b1);}}};J.prototype.removeColumn=function(a1){a1=this.removeAggregation("columns",a1,true);if(this._oTable){var b1=this._oTable.removeColumn(a1.getId()+"-innerColumn");b1.destroy();if(this._bMobileTable){this._updateColumnTemplate(a1,-1);}this._onModifications();}return a1;};J.prototype.addColumn=function(a1){this.addAggregation("columns",a1,true);this._insertInnerColumn(a1);return this;};J.prototype.insertColumn=function(a1,b1){this.insertAggregation("columns",a1,b1,true);this._insertInnerColumn(a1,b1);this._onModifications();return this;};J.prototype._updateColumnTemplate=function(a1,b1){var c1,d1;if(this._oTemplate){c1=a1.getTemplate(true);d1=this._oTemplate.indexOfCell(c1);J._removeItemCell(this._oTemplate,d1,b1);}if(d1>-1){this._oTable.getItems().forEach(function(e1){if(e1.removeCell){J._removeItemCell(e1,d1,b1);}});}};J._removeItemCell=function(a1,b1,c1){var d1=a1.removeCell(b1);if(d1){if(c1>-1){a1.insertCell(d1,c1);}else{d1.destroy();}}};J.prototype._onItemPress=function(a1){this.fireRowPress({bindingContext:a1.getParameter("listItem").getBindingContext()});};J.prototype._onSelectionChange=function(a1){var b1=a1.getParameter("selectAll");this.fireSelectionChange({bindingContext:a1.getParameter("listItem").getBindingContext(),selected:a1.getParameter("selected"),selectAll:b1});if(b1){var c1=this.getRowBinding();if(c1&&this._oTable){var d1=c1.getLength();var e1=this._oTable.getItems().length;var f1=c1.isLengthFinal();if(e1!=d1||!f1){H("table.SELECTION_LIMIT_MESSAGE",[e1]);}}}};J.prototype._onResponsiveTableColumnPress=function(a1){this._onColumnPress(a1.getParameter("column"));};J.prototype._onCellClick=function(a1){this.fireRowPress({bindingContext:a1.getParameter("rowBindingContext")});};J.prototype._onRowActionPress=function(a1){var b1=a1.getParameter("row");this.fireRowPress({bindingContext:b1.getBindingContext()});};J.prototype._onRowSelectionChange=function(a1){if(!this._bSelectionChangedByAPI){this.fireSelectionChange({bindingContext:a1.getParameter("rowContext"),selected:a1.getSource().isIndexSelected(a1.getParameter("rowIndex")),selectAll:a1.getParameter("selectAll")});}};J.prototype._onGridTableColumnPress=function(a1){a1.preventDefault();this._onColumnPress(a1.getParameter("column"));};J.prototype.getSelectedContexts=function(){if(this._oTable){if(this._bMobileTable){return this._oTable.getSelectedContexts();}var a1=this._oTable.getPlugins()[0].getSelectedIndices();return a1.map(function(b1){return this._oTable.getContextByIndex(b1);},this);}return[];};J.prototype.clearSelection=function(){if(this._oTable){if(this._bMobileTable){this._oTable.removeSelections(true);}else{this._bSelectionChangedByAPI=true;this._oTable.getPlugins()[0].clearSelection();this._bSelectionChangedByAPI=false;}}};J.prototype._registerInnerFilter=function(a1){a1.attachSearch(function(){this.rebind();},this);};J.prototype.isTableBound=function(){return this._oTable?this._oTable.isBound(this._bMobileTable?"items":"rows"):false;};J.prototype.bindRows=function(){if(!this.bDelegateInitialized||!this._oTable){return;}var a1={parameters:{},filters:[],sorter:this._getSorters()};this.getControlDelegate().updateBindingInfo(this,this.getPayload(),a1);if(a1.path){this._oTable.setShowOverlay(false);if(this._bMobileTable&&this._oTemplate){a1.template=this._oTemplate;}else{delete a1.template;}J._addBindingListener(a1,"dataRequested",this._onDataRequested.bind(this));J._addBindingListener(a1,"dataReceived",this._onDataReceived.bind(this));J._addBindingListener(a1,"change",this._onBindingChange.bind(this));this._updateColumnsBeforeBinding(a1);this.getControlDelegate().updateBinding(this,a1,this._bForceRebind?null:this.getRowBinding());this._updateInnerTableNoDataText();this._bForceRebind=false;}};J.prototype._onDataRequested=function(){this._bIgnoreChange=true;};J.prototype._onDataReceived=function(){this._bIgnoreChange=false;this._updateHeaderText();this._updateExportState();};J.prototype._onBindingChange=function(){if(this._bIgnoreChange){return;}this._updateHeaderText();};J.prototype._updateHeaderText=function(){var a1,b1;if(!this._oNumberFormatInstance){this._oNumberFormatInstance=N.getFloatInstance();}if(this._oTitle&&this.getHeader()){a1=this.getHeader();if(this.getShowRowCount()){b1=this._getRowCount(true);if(b1>0){var c1=this._oNumberFormatInstance.format(b1);a1+=" ("+c1+")";}}this._oTitle.setText(a1);}if(!this._bIgnoreChange&&this._bAnnounceTableUpdate){this._bAnnounceTableUpdate=false;this._announceTableUpdate(b1);}};J.prototype._announceTableUpdate=function(a1){var b1=i.getInstance();if(b1){var c1=d.getLibraryResourceBundle("sap.ui.mdc");var d1=this.getHeader();if(a1===undefined&&this._getRowCount(false)>0){b1.announce(c1.getText("table.ANNOUNCEMENT_TABLE_UPDATED",[d1]));}else if(a1>1){b1.announce(c1.getText("table.ANNOUNCEMENT_TABLE_UPDATED_MULT",[d1,a1]));}else if(a1===1){b1.announce(c1.getText("table.ANNOUNCEMENT_TABLE_UPDATED_SING",[d1,a1]));}else{b1.announce(c1.getText("table.ANNOUNCEMENT_TABLE_UPDATED_NOITEMS",[d1]));}}};J.prototype._updateColumnsBeforeBinding=function(a1){var b1=[].concat(a1.sorter||[]);var c1=this.getColumns();var d1=this._bMobileTable;var e1=this.getPropertyHelper();c1.forEach(function(f1){var g1=d.byId(f1.getId()+"-innerColumn");var h1=e1.getSortableProperties(f1.getDataProperty()).map(function(k1){return k1.getPath();});if(h1.length>0){var i1=b1.find(function(i1){return h1.indexOf(i1.sPath)>-1;});var j1=i1&&i1.bDescending?"Descending":"Ascending";if(d1){g1.setSortIndicator(i1?j1:"None");}else{g1.setSorted(!!i1).setSortOrder(j1);}}});};J.prototype._getRowCount=function(a1){var b1=this._getRowBinding();if(!b1){return a1?undefined:0;}var c1;if(!a1){c1=b1.getLength();}else{if(typeof b1.getCount==='function'){c1=b1.getCount();}else if(b1.isLengthFinal()){c1=b1.getLength();}}if(c1<0||c1==="0"){c1=0;}return c1;};J.prototype.getRowBinding=function(){return this._getRowBinding();};J.prototype._getRowBinding=function(){if(this._oTable){return this._oTable.getBinding(this._sAggregation);}};J._addBindingListener=function(a1,b1,c1){if(!a1.events){a1.events={};}if(!a1.events[b1]){a1.events[b1]=c1;}else{var d1=a1.events[b1];a1.events[b1]=function(){c1.apply(this,arguments);d1.apply(this,arguments);};}};J.prototype.rebindTable=function(){this.rebind();};J.prototype.rebind=function(){if(this._bFullyInitialized){this.bindRows();}else{this._fullyInitialized().then(this.rebind.bind(this));}};J.prototype._showSettings=function(a1){T.showPanel(this,"Columns",a1.getSource());};J.prototype._showSort=function(a1){T.showPanel(this,"Sort",a1.getSource());};J.prototype._showFilter=function(a1){T.showPanel(this,"Filter",a1.getSource());};J.prototype._showGroup=function(a1){T.showPanel(this,"Group",a1.getSource());};J.prototype._getSorters=function(){var a1=this.getSortConditions()?this.getSortConditions().sorters:[];var b1=[],c1=this.getPropertyHelper();a1.forEach(function(d1){var e1=c1.getPath(d1.name);b1.push(new S(e1,d1.descending));});return b1;};J.prototype._onInnerTablePaste=function(a1){this.firePaste({data:a1.getParameter("data")});};J.prototype.exit=function(){if(this._oTemplate){this._oTemplate.destroy();}this._oTemplate=null;this._oTable=null;if(this._oToolbar&&!this._bTableExists){this._oToolbar.destroy();}this._oToolbar=null;this._oTitle=null;this._oNumberFormatInstance=null;Q.forEach(function(a1){var b1=f(a1),c1="_o"+b1;this[c1]=null;},this);this._oTableReady=null;this._oFullInitialize=null;this._oPasteButton=null;C.prototype.exit.apply(this,arguments);};return J;});
