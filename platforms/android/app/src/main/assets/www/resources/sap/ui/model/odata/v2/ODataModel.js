/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./Context","./ODataAnnotations","./ODataContextBinding","./ODataListBinding","./ODataTreeBinding","sap/base/assert","sap/base/Log","sap/base/security/encodeURL","sap/base/util/deepEqual","sap/base/util/deepExtend","sap/base/util/each","sap/base/util/extend","sap/base/util/isEmptyObject","sap/base/util/isPlainObject","sap/base/util/merge","sap/base/util/uid","sap/base/util/UriParameters","sap/ui/core/library","sap/ui/core/message/Message","sap/ui/core/message/MessageParser","sap/ui/model/BindingMode","sap/ui/model/Context","sap/ui/model/FilterProcessor","sap/ui/model/Model","sap/ui/model/odata/CountMode","sap/ui/model/odata/MessageScope","sap/ui/model/odata/ODataMetadata","sap/ui/model/odata/ODataMetaModel","sap/ui/model/odata/ODataMessageParser","sap/ui/model/odata/ODataPropertyBinding","sap/ui/model/odata/ODataUtils","sap/ui/model/odata/OperationMode","sap/ui/model/odata/UpdateMethod","sap/ui/thirdparty/datajs","sap/ui/thirdparty/URI"],function(C,O,a,b,c,d,L,e,f,g,h,l,m,o,p,u,U,q,M,r,B,s,F,t,v,w,x,y,z,A,D,E,G,H,I){"use strict";var J="sap.ui.model.odata.v2.ODataModel",K=q.MessageType,N={};N[K.Error]=0;N[K.Warning]=1;N[K.Success]=2;N[K.Information]=3;N[K.None]=4;var P=t.extend("sap.ui.model.odata.v2.ODataModel",{constructor:function(S,i){t.apply(this,arguments);var j,k,n,T,W,R,V,X,Y,Z,$,_,a1,b1,c1,d1,e1,f1,g1,h1,i1,j1,k1,l1,m1,n1,o1,p1,q1,r1,s1=this;if(typeof(S)==="object"){i=S;this.sServiceUrl=i.serviceUrl;}else{this.sServiceUrl=S;}this.mCodeListModelParams=this.createCodeListModelParameters(i);if(i){j=i.user;k=i.password;n=i.headers;T=i.tokenHandling;W=i.withCredentials;R=i.maxDataServiceVersion;V=i.useBatch;X=i.refreshAfterChange;Y=i.annotationURI;Z=i.loadAnnotationsJoined;a1=i.defaultBindingMode;$=i.defaultCountMode;_=i.preliminaryContext;b1=i.defaultOperationMode;c1=i.metadataNamespaces;d1=i.serviceUrlParams;e1=i.metadataUrlParams;f1=i.json;g1=i.messageParser;h1=i.skipMetadataAnnotationParsing;i1=i.defaultUpdateMethod;j1=i.disableHeadRequestForToken;k1=i.sequentializeRequests;l1=i.disableSoftStateHeader;m1=i.bindableResponseHeaders;n1=i.warmupUrl;o1=i.canonicalRequests;p1=i.tokenHandlingForGet;q1=i.earlyTokenRequest;r1=i.persistTechnicalMessages;}this.mPathCache={};this.mInvalidatedPaths={};this.bCanonicalRequests=!!o1;this.bTokenHandlingForGet=!!p1;this.sMessageScope=w.RequestedObjects;this.sWarmupUrl=n1;this.bWarmup=!!n1;this.mSupportedBindingModes={"OneWay":true,"OneTime":true,"TwoWay":true};this.mUnsupportedFilterOperators={"Any":true,"All":true};this.sDefaultBindingMode=a1||B.OneWay;this.bIsMessageScopeSupported=false;this.iPendingDeferredRequests=0;this.bJSON=f1!==false;this.aPendingRequestHandles=[];this.aCallAfterUpdate=[];this.mRequests={};this.mDeferredRequests={};this.mChangedEntities={};this.mChangeHandles={};this.mDeferredGroups={};this.mLaunderingState={};this.sDefaultUpdateMethod=i1||G.Merge;this.bTokenHandling=T!==false;this.bWithCredentials=W===true;this.bUseBatch=V!==false;this.bRefreshAfterChange=X!==false;this.sMaxDataServiceVersion=R;this.bLoadAnnotationsJoined=Z!==false;this.sAnnotationURI=Y;this.sDefaultCountMode=$||v.Request;this.sDefaultOperationMode=b1||E.Default;this.sMetadataLoadEvent=null;this.oMetadataFailedEvent=null;this.sRefreshGroupId=undefined;this.bIncludeInCurrentBatch=false;this.bSkipMetadataAnnotationParsing=!!h1;this.bDisableHeadRequestForToken=!!j1;this.bSequentializeRequests=!!k1;this.bDisableSoftStateHeader=!!l1;this.aBindableResponseHeaders=m1?m1:null;this.bPreliminaryContext=_||false;this.mMetadataUrlParams=e1||{};this.mChangedEntities4checkUpdate={};this.bPersistTechnicalMessages=r1===undefined?undefined:!!r1;if(g1){g1.setProcessor(this);}this.oMessageParser=g1;this.sDefaultChangeGroup="changes";this.setDeferredGroups([this.sDefaultChangeGroup]);this.setChangeGroups({"*":{groupId:this.sDefaultChangeGroup}});this.oData={};this.oMetadata=null;this.oAnnotations=null;this.aUrlParams=[];this.pSequentialRequestCompleted=Promise.resolve();this.pReadyForRequest=Promise.resolve();var t1=this.sServiceUrl.split("?");if(t1.length>1){this.sServiceUrl=t1[0];if(t1[1]){this.aUrlParams.push(t1[1]);}}this.sServiceUrl=this.sServiceUrl.replace(/\/$/,"");this.sUser=j;this.sPassword=k;if(sap.ui.getCore().getConfiguration().getStatistics()){this.aUrlParams.push("sap-statistics=true");}this.oHeaders={};this.setHeaders(n);if(!this.bDisableSoftStateHeader){this.oHeaders["sap-contextid-accept"]="header";this.mCustomHeaders["sap-contextid-accept"]="header";}var u1=this._getServerUrl();this.sMetadataUrl=this.sWarmupUrl||this._createMetadataUrl("/$metadata");this.oSharedServerData=P._getSharedData("server",u1);this.oSharedServiceData=P._getSharedData("service",this.sServiceUrl);this.oSharedMetaData=P._getSharedData("meta",this.sMetadataUrl);this.bUseCache=this._cacheSupported(this.sMetadataUrl);if(!this.oSharedMetaData.oMetadata||this.oSharedMetaData.oMetadata.bFailed){this.oMetadata=new x(this.sMetadataUrl,{async:true,cacheKey:this.bUseCache?this.sMetadataUrl:undefined,user:this.sUser,password:this.sPassword,headers:this.mCustomHeaders,namespaces:c1,withCredentials:this.bWithCredentials});if(!this.bWarmup){this.oSharedMetaData.oMetadata=this.oMetadata;}}else{this.oMetadata=this.oSharedMetaData.oMetadata;}this.oAnnotations=new O(this.oMetadata,{source:this.sAnnotationURI,skipMetadata:this.bSkipMetadataAnnotationParsing,headers:this.mCustomHeaders,combineEvents:true,cacheKey:this._getAnnotationCacheKey(this.sMetadataUrl),useCache:this.bUseCache});if(!this.bDisableSoftStateHeader){delete this.mCustomHeaders["sap-contextid-accept"];}this.oAnnotations.attachAllFailed(this.onAnnotationsFailed,this);this.oAnnotations.attachSomeLoaded(this.onAnnotationsLoaded,this);this.pAnnotationsLoaded=this.oAnnotations.loaded();if(d1){this.aUrlParams=this.aUrlParams.concat(D._createUrlParamsArray(d1));}this.onMetadataFailed=function(v1){s1.fireMetadataFailed(v1.getParameters());};if(!this.oMetadata.isLoaded()){this.oMetadata.attachFailed(this.onMetadataFailed);}this.oMetadata.loaded().then(function(){s1._initializeMetadata();});if(this.bJSON){if(this.sMaxDataServiceVersion==="3.0"){this.oHeaders["Accept"]="application/json;odata=fullmetadata";}else{this.oHeaders["Accept"]="application/json";}}else{this.oHeaders["Accept"]="application/atom+xml,application/atomsvc+xml,application/xml";}if(this.bTokenHandling){if(this.oSharedServiceData.securityToken){this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken;}else if(this.oSharedServerData.securityToken){this.oSharedServiceData.securityToken=this.oSharedServerData.securityToken;this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken;}if(q1){this.securityTokenAvailable();}}this.oHeaders["Accept-Language"]=sap.ui.getCore().getConfiguration().getLanguageTag();this.oHeaders["DataServiceVersion"]="2.0";this.oHeaders["MaxDataServiceVersion"]="2.0";if(this.sMaxDataServiceVersion){this.oHeaders["MaxDataServiceVersion"]=this.sMaxDataServiceVersion;}},metadata:{publicMethods:["read","create","update","remove","submitChanges","getServiceMetadata","metadataLoaded","hasPendingChanges","getPendingChanges","refresh","refreshMetadata","resetChanges","setDefaultCountMode","setDefaultBindingMode","getDefaultBindingMode","getDefaultCountMode","setProperty","getSecurityToken","refreshSecurityToken","setHeaders","getHeaders","setUseBatch","setDeferredBatchGroups","getDeferredBatchGroups","setChangeBatchGroups","getChangeBatchGroups"]}});P.M_EVENTS={MetadataLoaded:"metadataLoaded",MetadataFailed:"metadataFailed",AnnotationsLoaded:"annotationsLoaded",AnnotationsFailed:"annotationsFailed",BatchRequestFailed:"batchRequestFailed",BatchRequestSent:"batchRequestSent",BatchRequestCompleted:"batchRequestCompleted"};P.prototype.attachBatchRequestFailed=function(i,j,k){this.attachEvent("batchRequestFailed",i,j,k);return this;};P.prototype.detachBatchRequestFailed=function(i,j){this.detachEvent("batchRequestFailed",i,j);return this;};P.prototype.fireBatchRequestFailed=function(i){this.fireEvent("batchRequestFailed",i);return this;};P.prototype.attachBatchRequestSent=function(i,j,k){this.attachEvent("batchRequestSent",i,j,k);return this;};P.prototype.detachBatchRequestSent=function(i,j){this.detachEvent("batchRequestSent",i,j);return this;};P.prototype.fireBatchRequestSent=function(i){this.fireEvent("batchRequestSent",i);return this;};P.prototype.attachBatchRequestCompleted=function(i,j,k){this.attachEvent("batchRequestCompleted",i,j,k);return this;};P.prototype.detachBatchRequestCompleted=function(i,j){this.detachEvent("batchRequestCompleted",i,j);return this;};P.prototype.fireBatchRequestCompleted=function(i){this.fireEvent("batchRequestCompleted",i);return this;};P.mSharedData={server:{},service:{},meta:{}};P._getSharedData=function(S,k){var i=this.mSharedData[S][k];if(!i){i={};this.mSharedData[S][k]=i;}return i;};P.prototype._initializeMetadata=function(){if(this.bDestroyed){return;}this.bIsMessageScopeSupported=this.oMetadata._isMessageScopeSupported();var i=function(){this.fireMetadataLoaded({metadata:this.oMetadata});L.debug(this+" - metadataloaded fired");}.bind(this);this.initialize();if(this.bLoadAnnotationsJoined){this.oAnnotations.loaded().then(i,this.fireMetadataFailed.bind(this));}else{i();}};P.prototype.refreshMetadata=function(){if(this.oMetadata&&this.oMetadata.refresh){return this.oMetadata.refresh();}};P.prototype.fireAnnotationsLoaded=function(i){this.fireEvent("annotationsLoaded",i);return this;};P.prototype.attachAnnotationsLoaded=function(i,j,k){this.attachEvent("annotationsLoaded",i,j,k);return this;};P.prototype.detachAnnotationsLoaded=function(i,j){this.detachEvent("annotationsLoaded",i,j);return this;};P.prototype.fireAnnotationsFailed=function(i){this.fireEvent("annotationsFailed",i);L.debug(this+" - annotationsfailed fired");return this;};P.prototype.attachAnnotationsFailed=function(i,j,k){this.attachEvent("annotationsFailed",i,j,k);return this;};P.prototype.detachAnnotationsFailed=function(i,j){this.detachEvent("annotationsFailed",i,j);return this;};P.prototype.fireMetadataLoaded=function(i){this.fireEvent("metadataLoaded",i);return this;};P.prototype.attachMetadataLoaded=function(i,j,k){this.attachEvent("metadataLoaded",i,j,k);return this;};P.prototype.detachMetadataLoaded=function(i,j){this.detachEvent("metadataLoaded",i,j);return this;};P.prototype.fireMetadataFailed=function(i){this.fireEvent("metadataFailed",i);return this;};P.prototype.attachMetadataFailed=function(i,j,k){this.attachEvent("metadataFailed",i,j,k);return this;};P.prototype.detachMetadataFailed=function(i,j){this.detachEvent("metadataFailed",i,j);return this;};P.prototype._createEventInfo=function(R,k,n){var S={};S.url=R.requestUri;S.method=R.method;S.async=R.async;S.headers=R.headers;if(n){S.requests=[];for(var i=0;i<n.length;i++){var T={};if(Array.isArray(n[i])){var V=n[i];for(var j=0;j<V.length;j++){var R=V[j].request;var W=n[i][j].response;T={};T.url=R.requestUri;T.method=R.method;T.headers=R.headers;if(W){T.response={};if(R._aborted){T.success=false;T.response.statusCode=0;T.response.statusText="abort";}else{T.success=true;if(W.message){T.response.message=W.message;W=W.response;T.response.responseText=W.body;T.success=false;}T.response.headers=W.headers;T.response.statusCode=W.statusCode;T.response.statusText=W.statusText;}}S.requests.push(T);}}else{var R=n[i].request;var W=n[i].response;T.url=R.requestUri;T.method=R.method;T.headers=R.headers;if(W){T.response={};if(R._aborted){T.success=false;T.response.statusCode=0;T.response.statusText="abort";}else{T.success=true;if(W.message){T.response.message=W.message;W=W.response;T.response.responseText=W.body;T.success=false;}T.response.headers=W.headers;T.response.statusCode=W.statusCode;T.response.statusText=W.statusText;}}S.requests.push(T);}}}if(k){S.response={};S.success=true;if(k.message){S.response.message=k.message;S.success=false;}if(k.response){k=k.response;}if(k&&k.statusCode!=undefined){S.response.headers=k.headers;S.response.statusCode=k.statusCode;S.response.statusText=k.statusText;S.response.responseText=k.body!==undefined?k.body:k.responseText;if(k.expandAfterCreateFailed){S.response.expandAfterCreateFailed=true;}if(k.expandAfterFunctionCallFailed){S.response.expandAfterFunctionCallFailed=true;}}}S.ID=R.requestID;return S;};P.prototype._createRequestID=function(){var R;R=u();return R;};P.prototype._getServerUrl=function(){var S,i;S=new I(this.sServiceUrl).absoluteTo(document.baseURI);i=new I("/").absoluteTo(S).toString();return i;};P.prototype._createMetadataUrl=function(i){if(i.indexOf(this.sServiceUrl)==-1){if(!i.startsWith("/")){i="/"+i;}i=this.sServiceUrl+i;}var j=U.fromURL(i||window.location.href);var k=Object.assign({},this.mMetadataUrlParams);Array.from(j.keys()).forEach(function(S){k[S]=j.get(S);});var n=D._createUrlParamsArray(k);var R=i.split("?");if(R.length>1){i=R[0];}return this._addUrlParams(i,n);};P.prototype._addUrlParams=function(i,j){var k=[];if(this.aUrlParams){k=k.concat(this.aUrlParams);}if(j){k=k.concat(j);}if(k.length>0){i+="?"+k.join("&");}return i;};P.prototype._createRequestUrl=function(i,j,k,n){return this._createRequestUrlWithNormalizedPath(this._normalizePath(i,j),k,n);};P.prototype._createRequestUrlWithNormalizedPath=function(n,i,j){var k="";if(!j){k=this.sServiceUrl+n;}else{k=n.substr(n.indexOf('/')+1);}return this._addUrlParams(k,i);};P.prototype._importData=function(j,k,R,n,S,T,V,W){var X=this,Y,Z,$,_;n=n||"";T=T||"";if(j.results&&Array.isArray(j.results)){Y=[];h(j.results,function(i,g1){var T=X._getKey(g1);T=X._importData(g1,k,R,n.substr(0,n.lastIndexOf("/")),S,T);if(T){Y.push(T);}});return Y;}else{if(T){n="/"+T;S+=T.substr(T.indexOf("("));}else{T=this._getKey(j);}if(!T){return T;}$=this._getEntity(T);_=$;if(!$||($.__metadata&&$.__metadata.invalid)){if(!_){_=j;}$=j;T=this._addEntity($);}if(this.aBindableResponseHeaders){var a1={};for(var b1 in R.headers){var c1=b1.toLowerCase();if(this.aBindableResponseHeaders.indexOf(c1)>-1){a1[c1]=R.headers[b1];}}if(!m(a1)){if(!j.__metadata){j.__metadata={};}j.__metadata.headers=a1;}}h(j,function(i,g1){if(g1&&(g1.__metadata&&g1.__metadata.uri||g1.results)&&!g1.__deferred){var h1=n+"/"+i;var i1=S+"/"+i;Z=X._importData(g1,k,R,h1,i1,undefined,false,"/"+T+"/"+i);if(Array.isArray(Z)){$[i]={__list:Z};}else{if(_[i]&&_[i].__ref){if(_[i].__ref!==Z){X.mInvalidatedPaths[n.substr(n.lastIndexOf("("))+"/"+i]="/"+Z;}}$[i]={__ref:Z};}}else if(!g1||!g1.__deferred){if(_[i]&&g1===null){X.mInvalidatedPaths[n.substr(n.lastIndexOf("("))+"/"+i]=null;}$[i]=g1;}});var d1={};d1[T]=$;if(this.hasContext("/"+T)&&this.getContext("/"+T).isPreliminary()){var e1=this.getContext("/"+T);e1.setUpdated(true);e1.setPreliminary(false);}this._updateChangedEntities(d1);k[T]=true;n=n||'/'+T;S=S||n;var f1=this.resolveFromCache(S);if(f1==="/"+T||(f1&&f1.split("/").length>2)){this._writePathCache(f1,"/"+T,V);}this._writePathCache(n,"/"+T,V);this._writePathCache(S,"/"+T,V,true);if(W){this._writePathCache(W,"/"+T,V);}return T;}};P.prototype._writePathCache=function(i,j,k,n){var R,S,T,V,W,X;if(i&&j){if(!this.mPathCache[i]){this.mPathCache[i]={};}if(!k&&i.lastIndexOf("/")===0){j=i;}this.mPathCache[i].canonicalPath=j;if(n){W=i.split("/");for(X=3;X<W.length;X+=1){T=W.slice(0,X).join("/");V=this.mPathCache[T];if(V){R=V.canonicalPath+i.slice(T.length);S=this.mPathCache[R];if(S){S.canonicalPath=j;}}}}}};P.prototype._removeReferences=function(j){var k=this,n;if(!j){return j;}if(j.results){n=[];h(j.results,function(i,R){n.push(k._removeReferences(R));});return n;}else{h(j,function(i,R){if(R){if(R["__ref"]||R["__list"]){delete j[i];}}});return j;}};P.prototype._restoreReferences=function(j,V){var k=this,n,R,S;function T(n){var R=V[n];if(!R){R=k._getObject("/"+n);d(R,"ODataModel inconsistent: "+n+" not found!");if(R){R=p({},R);V[n]=R;k._restoreReferences(R,V);}}return R;}if(!V){V={};}h(j,function(W,X){if(X){if(X.__ref){n=X.__ref;R=T(n);if(R){j[W]=R;}delete X.__ref;}else if(X.__list){S=[];h(X.__list,function(i,n){R=T(n);if(R){S.push(R);}});delete X.__list;X.results=S;}}});return j;};P.prototype.removeData=function(){this.oData={};};P.prototype.initialize=function(){var i=this.getBindings();i.forEach(function(j){j.initialize();});};P.prototype.invalidate=function(i){var j;for(var k in this.oData){j=this.oData[k];if(!i||i(k,j)){j.__metadata.invalid=true;}}};P.prototype.invalidateEntry=function(i){var j;if(typeof i==="string"){if(i.indexOf("/")===0){j=this._getObject(i);}else{j=this.oData[i];}}else if(i instanceof s){j=this._getObject(i.getPath());}if(j&&j.__metadata){j.__metadata.invalid=true;}};P.prototype.invalidateEntityType=function(i){var j;for(var k in this.oData){j=this.oData[k];if(j.__metadata.type===i){j.__metadata.invalid=true;}}};P.prototype.refresh=function(i,R,j){if(typeof i==="string"){j=i;i=false;R=false;}if(R){this.removeData();}this._refresh(i,j);};P.prototype._refresh=function(i,j,k,n){var R=this.getBindings();this.sRefreshGroupId=j;R.forEach(function(S){S._refresh(i,k,n);});this.sRefreshGroupId=undefined;};P.prototype.checkUpdate=function(i,j,k,n){if(j){this.bForceUpdate=this.bForceUpdate||i;Object.assign(this.mChangedEntities4checkUpdate,k);if(!this.sUpdateTimer){this.sUpdateTimer=setTimeout(function(){this.checkUpdate(this.bForceUpdate,false,this.mChangedEntities4checkUpdate);}.bind(this),0);}return;}i=this.bForceUpdate||i;if(this.sUpdateTimer){clearTimeout(this.sUpdateTimer);this.sUpdateTimer=null;this.bForceUpdate=undefined;this.mChangedEntities4checkUpdate={};}var R=this.getBindings();R.forEach(function(S){if(!n||this.isMetaModelPath(S.getPath())){S.checkUpdate(i,k);}}.bind(this));this._processAfterUpdate();};P.prototype.checkDataState=function(i){var j=this.getBindings();j.forEach(function(k){if(k.checkDataState){k.checkDataState(i);}});};P.prototype.bindProperty=function(i,j,k){var n=new A(this,i,j,k);return n;};P.prototype.bindList=function(i,j,S,k,n){var R=new b(this,i,j,S,k,n);return R;};P.prototype.bindTree=function(i,j,k,n,S){var R=new c(this,i,j,k,n,S);return R;};P.prototype.createBindingContext=function(i,j,k,n,R){var S,T,V,W,X,Y=this,Z;if(j!==null&&typeof j==="object"&&!(j instanceof s)){R=n;n=k;k=j;j=undefined;}if(typeof j=="function"){R=k;n=j;k=undefined;j=undefined;}if(typeof j=="boolean"){R=j;n=undefined;k=undefined;j=undefined;}if(typeof k=="function"){R=n;n=k;k=undefined;}if(typeof k=="boolean"){R=k;n=undefined;k=undefined;}if(typeof n=="boolean"){R=n;n=undefined;}if(k){Z=k.canonicalRequest;}Z=this._isCanonicalRequestNeeded(Z);S=this.resolve(i,j,Z);if(!S&&Z){S=this.resolve(i,j);}X=this.resolveDeep(i,j);if(!S){if(n){n(null);}return null;}if(R===undefined){R=this._isReloadNeeded(S,k);}if(!R){T=this.resolve(i,j,true);if(T){V=this.getContext(T,X);}else{V=null;}if(n){n(V);}return V;}function $(d1){var e1=d1?Y._getKey(d1):null,f1=!(i===""||i.indexOf("/")>0),g1=null,h1,i1;V=null;if(e1){V=Y.getContext('/'+e1,X);g1={__ref:e1};}if(j&&a1&&f1){h1=j.getPath();h1=h1.substr(1);i1=Y._getEntity(h1);if(i1){i1[i]=g1;}}n(V);}function _(d1){var e1;if(d1.statusCode=='404'&&j&&a1){var f1=j.getPath();f1=f1.substr(1);e1=Y._getEntity(f1);if(e1){e1[i]={__ref:null};}}n(null);}if(n){var a1=!i.startsWith("/");var b1=[],c1=this.createCustomParams(k);if(c1){b1.push(c1);}if(k&&(k.batchGroupId||k.groupId)){W=k.groupId||k.batchGroupId;}this.read(i,{canonicalRequest:Z,context:j,error:_,groupId:W,success:$,updateAggregatedMessages:true,urlParameters:b1});}if(k&&k.createPreliminaryContext){S=this.resolve(i,j,Z);if(!S&&Z){S=this.resolve(i,j);}V=this.getContext(S,X);return V;}};P.prototype._updateContext=function(i,j,k){i.sPath=j;if(k!==undefined){i.sDeepPath=k;}this.mContexts[j]=i;};P.prototype._splitEntries=function(i){return i.replace(/\s/g,"").split(',').map(function(j){return j.split("/");});};P.prototype._filterOwnSelect=function(S,i){var j,k;if(!i){return[];}k=i.map(function(n){return n.name;});j=S.filter(function(n){return n.length===1;}).map(function(n){return n[0];});if(S.length===0||j.indexOf("*")!==-1||j.indexOf("**")!==-1){return k;}else{return j.filter(function(n){return k.indexOf(n)!==-1;});}};P.prototype._filterOwnExpand=function(i,S){return i.map(function(j){return j[0];}).filter(function(V,j,k){return k.indexOf(V)===j;}).filter(function(V){return S.length===0||S.some(function(j){return j.indexOf(V)===0||j.indexOf("**")===0;});});};P.prototype._filterSelectByNavProp=function(i,n){return i.filter(function(S){return S[0]===n;}).map(function(S){return S.length>1?S.slice(1):["**"];});};P.prototype._filterExpandByNavProp=function(i,n){return i.filter(function(S){return S.length>1&&S[0]===n;}).map(function(S){return S.slice(1);});};P.prototype._isReloadNeeded=function(k,n){var R=this,S=this.oMetadata,T,V=this._getObject(k),W=[],X=[];if(!this.oMetadata.isLoaded()){return true;}T=this.oMetadata._getEntityTypeByPath(k);if(this._isCreatedEntity(V)){return false;}function Y(T,V,X,W){var Z,$,_,a1,b1,c1,d1,e1,f1;if(!T){return false;}if(V===null){return false;}if(!V){return true;}if(V.__metadata&&V.__metadata.invalid){return true;}Z=R._filterOwnSelect(X,T.property);for(var i=0;i<Z.length;i++){f1=Z[i];if(V[f1]===undefined){return true;}}$=R._filterOwnExpand(W,X);for(var i=0;i<$.length;i++){e1=$[i];_=V[e1];if(_===null){continue;}if(_===undefined||_.__deferred){return true;}a1=S._getEntityTypeByNavProperty(T,e1);c1=R._filterSelectByNavProp(X,e1);d1=R._filterExpandByNavProp(W,e1);if(_.__ref){b1=R._getEntity(_.__ref);if(Y(a1,b1,c1,d1)){return true;}}if(_.__list){for(var j=0;j<_.__list.length;j++){b1=R._getEntity(_.__list[j]);if(Y(a1,b1,c1,d1)){return true;}}}}return false;}if(n){if(n.select){X=this._splitEntries(n.select);}if(n.expand){W=this._splitEntries(n.expand);}}return Y(T,V,X,W);};P.prototype.createCustomParams=function(i){var j=[],k,S={expand:true,select:true};for(var n in i){if(n in S){j.push("$"+n+"="+e(i[n]));}if(n==="custom"){k=i[n];for(n in k){if(n.indexOf("$")===0){L.warning(this+" - Trying to set OData parameter '"+n+"' as custom query option!");}else if(typeof k[n]==='string'){j.push(n+"="+e(k[n]));}else{j.push(n);}}}}return j.join("&");};P.prototype.bindContext=function(i,j,k){var n=new a(this,i,j,k);return n;};P.prototype.setDefaultCountMode=function(i){this.sDefaultCountMode=i;};P.prototype.getDefaultCountMode=function(){return this.sDefaultCountMode;};P.prototype._addEntity=function(i){var k=this._getKey(i);this.oData[k]=i;return k;};P.prototype._removeEntity=function(k){k=k&&D._normalizeKey(k);delete this.oData[k];delete this.mChangedEntities[k];delete this.mContexts["/"+k];};P.prototype._getEntity=function(k){var i=this.oData[k];if(!i){k=k&&D._normalizeKey(k);i=this.oData[k];}return i;};P.prototype._getKey=function(V){var k,i;if(V instanceof s){k=V.getPath().substr(1);}else if(V&&V.__metadata&&V.__metadata.uri){i=V.__metadata.uri;k=i.substr(i.lastIndexOf("/")+1);}else if(typeof V==='string'){k=V.substr(V.lastIndexOf("/")+1);}if(!this.oData[k]){k=k&&D._normalizeKey(k);}return k;};P.prototype.getKey=function(V){return this._getKey(V);};P.prototype.createKey=function(j,k){var n=this.oMetadata._getEntityTypeByPath(j),R=j,S=this,T,V;d(n,"Could not find entity type of collection \""+j+"\" in service metadata!");R+="(";if(n.key.propertyRef.length===1){T=n.key.propertyRef[0].name;d(T in k,"Key property \""+T+"\" is missing in object!");V=this.oMetadata._getPropertyMetadata(n,T);R+=encodeURIComponent(D.formatValue(k[T],V.type));}else{h(n.key.propertyRef,function(i,W){if(i>0){R+=",";}T=W.name;d(T in k,"Key property \""+T+"\" is missing in object!");V=S.oMetadata._getPropertyMetadata(n,T);R+=T;R+="=";R+=encodeURIComponent(D.formatValue(k[T],V.type));});}R+=")";return R;};P.prototype.getProperty=function(i,j,k){var V=this._getObject(i,j);if(!k){return V;}if(!o(V)){return V;}V=p({},V);if(k===true){return this._restoreReferences(V);}else{return this._removeReferences(V);}};P.prototype.getObject=function(n,R,S){if(o(R)){S=R;R=undefined;}var T=this,V=this.resolve(n,R),W=this._getObject(V),X=this.oMetadata._getEntityTypeByPath(V),Y=[],Z=[];if(!X||!o(W)||!W.__metadata||!W.__metadata.uri){return W;}if(!S||!(S.select||S.expand)){return p({},W);}function $(X,W,Z,Y){var _,a1,b1,c1,d1,e1,f1,g1,h1,i1,j1,k1,l1;if(!W){return undefined;}if(!X){return undefined;}b1=T._filterOwnSelect(Z,X.property);a1={};for(var i=0;i<b1.length;i++){k1=b1[i];if(W[k1]!==undefined){a1[k1]=W[k1];}else{L.fatal("No data loaded for select property: "+k1+" of entry: "+T.getKey(W));return undefined;}}if(W.__metadata){a1.__metadata=W.__metadata;}_=T._filterOwnExpand(Y,Z);for(var i=0;i<_.length;i++){j1=_[i];d1=W[j1];e1=T.oMetadata._getEntityTypeByNavProperty(X,j1);h1=T._filterSelectByNavProp(Z,j1);i1=T._filterExpandByNavProp(Y,j1);if(d1&&d1.__ref){g1=T._getObject("/"+d1.__ref);f1=$(e1,g1,h1,i1);if(f1!==undefined){a1[j1]=f1;}else{L.fatal("No data loaded for expand property: "+j1+" of entry: "+T.getKey(f1));return undefined;}}if(d1&&d1.__list){l1=[];for(var j=0;j<d1.__list.length;j++){g1=T._getObject("/"+d1.__list[j]);f1=$(e1,g1,h1,i1);if(f1!==undefined){l1.push(f1);}else{L.fatal("No data loaded for expand property: "+j1+" of entry: "+T.getKey(f1));return undefined;}}a1[j1]=l1;}}c1=T._filterOwnSelect(Z,X.navigationProperty);for(var k=0;k<c1.length;k++){j1=c1[k];if(_.indexOf(j1)===-1){var m1=a1.__metadata.uri+"/"+j1;a1[j1]={__deferred:{uri:m1}};}}return a1;}if(S.select){Z=this._splitEntries(S.select);}if(S.expand){Y=this._splitEntries(S.expand);}W=$(X,W,Z,Y);return W;};P.prototype._getObject=function(i,j,k){var n,R,S,T,V,W,X,Y,Z,$,_,a1=this.isLegacySyntax()?this.oData:null;$=this.resolve(i,j,this.bCanonicalRequests);if(!$&&this.bCanonicalRequests){$=this.resolve(i,j);}if(!$){return a1;}if(this._isMetadataPath($)){if(this.oMetadata&&this.oMetadata.isLoaded()){if(this.isMetaModelPath($)){X=this.getMetaModel();S=y.getCodeListTerm($);if(S){R=X.fetchCodeList(S);if(R.isFulfilled()){return R.getResult();}if(R.isRejected()){R.caught();}return undefined;}if(!this.bMetaModelLoaded){return null;}_=$.indexOf('/##');T=$.substr(0,_);Y=$.substr(_+3);W=X.getMetaContext(T);a1=X.getProperty(Y,W);}else{a1=this.oMetadata._getAnnotation($);}}else if(y.getCodeListTerm($)){return undefined;}}else{if($==="/"){return this.oData;}var b1=$.split("/"),c1=0;V=b1[1];b1.splice(0,2);n=this.mChangedEntities[V];Z=this._getEntity(V);a1=k?Z:n||Z;while(a1&&b1[c1]){var d1=n&&n.hasOwnProperty(b1[c1]);n=n&&n[b1[c1]];Z=Z&&Z[b1[c1]];a1=k||!d1?Z:n;if(a1){if(a1.__ref){n=this.mChangedEntities[a1.__ref];Z=this._getEntity(a1.__ref);a1=k?Z:n||Z;}else if(a1.__list){a1=a1.__list;}else if(a1.__deferred){a1=undefined;}}c1++;}}if(o(n)){a1=k?Z:p({},Z,n);}return a1;};P.prototype.updateSecurityToken=function(){if(this.bTokenHandling){if(!this.oSharedServiceData.securityToken){this.refreshSecurityToken();}if(this.bTokenHandling){this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken;}}};P.prototype.resetSecurityToken=function(){delete this.oSharedServiceData.securityToken;delete this.oHeaders["x-csrf-token"];delete this.pSecurityToken;};P.prototype.getSecurityToken=function(){var T=this.oSharedServiceData.securityToken;if(!T){this.refreshSecurityToken();T=this.oSharedServiceData.securityToken;}return T;};P.prototype.securityTokenAvailable=function(){if(!this.pSecurityToken){if(this.oSharedServiceData.securityToken){this.pSecurityToken=Promise.resolve(this.oSharedServiceData.securityToken);}else{this.pSecurityToken=new Promise(function(i,j){this.refreshSecurityToken(function(){i(this.oSharedServiceData.securityToken);}.bind(this),function(){j();},true);}.bind(this));}}return this.pSecurityToken;};P.prototype.refreshSecurityToken=function(S,i,j){var R,T,k={abort:function(){this.request.abort();}},n=this._createRequestUrlWithNormalizedPath("/"),V=this;function W($,_){if(_){T=V._getHeader("x-csrf-token",_.headers);V._setSessionContextIdHeader(V._getHeader("sap-contextid",_.headers));if(T){V.oSharedServerData.securityToken=T;V.oSharedServiceData.securityToken=T;V.pSecurityToken=Promise.resolve(T);V.oHeaders["x-csrf-token"]=T;}else{V.resetSecurityToken();V.bTokenHandling=false;}}if(S){S($,_);}}function X($){V.resetSecurityToken();V.bTokenHandling=false;V._handleError($,R);if(i){i($);}}function Y($){k.request=Z("GET",X);}function Z($,i){R=V._createRequest(n,"",$,V._getHeaders(undefined,true),null,null,!!j);R.headers["x-csrf-token"]="Fetch";return V._request(R,W,i,undefined,undefined,V.getServiceMetadata());}if(this.bDisableHeadRequestForToken){k.request=Z("GET",X);}else{k.request=Z("HEAD",Y);}return k;};P.prototype._submitRequest=function(R,S,j){var k=this,n,T,V,W,X;W=new Promise(function(i,c1){X=i;});function Y(i,c1){if(S){S(i,c1);}X();}function Z(i){if(k.bTokenHandling&&i.response){var c1=k._getHeader("x-csrf-token",i.response.headers);if(!R.bTokenReset&&i.response.statusCode=='403'&&c1&&c1.toLowerCase()==="required"){k.resetSecurityToken();R.bTokenReset=true;_();return;}}if(j){j(i);}X();}function $(R){if(k.bTokenHandling&&(R.method!=="GET"||k.bTokenHandlingForGet)){k.pReadyForRequest=k.securityTokenAvailable();}return k.pReadyForRequest;}function _(){if(k.bTokenHandling){delete R.headers["x-csrf-token"];}$(R).then(function(i){if(k.bTokenHandling&&(R.method!=="GET"||k.bTokenHandlingForGet)){R.headers["x-csrf-token"]=i;}b1();},function(){b1();});}function a1(c1,R,d1){var e1,f1=R.eventInfo.requests;if(f1){h(f1,function(i,R){if(Array.isArray(R)){R.forEach(function(R){h(R.parts,function(i,g1){e1=k._createEventInfo(R.request,g1.fnError);k["fireRequest"+c1](e1);});});}else{if(R.parts){h(R.parts,function(i,g1){e1=k._createEventInfo(R.request,g1.fnError);k["fireRequest"+c1](e1);});}else{e1=k._createEventInfo(R.request,R.fnError);k["fireRequest"+c1](e1);}}});if(R.eventInfo.batch){e1=k._createEventInfo(R,d1,f1);k["fireBatchRequest"+c1](e1);}}}function b1(){if(k.sSessionContextId){R.headers["sap-contextid"]=k.sSessionContextId;}T=k._request(R,Y,Z,n,undefined,k.getServiceMetadata());if(R.eventInfo){a1("Sent",R,null);delete R.eventInfo;}if(V&&T){T.abort();}}n=k._getODataHandler(R.requestUri);if(this.bSequentializeRequests){this.pSequentialRequestCompleted.then(function(){_();});this.pSequentialRequestCompleted=W;}else{_();}return{abort:function(){if(T){T.abort();}V=true;}};};P.prototype._setSessionContextIdHeader=function(S){if(S){this.sSessionContextId=S;}};P.prototype._submitSingleRequest=function(R){var j=this,k,n={},S={},T={};function V(X,Y){if(X===undefined&&Y.statusCode===200){W({message:"Response did not contain a valid OData result",response:Y});return;}function Z(X,Y){for(var i=0;i<R.parts.length;i++){if(R.parts[i].request._aborted){j._processAborted(R.parts[i].request,Y);}else if(R.parts[i].fnSuccess){R.parts[i].fnSuccess(X,Y);}}if(R.request.requestUri.indexOf("$count")===-1){j.checkUpdate(false,false,S);if(R.bRefreshAfterChange){j._refresh(false,undefined,n,T);}}}j._processSuccess(R.request,Y,Z,S,n,T);j._invalidatePathCache();j._setSessionContextIdHeader(j._getHeader("sap-contextid",Y.headers));}function W(X){if(X.message=="Request aborted"){for(var i=0;i<R.parts.length;i++){j._processAborted(R.parts[i].request,X);}}else{for(var i=0;i<R.parts.length;i++){j._processError(R.parts[i].request,X,R.parts[i].fnError);}}j._processAfterUpdate();}R.request.eventInfo={requests:R.parts,batch:false};k=this._submitRequest(R.request,V,W);return k;};P.prototype._submitBatchRequest=function(k,R,S,n){var T=this,V={},W={},X={},Y={};function Z(j,d1,e1){var f1,g1,i;for(i=0;i<j.parts.length;i++){if(e1||j.parts[i].request._aborted){T._processAborted(j.parts[i].request,d1);}else if(d1.message){T._processError(j.parts[i].request,d1,j.parts[i].fnError);}else{if(j.request.contentID){f1=j.request.contentID;if(j.request.created||j.request.functionMetadata){g1=T._getKey(d1.data);W[f1]={key:g1,deepPath:j.request.deepPath.replace("('"+f1+"')",g1.slice(g1.indexOf("(")))};}else{g1=W[f1].key;j.request.requestUri=j.request.requestUri.replace("$"+f1,g1);j.request.deepPath=W[f1].deepPath;}}T._processSuccess(j.parts[i].request,d1,j.parts[i].fnSuccess,X,V,Y,false,undefined,W);}}}function $(d1,e1){if(d1===undefined&&e1.statusCode===200){_({message:"Response did not contain a valid OData batch result",response:e1});return;}var f1,g1,h1,i1=d1.__batchResponses;if(i1){var i,j;for(i=0;i<i1.length;i++){f1=i1[i];if(Array.isArray(R[i])){if(f1.message){for(j=0;j<R[i].length;j++){f1.$reported=false;g1=R[i][j];Z(g1,f1);g1.response=f1;}}else{h1=f1.__changeResponses;for(j=0;j<h1.length;j++){var j1=h1[j];g1=R[i][j];Z(g1,j1);g1.response=j1;}}}else{g1=R[i];Z(g1,f1);g1.response=f1;}}T._invalidatePathCache();T.checkUpdate(false,false,X);}T._processSuccess(k,e1,S,X,V,Y,true,R);T._setSessionContextIdHeader(T._getHeader("sap-contextid",e1.headers));}function _(j){var d1=j.message=="Request aborted";j.$reported=true;h(R,function(i,e1){if(Array.isArray(e1)){e1.forEach(function(e1){Z(e1,j,d1);});}else{Z(e1,j,d1);}});T._processAfterUpdate();if(d1){T._processAborted(k,j,true);}else{j.$reported=false;T._processError(k,j,n,true,R);}}k.eventInfo={requests:R,batch:true};var a1=this._submitRequest(k,$,_);function b1(j){var n;for(var i=0;i<j.parts.length;i++){n=j.parts[i].fnError;if(!j.parts[i].request._aborted&&n){n(Q);}}}var c1={abort:function(j){h(R,function(i,d1){if(Array.isArray(d1)){d1.forEach(function(d1){b1(d1);});}else{b1(d1);}});if(n&&!j){n(Q);}a1.abort();}};return c1;};P.prototype._invalidatePathCache=function(){var i=this,j;if(Object.keys(this.mInvalidatedPaths).length>0){Object.keys(this.mPathCache).forEach(function(k){for(var n in i.mInvalidatedPaths){j=k.indexOf(n);if(j>-1){if(j+n.length!==k.length){var R=k.substr(j+n.length);i.mPathCache[k].canonicalPath=i.mInvalidatedPaths[n]===null?null:i.mInvalidatedPaths[n]+R;}else{i.mPathCache[k].canonicalPath=i.mInvalidatedPaths[n];}}}});}this.mInvalidatedPaths={};};P.prototype._createBatchRequest=function(i){var j,R,k={},n={},S=true;n.__batchRequests=i;for(var T in i){if(i[T]&&i[T].__changeRequests||i[T]&&i[T].headers&&!i[T].headers['sap-cancel-on-close']){S=false;break;}}j=this.sServiceUrl+"/$batch";if(this.aUrlParams.length>0){j+="?"+this.aUrlParams.join("&");}l(k,this.mCustomHeaders,this.oHeaders);k["Accept"]="multipart/mixed";delete k["Content-Type"];k['sap-cancel-on-close']=S;R={headers:k,requestUri:j,method:"POST",data:n,user:this.sUser,password:this.sPassword,async:true};R.withCredentials=this.bWithCredentials;return R;};P.prototype.abortInternalRequest=function(j,k){var R=this.mRequests;var n,S;if(k){n=k.requestKey;S=k.path;}if(j in this.mDeferredGroups){R=this.mDeferredRequests;}var T=function(W){for(var i=0;i<W.parts.length;i++){W.parts[i].requestHandle.abort();}};var V=R[j];if(V){if(n in V.map){T(V.map[n]);}else if(S){h(V.map,function(n,i){if(n.indexOf(S)>=0){T(i);}});}else if(j&&!k){h(V.map,function(i,W){T(W);});}}};P.prototype._pushToRequestQueue=function(R,i,j,k,S,n,T,V){var W=R[i],X=k.key?k.key:k.method+":"+k.requestUri;if(this.bWarmup){return;}if(!W){W={};W.map={};W.requests=[];R[i]=W;}if(X in W.map&&(k.key||k.method==='GET')){var Y=W.map[X];var Z=Y.request;k.deepPath=Z.deepPath;if(this.sMessageScope===w.BusinessObject){k.headers["sap-message-scope"]=Z.headers["sap-message-scope"];}if(Y.bRefreshAfterChange===undefined){Y.bRefreshAfterChange=V;}if(!k.key){Y.parts.push({request:k,fnSuccess:S,fnError:n,requestHandle:T});}if(k.method==="GET"){delete Z.data;}else{Z.method=k.method;Z.headers=k.headers;Z.data=k.data;if(k.method==="PUT"){delete Z.headers["x-http-method"];}if(Z._aborted){delete Z._aborted;}}if(Z.functionMetadata){Z.requestUri=k.requestUri;Z.functionTarget=k.functionTarget;}}else{var Y={request:k,bRefreshAfterChange:V,parts:[{request:k,fnSuccess:S,fnError:n,requestHandle:T}]};if(k.method==="GET"){W.requests.push(Y);}else{if(!W.changes){W.changes={};}var $=W.changes[j];if(!$){$=[];W.changes[j]=$;}Y.changeSetId=j;$.push(Y);}W.map[X]=Y;}};P.prototype._collectChangedEntities=function(j,k,n){var R=this;if(j.changes){h(j.changes,function(S,T){for(var i=0;i<T.length;i++){if(T[i].bRefreshAfterChange){var V=T[i].request,W="/"+V.requestUri.split("?")[0],X,Y;if(V.method==="POST"||V.method==="DELETE"){var Z=R.oMetadata._getEntityTypeByPath(W);if(Z){n[Z.entityType]=true;}}else{X=R._getObject(W);if(X){Y=R._getKey(X);}else if(W.lastIndexOf("/")===0){Y=R._getKey(W);}if(Y){k[Y]=true;}}}}});}};P.prototype._processRequestQueue=function(R,j,S,k){var n=this,T,V=[];function W(Y,Z){for(var i=0;i<Y.parts.length;i++){var $=Y.parts[i];if($.request._aborted){n._processAborted(Y.request,null);Y.parts.splice(i,1);i--;}else if(Z){$.request._handle=Z;Z.iRelevantRequests++;}}}function X(){return{iRelevantRequests:0,oRequestHandle:{},abort:function(){this.iRelevantRequests--;if(this.iRelevantRequests===0&&this.oRequestHandle){this.oRequestHandle.abort(true);if(S){S({},undefined);}}}};}if(this.bUseBatch){h(R,function(i,Y){if(i===j||!j){var Z={},$={};n._collectChangedEntities(Y,Z,$);if(Object.keys(Z).length||Object.keys($).length){n.bIncludeInCurrentBatch=true;n._refresh(false,i,Z,$);n.bIncludeInCurrentBatch=false;}}});h(R,function(Y,Z){if(Y===j||!j){var $=[],_=[],a1,b1;var c1=X();if(Z.changes){h(Z.changes,function(f1,g1){var h1,i,i1;a1={__changeRequests:[]};b1=[];for(i=0;i<g1.length;i++){h1=g1[i].request;T='/'+n.getKey(h1.data);n.increaseLaundering(T,h1.data);W(g1[i],c1);if(g1[i].parts.length>0){n.removeInternalMetadata(h1.data);a1.__changeRequests.push(h1);if(h1.expandRequest){i1=g1[i].parts[0];n._pushToRequestQueue(R,Y,undefined,h1.expandRequest,i1.fnSuccess,i1.fnError,i1.requestHandle,false);}b1.push(g1[i]);}}if(a1.__changeRequests&&a1.__changeRequests.length>0){$.push(a1);_.push(b1);}});}if(Z.requests){var d1=Z.requests;for(var i=0;i<d1.length;i++){W(d1[i],c1);if(d1[i].parts.length>0){$.push(d1[i].request);_.push(d1[i]);}}}if($.length>0){var e1=n._createBatchRequest($);c1.oRequestHandle=n._submitBatchRequest(e1,_,S,k);V.push(c1.oRequestHandle);}delete R[Y];}});}else{h(R,function(Y,Z){if(Y===j||!j){if(Z.changes){h(Z.changes,function(a1,b1){for(var i=0;i<b1.length;i++){var _=X();T='/'+n.getKey(b1[i].request.data);n.increaseLaundering(T,b1[i].request.data);W(b1[i],_);if(b1[i].parts.length>0){n.removeInternalMetadata(b1[i].request.data);_.oRequestHandle=n._submitSingleRequest(b1[i]);V.push(_.oRequestHandle);}}});}if(Z.requests){var $=Z.requests;for(var i=0;i<$.length;i++){var _=X();W($[i],_);if($[i].parts.length>0){_.oRequestHandle=n._submitSingleRequest($[i]);V.push(_.oRequestHandle);}}}delete R[Y];}});}this.checkDataState(this.mLaunderingState);return V.length==1?V[0]:V;};P.prototype._processRequestQueueAsync=function(R){var i=this;if(!this.pCallAsync){this.pCallAsync=this.oMetadata.loaded().then(function(){return Promise.resolve().then(function(){i._processRequestQueue(R);i.pCallAsync=undefined;});});}};P.prototype._processSuccess=function(R,i,S,j,k,n,T,V,W){var X,Y,Z,$,_,a1,b1,c1,d1,e1,f1,g1,h1,i1={},j1={},k1=i.data,l1=this;if(!T){Y=!(i.statusCode===204||i.statusCode==='204');h1=R.requestUri;f1=h1.replace(this.sServiceUrl,"");if(!f1.startsWith('/')){f1='/'+f1;}d1=this._normalizePath(f1);_=this.oMetadata._getEntityTypeByPath(d1);c1=_&&_.isFunction;f1=this._normalizePath(f1,undefined,!c1);this.decreaseLaundering(f1,R.data);this._decreaseDeferredRequestCount(R);if(R.functionMetadata){if(i.headers&&i.headers.location){a1=i.headers.location;g1=a1.lastIndexOf(this.sServiceUrl);if(g1>-1){X=a1.slice(g1+this.sServiceUrl.length);if(R.functionTarget===X){Z=this.getDeepPathForCanonicalPath(X);if(Z){R.deepPath=Z;}}R.functionTarget=X;}}if(R.adjustDeepPath){R.deepPath=R.adjustDeepPath({deepPath:Z||R.functionTarget,response:p({},i)});}else if(!Z){R.deepPath=R.functionTarget;}if(W&&R.contentID){W[R.contentID].deepPath=R.deepPath;}}if(Y&&k1===undefined&&i){this._parseResponse(i,R);L.fatal(this+" - No data was retrieved by service: '"+i.requestUri+"'");l1.fireRequestCompleted({url:i.requestUri,type:"GET",async:i.async,info:"Accept headers:"+this.oHeaders["Accept"],infoObject:{acceptHeaders:this.oHeaders["Accept"]},success:false});return false;}if(k1&&!k1.__metadata&&k1.results&&!Array.isArray(k1.results)){k1=k1.results;}if(!i._imported&&k1&&(Array.isArray(k1)||typeof k1=='object')){b1=p({},k1);if(R.key||R.created){l1._importData(b1,j1,i,undefined,undefined,undefined,c1);}else{l1._importData(b1,j1,i,f1,R.deepPath,undefined,c1);}i._imported=true;}$=this._getEntity(R.key);if(j1&&$&&$.__metadata.created&&$.__metadata.created.functionImport){var m1=[];var n1=$["$result"];if(n1&&n1.__list){h(j1,function(p1){m1.push(p1);});n1.__list=m1;}else if(n1&&n1.__ref){h(j1,function(p1){n1.__ref=p1;});}}if(!Y){e1=f1.split("/");if(e1[1]){i1[e1[1]]=R;var o1={};o1[e1[1]]=R.data;this._updateChangedEntities(o1);}if(R.method==="DELETE"&&e1[2]!=="$links"){this._removeEntity(e1[1]);}}if(Y&&R.method==="POST"||R.functionMetadata){if(_){n[_.entityType]=true;}if(R.key){if(R.created){var p1=this._getKey(k1);var q1=this.getContext("/"+R.key);Z=R.deepPath;if(q1.bCreated&&Z.endsWith(")")){R.deepPath=Z.slice(0,Z.lastIndexOf("("))+p1.slice(p1.indexOf("("));}this._updateContext(q1,'/'+p1,R.deepPath);q1.bCreated=false;q1.setUpdated(true);this.callAfterUpdate(function(){q1.setUpdated(false);});$=this._getEntity(p1);if($){delete $.__metadata.created;}this._removeEntity(R.key);}else{delete this.mChangedEntities[R.key];}}}this._parseResponse(i,R,j1,i1);l(j,j1);l(k,i1);this._updateETag(R,i);}if(S){S(k1,i);}var r1=this._createEventInfo(R,i,V);if(T){this.fireBatchRequestCompleted(r1);}else{this.fireRequestCompleted(r1);}return true;};P.prototype._processError=function(R,i,j,k,n){var S,T;if(R.functionMetadata){R.deepPath=R.functionTarget;}S=this._handleError(i,R);if(!k){T='/'+this.getKey(R.data);this.decreaseLaundering(T,R.data);this._decreaseDeferredRequestCount(R);}if(j){j(S);}var V=this._createEventInfo(R,S,n);if(k){this.fireBatchRequestCompleted(V);this.fireBatchRequestFailed(V);}else{this.fireRequestCompleted(V);this.fireRequestFailed(V);}};var Q={message:"Request aborted",statusCode:0,statusText:"abort",headers:{},responseText:""};P.prototype._processAborted=function(R,i,j){var k;if(!j){k='/'+this.getKey(R.data);this.decreaseLaundering(k,R.data);this._decreaseDeferredRequestCount(R);}if(i){var n=this._createEventInfo(R,Q);n.success=false;if(j){this.fireBatchRequestCompleted(n);}else{this.fireRequestCompleted(n);}}};P.prototype._processAfterUpdate=function(){var j=this.aCallAfterUpdate;this.aCallAfterUpdate=[];for(var i=0;i<j.length;i++){j[i]();}};P.prototype._processChange=function(k,i,j,R){var S,T,V,W,X,Y,Z,$,_,a1,b1,c1,d1,e1=this;if(R&&this.mChangedEntities[k]&&this.mChangedEntities[k].__metadata){this.mChangedEntities[k].__metadata.deepPath=R;}else if(!R&&this.mChangedEntities[k]&&this.mChangedEntities[k].__metadata&&this.mChangedEntities[k].__metadata.deepPath){R=this.mChangedEntities[k].__metadata.deepPath;}V=this.oMetadata._getEntityTypeByPath(k);if(!j){j="MERGE";}_=p({},this._getObject('/'+k,true),i);if(i.__metadata&&i.__metadata.created){Z=i.__metadata.created.method?i.__metadata.created.method:"POST";k=i.__metadata.created.key;T=true;$=i.__metadata.created;X=i.__metadata.created.expandRequest;S=i.__metadata.created.contentID;if(i.__metadata.created.functionImport){$.urlParameters=this._createFunctionImportParameters(i.__metadata.created.key,Z,_);_=undefined;}else{delete _.__metadata['uri'];}}else if(j==="MERGE"){Z="MERGE";b1=this._getEntity(k);}else{Z="PUT";}if(_&&_.__metadata){for(var n in _.__metadata){if(n!=='type'&&n!=='uri'&&n!=='etag'&&n!=='content_type'&&n!=='media_src'){delete _.__metadata[n];}}}if(_&&V){var f1=this.oMetadata._getNavigationPropertyNames(V);f1.forEach(function(i1){delete _[i1];});}if(Z==="MERGE"&&V&&b1){h(_,function(i1,j1){if(i1!=='__metadata'){if(f(b1[i1],j1)&&!e1.isLaundering('/'+k+'/'+i1)){delete _[i1];}}});var g1="/"+k,h1;h(_,function(i1,j1){if(i1!=='__metadata'){h1=e1.getProperty(g1+"/"+i1+"/#@sap:unit");if(h1){if(_[h1]===undefined){_[h1]=b1[h1];}}}});if(b1.__metadata.etag){_.__metadata.etag=b1.__metadata.etag;}}_=this._removeReferences(_);d1=$&&$.urlParameters?D._createUrlParamsArray($.urlParameters):undefined;Y=$?this._getHeaders($.headers):this._getHeaders();W=$&&$.eTag?$.eTag:this.getETag(_);c1=this._createRequestUrl('/'+k,null,d1,this.bUseBatch);a1=this._createRequest(c1,R,Z,Y,_,W,undefined,true);if(T){a1.created=true;if(X){a1.expandRequest=X;a1.contentID=S;}if(i.__metadata.created.functionMetadata){a1.functionTarget=this.oMetadata._getCanonicalPathOfFunctionImport(i.__metadata.created.functionMetadata,$.urlParameters);}}if(this.bUseBatch){a1.requestUri=a1.requestUri.replace(this.sServiceUrl+'/','');}return a1;};P.prototype._resolveGroup=function(k){var i,j,n,R,S,T;j=this.oMetadata._getEntityTypeByPath(k);T=this._getObject('/'+k);if(T){n=T.__metadata.created;if(n){return{groupId:n.groupId,changeSetId:n.changeSetId};}}if(this.mChangeGroups[j.name]){i=this.mChangeGroups[j.name];R=i.groupId;S=i.single?u():i.changeSetId;}else if(this.mChangeGroups['*']){i=this.mChangeGroups['*'];R=i.groupId;S=i.single?u():i.changeSetId;}return{groupId:R,changeSetId:S};};P.prototype._updateETag=function(R,i){var j,k,n;j=R.requestUri.replace(this.sServiceUrl+'/','');if(!j.startsWith("/")){j="/"+j;}k=this._getObject(j.split("?")[0],undefined,true);n=this._getHeader("etag",i.headers);if(k&&k.__metadata&&n){k.__metadata.etag=n;}};P.prototype._handleError=function(i,R){var T,j={message:i.message};if(i.response){if(!i.$reported){this._parseResponse(i.response,R);if(this.bTokenHandling){T=this._getHeader("x-csrf-token",i.response.headers);if(i.response.statusCode=='403'&&T&&T.toLowerCase()==="required"){this.resetSecurityToken();}}}j.statusCode=i.response.statusCode;j.statusText=i.response.statusText;j.headers=i.response.headers;j.responseText=i.response.body;}else if(!i.$reported){L.error("The following problem occurred: "+i.message,undefined,J);}i.$reported=true;return j;};P.prototype.getData=function(i,j,k){return this.getProperty(i,j,k);};P.prototype._getODataHandler=function(i){if(i.indexOf("$batch")>-1){return H.batchHandler;}else if(i.indexOf("$count")>-1){return undefined;}else if(this.bJSON){return H.jsonHandler;}else{return H.atomHandler;}};P.prototype.getETag=function(i,j,k){if(typeof i=="object"){k=i;i="";}return this._getETag(i,j,k);};P.prototype._getETag=function(i,j,k){if(!k||!k.__metadata){k=this._getObject(i,j);}if(k&&k.__metadata){return k.__metadata.etag;}return null;};P.prototype.forceEntityUpdate=function(k){var i=this.mChangedEntities[k];if(i&&i.__metadata){i.__metadata.etag='*';}else{L.error(this+" - Entity with key "+k+" does not exist or has no change");}};P.prototype._createRequest=function(i,j,k,n,R,S,T,V){var W;T=T!==false;if(S&&k!=="GET"){n["If-Match"]=S;}if(!n["Content-Type"]&&k!=="DELETE"&&k!=="GET"){if(this.bJSON){n["Content-Type"]="application/json";}else{n["Content-Type"]="application/atom+xml";}}if(i.indexOf("$count")>-1){n["Accept"]="text/plain, */*;q=0.5";}if(k==="MERGE"&&!this.bUseBatch){n["x-http-method"]="MERGE";k="POST";}if(this.sMessageScope===w.BusinessObject){if(this.bIsMessageScopeSupported){n["sap-message-scope"]=this.sMessageScope;}else{L.error("Message scope 'sap.ui.model.odata.MessageScope.BusinessObject' is not"+" supported by the service: "+this.sServiceUrl,undefined,J);}}V=V&&this.sMessageScope===w.BusinessObject&&this.bIsMessageScopeSupported;if(this.bUseBatch&&k!=="GET"&&k!=="HEAD"&&!n["Content-ID"]){n["Content-ID"]=u();}W={headers:n,requestUri:i,method:k,user:this.sUser,password:this.sPassword,async:T,deepPath:j,updateAggregatedMessages:V};if(R){W.data=R;}if(this.bWithCredentials){W.withCredentials=this.bWithCredentials;}W.requestID=this._createRequestID();return W;};P.prototype._processRequest=function(i,j,k){var R,n,S=false,T=this;if(this.bWarmup){return{abort:function(){}};}if(k){this.iPendingDeferredRequests++;}R={abort:function(){if(k&&!S){T.iPendingDeferredRequests--;}if(!S&&j){j(Q);}if(n){n._aborted=true;if(n._handle){n._handle.abort();}}S=true;}};this.oMetadata.loaded().then(function(){n=i(R);if(n){n.deferred=!!k;}T._processRequestQueueAsync(T.mRequests);if(S){R.abort();}});return R;};P.prototype.update=function(i,j,k){var S,n,R,T,V,W,X,Y,Z,$,_,a1,b1,c1,d1,e1=this,f1,g1,h1;if(k){Y=k.groupId||k.batchGroupId;Z=k.changeSetId;V=k.context;S=k.success;n=k.error;W=k.eTag;_=k.headers;$=k.urlParameters;c1=k.refreshAfterChange;h1=k.canonicalRequest;if(k.merge!==undefined){a1=k.merge?"MERGE":"PUT";}}h1=this._isCanonicalRequestNeeded(h1);d1=Y in e1.mDeferredGroups;c1=this._getRefreshAfterChange(c1,Y);X=D._createUrlParamsArray($);_=this._getHeaders(_);a1=a1?a1:this.sDefaultUpdateMethod;W=W||this._getETag(i,V,j);f1=this._normalizePath(i,V,h1);g1=this.resolveDeep(i,V);return this._processRequest(function(i1){T=e1._createRequestUrlWithNormalizedPath(f1,X,e1.bUseBatch);R=e1._createRequest(T,g1,a1,_,j,W);b1=e1.mRequests;if(d1){b1=e1.mDeferredRequests;}e1._pushToRequestQueue(b1,Y,Z,R,S,n,i1,c1);return R;},n,d1);};P.prototype.create=function(i,j,k){var R,n,S,T,V,W,X,Y,Z,$,_,a1,b1,c1,d1,e1,f1=this,g1,h1,i1;if(k){T=k.context;X=k.urlParameters;V=k.success;W=k.error;a1=k.groupId||k.batchGroupId;c1=k.changeSetId;_=k.eTag;Z=k.headers;d1=k.refreshAfterChange;i1=k.canonicalRequest;}i1=this._isCanonicalRequestNeeded(i1);d1=this._getRefreshAfterChange(d1,a1);$=D._createUrlParamsArray(X);Z=this._getHeaders(Z);b1="POST";e1=a1 in f1.mDeferredGroups;g1=f1._normalizePath(i,T,i1);h1=this.resolveDeep(i,T);return this._processRequest(function(j1){n=f1._createRequestUrlWithNormalizedPath(g1,$,f1.bUseBatch);R=f1._createRequest(n,h1,b1,Z,j,_);R.created=true;S=f1.oMetadata._getEntityTypeByPath(g1);R.entityTypes={};if(S){R.entityTypes[S.entityType]=true;}Y=f1.mRequests;if(e1){Y=f1.mDeferredRequests;}f1._pushToRequestQueue(Y,a1,c1,R,V,W,j1,d1);return R;},W,e1);};P.prototype.remove=function(i,j){var k,n,S,R,T,V,W,X,Y,Z,$,_,a1,b1,c1,d1,e1=this,f1,g1,h1=this.bCanonicalRequests;if(j){W=j.groupId||j.batchGroupId;X=j.changeSetId;k=j.context;S=j.success;R=j.error;Y=j.eTag;_=j.headers;$=j.urlParameters;Z=j.refreshAfterChange;h1=j.canonicalRequest;}h1=this._isCanonicalRequestNeeded(h1);Z=this._getRefreshAfterChange(Z,W);a1=D._createUrlParamsArray($);_=this._getHeaders(_);b1="DELETE";Y=Y||this._getETag(i,k);d1=W in e1.mDeferredGroups;f1=this._normalizePath(i,k,h1);g1=this.resolveDeep(i,k);function i1(j1,k1){n=V.substr(V.lastIndexOf('/')+1);if(n.indexOf('?')!==-1){n=n.substr(0,n.indexOf('?'));}e1._removeEntity(n);if(S){S(j1,k1);}}return this._processRequest(function(j1){V=e1._createRequestUrlWithNormalizedPath(f1,a1,e1.bUseBatch);T=e1._createRequest(V,g1,b1,_,undefined,Y,undefined,true);c1=e1.mRequests;if(d1){c1=e1.mDeferredRequests;}e1._pushToRequestQueue(c1,W,X,T,i1,R,j1,Z);return T;},R,d1);};P.prototype.callFunction=function(i,j){var k,n,R,S,T,V,W,X,Y,Z,$,_,a1,b1,c1=this;if(!i.startsWith("/")){L.fatal("callFunction: sFunctionName has to be absolute, but the given '"+i+"' is not absolute",this,J);return undefined;}j=j||{};k=j.changeSetId;R=j.error;S=j.eTag;T=j.expand;V=j.groupId||j.batchGroupId;W=j.headers;X=j.method||"GET";Y=j.refreshAfterChange;a1=j.success;b1=Object.assign({},j.urlParameters);if(T){if(!this.bUseBatch){throw new Error("Use 'expand' parameter only with 'useBatch' set to 'true'");}if(X!=="POST"){throw new Error("Use 'expand' parameter only with HTTP method 'POST'");}}Y=this._getRefreshAfterChange(Y,V);n=new Promise(function(d1,e1){_=d1;Z=e1;});$=this._processRequest(function(d1){var e1,f1,g1,h1,i1,j1,k1,l1,m1,n1,o1,p1={},q1=R,r1=false,s1=a1;g1=c1.oMetadata._getFunctionImportMetadata(i,X);if(!g1){L.error("Function '"+i+"' not found in the metadata",c1,J);Z();return undefined;}if(g1.entitySet||g1.entitySetPath){p1.$result={__list:[]};if(g1.returnType&&!g1.returnType.startsWith("Collection")){p1.$result={__ref:{}};}}if(T&&(!p1.$result||!p1.$result.__ref)){Z(new Error("Use 'expand' parameter only for functions returning a single"+" entity"));return undefined;}if(g1.parameter!=null){g1.parameter.forEach(function(t1){p1[t1.name]=c1._createPropertyValue(t1.type);if(b1[t1.name]!==undefined){p1[t1.name]=b1[t1.name];b1[t1.name]=D.formatValue(b1[t1.name],t1.type);}else{L.warning("No value given for parameter '"+t1.name+"' of function import '"+i+"'",c1,J);}});}m1=u();if(T){W=Object.assign({},W,{"Content-ID":m1,"sap-messages":"transientOnly"});a1=function(p1,t1){if(!i1){i1=p1;h1=t1;return;}if(s1){p1=Object.assign({},i1,p1);s1(p1,h1);}};R=function(t1){if(i1){h1.expandAfterFunctionCallFailed=true;t1.expandAfterFunctionCallFailed=true;L.error("Function '"+i+"' was called successfully, but"+" expansion of navigation properties ("+T+") failed",t1,J);if(s1){s1(i1,h1);}return;}if(!r1){r1=true;if(q1){q1(t1);}}else{t1.expandAfterFunctionCallFailed=true;}};}p1.__metadata={uri:c1.sServiceUrl+i+"('"+m1+"')",created:{changeSetId:k,error:R,eTag:S,functionImport:true,groupId:V,headers:Object.assign({},W),key:i.substring(1),method:X,success:a1}};j1=c1._addEntity(p1);e1=c1.getContext("/"+j1);c1._writePathCache("/"+j1,"/"+j1);_(e1);o1=D._createUrlParamsArray(b1);n1=c1._createRequestUrlWithNormalizedPath(i,o1,c1.bUseBatch);k1=c1._createRequest(n1,i,X,c1._getHeaders(W),undefined,S,undefined,true);k1.adjustDeepPath=j.adjustDeepPath;k1.functionMetadata=g1;p1.__metadata.created.functionMetadata=g1;k1.functionTarget=c1.oMetadata._getCanonicalPathOfFunctionImport(g1,b1);k1.key=j1;if(T){f1=c1._createRequest("$"+m1+"?"+D._encodeURLParameters({$expand:T,$select:T}),"/$"+m1,"GET",c1._getHeaders(undefined,true),undefined,undefined,undefined,true);f1.contentID=m1;k1.expandRequest=f1;k1.contentID=m1;}l1=c1.mRequests;if(V in c1.mDeferredGroups){l1=c1.mDeferredRequests;}c1._pushToRequestQueue(l1,V,k,k1,a1,R,d1,Y);return k1;},R);$.contextCreated=function(){return n;};return $;};P.prototype._createFunctionImportParameters=function(i,j,k){var n=g({},k);delete n.__metadata;delete n["$result"];var R=this.oMetadata._getFunctionImportMetadata(i,j);d(R,this+": Function "+i+" not found in the metadata !");if(!R){return;}if(R.parameter!=null){h(R.parameter,function(S,T){if(n&&n[T.name]!==undefined){n[T.name]=D.formatValue(n[T.name],T.type);}});}return n;};P.prototype._getResourcePath=function(S,i,j,k){var n,R,T,V;if(!S){return this.resolve(j,k);}T=this.oMetadata._splitByLastNavigationProperty(i);R=T.pathBeforeLastNavigationProperty;n=T.lastNavigationProperty;if(n.includes("(")&&T.addressable){V=this.resolve(R+n,undefined,true);if(V){return V+T.pathAfterLastNavigationProperty;}}V=this.resolve(R,undefined,true)||R;return V+n+T.pathAfterLastNavigationProperty;};P.prototype.read=function(i,j){var k,n,R,S,T,V,W,X,Y,Z,$,_,a1,b1,c1=this;if(j){k=j.canonicalRequest;n=j.context;R=j.error;T=j.filters;V=j.groupId||j.batchGroupId;W=j.headers;Z=j.sorters;$=j.success;_=j.updateAggregatedMessages;b1=j.urlParameters;}k=this._isCanonicalRequestNeeded(k);if(i&&i.indexOf('?')!==-1){i=i.slice(0,i.indexOf('?'));}if(this.sRefreshGroupId){V=this.sRefreshGroupId;}a1=D._createUrlParamsArray(b1);W=this._getHeaders(W,true);X="GET";S=this._getETag(i,n);var d1={abort:function(){if(Y){Y._aborted=true;}}};function e1(f1){var g1,h1,i1,j1,k1,l1,m1=c1.resolveDeep(i,n),n1=c1._getResourcePath(k,m1,i,n);k1=D.createSortParams(Z);if(k1){a1.push(k1);}g1=c1.oMetadata._getEntityTypeByPath(n1);h1=F.groupFilters(T);i1=D.createFilterParams(h1,c1.oMetadata,g1);if(i1){a1.push(i1);}l1=c1._createRequestUrlWithNormalizedPath(n1,a1,c1.bUseBatch);Y=c1._createRequest(l1,m1,X,W,null,S,undefined,_);j1=c1.mRequests;if(V in c1.mDeferredGroups){j1=c1.mDeferredRequests;}c1._pushToRequestQueue(j1,V,null,Y,$,R,f1,false);return Y;}if(this.bUseBatch&&this.bIncludeInCurrentBatch){Y=e1(d1);return d1;}else{return this._processRequest(e1,R);}};P.prototype.getServiceMetadata=function(){if(this.oMetadata&&this.oMetadata.isLoaded()){return this.oMetadata.getServiceMetadata();}};P.prototype.metadataLoaded=function(R){var i=this.oMetadata.loaded(R);if(this.bLoadAnnotationsJoined){if(R){return Promise.all([i,this.pAnnotationsLoaded]);}var j=function(){return i;};return this.pAnnotationsLoaded.then(j,j);}else{return i;}};P.prototype.annotationsLoaded=function(){return this.pAnnotationsLoaded;};P.prototype.isMetadataLoadingFailed=function(){return this.oMetadata.isFailed();};P.prototype.getServiceAnnotations=function(){var i=this.oAnnotations.getData();return m(i)?null:i;};P.prototype.onAnnotationsFailed=function(i){this.fireAnnotationsFailed(i.getParameters());};P.prototype.onAnnotationsLoaded=function(i){this.fireAnnotationsLoaded(i.getParameters());};P.prototype.addAnnotationUrl=function(i){var j=[].concat(i),k=[],n=[],R=[],S=this;j.forEach(function(T){var V=T.indexOf("$metadata");if(V>=0){T=S._createMetadataUrl(T);k.push(T);}else{n.push(T);}});return this.oMetadata._addUrl(k).then(function(T){return Promise.all(T.map(function(V){R=R.concat(V.entitySets);return S.oAnnotations.addSource({type:"xml",data:V["metadataString"]});}));}).then(function(){return S.oAnnotations.addSource(n);}).then(function(T){return{annotations:S.oAnnotations.getData(),entitySets:R};});};P.prototype.addAnnotationXML=function(X,S){return this.oAnnotations.addSource({type:"xml",data:X});};P.prototype.submitChanges=function(j){var R,k,n,S,T,V,W,X=false,Y,Z,$=this.bRefreshAfterChange,_,a1=this;if(j){k=j.groupId||j.batchGroupId;S=j.success;T=j.error;if(j.merge!==undefined){Y=j.merge?"MERGE":"PUT";}}if(k&&!this.mDeferredGroups[k]){L.fatal(this+" submitChanges: \""+k+"\" is not a deferred group!");}Z=p({},a1.mChangedEntities);this.oMetadata.loaded().then(function(){h(Z,function(g1,h1){n=a1._resolveGroup(g1);if(n.groupId===k||!k){R=a1._processChange(g1,h1,Y||a1.sDefaultUpdateMethod);R.key=g1;_=h1.__metadata&&h1.__metadata.created?h1.__metadata.created:{};var V={abort:function(){R._aborted=true;}};if(n.groupId in a1.mDeferredGroups){a1._pushToRequestQueue(a1.mDeferredRequests,n.groupId,n.changeSetId,R,_.success,_.error,V,$);}}});var b1,c1,d1,e1,f1,i;for(b1 in a1.mDeferredRequests){d1=a1.mDeferredRequests[b1];for(c1 in d1.changes){e1=d1.changes[c1];for(i=e1.length-1;i>=0;i--){f1=e1[i];if(f1.bRefreshAfterChange===undefined){f1.bRefreshAfterChange=$;}}}}W=a1._processRequestQueue(a1.mDeferredRequests,k,S,T);if(X){V.abort();}if(Array.isArray(W)&&W.length==0&&S){S({},undefined);}});V={abort:function(){if(W){if(Array.isArray(W)){W.forEach(function(V){V.abort();});}else{W.abort();}}else{X=true;}}};return V;};P.prototype._updateChangedEntities=function(i){var j=this,R,k,n;function S(T,V,W){h(V,function(X){var Y=W+'/'+X;if(o(V[X])&&o(T[X])){S(T[X],V[X],Y);if(m(V[X])){delete V[X];}}else if(W.endsWith("__metadata")||f(V[X],T[X])&&!j.isLaundering(Y)){delete V[X];if(W===R){k=j.oMetadata._getEntityTypeByPath(R);n=k&&j.oMetadata._getNavPropertyRefInfo(k,X);if(n&&V[n.name]){T[n.name]=V[n.name];delete V[n.name];}}}});}h(i,function(T,V){if(T in j.mChangedEntities){var W=j._getObject('/'+T,null,true);var X=j._getObject('/'+T);p(W,V);R='/'+T;var Y=j.removeInternalMetadata(X).deepPath;S(W,X,R);if(m(X)){delete j.mChangedEntities[T];j.abortInternalRequest(j._resolveGroup(T).groupId,{requestKey:T});}else{j.mChangedEntities[T]=X;X.__metadata={deepPath:Y};l(X.__metadata,W.__metadata);}}});};P.prototype.resetChanges=function(j,k){var n=this,R,S={},T,V;if(k){if(j){j.forEach(function(i){n.oMetadata.loaded().then(function(){h(n.mDeferredGroups,function(W){n.abortInternalRequest(W,{path:i.substring(1)});});});});}else{this.oMetadata.loaded().then(function(){h(n.mDeferredGroups,function(i){n.abortInternalRequest(i);});});}}if(j){h(j,function(W,X){n.getEntityByPath(X,null,S);if(S&&S.propertyPath!==undefined){R=S.propertyPath.split("/");var Y=S.key;T=n.mChangedEntities[Y];for(var i=0;i<R.length-1;i++){if(T.hasOwnProperty(R[i])){T=T[R[i]];}else{T=undefined;}}if(T){delete T[R[R.length-1]];}if(n.mChangedEntities[Y]){V=n.mChangedEntities[Y].__metadata;delete n.mChangedEntities[Y].__metadata;if(m(n.mChangedEntities[Y])||!S.propertyPath){n.oMetadata.loaded().then(function(){n.abortInternalRequest(n._resolveGroup(Y).groupId,{requestKey:Y});});delete n.mChangedEntities[Y];sap.ui.getCore().getMessageManager().removeMessages(n.getMessagesByEntity(Y,true));}else{n.mChangedEntities[Y].__metadata=V;}}else{L.warning(n+" - resetChanges: "+X+" is not changed");}}});}else{h(this.mChangedEntities,function(i,W){n.oMetadata.loaded().then(function(){n.abortInternalRequest(n._resolveGroup(i).groupId,{requestKey:i});});delete n.mChangedEntities[i];sap.ui.getCore().getMessageManager().removeMessages(n.getMessagesByEntity(i,true));});}this.checkUpdate(true);return this.oMetadata.loaded();};P.prototype.setProperty=function(j,V,k,n){var R,S,T,W,X,Y,Z,$,_,a1,b1,c1,d1={},e1={},f1,g1,h1,i1=false,j1=this,k1,l1,m1,n1,o1,p1,q1;function r1(t1,u1){h(u1,function(_){if(o(u1[_])&&o(t1[_])){r1(t1[_],u1[_]);if(m(u1[_])){delete u1[_];}}else if(f(u1[_],t1[_])){delete u1[_];}});}Z=this.resolve(j,k);q1=this.resolveDeep(j,k);Y=this.getEntityByPath(Z,null,e1);if(!Y){return false;}S=Z.substring(Z.lastIndexOf("/")+1);_=e1.key;X=this._getObject('/'+_,null,true);R=this._getObject(j,k,true);if(!this.mChangedEntities[_]){c1=Y.__metadata;Y={};Y.__metadata=Object.assign({},c1);if(e1.propertyPath.length>0){var s1=q1.lastIndexOf(e1.propertyPath);Y.__metadata.deepPath=q1.substring(0,s1-1);}this.mChangedEntities[_]=Y;}g1=this.mChangedEntities[_];$=e1.propertyPath.split("/");for(var i=0;i<$.length-1;i++){if(!g1.hasOwnProperty($[i])){g1[$[i]]={};}g1=g1[$[i]];}i1=X.__metadata.created&&X.__metadata.created.functionImport;g1[S]=V;l1=this.oMetadata._getEntityTypeByPath(e1.key);m1=l1&&this.oMetadata._getNavPropertyRefInfo(l1,S);n1=m1&&X[m1.name]&&X[m1.name].__ref;if(n1&&m1.keys.length===1){if(V===null){p1=null;}else{o1={};m1.keys.forEach(function(t1){o1[t1]=Y[t1]!==undefined?Y[t1]:X[t1];});o1[m1.keys[0]]=V;p1=this.createKey(m1.entitySet,o1);}g1[m1.name]={__ref:p1};}if(f(V,R)&&!this.isLaundering('/'+_)&&!i1){c1=this.mChangedEntities[_].__metadata;k1=c1&&c1.created;delete this.mChangedEntities[_].__metadata;if(!k1){r1(X,this.mChangedEntities[_]);}if(m(this.mChangedEntities[_])){delete this.mChangedEntities[_];d1[_]=true;this.checkUpdate(false,n,d1);j1.oMetadata.loaded().then(function(){j1.abortInternalRequest(j1._resolveGroup(_).groupId,{requestKey:_});});return true;}this.mChangedEntities[_].__metadata=c1;}a1=this._resolveGroup(_);T=this.mRequests;if(a1.groupId in this.mDeferredGroups){T=this.mDeferredRequests;W=this._processChange(_,{__metadata:Y.__metadata},this.sDefaultUpdateMethod);}else{W=this._processChange(_,this._getObject('/'+_),this.sDefaultUpdateMethod);}W.key=_;f1=g1.__metadata&&g1.__metadata.created?g1.__metadata.created:{};h1=this._getRefreshAfterChange(undefined,a1.groupId);this.oMetadata.loaded().then(function(){b1={abort:function(){W._aborted=true;}};j1._pushToRequestQueue(T,a1.groupId,a1.changeSetId,W,f1.success,f1.error,b1,h1);j1._processRequestQueueAsync(j1.mRequests);});d1[_]=true;this.checkUpdate(false,n,d1);return true;};P.prototype._isHeaderPrivate=function(i){switch(i.toLowerCase()){case"accept":case"accept-language":case"maxdataserviceversion":case"dataserviceversion":return true;case"x-csrf-token":return this.bTokenHandling;case"sap-contextid-accept":case"sap-contextid":return!this.bDisableSoftStateHeader;default:return false;}};P.prototype.setHeaders=function(i){var j={},k=this;this.mCustomHeaders={};if(i){h(i,function(n,R){if(k._isHeaderPrivate(n)){L.warning(this+" - modifying private header: '"+n+"' not allowed!");}else{j[n]=R;}});this.mCustomHeaders=j;}if(this.oAnnotations){this.oAnnotations.setHeaders(this.mCustomHeaders);}};P.prototype._getHeaders=function(i,j){var k={},n=this;if(i){h(i,function(R,S){if(n._isHeaderPrivate(R)){L.warning(this+" - modifying private header: '"+R+"' not allowed!");}else{k[R]=S;}});}return l({'sap-cancel-on-close':!!j},this.mCustomHeaders,k,this.oHeaders);};P.prototype.getHeaders=function(){return l({},this.mCustomHeaders,this.oHeaders);};P.prototype._getHeader=function(i,j){var k;for(k in j){if(k.toLowerCase()===i.toLowerCase()){return j[k];}}return null;};P.prototype.hasPendingChanges=function(i){var j=!m(this.mChangedEntities);if(i){j=j||this.iPendingDeferredRequests>0;}return j;};P.prototype.hasPendingRequests=function(){return this.aPendingRequestHandles.length>0;};P.prototype.getPendingChanges=function(){return p({},this.mChangedEntities);};P.prototype.updateBindings=function(i){this.checkUpdate(i);};P.prototype.setTokenHandlingEnabled=function(T){this.bTokenHandling=T;};P.prototype.setUseBatch=function(i){this.bUseBatch=i;};P.prototype.formatValue=function(V,T){return D.formatValue(V,T);};P.prototype.deleteCreatedEntry=function(i){var j=this,k,n;if(i){var k=i.getPath().substr(1);n=this._resolveGroup(k).groupId;j.oMetadata.loaded().then(function(){j.abortInternalRequest(n,{requestKey:k});});j._removeEntity(k);sap.ui.getCore().getMessageManager().removeMessages(this.getMessagesByEntity(i.getPath(),true));}};P.prototype.createEntry=function(j,k){var n,R,S,T,V,W,X,Y,Z,$,_,a1,b1,c1,d1,e1,f1,g1,h1,i1,j1={},k1="POST",l1=this;if(k){b1=k.properties;Z=k.groupId||k.batchGroupId;R=k.changeSetId;S=k.context;f1=k.success;W=k.error;T=k.created;X=k.eTag;$=k.headers;i1=k.urlParameters;c1=k.refreshAfterChange;n=k.canonicalRequest;Y=k.expand;}if(Y&&!this.bUseBatch){throw new Error("The 'expand' parameter is only supported if batch mode is used");}n=this._isCanonicalRequestNeeded(n);$=$||{};c1=this._getRefreshAfterChange(c1,Z);Z=Z?Z:this.sDefaultChangeGroup;h1=D._createUrlParamsArray(i1);var m1={abort:function(){if(d1){d1._aborted=true;if(d1.expandRequest){d1.expandRequest._aborted=true;}}}};if(!j.startsWith("/")&&!S){j="/"+j;}a1=l1._normalizePath(j,S,n);V=l1.resolveDeep(j,S);function n1(){var o1,p1,q1,r1,s1,t1,u1=false,v1=W,w1=f1;var x1=l1.oMetadata._getEntityTypeByPath(a1);if(!x1){d(x1,"No Metadata for collection "+a1+" found");return undefined;}if(typeof b1==="object"&&!Array.isArray(b1)){j1=p({},b1);}else{for(var i=0;i<x1.property.length;i++){var y1=x1.property[i];var z1=(b1?b1.indexOf(y1.name):-1)>-1;if(!b1||z1){j1[y1.name]=l1._createPropertyValue(y1.type);if(z1){b1.splice(b1.indexOf(y1.name),1);}}}if(b1){d(b1.length===0,"No metadata for the following properties found: "+b1.join(","));}}r1=l1.oMetadata._getEntitySetByType(x1);t1=u();_=r1.name+"('"+t1+"')";if(V&&l1.oMetadata._isCollection(V)){V=V+"('"+t1+"')";}if(Y){$=Object.assign({},$,{"Content-ID":t1,"sap-messages":"transientOnly"});f1=function(A1,B1){if(!o1){o1=A1;q1=B1;return;}if(w1){A1=Object.assign({},o1,A1);w1(A1,q1);}};W=function(A1){if(o1){q1.expandAfterCreateFailed=true;A1.expandAfterCreateFailed=true;L.error("Entity creation was successful but expansion of navigation"+" properties failed",A1,J);if(w1){w1(o1,q1);}return;}if(!u1){u1=true;if(v1){v1(A1);}}else{A1.expandAfterCreateFailed=true;u1=false;}};}j1.__metadata={type:""+x1.entityType,uri:l1.sServiceUrl+'/'+_,created:{key:a1.substring(1),success:f1,error:W,headers:$,urlParameters:i1,groupId:Z,changeSetId:R,eTag:X},deepPath:V};_=l1._addEntity(p({},j1));l1.mChangedEntities[_]=j1;g1=l1._createRequestUrlWithNormalizedPath(a1,h1,l1.bUseBatch);d1=l1._createRequest(g1,V,k1,$,j1,X);if(Y){s1=l1._createRequest("$"+t1+"?"+D._encodeURLParameters({$expand:Y,$select:Y}),"/$"+t1,"GET",l1._getHeaders(undefined,true),null,undefined,undefined,true);s1.contentID=t1;d1.expandRequest=s1;d1.contentID=t1;j1.__metadata.created.expandRequest=s1;j1.__metadata.created.contentID=t1;}p1=l1.getContext("/"+_,V);p1.bCreated=true;d1.key=_;d1.created=true;e1=l1.mRequests;if(Z in l1.mDeferredGroups){e1=l1.mDeferredRequests;}l1.oMetadata.loaded().then(function(){l1._pushToRequestQueue(e1,Z,R,d1,f1,W,m1,c1);l1._processRequestQueueAsync(l1.mRequests);});return p1;}if(T){this.oMetadata.loaded().then(function(){T(n1());});}else if(this.oMetadata.isLoaded()){return n1();}else{L.error("Tried to use createEntry without created-callback, before metadata is available!");}};P.prototype._isCreatedEntity=function(i){return!!(i&&i.__metadata&&i.__metadata.created);};P.prototype._createPropertyValue=function(T){var j=this.oMetadata._splitName(T);var n=j.namespace;var k=j.name;if(n.toUpperCase()!=='EDM'){var R={};var S=this.oMetadata._getObjectMetadata("complexType",k,n);d(S,"Complex type "+T+" not found in the metadata !");for(var i=0;i<S.property.length;i++){var V=S.property[i];R[V.name]=this._createPropertyValue(V.type);}return R;}else{return this._getDefaultPropertyValue(k,n);}};P.prototype._getDefaultPropertyValue=function(T,n){return undefined;};P.prototype._normalizePath=function(i,j,k){if(i&&i.indexOf('?')!==-1){i=i.substr(0,i.indexOf('?'));}if(!j&&!i.startsWith("/")){L.fatal(this+" path "+i+" must be absolute if no Context is set");}return this.resolve(i,j,k)||this.resolve(i,j);};P.prototype.getRefreshAfterChange=function(){return this.bRefreshAfterChange;};P.prototype.setRefreshAfterChange=function(R){this.bRefreshAfterChange=R;};P.prototype.isList=function(i,j){i=this.resolve(i,j);return i&&i.substr(i.lastIndexOf("/")).indexOf("(")===-1;};P.prototype._isMetadataPath=function(i){var j=false;if(i&&i.indexOf('/#')>-1){j=true;}return j;};P.prototype.isMetaModelPath=function(i){return i.indexOf("##")==0||i.indexOf("/##")>-1;};P.prototype._request=function(R,S,i,j,k,n){var T;if(this.bDestroyed){return{abort:function(){}};}var V=this;function W(X){return function(){if(V.aPendingRequestHandles){var Y=V.aPendingRequestHandles.indexOf(T);if(Y>-1){V.aPendingRequestHandles.splice(Y,1);}}if(!(T&&T.bSuppressErrorHandlerCall)){X.apply(this,arguments);}};}T=H.request(R,W(S||H.defaultSuccess),W(i||H.defaultError),j,k,n);if(R.async!==false){this.aPendingRequestHandles.push(T);}return T;};P.prototype.destroy=function(){this.bDestroyed=true;t.prototype.destroy.apply(this,arguments);if(this.aPendingRequestHandles){for(var i=this.aPendingRequestHandles.length-1;i>=0;i--){var R=this.aPendingRequestHandles[i];if(R&&R.abort){R.bSuppressErrorHandlerCall=true;R.abort();}}delete this.aPendingRequestHandles;}if(this.sMetadataLoadEvent){clearTimeout(this.sMetadataLoadEvent);}if(this.oMetadataFailedEvent){clearTimeout(this.oMetadataFailedEvent);}if(this.oMetadata){this.oMetadata.detachFailed(this.onMetadataFailed);if(!this.oMetadata.isLoaded()&&!this.oMetadata.hasListeners("loaded")){this.oMetadata.destroy();delete this.oSharedMetaData.oMetadata;}delete this.oMetadata;delete this.pMetadataLoaded;}if(this.oMetaModel){this.oMetaModel.destroy();delete this.oMetaModel;}if(this.oAnnotations){this.oAnnotations.detachSomeLoaded(this.onAnnotationsLoaded);this.oAnnotations.detachAllFailed(this.onAnnotationsFailed);this.oAnnotations.destroy();delete this.oAnnotations;delete this.pAnnotationsLoaded;}};P.prototype.setDeferredBatchGroups=function(i){this.setDeferredGroups(i);};P.prototype.setDeferredGroups=function(i){var j=this;this.mDeferredGroups={};h(i,function(k,n){j.mDeferredGroups[n]=n;});};P.prototype.getDeferredBatchGroups=function(){return this.getDeferredGroups();};P.prototype.getDeferredGroups=function(){return Object.keys(this.mDeferredGroups);};P.prototype.setChangeBatchGroups=function(i){h(i,function(j,k){k.groupId=k.batchGroupId;});this.setChangeGroups(i);};P.prototype.setChangeGroups=function(i){this.mChangeGroups=i;};P.prototype.getChangeBatchGroups=function(){return this.getChangeGroups();};P.prototype.getChangeGroups=function(){return this.mChangeGroups;};P.prototype.setMessageParser=function(i){if(!(i instanceof r)){L.error("Given MessageParser is not of type sap.ui.core.message.MessageParser");return this;}i.setProcessor(this);this.oMessageParser=i;return this;};P.prototype._parseResponse=function(R,i,j,k){try{if(!this.oMessageParser){this.oMessageParser=new z(this.sServiceUrl,this.oMetadata,!!this.bPersistTechnicalMessages);this.oMessageParser.setProcessor(this);}this.oMessageParser.parse(R,i,j,k,this.bIsMessageScopeSupported);}catch(n){L.error("Error parsing OData messages: "+n);}};P.prototype.callAfterUpdate=function(i){this.aCallAfterUpdate.push(i);};P.prototype.getMetaModel=function(){var i=this;if(!this.oMetaModel){this.oMetaModel=new y(this.oMetadata,this.oAnnotations,this);this.oMetaModel.loaded().then(function(){i.bMetaModelLoaded=true;i.checkUpdate(false,false,null,true);},function(j){var k=j.message,n;if(!k&&j.xmlDoc&&j.xmlDoc.parseError){k=j.xmlDoc.parseError.reason;n=j.xmlDoc.parseError.srcText;}L.error("error in ODataMetaModel.loaded(): "+k,n,J);});}return this.oMetaModel;};P.prototype.getOriginalProperty=function(i,j){return this._getObject(i,j,true);};P.prototype.getEntityByPath=function(i,j,k){var R=t.prototype.resolve.call(this,i,j);if(!R){return null;}var n=R.split("/"),S=null,T=[];while(n.length>0){var V=n.join("/"),W=this._getObject(V);if(o(W)){var X=this._getKey(W);if(X){S=W;break;}}T.unshift(n.pop());}if(S){k.propertyPath=T.join("/");k.key=X;return S;}return null;};P.prototype.resolveFromCache=function(i){if(!this.mPathCache){return undefined;}var S,j="",k,n,R;k=this.mPathCache[i]?this.mPathCache[i].canonicalPath:undefined;if(i&&k!==i){S=k||i;if(!k){R=S.lastIndexOf("/");j=S.substr(R);S=S.substr(0,R);}n=this.resolveFromCache(S);if(n&&n!==S){k=n+j;}}return k;};P.prototype.resolve=function(i,j,k){var R=t.prototype.resolve.call(this,i,j);if(R&&!this._isMetadataPath(R)&&k){var n=this.resolveFromCache(R);if(!n){n=this.oMetadata._calculateCanonicalPath(R);n=this.resolveFromCache(n)||n;}this._writePathCache(R,n);return n;}return R;};P.prototype.resolveDeep=function(i,j){var R=t.prototype.resolve.call(this,i,j);if(i&&!i.startsWith("/")){R=j?j.sDeepPath+'/'+i:R;}if(i===""){R=j?j.sDeepPath:R;}return R;};P.prototype.isLaundering=function(i,j){var R=this.resolve(i,j);return(R in this.mLaunderingState)&&this.mLaunderingState[R]>0;};P.prototype.increaseLaundering=function(i,j){if(!o(j)){return;}for(var n in j){if(n==="__metadata"){continue;}var k=j[n];if(o(k)){this.increaseLaundering(i+"/"+n,k);}else{var T=i+"/"+n;if(!(T in this.mLaunderingState)){this.mLaunderingState[T]=0;}this.mLaunderingState[T]++;}}if(!(i in this.mLaunderingState)){this.mLaunderingState[i]=0;}this.mLaunderingState[i]++;};P.prototype.decreaseLaundering=function(i,j){if(!o(j)){return;}for(var n in j){if(n==="__metadata"){continue;}var k=j[n],T=i+"/"+n;if(o(k)){this.decreaseLaundering(T,k);}else{if(T in this.mLaunderingState){this.mLaunderingState[T]--;if(this.mLaunderingState[T]===0){delete this.mLaunderingState[T];}}}}this.mLaunderingState[i]--;if(this.mLaunderingState[i]===0){delete this.mLaunderingState[i];}};P.prototype._getRefreshAfterChange=function(R,i){if(R===undefined&&!(i in this.mDeferredGroups)){return this.bRefreshAfterChange;}return R;};P.prototype.getMessagesByEntity=function(j,k){var n=j,R=[],S;function T(R){var V=[];for(var i=0;i<R.length;i++){if(!k||(k&&!R[i].persistent)){V.push(R[i]);}}return V;}if(!n.startsWith('/')){n='/'+n;}if(this.mMessages){for(S in this.mMessages){if(typeof n=="string"&&n.length>0&&S.startsWith(n)){R=R.concat(T(this.mMessages[S]));}}return R;}return null;};P.prototype._cacheSupported=function(i){var j=/\/~[\w\-]+~[A-Z0-9]?/;var k=[i];if(this.sAnnotationURI){if(!Array.isArray(this.sAnnotationURI)){this.sAnnotationURI=[this.sAnnotationURI];}k=k.concat(this.sAnnotationURI);}k=k.filter(function(n){return n.indexOf("sap-context-token")===-1;});k=k.filter(function(n){return!j.test(n);});return k.length===0?true:false;};P.prototype._getAnnotationCacheKey=function(i){var j;if(this.bUseCache){if(!this.bSkipMetadataAnnotationParsing){j=i+"#annotations";}if(this.sAnnotationURI){if(!Array.isArray(this.sAnnotationURI)){this.sAnnotationURI=[this.sAnnotationURI];}this.sAnnotationURI=this.sAnnotationURI.map(function(k){return k+"#annotations";});j=this.bSkipMetadataAnnotationParsing?this.sAnnotationURI.join("_"):j+"_"+this.sAnnotationURI.join("_");}}return j;};P.prototype.canonicalRequestsEnabled=function(){return this.bCanonicalRequests;};P.prototype._decreaseDeferredRequestCount=function(R){if(R.deferred){this.iPendingDeferredRequests--;}};P.prototype.enableCanonicalRequests=function(i){this.bCanonicalRequests=!!i;};P.prototype.getMessageScope=function(){return this.sMessageScope;};P.prototype.setMessageScope=function(i){if(i!==w.RequestedObjects&&i!==w.BusinessObject){throw new Error("Unsupported message scope: "+i);}this.sMessageScope=i;};P.prototype.messageScopeSupported=function(){var i=this;return this.metadataLoaded().then(function(){return i.bIsMessageScopeSupported;});};P.prototype.getContext=function(i,j){var k=this.mContexts[i];if(!k){k=this.mContexts[i]=new C(this,i,j);}else{k.setDeepPath(j||k.getDeepPath()||i);}return k;};P.prototype.hasContext=function(i){return this.mContexts[i];};P.prototype.removeInternalMetadata=function(i){var j,k,n,R,V;if(i&&i.__metadata){j=i.__metadata.created;k=i.__metadata.deepPath;n=i.__metadata.invalid;delete i.__metadata.created;delete i.__metadata.deepPath;delete i.__metadata.invalid;}for(R in i){V=i[R];if(Array.isArray(V)){V.forEach(P.prototype.removeInternalMetadata);}else if(typeof V==="object"){P.prototype.removeInternalMetadata(V);}}return{created:j,deepPath:k,invalid:n};};P.prototype._isCanonicalRequestNeeded=function(i){if(i!==undefined){return!!i;}else{return!!this.bCanonicalRequests;}};P.prototype.filterMatchingMessages=function(i,j){var k=this;return this.mMessages[i].filter(function(n){return k.isMessageMatching(n,j);});};P.prototype.isMessageMatching=function(i,j){var k=j.length;return i.aFullTargets.some(function(n){return n===j||n.startsWith(j)&&(j==="/"||n[k]==="/"||n[k]==="(");});};P.prototype.getMessages=function(i){return this.getMessagesByPath(i.sDeepPath,true).sort(M.compare);};P.prototype.getDeepPathForCanonicalPath=function(j){var k,R,S,T,V,i,n,W=j.slice(j.indexOf("("));V=this.aBindings.filter(function(X){return(X instanceof a||X instanceof b)&&X.isResolved();});for(i=0,n=V.length;i<n;i+=1){k=V[i];S=this.resolveDeep(k instanceof b?k.sPath+W:k.sPath,k.oContext);R=this.resolveFromCache(S);if(R===j){if(T&&T!==S){return undefined;}T=S;}}return T;};P.prototype.getPersistTechnicalMessages=function(){return this.bPersistTechnicalMessages;};P.prototype.setPersistTechnicalMessages=function(i){i=!!i;if(this.bPersistTechnicalMessages===i){return;}if(this.bPersistTechnicalMessages!==undefined){L.warning("The flag whether technical messages should always be treated as persistent"+" has been overwritten to "+i,undefined,J);}this.bPersistTechnicalMessages=i;if(this.oMessageParser){this.oMessageParser._setPersistTechnicalMessages(i);}};P.prototype.createCodeListModelParameters=function(i){i=i||{};return{defaultCountMode:v.None,disableSoftStateHeader:true,headers:i.headers&&Object.assign({},i.headers),json:i.json,metadataUrlParams:i.metadataUrlParams&&Object.assign({},i.metadataUrlParams),persistTechnicalMessages:i.persistTechnicalMessages,serviceUrl:this.sServiceUrl,serviceUrlParams:i.serviceUrlParams&&Object.assign({},i.serviceUrlParams),tokenHandling:false,useBatch:false,warmupUrl:i.warmupUrl};};P.prototype.getCodeListModelParameters=function(){return this.mCodeListModelParams;};P.prototype.getMetadataUrl=function(){return this.sMetadataUrl;};return P;});
