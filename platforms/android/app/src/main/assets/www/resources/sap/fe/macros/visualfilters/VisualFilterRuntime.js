/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2021 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/mdc/condition/Condition","sap/base/Log","sap/ui/mdc/util/FilterUtil","sap/ui/mdc/util/DateUtil","sap/fe/macros/CommonHelper","sap/fe/core/templating/FilterHelper","sap/fe/macros/visualfilters/VisualFilterUtils"],function(C,L,M,D,a,F,V){"use strict";var b={selectionChanged:function(e){var i=e.getSource(),o=i.data("outParameter"),d=i.data("dimension"),s=i.data("dimensionText"),m=i.data("multipleSelectionAllowed"),c=i.data("dimensionType"),S=e.getParameter("bar")||e.getParameter("point")||e.getParameter("segment"),I=e.getParameter("selected"),f=i.getModel("$field"),g=f.getProperty("/conditions");if(!o||o!==d){L.error("VisualFilter: Cannot sync values with regular filter as out parameter is not configured properly!");}else{var h=S.getBindingContext().getObject(o);if(h){var j=S.getBindingContext().getObject(s);if(I){if(m==="false"){g=[];}if(c==="Edm.DateTimeOffset"){h=V._parseDateTime(h);}var k=C.createItemCondition(h,j||undefined);g.push(k);}else{g=g.filter(function(k){if(c==="Edm.DateTimeOffset"){return(k.operator!=="EQ"||Date.parse(k.values[0])!==Date.parse(h));}return k.operator!=="EQ"||k.values[0]!==h;});}f.setProperty("/conditions",g);}else{L.error("VisualFilter: No vaue found for the outParameter");}}},getAggregationSelected:function(c){var s=[];for(var i=0;i<=c.length-1;i++){var o=c[i];if(o.operator==="EQ"){s.push(o.values[0]);}}var I=this.getParent(),d=I.data("dimension"),e=I.data("dimensionType"),f=this.getBindingContext().getObject(d);if(e==="Edm.DateTimeOffset"){f=V._parseDateTime(f);}return s.indexOf(f)>-1;},getFiltersFromConditions:function(){var I=this.getParent(),f=I.getParent().getParent().getParent().getParent(),c=I.data("inParameters").customData,p=f.getPropertyInfoSet(),A=[].slice.call(arguments),m={},v=[],o,s=a.parseCustomData(I.data("selectionVariantAnnotation")),d=I.getBinding("bars")||I.getBinding("points")||I.getBinding("segments"),e=I.getModel().getMetaModel(),g=e.getObject(d.getPath()+"/");var h=F.getFiltersConditionsFromSelectionVariant(g,s,V.getCustomConditions.bind(V));var S=V.convertFilterCondions(h);Object.keys(S).forEach(function(K){m[K]=S[K];for(var i=0;i<p.length;i++){v.push({name:K,typeConfig:p[i].typeConfig});}});c.forEach(function(t,u){if(A[u].length>0){m[t.valueListProperty]=A[u];for(var i=0;i<p.length;i++){v.push({name:t.valueListProperty,typeConfig:p[i].typeConfig});}}});var j=I.getBindingContext("internal");var k=I.getId().split("fe::VisualFilter");var l="fe::VisualFilter"+k[1];var r=sap.ui.getCore().getLibraryResourceBundle("sap.fe.macros");var R=a.parseCustomData(I.data("requiredProperties"));if(R.length){var n=Object.keys(m)||[];var N=[];R.forEach(function(P){if(n.indexOf(P)===-1){N.push(P);}});if(!N.length){j.setProperty(l,{"VFOverLayMessage":"","showOverLayForVF":false});}else if(N.length>1){j.setProperty(l,{"VFOverLayMessage":r.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_MULTIPLEVF"),"showOverLayForVF":true});return;}else{var e=I.getModel().getMetaModel();var E=d.getPath();var q=e.getObject(E+"/"+N[0]+"@com.sap.vocabularies.Common.v1.Label")||N[0];j.setProperty(l,{"VFOverLayMessage":r.getText("M_VISUAL_FILTERS_PROVIDE_FILTER_VAL_SINGLEVF",q),"showOverLayForVF":true});return;}}else{j.setProperty(l,{"VFOverLayMessage":"","showOverLayForVF":false});}if(Object.keys(m).length>0&&v.length){o=M.getFilterInfo(f,m,v).filters;d.filter(o);}else if(!Object.keys(m).length){d.filter();}if(d.isSuspended()){d.resume();}return o;}};return b;},true);
