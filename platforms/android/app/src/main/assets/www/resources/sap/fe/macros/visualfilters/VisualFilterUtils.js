/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2021 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/fe/core/templating/FilterHelper","sap/ui/core/format/NumberFormat","sap/ui/mdc/condition/Condition","sap/base/Log"],function(F,N,C,L){"use strict";var v={applyMedianScaleToChartData:function(V,o,s){var a;var d=[];var m=V.data("measure");var I=o.getBindingContext("internal");a=(V.getPoints&&V.getPoints())||(V.getBars&&V.getBars())||(V.getSegments&&V.getSegments());for(var i=0;i<a.length;i++){d.push(a[i].getBindingContext().getObject());}var b=this._getMedianScaleFactor(d,m);if(b&&b.iShortRefNumber&&b.scale){I.setProperty("scalefactor/"+s,b.scale);I.setProperty("scalefactorNumber/"+s,b.iShortRefNumber);}else{I.setProperty("scalefactor/"+s,"");I.setProperty("scalefactorNumber/"+s,"");var S=o.byId(s+"::ScaleUoMTitle");var M=o.byId(s+"::MeasureDimensionTitle");var t=S.getText();if(t===" | "){S.setVisible(false);M.setTooltip(M.getText());}}},_getMedianScaleFactor:function(d,m){d.sort(function(a,b){if(Number(a[m])<Number(b[m])){return-1;}if(Number(a[m])>Number(b[m])){return 1;}return 0;});if(d.length>0){var M=d.length/2,c=M%1===0?(parseFloat(d[M-1][m])+parseFloat(d[M][m]))/2:parseFloat(d[Math.floor(M)][m]),e=c,s;for(var i=0;i<14;i++){s=Math.pow(10,i);if(Math.round(Math.abs(e)/s)<10){break;}}}var f=N.getIntegerInstance({style:"short",showScale:false,shortRefNumber:s});for(var i=0;i<d.length;i++){var D=d[i],S=f.format(D[m]),g=S.split(".");if((!g[1]&&parseInt(g[0],10)===0)||(g[1]&&parseInt(g[0],10)===0&&g[1].indexOf("0")===0)||S/1000>=1000){s=undefined;break;}}return{iShortRefNumber:s,scale:s?f.getScale():""};},getFormattedNumber:function(a,s){a=typeof a==="string"?Number(a.replace(/,/g,"")):a;var f=N.getFloatInstance({style:"short",showScale:false,shortRefNumber:s});return f.format(parseFloat(a));},getVisualFilterControl:function(f,s){var V=f._oFilterBarLayout.getFilterFields(),b;for(var i=0;i<=V.length;i++){var o=V[i].getContent()[0].getContent().getItems()[1].getItems()[0];b=o.getBinding("points")||o.getBinding("bars")||o.getBinding("segments");if(s===b){return o;}}return undefined;},applyUOMToTitle:function(V,c,o){var i=V.getId().split("fe::VisualFilter");var u=V.data("uom"),U;if(u&&u["ISOCurrency"]){U=u["ISOCurrency"];}else if(u&&u["Unit"]){U=u["Unit"];}if(U){var s=U.$Path?c[U.$Path]:U;var a="fe::VisualFilter"+i[1];var I=o.getBindingContext("internal");I.setProperty("uom/"+a,s);}},updateChartScaleFactorTitle:function(V,o){var i=V.getId().split("fe::VisualFilter");var s="fe::VisualFilter"+i[1];if(!V.data("scalefactor")){this.applyMedianScaleToChartData(V,o,s);}else{var f=N.getIntegerInstance({style:"short",showScale:false,shortRefNumber:V.data("scalefactor")});var I=o.getBindingContext("internal");I.setProperty("scalefactor/"+s,f.getScale());}},applyOverLay:function(i,c,V){var I=V.getBindingContext("internal");I.setProperty(c,{});I.setProperty(c,{"VFOverLayMessage":i,"showOverLayForVF":true});},checkMulitUnit:function(c,u){var d=[];if(c&&u){for(var i=0;i<c.length;i++){var a=c[i]&&c[i].getObject();d.push(a[u]);}}return!!d.reduce(function(b,k){return b===k?b:NaN;});},setMultiUOMMessage:function(d,V,c,r,o){var u=V.data("uom");var i=u&&u["ISOCurrency"]&&u["ISOCurrency"].$Path;var I=u&&u["Unit"]&&u["Unit"].$Path;var U=i||I;var s;if(U){if(!this.checkMulitUnit(d,U)){if(i){s=r.getText("M_VISUAL_FILTERS_MULTIPLE_CURRENCY",U);this.applyOverLay(s,c,o);L.warning("Filter is set for multiple Currency for"+U);}else if(I){s=r.getText("M_VISUAL_FILTERS_MULTIPLE_UNIT",U);this.applyOverLay(s,c,o);L.warning("Filter is set for multiple UOMs for"+U);}}}},setNoDataMessage:function(c,r,V){var s=r.getText("M_VISUAL_FILTER_NO_DATA_TEXT");this.applyOverLay(s,c,V);},convertFilterCondions:function(f){var c={};Object.keys(f).forEach(function(k){var a=[];var b=f[k];for(var i=0;i<b.length;i++){var d=b[i].value2?[b[i].value1,b[i].value2]:[b[i].value1];a.push(C.createCondition(b[i].operator,d,null,null,"Validated"));}if(a.length){c[k]=a;}});return c;},getCustomConditions:function(R,V,p){var a,b;if(V.$Type==="Edm.DateTimeOffset"){a=this._parseDateTime(F.getTypeCompliantValue(this._formatDateTime(R.Low),V.$Type));b=R.High?this._parseDateTime(F.getTypeCompliantValue(this._formatDateTime(R.High),V.$Type)):null;}else{a=R.Low;b=R.High?R.High:null;}return{operator:R.Option?F.getOperator(R.Option.$EnumMember||R.Option):null,value1:a,value2:b,path:p};},_parseDateTime:function(V){return this._getDateTimeTypeInstance().parseValue(V,"string");},_formatDateTime:function(V){return this._getDateTimeTypeInstance().formatValue(V,"string");},_getDateTimeTypeInstance:function(){return new sap.ui.model.odata.type.DateTimeOffset({pattern:"yyyy-MM-ddTHH:mm:ssZ",calendarType:"Gregorian"},{V4:true});}};return v;});
