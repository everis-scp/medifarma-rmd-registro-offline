// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/core/Control","sap/ui/core/theming/Parameters","sap/ui/Device","sap/ui/dom/units/Rem","sap/ushell/ui/shell/ShellAppTitle","./ShellHeaderRenderer"],function(C,T,D,R){"use strict";var s="sapUshellShellShowSearchOverlay";var _=0;var a;var b="data:image/png;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";var c=sap.ui.require.toUrl("sap/ushell")+"/themes/base/img/sap_55x27.png";var S=C.extend("sap.ushell.ui.ShellHeader",{metadata:{properties:{logo:{type:"sap.ui.core.URI",defaultValue:""},showLogo:{type:"boolean",defaultValue:true},homeUri:{type:"sap.ui.core.URI",defaultValue:"#"},searchState:{type:"string",defaultValue:"COL"},ariaLabel:{type:"string",defaultValue:undefined},centralAreaElement:{type:"string",defaultValue:null},title:{type:"string",defaultValue:""}},aggregations:{headItems:{type:"sap.ushell.ui.shell.ShellHeadItem",multiple:true},headEndItems:{type:"sap.ushell.ui.shell.ShellHeadItem",multiple:true},search:{type:"sap.ui.core.Control",multiple:false},appTitle:{type:"sap.ushell.ui.shell.ShellAppTitle",multiple:false}},associations:{shellLayout:{type:"sap.ui.base.ManagedObject",multiple:false}},events:{searchSizeChanged:{}}}});S.prototype.getShellLayoutControl=function(){return sap.ui.getCore().byId(this.getShellLayout());};S.prototype.createUIArea=function(i){var h=window.document.getElementById("shell-hdrcntnt");var d=window.document.getElementById(i||"canvas");if(d&&!h){d.insertAdjacentHTML("beforebegin","<header id=\"shell-hdr\" class=\"sapContrastPlus sapUshellShellHead\">"+"</header>");if(!this.getVisible()){this.setVisible(false);}this.placeAt("shell-hdr");}};S.prototype.SearchState={COL:"COL",EXP:"EXP",EXP_S:"EXP_S"};S.prototype.init=function(){D.media.attachHandler(this.refreshLayout,this,D.media.RANGESETS.SAP_STANDARD);D.resize.attachHandler(this.refreshLayout,this);this.data("sap-ui-fastnavgroup","true",true);this._fnFocusListener=this._handleFocus.bind(this);};S.prototype.exit=function(){D.media.detachHandler(this.refreshLayout,this,D.media.RANGESETS.SAP_STANDARD);D.resize.detachHandler(this.refreshLayout,this);var o=window.document.getElementById("shell-hdr");if(o){o.parentElement.removeChild(o);}};S.prototype._toggleFocusListener=function(t){var A=window.document.getElementById("sapUshellHeaderAccessibilityHelper");if(A){A[t?"addEventListener":"removeEventListener"]("focus",this._fnFocusListener);}};S.prototype.setAccessKeyHandler=function(A){this._accessKeyHandler=A;};S.prototype._handleFocus=function(e){var t=this;function d(){if(t._accessKeyHandler.bForwardNavigation){var h=t.getHeadItems();if(h.length>0){h[0].focus();}else{t.getAppTitle().focus();}}else{var H=t.getHeadEndItems();if(H.length>0){H[H.length-1].focus();}else{t.getAppTitle().focus();}}t._accessKeyHandler.fromOutside=false;}if(this._accessKeyHandler){if(this._accessKeyHandler.fromOutside||this._accessKeyHandler.bForwardNavigation){d();}else{this._accessKeyHandler._handleEventUsingExternalKeysHandler(e);var A=window.document.getElementById("sapUshellHeaderAccessibilityHelper");if(window.document.activeElement===A){var f=window.document.querySelectorAll("#canvas [tabindex='0']");if(f.length){f[f.length-1].focus();}else{d();return;}}this._accessKeyHandler.bFocusOnShell=false;}}};S.prototype.onsapspace=function(e){if(e.target===this.getDomRef("logo")){window.location.href=e.target.href;}};S.prototype.onBeforeRendering=function(){this._toggleFocusListener(false);};S.prototype.onAfterRendering=function(){var h=this.getDomRef();if(!a&&h.parentElement.getBoundingClientRect().height>0){h.style.visibility="hidden";h.style.height="2.75rem";return;}this.refreshLayout();this._toggleFocusListener(true);};S.prototype.onThemeChanged=function(e){if(e.theme!==a){a=e.theme;this.invalidate();}};S.prototype.getLogo=function(){return this.getProperty("logo")||(sap.ui.getCore().isThemeApplied()?T._getThemeImage()||c:b);};S.prototype.refreshLayout=function(){if(!this.getDomRef()){return;}this._setAppTitleFontSize();if(this.getSearchVisible()){var o=this.getDomRef("hdr-search");o.style.display="none";this._hideElementsForSearch();o.style.display="";o.style["max-width"]=_+"rem";this.fireSearchSizeChanged({remSize:R.fromPx(o.getBoundingClientRect().width),isFullWidth:this.isPhoneState()});}};S.prototype._setAppTitleFontSize=function(){var A=window.document.getElementById("shellAppTitle");var t;var d="sapUshellHeadTitleWithSmallerFontSize";if(A&&A.style.display!=="none"){t=A.querySelector("h1");if(t){t.classList.remove(d);if(!this.isLSize()&&t.scrollWidth>t.clientWidth+1){t.classList.add(d);A.style.overflow="hidden";}else{A.style.overflow="visible";}}}};S.prototype.removeHeadItem=function(i){if(typeof i==="number"){i=this.getHeadItems()[i];}this.removeAggregation("headItems",i);};S.prototype.addHeadItem=function(i){this.addAggregation("headItems",i);};S.prototype.isPhoneState=function(){var d=D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD).name;var e=window.document.getElementById(this.getId()).getBoundingClientRect().width>_;return(D.system.phone||d==="Phone"||!e);};S.prototype.isLSize=function(){return D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD).name==="Desktop";};S.prototype.setSearchState=function(d,m,w){if(this.SearchState[d]&&this.getSearchState()!==d){if(typeof m==="boolean"){w=m;m=undefined;}this.setProperty("searchState",d,false);var e=(d!=="COL");var f=this.getShellLayoutControl();if(f){f.toggleStyleClass(s,e&&w);}_=e?m||35:0;}};S.prototype._hideElementsForSearch=function(){var n,o=this.getDomRef("hdr-search-container"),B=this.getDomRef("hdr-begin"),d=this.getDomRef("hdr-center"),e=this.getDomRef("hdr-end");if(this.getSearchState()==="EXP"||this.isPhoneState()){n=R.toPx(_+3);}else{n=R.toPx(9+0.5);}var E=[d,B,e];Array.prototype.forEach.call(B.childNodes,function(g){E.splice(1,0,g);});var f;for(var i=0;i<E.length-1;i++){f=E[i];if(f){if(n>o.getBoundingClientRect().width){f.style.display="none";B.style.flexBasis="auto";continue;}return;}}if(R.toPx(_)>o.getBoundingClientRect().width){e.style.display="none";}};S.prototype.getSearchWidth=function(){return _;};S.prototype.isHomepage=function(){return!!window.hasher&&"#"+window.hasher.getHash()===this.getHomeUri();};S.prototype.getSearchVisible=function(){return this.getSearchState()!==this.SearchState.COL;};S.prototype.getCentralControl=function(){return sap.ui.getCore().byId(this.getCentralAreaElement());};S.prototype.setNoLogo=function(){this.setLogo(b);};S.prototype._getLeanMode=function(){return(window.location.search||"").indexOf("appState=lean")>=0;};return S;},true);
