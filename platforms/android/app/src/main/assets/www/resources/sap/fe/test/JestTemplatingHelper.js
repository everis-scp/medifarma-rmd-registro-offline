/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/macros/internal/Field.metadata","sap/fe/macros/PhantomUtil","sap/ui/model/odata/v4/lib/_MetadataRequestor","sap/ui/model/odata/v4/ODataMetaModel","sap/ui/core/util/XMLPreprocessor","sap/base/Log","xpath","fs","@sap/cds-compiler","prettier","sap/ui/base/BindingParser","sap/ui/model/json/JSONModel","sap/ui/core/InvisibleText","sap/base/util/merge","path","sap/fe/core/converters/ConverterContext","sap/fe/core/services/SideEffectsServiceFactory"],function(F,P,_,O,X,L,x,f,c,p,B,J,I,m,a,C,S){"use strict";var b={};var d=p.format;var t=c.to;var g=c.compileSources;var h=c.compactModel;P.register(F);L.setLevel(1,"sap.ui.core.util.XMLPreprocessor");jest.setTimeout(40000);var n={"macros":"sap.fe.macros","macro":"sap.fe.macros","macrodata":"http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1","log":"http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1","unittest":"http://schemas.sap.com/sapui5/preprocessorextension/sap.fe.unittesting/1","control":"sap.fe.core.controls","core":"sap.ui.core","m":"sap.m","f":"sap.ui.layout.form","mdc":"sap.ui.mdc","mdcField":"sap.ui.mdc.field","u":"sap.ui.unified","macroMicroChart":"sap.fe.macros.microchart","microChart":"sap.suite.ui.microchart"};var s=x.useNamespaces(n);var r=function(e){P.register(e);};b.registerMacro=r;var i=function(e,E){return s(e,E);};expect.extend({toHaveControl:function(e,E){var G=i("/root".concat(E),e);return{message:function(){var H=k(e);return"did not find controls matching ".concat(E," in generated xml:\n ").concat(H);},pass:G&&G.length>=1};},toNotHaveControl:function(e,E){var G=i("/root".concat(E),e);return{message:function(){var H=k(e);return"There is a control matching ".concat(E," in generated xml:\n ").concat(H);},pass:G&&G.length===0};}});b.runXPathQuery=i;var j=function(e,E,G){var H="string(/root".concat(e,"/@").concat(E,")");return i(H,G);};b.getControlAttribute=j;var k=function(e){var E=new window.XMLSerializer();var G=E.serializeToString(e).replace(/(?:[\t ]*(?:\r?\n|\r))+/g,"\n").replace(/\\"/g,'"');return d(G,{parser:"html"});};b.serializeXML=k;var l=function(e){var E=f.readFileSync(e,"utf-8");var G=g({"string.cds":E},{});var H=h(G);var K=t.edmx(H,{service:"sap.fe.test.JestService"});var M=a.resolve(e,"..","gen");var N=a.resolve(M,a.basename(e).replace(".cds",".xml"));if(!f.existsSync(M)){f.mkdirSync(M);}f.writeFileSync(N,K);return N;};b.compileCDS=l;var o=function(M){try{var E={scopeObject:{},scopeType:"",settings:{}};return Promise.resolve(new S().createInstance(E).then(function(G){var H=G.getInterface();H.getContext=function(){return{scopeObject:{getModel:function(){return{getMetaModel:function(){return M;}};}}};};return H;}));}catch(e){return Promise.reject(e);}};b.getFakeSideEffectsService=o;var q=function(){var e=[];return{addIssue:function(E,G,H){e.push({issueCategory:E,issueSeverity:G,details:H});},getIssues:function(){return e;},checkIfIssueExists:function(E,G,H){return e.find(function(K){K.issueCategory===E&&K.issueSeverity===G&&K.details===H;});}};};b.getFakeDiagnostics=q;var u=function(e,E){var G=e.entitySets.find(function(K){return K.name===E.entitySet;});var H=y(G,G);return new C(e,E,q(),m,H);};b.getConverterContextForTest=u;var v={};var w=function(M){try{function E(){return v[M];};var R=_.create({},"4.0",{});var G=function(){if(!v[M]){var H=new O(R,M,undefined,null);return Promise.resolve(H.fetchEntityContainer()).then(function(){v[M]=H;});}}();return Promise.resolve(G&&G.then?G.then(E):E(G));}catch(e){return Promise.reject(e);}};b.getMetaModel=w;var y=function(e,E){var G={startingEntitySet:e,navigationProperties:[],targetObject:E,targetEntitySet:e,targetEntityType:e.entityType};G.contextLocation=G;return G;};b.getDataModelObjectPathForProperty=y;var z=function(e){var E=B.complexParser(e);for(var G=arguments.length,H=new Array(G>1?G-1:0),K=1;K<G;K++){H[K-1]=arguments[K];}return E.formatter.apply(undefined,H);};b.evaluateBinding=z;var A=function(e,E){var G=B.complexParser(e);var H=new J(E);var K=new I();K.bindProperty("text",G);K.setModel(H);K.setBindingContext(H.createBindingContext("/"));return K.getText();};b.evaluateBindingWithModel=A;var D=function(E,M,G,H){try{var K="<root>".concat(E,"</root>");var N=new window.DOMParser();var Q=N.parseFromString(K,"text/xml");return Promise.resolve(w(M)).then(function(R){var T={models:Object.assign({metaModel:R},H),bindingContexts:{}};Object.keys(G).forEach(function(U){expect(typeof R.getObject(G[U])).toBeDefined();var V=H[U]||R;T.bindingContexts[U]=V.createBindingContext(G[U]);T.models[U]=V;});if(T.models["this"]){T.bindingContexts["this"]=T.models["this"].createBindingContext("/");}return X.process(Q.firstElementChild,{name:"Test Fragment"},T);});}catch(e){return Promise.reject(e);}};b.getTemplatingResult=D;return b;},false);
