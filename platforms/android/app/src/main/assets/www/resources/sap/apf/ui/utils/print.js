/*
 * ! SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.define(["sap/apf/ui/utils/printView","sap/apf/ui/utils/formatter","sap/viz/ui5/types/legend/Common","sap/base/util/isEmptyObject","sap/ui/thirdparty/jquery"],function(p,f,C,a,q){"use strict";sap.apf.ui.utils.Print=function(I){"use strict";var c=I.oCoreApi;var u=I.uiApi;var A=null;var b=new sap.apf.ui.utils.PrintModel(I);var p=new sap.apf.ui.utils.PrintView(I,b);this.oPrintLayout={};function _(o){if(!a(o.oPrintLayout)){o.oPrintLayout.removeContent();}q('#apfPrintArea').remove();q("body").append('<div id="apfPrintArea"></div>');u.createApplicationLayout(false).then(function(i){i.setBusy(true);});}this.doPrint=function(){c.getApplicationConfigProperties().done(function(i){b.setApplicationConfig(i);var j,n,P;var k=2000,s=this;b.nStepRenderCount=0;A=c.getSteps();b.nNoOfSteps=A.length;this.oPrintLayout=new sap.ui.layout.VerticalLayout({id:"idAPFPrintLayout"});_(this);P=new sap.ui.layout.VerticalLayout({id:'idAPFPrintFirstPageLayout',content:[p.getHeaderForFirstPage(),p.getPrintLayoutForFacetFiltersAndFooters()]}).addStyleClass("filterLayout");this.oPrintLayout.addContent(P);for(j=0;j<A.length;j++){n=parseInt(j,10)+1;this.oPrintLayout.addContent(p.getPrintLayoutForEachStep(A[j],n,A.length));}this.oPrintLayout.placeAt("apfPrintArea");d(s.oPrintLayout,k);}.bind(this));};function d(P,i){new Promise(function(r){setTimeout(function(){r();},i);}).then(function(){h(P);g();e(P);return u.createApplicationLayout(false)}).then(function(j){j.setBusy(false);});}function e(P){var s,o;var k,l;for(var i=0;i<q("#apfPrintArea").siblings().length;i++){q("#apfPrintArea").siblings()[i].hidden=false;}for(var m=0;m<A.length;m++){s=A[m].getSelectedRepresentation();s=s.bIsAlternateView?s.toggleInstance:s;if(s&&s.titleControl&&s.titleControl.oParent){k=s.titleControl.oParent.getItems();if(k&&k.length>1){for(var j=0;j<k.length;j++){if(k[j].getMetadata()._sClassName==="sap.m.HBox"){l=k[j];l.setVisible(true);}}}}if(s.type!==sap.apf.ui.utils.CONSTANTS.representationTypes.TREE_TABLE_REPRESENTATION&&s.type!==sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION){o=P.getContent()[m+1].getContent()[1].getContent()[0];o.destroy();o=null;}}P.destroy();P=null;q("div[id^=idAPFStepLayout]").remove();q("#apfPrintArea").remove();}function g(){var i=sap.ui.Device.system.tablet;var j=sap.ui.Device.os.ios;if(i===true&&j===true){var k=q("html").clone();var l=q(k).find('body');q(l).children("div").each(function(r,s){if(q(s).attr('id')==='apfPrintArea'){q(s).show();}else{q(s).remove();}});q(q(k).find('body')).html(q(l.html()));var t="<html>"+q(k).html()+"</html>";var m=window.open(null,"_blank","width=300,height=300");m.document.write(t);m.print();}else{var n=document.getElementById("apfPrintArea").innerHTML;var o=window.open(null,"_blank",'height=600,width=700');o.document.write('<html><head><title>Analysis Path Framework</title>');o.document.write('</head><body >');o.document.write(n);o.document.write('</body></html>');o.document.close();o.print();o.close();}}function h(P){var j=P.getDomRef();q("#apfPrintArea").empty();q("#apfPrintArea").append(q(j).html());for(var i=0;i<q("#apfPrintArea").siblings().length;i++){q("#apfPrintArea").siblings()[i].hidden=true;}}};});
