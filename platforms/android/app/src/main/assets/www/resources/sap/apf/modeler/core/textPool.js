/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.apf.modeler.core.textPool");sap.ui.define(["sap/apf/utils/hashtable","sap/apf/core/utils/filter","sap/ui/core/format/DateFormat","sap/apf/utils/utils","sap/ui/thirdparty/jquery"],function(h,f,D,u,q){"use strict";sap.apf.modeler.core.TextPool=function(a,b,e){var m=a.instances.messageHandler;var p=a.instances.persistenceProxy;var c=a.isUsingCloudFoundryProxy;var H=a.constructors.Hashtable;var d=new H(m);var k=new H(m);var g=new H(m);var l=0;var n={TextElement:sap.apf.core.constants.textKeyForInitialText,Language:sap.apf.core.constants.developmentLanguage,TextElementType:"XFLD",TextElementDescription:"",MaximumLength:10,Application:b,TranslationHint:""};function o(t,j){var s=d.getKeys();var i,v=s.length;var w=j.MaximumLength||10;var x=j.TranslationHint||"";var y;for(i=0;i<v;i++){y=d.getItem(s[i]);if((y.TextElementDescription===t)&&(y.MaximumLength===w)&&(y.TranslationHint===x)){return s[i];}}return undefined;}this.removeTexts=function(t,s,v){var w=[];var i,x;function y(z){var j;if(!z){for(j=0;j<x;j++){d.removeItem(t[j]);}}v(z);}x=t.length;if(x===0){v(undefined);return;}for(i=0;i<x;i++){if(t[i]===sap.apf.core.constants.textKeyForInitialText){continue;}w.push({method:"DELETE",entitySetName:"texts",inputParameters:[{name:'TextElement',value:t[i]},{name:'Language',value:sap.apf.core.constants.developmentLanguage}]});}if(c){p.doChangeOperationsInBatch(w,y,s,true);}else{p.doChangeOperationsInBatch(w,y,s);}};this.isInitialTextKey=function(t){return(t===sap.apf.core.constants.textKeyForInitialText);};this.addTextsAndSave=function(t,j,s){function v(C,E){return(C.TextElement===E.TextElement&&C.TextElementDescription===E.TextElementDescription&&C.MaximumLength===E.MaximumLength&&C.Language===E.Language&&C.TranslationHint===E.TranslationHint);}var i;var w=t.length;var x;var y=[];var z=[];var A=[];var B;for(i=0;i<w;i++){if(t[i]===sap.apf.core.constants.textKeyForInitialText){continue;}x=d.getItem(t[i].TextElement);if(x){if(!v(x,t[i])){y.push(t[i]);d.setItem(t[i].TextElement,t[i]);}}else{z.push(t[i]);d.setItem(t[i].TextElement,t[i]);}}w=y.length;for(i=0;i<w;i++){B=[{name:'TextElement',value:y[i].TextElement},{name:'Language',value:y[i].Language}];y[i].MaximumLength=parseInt(y[i].MaximumLength,10);A.push({method:"PUT",entitySetName:"texts",data:y[i],inputParameters:B});}w=z.length;for(i=0;i<w;i++){z[i].MaximumLength=parseInt(z[i].MaximumLength,10);A.push({method:"POST",entitySetName:"texts",data:z[i]});}if(A.length>0){if(c){p.doChangeOperationsInBatch(A,j,s,false);}else{p.doChangeOperationsInBatch(A,j,s);}}else{j(undefined);}};this.exportTexts=function(i){var t=sap.apf.utils.renderHeaderOfTextPropertyFile(b,m);var j={TextElement:"AnalyticalConfigurationName",Language:sap.apf.core.constants.developmentLanguage,TextElementType:"XTIT",TextElementDescription:i,MaximumLength:250,Application:b,TranslationHint:""};return t+sap.apf.utils.renderTextEntries(d,m)+sap.apf.utils.renderEntryOfTextPropertyFile(j,m);};this.get=function(i){var j,s;if(i===sap.apf.core.constants.textKeyForInitialText){return n;}if(d.hasItem(i)){return d.getItem(i);}if(k.hasItem(i)){j=k.getItem(i);if(j.TextElementDescription){return j;}return d.getItem(j);}s=q.extend({},true,n);s.TextElement=i;s.TextElementDescription=i;return s;};this.getPersistentKey=function(i){return i;};this.setTextAsPromise=function(t,i){var j;var s=q.Deferred();var v=function(x,y,z){if(z){m.putMessage(z);}if(x){d.setItem(x.TextElement,x);j=x.TextElement;}s.resolve(x&&x.TextElement);};var w={TextElement:"",Language:sap.apf.core.constants.developmentLanguage,TextElementType:i.TextElementType,TextElementDescription:t,MaximumLength:i.MaximumLength||10,Application:b,TranslationHint:i.TranslationHint||""};if(!t){s.resolve(sap.apf.core.constants.textKeyForInitialText);}j=o(t,i);if(j){s.resolve(j);}else{l++;p.create('texts',w,v,true);}return s.promise();};this.getTextKeys=function(t){var j=d.getKeys();var i,s,v=j.length;var w=[];for(i=0;i<v;i++){s=d.getItem(j[i]);if(t&&s.TextElementType!==t){continue;}if(g.hasItem(j[i])){w.push(g.getItem(j[i]));}else{w.push(j[i]);}}return w;};this.getTextsByTypeAndLength=function(t,j){var s=d.getKeys();var i,v,w=s.length;var x=[];for(i=0;i<w;i++){v=d.getItem(s[i]);if(v.TextElementType===t&&v.MaximumLength===j){if(g.hasItem(s[i])){x.push({TextElement:g.getItem(s[i]),TextElementDescription:v.TextElementDescription});}else{x.push({TextElement:s[i],TextElementDescription:v.TextElementDescription});}}}return x;};function r(){var i,j;j=e.length;for(i=0;i<j;i++){if(e[i].TextElement){d.setItem(e[i].TextElement,e[i]);}}}r();};});
