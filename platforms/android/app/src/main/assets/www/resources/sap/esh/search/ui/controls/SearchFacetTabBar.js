/*!
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/Control","sap/m/Button","sap/m/ButtonRenderer","sap/m/SegmentedButtonItem","sap/base/Log","sap/esh/search/ui/SearchFacetDialogModel","sap/m/Title","sap/m/List","sap/m/CustomListItem","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/m/GroupHeaderListItemRenderer","sap/m/GroupHeaderListItem","sap/m/ListSeparators","sap/m/ActionSheet","sap/m/PlacementType","sap/m/Link","sap/m/Label","sap/m/VBox","sap/esh/search/ui/controls/SearchFacetDialog",],function(C,B,a,S,L,b,T,c,d,e,f,G,g,h,A,P,l,m,V){"use strict";B.extend("sap.esh.search.ui.controls.SearchFacetDisplayModeDropDown",{renderer:"sap.esh.search.ui.controls.SearchFacetDisplayModeDropDownRenderer",});sap.esh.search.ui.controls.SearchFacetDisplayModeDropDownRenderer=jQuery.extend(true,{},a);G.extend("sap.esh.search.ui.controls.SearchGroupHeaderListItemRenderer");g.extend("sap.esh.search.ui.controls.SearchGroupHeaderListItem",{renderer:"sap.esh.search.ui.controls.SearchGroupHeaderListItemRenderer",metadata:{properties:{upperCase:{type:"boolean",group:"Appearance",defaultValue:false,},},aggregations:{button:{type:"sap.esh.search.ui.controls.SearchFacetDisplayModeDropDown",multiple:false,},},},});sap.esh.search.ui.controls.SearchGroupHeaderListItemRenderer.renderCounter=function(r,o){var i=o.getButton();if(typeof i==="object"){this.renderCounterContent(r,o,i);}};sap.esh.search.ui.controls.SearchGroupHeaderListItemRenderer.renderCounterContent=function(r,o,i){r.write("<div>");r.renderControl(i);r.write("</div>");};S.extend("my.SegmentedButtonItem",{aggregations:{content1:{type:"sap.ui.core.Control",multiple:false,},},});return C.extend("sap.esh.search.ui.controls.SearchFacetTabBar",{metadata:{properties:{eshRole:"string",headerText:"string",selectedButtonParameters:{type:"object",defaultValue:null,},},aggregations:{items:{type:"sap.m.IconTabFilter",multiple:true,},},},getSearchFacetTabBarAndDimensionById:function(j){var r={};r.index=0;var k=document.getElementById(j);var v=k.dataset.facetView;var n=k.dataset.facetViewIndex;var o=$("#"+j).parent()[0];var p=o.dataset.facetDimension;var q=$(".sapUshellSearchFacetTabBar");for(var i=0;i<q.length;i++){var s=$(".sapUshellSearchFacetTabBar .sapUshellSearchFacetTabBarHeader")[i];var t=s.dataset.facetDimension;if(t===p){r.index=i;r.control=sap.ui.getCore().byId(q[i].id);r.view=v;r.buttonIndex=n;r.dimension=p;break;}}return r;},storeClickedTabInformation:function(E){var s,j,k,n,o;var t=E.getSource().sId;var p=this.getSearchFacetTabBarAndDimensionById(t);var q=p.control.getModel().getPersonalizationStorageInstance().getItem("search-facet-panel-chart-state");s=p.dimension;j=p.control;k=p.view;o=p.buttonIndex;n=j.getBindingContext().getObject().dimension;var r=E.getParameters().id;var u=[];var v={};v.tabId=t;v.searchFacetTabBarIndex=p.searchFacetTabBarIndex;v.buttonId=r;v.buttonIndex=o;v.dimension=n;v.view=k;u.push(v);if(q&&Object.prototype.toString.call(q)==="[object Array]"){for(var i=0;i<q.length;i++){var w=q[i];if(w.dimension!==s){u.push(w);}}}p.control.getModel().getPersonalizationStorageInstance().setItem("search-facet-panel-chart-state",u);j.getBindingContext().getObject().chartIndex=o;},renderer:function(r,o){var n=function(j,c1){return function(){var p;var d1=$(this.getDomRef()).closest(".sapUshellSearchFacetTabBar")[0];var e1=sap.ui.getCore().byId($(d1).attr("id"));var f1=new b(o.getModel());f1.initBusinessObjSearch().then(function(){var g1=o.getModel();f1.setData(o.getModel().getData());f1.config=o.getModel().config;f1.sinaNext=o.getModel().sinaNext;if(e1&&e1.getBindingContext()&&e1.getBindingContext().getObject()&&e1.getBindingContext().getObject().dimension){p=e1.getBindingContext().getObject().dimension;}if(p==="space_description"&&g1.config.openSpaceShowMoreDialog){return g1.config.openSpaceShowMoreDialog(p,g1);}f1.prepareFacetList();var h1=new sap.esh.search.ui.controls.SearchFacetDialog({selectedAttribute:p,selectedTabBarIndex:j,tabBarItems:c1,});h1.setModel(f1);h1.setModel(o.getModel(),"searchModel");h1.open();var i1=o.getParent().getParent().getParent().getParent();i1.oFacetDialog=h1;o.getModel().eventLogger.logEvent({type:o.getModel().eventLogger.FACET_SHOW_MORE,referencedAttribute:p,});});};};r.write('<div tabindex="0"');r.writeControlData(o);r.addClass("sapUshellSearchFacetTabBar");r.writeClasses();r.write(">");var p=o.getBindingContext().getObject().dimension;var q=o.getBindingContext().getObject().dataType;var t=o.getBindingContext().getObject().title;var s;var u;s=o.getModel().getPersonalizationStorageInstance().getItem("search-facet-panel-chart-state");if(s&&Object.prototype.toString.call(s)==="[object Array]"){for(var k=0;k<s.length;k++){if(s[k].dimension===p){u=s[k];break;}}}var v=[];var w=[];var x=null;var y=null;var z=0;if(u&&u.buttonIndex){z=u.buttonIndex;z=parseInt(z,10);}if(q!=o.getModel().sinaNext.AttributeType.String){z=0;}o.getBindingContext().getObject().chartIndex=z;var D=o.getItems();var E=new sap.esh.search.ui.controls.SearchFacetDisplayModeDropDown({icon:D[z].getIcon(),type:"Transparent",});for(var i=0;i<D.length;i++){x=D[i].getContent()[0];y=new B({text:D[i].getText(),icon:D[i].getIcon(),press:function(j){o.storeClickedTabInformation(j);o.setSelectedButtonParameters(j.getParameters());},});y.data("facet-view",D[i].getText(),true);y.data("facet-view-index",""+i,true);y.data("dimension",p,true);v.push(y);w.push(x);}var F=new A({showCancelButton:false,buttons:v,placement:P.Bottom,cancelButtonPress:function(){L.info("sap.m.ActionSheet: cancelButton is pressed");},afterClose:function(){var j=this;window.setTimeout(function(){var p=j.getFocusDomRef().getAttribute("data-facet-dimension");var c1=$(".sapUshellSearchFacetTabBarButton");for(var i=0;i<c1.length;i++){var d1=c1[i];var e1=d1.parentNode.parentNode.getAttribute("data-facet-dimension");if(e1===p){d1.focus();break;}}},100);L.info("=====================");L.info("sap.m.ActionSheet: closed");},});F.data("facet-dimension",p,true);E.addStyleClass("sapUshellSearchFacetTabBarButton");var H=D[z].getText();var I=sap.esh.search.ui.resources.i18n.getText("displayAs",[H]);E.setTooltip(I);E.attachPress(function(){F.openBy(this);});E.onAfterRendering=function(){$(this.getDomRef()).attr("aria-label",sap.esh.search.ui.resources.i18n.getText("dropDown"));};if(o.getHeaderText()){var J=new c({});J.setShowNoData(false);J.setShowSeparators(h.None);J.data("sap-ui-fastnavgroup","false",true);var K=false;var M=o.getModel();var N=M.getProperty("/uiFilter/rootCondition");if(N.hasFilters()){K=true;if(typeof M.config.hasSpaceFiltersOnly==="function"){if(M.config.hasSpaceFiltersOnly(N)===true){K=false;}}}else{K=false;}var R=new B({icon:"sap-icon://clear-filter",tooltip:sap.esh.search.ui.resources.i18n.getText("resetFilterButton_tooltip"),type:"Transparent",enabled:K,press:function(){var c1=o.getModel();c1.eventLogger.logEvent({type:c1.eventLogger.CLEAR_ALL_FILTERS,});var d1=[];var e1;var f1=c1.getProperty("/uiFilter");var g1=c1.config.searchInAttibuteFacetPostion;if(g1){for(var h1 in g1){e1=f1.rootCondition.getAttributeConditions(h1);for(var j=0;j<e1.length;j++){d1.push(e1[j]);}}}if(d1.length>0){c1.resetFilterConditions(false);for(var i=0;i<d1.length;i++){var i1=d1[i];f1.autoInsertCondition(i1);}c1._firePerspectiveQuery({preserveFormerResults:false,});c1.notifyFilterChanged();}else{c1.resetFilterConditions(true);}},});if(o.getModel().config&&o.getModel().config.searchInAttibuteFacetPostion&&o.getModel().config.searchInAttibuteFacetPostion[p]){R.addStyleClass("sapUshellSearchFilterByResetButtonHidden");}else{R.addStyleClass("sapUshellSearchFilterByResetButton");}R.onAfterRendering=function(){$(this.getDomRef()).attr("aria-label",sap.esh.search.ui.resources.i18n.getText("resetFilterButton_tooltip"));};var O=new T({text:o.getHeaderText(),});O.addStyleClass("sapUshellSearchFilterByResetButtonLabel");var Q=new f();var U=new e({content:[O,Q,R],});U.data("sap-ui-fastnavgroup","false",true);J.setHeaderToolbar(U);J.addStyleClass("sapUshellSearchFilterByHeaderList");J.onAfterRendering=function(){$(".sapUshellSearchFilterByHeaderList").find("ul").attr("tabindex","-1");$(".sapUshellSearchFilterByHeaderList").find("div").attr("tabindex","-1");};r.renderControl(J);}var W=new d({content:w[z],});W.setModel(o.getModel(),"facets");W.addStyleClass("sapUshellSearchFacetList");var X;if(q===o.getModel().sinaNext.AttributeType.String){X=new sap.esh.search.ui.controls.SearchGroupHeaderListItem({title:t,button:E,});}else{X=new sap.esh.search.ui.controls.SearchGroupHeaderListItem({title:t,});}X.data("facet-dimension",p,true);if(o.getModel().config&&o.getModel().config.searchInAttibuteFacetPostion&&o.getModel().config.searchInAttibuteFacetPostion[p]){X.addStyleClass("sapUshellSearchFacetTabBarHeader sapUshellSearchFacetTabBarHeaderHidden");}else{X.addStyleClass("sapUshellSearchFacetTabBarHeader");}var Y=new l({text:sap.esh.search.ui.resources.i18n.getText("showMore"),press:n(z,D),});Y.setModel(o.getModel("i18n"));Y.addStyleClass("sapUshellSearchFacetShowMoreLink");var Z=new m({text:"",});Z.addStyleClass("sapUshellSearchFacetInfoZeile");var _=new V({items:[Z,Y],});var a1=new d({content:_,visible:{parts:[{path:"/uiFilter/dataSource",},],formatter:function(j){return j.type!==this.getModel().sinaNext.DataSourceType.Category;},},});a1.addStyleClass("sapUshellSearchFacetShowMoreItem");var b1=new c({showSeparators:h.None,items:[X,W,a1],});b1.data("sap-ui-fastnavgroup","false",true);b1.setModel(o.getModel());r.renderControl(b1);o.getItems()[z].addContent(w[z]);r.write("</div>");},onAfterRendering:function(){jQuery(this.getDomRef()).removeAttr("tabindex");},});});
