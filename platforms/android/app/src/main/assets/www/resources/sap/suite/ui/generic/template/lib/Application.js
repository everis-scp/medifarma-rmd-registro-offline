sap.ui.define(["sap/ui/base/Object","sap/ui/Device","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/ActionSheet","sap/m/Dialog","sap/m/Popover","sap/suite/ui/generic/template/lib/deletionHelper","sap/suite/ui/generic/template/lib/navigation/routingHelper","sap/suite/ui/generic/template/lib/ContextBookkeeping","sap/suite/ui/generic/template/lib/CRUDHelper","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/suite/ui/generic/template/genericUtilities/oDataModelHelper","sap/ui/core/syncStyleClass","sap/base/util/extend","sap/ui/core/Fragment","sap/ui/generic/app/navigation/service/NavigationHandler","sap/suite/ui/generic/template/lib/KeepAliveHelper"],function(B,D,J,M,A,a,P,d,r,C,b,t,F,o,s,e,c,N,K){"use strict";var G={storeInnerAppStateWithImmediateReturn:function(){return{promise:{fail:Function.prototype}};},parseNavigation:function(){return{done:function(H){setTimeout(H.bind(null,{},{},sap.ui.generic.app.navigation.service.NavType.initial),0);},fail:Function.prototype};}};var l=new F("lib.Application").getLogger();var f=(t.testableStatic(function(T,i){var k="sapUiSizeCozy",m="sapUiSizeCompact";if(i&&(i.classList.contains(k)||i.classList.contains(m))){return"";}else{return T?k:m;}},"Application_determineContentDensityClass")(D.support.touch,document.body));function g(){return f;}function h(i,p){s(f,p,i);p.addDependent(i);}var h=t.testableStatic(h,"Application_attachControlToParent");function j(T){var k=new C(T);var E;var n=Object.create(null);var m=new K(T);function p(i){var z1=T.oNavigationControllerProxy.getActiveComponents();return z1.indexOf(i.getId())>=0;}var I=false;function q(i){T.fnAddSideEffectPromise(i);}function u(i,z1){if(I){return;}var A1=T.aRunningSideEffectExecutions.filter(function(B1){return!!B1;});if(A1.length){I=true;Promise.all(A1).then(function(){I=false;u(i,z1);});}else if(z1&&T.oBusyHelper.isBusy()){if(typeof z1==="function"){z1();}}else{i();}}function v(i){var z1;if(i instanceof a){z1="open";}else if(i instanceof P||i instanceof A){z1="openBy";}if(z1){var A1=i[z1];i[z1]=function(){var B1=arguments;u(function(){if(!T.oBusyHelper.isBusy()){T.oBusyHelper.getUnbusy().then(function(){A1.apply(i,B1);});}});};}}var w={};function x(i,z1,A1,B1,C1){i=i||T.oNavigationHost;var D1=i.getId();var E1=w[D1]||(w[D1]={});var F1=E1[z1];if(!F1){F1=sap.ui.xmlfragment(D1,z1,A1);h(F1,i);var G1;if(B1){G1=new J();F1.setModel(G1,B1);}(C1||Function.prototype)(F1,G1);E1[z1]=F1;v(F1);}return F1;}function y(i,z1,A1,B1,C1,D1){return new Promise(function(E1){i=i||T.oNavigationHost;var F1=i.getId();var G1=w[F1]||(w[F1]={});var H1=G1[z1];if(!H1||D1){if(H1){H1.destroy();}c.load({id:F1,name:z1,controller:A1,type:"XML"}).then(function(I1){H1=I1;h(I1,i);var J1;if(B1){J1=new J();I1.setModel(J1,B1);}(C1||Function.prototype)(I1,J1);G1[z1]=I1;v(I1);E1(H1);});return;}E1(H1);});}function z(){return new Promise(function(i){T.oNavigationObserver.getProcessFinished(true).then(function(){T.oBusyHelper.getUnbusy().then(i);});});}function O(){var i=T.oNavigationControllerProxy.getCurrentIdentity();if(i.treeNode.isDraft&&T.oNavigationControllerProxy.isBackLeavingTheMainObject()){T.oPageLeaveHandler.performAfterDiscardOrKeepDraft(function(){T.oNavigationControllerProxy.navigateBack();},Function.prototype);}else{T.oDataLossHandler.performIfNoDataLoss(function(){T.oNavigationControllerProxy.navigateBack();},Function.prototype);}}function H(i,z1,A1){var B1=b.createNonDraft(null,"/"+i,T.oAppComponent.getModel(),z1,u1());if(A1){A1.aCreateContexts=A1.aCreateContexts||[];A1.aCreateContexts.push({entitySet:i,context:B1,predefinedValues:z1});}return B1;}function L(i){T.oNavigationControllerProxy.navigateForNonDraftCreate(i.entitySet,i.predefinedValues,i.context);}function Q(z1){var A1=T.oNavigationControllerProxy.getActiveComponents();for(var i=0;i<A1.length;i++){var B1=T.componentRegistry[A1[i]];B1.utils.onBeforeDraftTransfer(z1);}}function R(i,z1){Q(z1);k.activationStarted(i,z1);}function S(i,z1,A1){Q(z1);k.cancellationStarted(i,z1,A1);}function U(i,z1){Q(z1);k.editingStarted(i,z1);}function V(i){return k.checkmPath2ContextData(i);}function W(i){T.aStateChangers.push(i);}function X(i,z1){z1.then(function(){k.adaptAfterObjectDeleted(i);},Function.prototype);}function Y(){return T.oNavigationControllerProxy.getLinksToUpperLayers();}function Z(){var z1=T.oNavigationControllerProxy.getActiveComponents();var A1=0;var B1;for(var i=0;i<z1.length;i++){var C1=T.componentRegistry[z1[i]];if(C1.viewLevel>0&&(A1===0||C1.viewLevel<A1)){A1=C1.viewLevel;B1=C1.oComponent;}}var D1=B1?Promise.resolve(B1):T.oNavigationControllerProxy.getRootComponentPromise();return D1.then(function(E1){return E1.getModel("i18n").getResourceBundle();});}function $(){return T.oNavigationControllerProxy.getAppTitle();}function _(i){return T.oNavigationControllerProxy.getCurrentKeys(i);}function a1(i,z1){var A1=i;for(;A1.level>z1;){A1=T.mRoutingTree[A1.parentRoute];}return A1;}var b1;function c1(z1,A1){var i=A1||0;if(i>0){return null;}var B1=z1.getId();var C1=T.componentRegistry[B1];var D1=T.mRoutingTree[C1.route];var E1=D1.communicationObject;for(;i<0&&E1;){D1=T.mRoutingTree[D1.parentRoute];if(D1.communicationObject!==E1){i++;E1=D1.communicationObject;}}if(i<0||E1){return E1;}b1=b1||{};return b1;}function d1(i){for(var z1 in T.mEntityTree){if(T.mEntityTree[z1].navigationProperty&&(T.mEntityTree[z1].level===i+1)){return T.mEntityTree[z1].navigationProperty;}}}function e1(){var i=T.oNavigationControllerProxy.getCurrentIdentity();for(var z1=i.treeNode;z1.level>0;z1=T.mRoutingTree[z1.parentRoute]){if(z1.level===1&&z1.isDraft){var A1=z1.getPath(3,i.keys);k.markDraftAsModified(A1);return;}}}function f1(){if(E!==undefined){return E;}var i,z1,A1,B1,C1,D1,E1=true;var F1=T.oAppComponent.getModel();var G1=F1.getMetaModel();var H1=F1.mContexts;for(A1 in H1){E1=false;C1=H1[A1].sPath;B1=C1&&C1.substring(1,C1.indexOf('('));D1=B1&&G1.getODataEntitySet(B1);if(D1){i=F1.getProperty(C1);z1=i&&F1.getETag(undefined,undefined,i)||null;if(z1){E=true;return E;}}}if(E1){return true;}E=false;return E;}function g1(z1){var i,A1,B1;var C1=T.oNavigationControllerProxy.getAllComponents();for(i=0;i<C1.length;i++){A1=C1[i];if(!z1||!z1[A1]){B1=T.componentRegistry[A1];B1.utils.refreshBinding(true);}}}function h1(i){if(T.oFlexibleColumnLayoutHandler){T.oFlexibleColumnLayoutHandler.setStoredTargetLayoutToFullscreen(i);}}function i1(){T.oPaginatorInfo={};}function j1(z1,A1){var B1=n[z1];if(!B1){B1=Object.create(null);n[z1]=B1;var C1=T.oAppComponent.getModel();var D1=C1.getMetaModel();var E1=D1.getODataEntitySet(z1);var F1=E1&&D1.getODataEntityType(E1.entityType);var G1=(F1&&F1.navigationProperty)||[];for(var i=0;i<G1.length;i++){var H1=G1[i];B1[H1.name]=H1;}}return B1[A1];}function k1(i,z1){var A1=T.oNavigationControllerProxy.getSwitchToSiblingPromise(i,2,z1);T.oBusyHelper.setBusy(A1.then(function(B1){B1();}));}function l1(i){var z1=T.oNavigationControllerProxy.getSpecialDraftCancelPromise(i);if(z1){return z1;}var A1=k.getDraftSiblingPromise(i);var B1=T.oNavigationControllerProxy.getCurrentIdentity();var C1=T.componentRegistry[B1.treeNode.componentId];var D1=C1&&C1.utils.getTargetKeyFromLevel(2);return Promise.all([A1,D1]).then(function(E1){var F1=E1[0];var G1=F1&&F1.getObject();var H1=G1&&G1.IsActiveEntity;if(!H1){return Promise.resolve(d.getNavigateAfterDeletionOfCreateDraft(T));}return T.oNavigationControllerProxy.getSwitchToSiblingPromise(F1,1,E1[1]).then(function(I1){return function(){var J1=F1.getModel();J1.invalidateEntry(F1);return I1();};});});}function m1(i,z1){var A1=[];for(var B1=i;B1.level>=z1;B1=T.mRoutingTree[B1.parentRoute]){A1.push(B1);if(B1.level===0){break;}}return A1.reverse();}function n1(z1,A1,B1,C1){if(B1.length===0){B1.push("");}if(z1.level<B1.length){B1.splice(z1.level+1,B1.length-z1.level-1);return Promise.resolve(z1);}var D1=m1(z1,B1.length);var E1=D1.map(function(i){if(i.noKey||i.level===0){return Promise.resolve(true);}if(!i.isDraft){return Promise.resolve(A1[i.level]);}var F1=i.getPath(3,A1);var G1=k.getSiblingPromise(F1,C1);return G1.then(function(H1){var I1=H1&&o.analyseContext(H1);return I1&&I1.key;},Function.prototype);});return Promise.all(E1).then(function(F1){var G1=T.mRoutingTree[D1[0].parentRoute];F1.every(function(H1,i){if(H1){B1.push(H1===true?"":H1);G1=D1[i];}return H1;});return G1;});}function o1(i){return T.oNavigationControllerProxy.navigateAfterActivation(i);}function p1(i,z1,A1,B1){T.oNavigationControllerProxy.navigateToSubContext(i,z1,A1,B1);}function q1(i,z1,A1,B1){return T.oNavigationControllerProxy.navigateToDetailContextIfPossible(i,z1,A1,B1);}function r1(i,z1){T.oNavigationControllerProxy.navigateByExchangingQueryParam(i,z1);}function s1(){return!T.bCreateRequestsCanonical;}function t1(){return T.oNavigationControllerProxy.getParsedShellHashFromFLP();}function u1(){return!T.bCreateRequestsCanonical;}function v1(i){return k.checkIfObjectIsADraftInstance(i);}function w1(i){return k.getContextForPath(i);}var x1;function y1(){x1=x1||new N(T.oAppComponent);return T.ghostapp?G:x1;}T.oApplicationProxy={getDraftSiblingPromise:k.getDraftSiblingPromise,getSiblingPromise:k.getSiblingPromise,fillSiblingKeyPromise:n1,getAlternativeIdentityPromise:k.getAlternativeIdentityPromise,getPathOfLastShownDraftRoot:k.getPathOfLastShownDraftRoot,areTwoKnownPathesIdentical:k.areTwoKnownPathesIdentical,getIdentityKeyForContext:k.getIdentityKeyForContext,getAncestralNode:a1,getResourceBundleForEditPromise:Z,getContentDensityClass:g,getDialogFragment:x.bind(null,null),getDialogFragmentAsync:y.bind(null,null),destroyView:function(i){delete w[i];},markCurrentDraftAsModified:e1,prepareDeletion:X,performAfterSideEffectExecution:u,onBackButtonPressed:O,mustRequireRequestsCanonical:u1,cancellationStarted:S,checkIfObjectIsADraftInstance:v1,getContextForPath:w1,invalidatePaginatorInfo:i1};return{createNonDraft:H,navigateToNonDraftCreateContext:L,getContentDensityClass:g,attachControlToParent:h,getDialogFragmentForView:x,getDialogFragmentForViewAsync:y,getBusyHelper:function(){return T.oBusyHelper;},addSideEffectPromise:q,performAfterSideEffectExecution:u,isComponentActive:p,showMessageToast:function(){var i=arguments;var z1=function(){l.info("Show message toast");M.show.apply(M,i);};Promise.all([z(true),T.oBusyHelper.getUnbusy()]).then(z1);},registerStateChanger:W,getDraftSiblingPromise:k.getDraftSiblingPromise,registerContext:k.registerContext,activationStarted:R,cancellationStarted:S,editingStarted:U,checkContextData:V,getLinksToUpperLayers:Y,getAppTitle:$,getCurrentKeys:_,getCommunicationObject:c1,getForwardNavigationProperty:d1,markCurrentDraftAsModified:e1,checkEtags:f1,refreshAllComponents:g1,getIsDraftModified:k.getIsDraftModified,prepareDeletion:d.prepareDeletion.bind(null,T),setStoredTargetLayoutToFullscreen:h1,invalidatePaginatorInfo:i1,getNavigationProperty:j1,switchToDraft:k1,getNavigateAfterDraftCancelPromise:l1,navigateAfterActivation:o1,navigateToSubContext:p1,navigateToDetailContextIfPossible:q1,navigateByExchangingQueryParam:r1,onBackButtonPressed:O,needsToSuppressTechnicalStateMessages:s1,mustRequireRequestsCanonical:u1,getNavigationHandler:y1,getParsedShellHashFromFLP:t1,getLeaveAppPromise:function(){return T.leaveAppPromise;},getComponentRefreshBehaviour:function(i){return m.getComponentRefreshBehaviour(i);},getChevronNavigationRefreshBehaviour:function(i){return m.getChevronNavigationRefreshBehaviour(i);}};}return B.extend("sap.suite.ui.generic.template.lib.Application",{constructor:function(T){e(this,j(T));}});});
