/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/restricted/_difference","sap/base/util/merge","sap/base/util/each","sap/base/Log","sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/core/IconPool","sap/ui/dt/ElementUtil","sap/ui/dt/OverlayRegistry","sap/ui/dt/Util","sap/ui/fl/apply/api/DelegateMediatorAPI","sap/ui/fl/write/api/FieldExtensibility","sap/ui/fl/Utils","sap/ui/rta/plugin/Plugin","sap/ui/rta/Utils"],function(d,m,e,L,J,I,E,O,D,a,F,b,P,U){"use strict";function _(s,t,u){var v;var R=t;if(u){var w=["add.delegate","reveal","add.custom"].some(function(z){return u.isResponsibleElementActionAvailable(t,z);});if(w){R=u.getResponsibleElementOverlay(t);}}var x=R.getRelevantContainer(!s);var y=O.getOverlay(x);if(s){v=R.getParentElementOverlay();}else{v=R;}return{responsibleElementOverlay:R,relevantContainerOverlay:y,parentOverlay:v,relevantContainer:x,parent:v&&v.getElement()};}function c(s,C){return C.sParentAggregationName;}function f(s,t){var u=s.getElement();if(!u){return[];}var v=E.getAggregation(u,t).filter(function(C){var w=O.getOverlay(C);if(!this.hasStableId(w)){return false;}var R=s.getRelevantContainer(true);var x=O.getOverlay(R);var y=s;var z=false;do{z=!y.getElementVisibility();if(z){break;}if(y===x){break;}else{y=y.getParentElementOverlay();}}while(y);if(z){return true;}return w.getElementVisibility()===false;},this);return v;}function g(s){return(s["addViaDelegate"]&&s["addViaDelegate"].designTimeMetadata)||(s["addViaCustom"]&&s["addViaCustom"].designTimeMetadata);}var S=true;var h=false;function i(R,s,t,u,C){var N=[];var v;var w;var x=s.aggregation;if(s.addViaCustom||s.addViaDelegate){var y=g(s);v=y.getAggregationDescription(x,t);if(v){w=u?v.singular:v.plural;N.push(w);}}if(s.reveal){s.reveal.controlTypeNames.forEach(function(v){w=u?v.singular:v.plural;N.push(w);});}var z=N.reduce(function(B,G){if(B.indexOf(G)===-1){B.push(G);}return B;},[]);var T=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");if(z.length===1){w=z[0];}else if(C){w=C;}else{w=T.getText("MULTIPLE_CONTROL_NAME");}return T.getText(R,[w]);}function j(s,R){var t;s.reveal.elements.some(function(u){if(u.element.getId()===R.getId()){t=u;return false;}});return t;}function k(s,t){var R=t.responsibleElementOverlay.getParentAggregationOverlay().getAggregationName();return Object.keys(s).some(function(u){return u===R;});}function l(C,s,t,u){var v=t.changeType&&u.hasStableId(C);if(v&&C!==s.relevantContainerOverlay){v=u.hasStableId(s.relevantContainerOverlay);}return v;}function n(s,t,u,v){return s.reduce(function(w,x){return w.then(function(y){var C=x.changeOnRelevantContainer?t.relevantContainer:t.parent;var z=O.getOverlay(C);var V=l(z,t,x,u);if(V){x.element=C;return a.getDelegateForControl({control:t.relevantContainer,modifier:J,supportsDefault:x.supportsDefaultDelegate}).then(function(B){if(B&&B.names&&B.names.length){var R=a.getRequiredLibrariesForDefaultDelegate({delegateName:B.names,control:t.relevantContainer});if(d(R,v.filter(Boolean)).length===0){x.delegateInfo=B;y.push(x);}}return y;});}return y;});},Promise.resolve([]));}function o(s,t){return this.hasChangeHandler(s.changeType,s.element).then(function(H){if(H){return{aggregationName:s.aggregation,addPropertyActionData:{designTimeMetadata:t,action:s,delegateInfo:{payload:s.delegateInfo.payload||{},delegate:s.delegateInfo.instance,modelType:s.delegateInfo.modelType,requiredLibraries:s.delegateInfo.requiredLibraries}}};}});}function p(C,R){var s=C.getManifestEntry("/sap.ui5/dependencies/libs");return Object.keys(R).some(function(t){return!s[t];});}function q(){var s=[];var R=a.getKnownDefaultDelegateLibraries();R.forEach(function(t){var u=sap.ui.getCore().loadLibrary(t,{async:true}).then(function(){return Promise.resolve(t);}).catch(function(v){L.warning("Required library not available: ",v);return Promise.resolve();});s.push(u);});return Promise.all(s);}function r(C){return F.onControlSelected(C).then(function(){return Promise.all([U.isServiceUpToDate(C),F.isExtensibilityEnabled(C)]);}).then(function(R){var s=!!R[1];if(s){return F.getExtensionData(C);}});}var A=P.extend("sap.ui.rta.plugin.additionalElements.AdditionalElementsPlugin",{metadata:{library:"sap.ui.rta",properties:{analyzer:"object",dialog:"object",commandFactory:"object"},associations:{},events:{}},getContextMenuTitle:function(s,t,u,v){if(v){var T=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");return T.getText("CTX_ADD_ELEMENTS_WITH_SUBMENU");}var w=_(s,t,this);var x=this._getActionsOrUndef(s,t);if(!u){u=Object.keys(x)[0];}var y=x[u];y.aggregation=u;return i("CTX_ADD_ELEMENTS",y,w.parent,S);},isAvailable:function(s,t){return t.every(function(u){return this._isEditableByPlugin(u,s);},this);},isEnabled:function(s,t,u){if(t.length>1){return false;}var v=this.getResponsibleElementOverlay(t[0]);var w;var x=false;if(s){w=v.getParentElementOverlay();if(w){x=true;}}else{var y=this._getActionsOrUndef(s,v);var z=y[u];if(z&&((z.reveal&&z.reveal.elements.length>0)||z.addViaCustom||z.addViaDelegate)){x=true;}}var C=this.getCachedElements(s);var B=C&&C.length>0;x=x&&(B||!!this.getExtensibilityInfo(s));return x;},registerElementOverlay:function(s){var M=s.getElement().getModel();if(M){var t=M.getMetaModel();if(t&&t.loaded){t.loaded().then(function(){this.evaluateEditable([s],{onRegistration:true});}.bind(this));}}P.prototype.registerElementOverlay.apply(this,arguments);},_getRevealActions:function(s,t){var u=_(s,t,this);var v=[u.parentOverlay];if(u.relevantContainer!==u.parent){v=E.findAllSiblingsInContainer(u.parent,u.relevantContainer).map(function(y){return O.getOverlay(y);}).filter(function(y){return y;});}var w;if(s){var x=u.responsibleElementOverlay.getParentAggregationOverlay();w=x?[u.responsibleElementOverlay.getParentAggregationOverlay().getAggregationName()]:[];}else{w=u.parentOverlay.getAggregationOverlays().filter(function(y){return!y.getDesignTimeMetadata().isIgnored(u.parent);}).map(function(y){return y.getAggregationName();});}return w.reduce(function(y,z){return y.then(function(R){return this._getRevealActionFromAggregations(v,R,z);}.bind(this));}.bind(this),Promise.resolve({}));},_getRevealActionFromAggregations:function(s,t,u){var v=s.reduce(function(x,y){return y?x.concat(f.call(this,y,u)):x;}.bind(this),[]);var w={elements:[],controlTypeNames:[]};var R=v.reduce(function(x,y){return x.then(function(z){return this._invisibleToReveal(z,y);}.bind(this));}.bind(this),Promise.resolve(w));return R.then(function(x){if(x.elements.length>0){t[u]={reveal:x};}return t;});},_invisibleToReveal:function(R,s){return Promise.resolve().then(function(){var t;var u;var v=false;var H=Promise.resolve();var w=O.getOverlay(s);if(w){t=w.getDesignTimeMetadata();u=t&&t.getAction("reveal",s);if(u&&u.changeType){var x=s;if(u.changeOnRelevantContainer){x=w.getRelevantContainer();}H=this.hasChangeHandler(u.changeType,x).then(function(y){if(y){if(u.changeOnRelevantContainer){var z=_(true,w);v=this.hasStableId(z.relevantContainerOverlay)&&this.hasStableId(z.parentOverlay);}else{v=true;}if(!u.getAggregationName){u.getAggregationName=c;}}}.bind(this));}}return H.then(function(){if(v){R.elements.push({element:s,designTimeMetadata:t,action:u});var N=t.getName(s);if(N){R.controlTypeNames.push(N);}}return R;});}.bind(this));},_getAddViaDelegateActions:function(s,t){var u=_(s,t,this);var v=u.parentOverlay&&u.parentOverlay.getDesignTimeMetadata();return Promise.resolve().then(function(){var w=v?v.getActionDataFromAggregations("add",u.parent,undefined,"delegate"):[];if(w.length){return q().then(n.bind(this,w,u,this));}return[];}.bind(this)).then(function(w){return w.reduce(function(x,y){return x.then(function(R){return o.call(this,y,v).then(function(z){if(z){z.addPropertyActionData.relevantContainer=u.relevantContainer;if(!R[z.aggregationName]){R[z.aggregationName]={};}R[z.aggregationName].addViaDelegate=z.addPropertyActionData;}return R;});}.bind(this));}.bind(this),Promise.resolve({}));}.bind(this));},_checkInvalidAddActions:function(s,t){var u=_(s,t,this);var v=u.parentOverlay&&u.parentOverlay.getDesignTimeMetadata();var w=v?v.getActionDataFromAggregations("addODataProperty",u.parent):[];if(w.length>0){L.error("Outdated addODataProperty action in designtime metadata in "+v.getData().designtimeModule+" or propagated or via instance specific designtime metadata.");}},_getCustomAddActions:function(s,t){var u=_(s,t,this);var v=u.parentOverlay&&u.parentOverlay.getDesignTimeMetadata();var w=v&&v.getActionDataFromAggregations("add",u.parent,undefined,"custom")||[];function x(y,C){var z=[];return Promise.resolve().then(function(){if(y&&typeof y.getItems==="function"){var B=O.getOverlay(C);if(this.hasStableId(B)){return y.getItems(C);}}}.bind(this)).then(function(B){z=B;if(Array.isArray(z)){var G=z.reduce(function(H,K){if(K.changeSpecificData.changeOnRelevantContainer){C=u.relevantContainer;}if(K.changeSpecificData.changeType){H.push(this.hasChangeHandler(K.changeSpecificData.changeType,C));}return H;}.bind(this),[]);return Promise.all(G);}}.bind(this)).then(function(H){if(Array.isArray(H)&&z.length===H.length&&H.indexOf(false)===-1){return{aggregationName:y.aggregation,addViaCustom:{designTimeMetadata:v,action:y,items:z}};}});}var C=u.parent;return w.reduce(function(y,z){return y.then(function(R){return x.call(this,z,C).then(function(B){if(B){R[B.aggregationName]={addViaCustom:B.addViaCustom};}return R;});}.bind(this));}.bind(this),Promise.resolve({}));},_getActions:function(s,t,u){return new Promise(function(v,w){var x=s?"asSibling":"asChild";if(!u&&t._mAddActions){return v(t._mAddActions[x]);}var R=this._getRevealActions(s,t);var y=this._getAddViaDelegateActions(s,t);var C=this._getCustomAddActions(s,t);return Promise.all([R,y,C,this._checkInvalidAddActions(s,t)]).then(function(z){var B=m(z[0],z[1],z[2]);t._mAddActions=t._mAddActions||{asSibling:{},asChild:{}};t._mAddActions[x]=B;v(B);}).catch(function(z){w(z);});}.bind(this));},_getActionsOrUndef:function(s,t){var u=s?"asSibling":"asChild";return t._mAddActions&&t._mAddActions[u];},_checkIfCreateFunctionIsAvailable:function(C){return!C||(C&&C.content&&C.content.createFunction);},showAvailableElements:function(s,t,R,u,C,v){var w=R[0];var x=_(s,w);var y=s&&w.getElement();var z;var B=[];return this._getActions(s,w).then(function(G){if(Object.keys(G).length>0){z=G[t];if(z){z.aggregation=t;}}}).then(function(){return this.getAllElements(s,[x.responsibleElementOverlay],C,v);}.bind(this)).then(function(G){B=G;var H=this.getExtensibilityInfo(s);this.getDialog().setCustomFieldEnabled(!!H);if(H){this.getDialog().detachEvent("openCustomField",this._onOpenCustomField,this);this.getDialog().attachEvent("openCustomField",s,this._onOpenCustomField,this);this.getDialog()._oCustomFieldButton.setVisible(true);return this.getDialog().addExtensionData(H.extensionData);}this.getDialog()._oCustomFieldButton.setVisible(false);}.bind(this)).then(function(){var G=B.filter(function(M){return M.aggregation===t;})[0];var H=G?G.elements:[];this.getDialog().setElements(H);if(v){var T=sap.ui.getCore().getLibraryResourceBundle("sap.ui.rta");var K=T.getText("HEADER_ADDITIONAL_ELEMENTS_WITH_AGGREGATION",v);this.getDialog().setTitle(K);}else if(z&&(z.aggregation||C)){this._setDialogTitle(z,x.parent,C);}return this.getDialog().open().then(function(){return this._createCommands(x,y,z,u);}.bind(this)).then(function(){var M=O.getOverlay(y)||w;M.focus();}).catch(function(M){if(M instanceof Error){throw M;}});}.bind(this)).catch(function(G){if(G instanceof Error){throw G;}else{L.info("Service not up to date, skipping add dialog","sap.ui.rta");}});},_setDialogTitle:function(s,t,C){var u=i("HEADER_ADDITIONAL_ELEMENTS",s,t,h,C);this.getDialog().setTitle(u);if(C){this.getDialog()._oList.setNoDataText(this.getDialog()._oTextResources.getText("MSG_NO_FIELDS",C.toLowerCase()));}},_onOpenCustomField:function(s,t){var R=U.getRtaStyleClassName();return F.onTriggerCreateExtensionData(this.getExtensibilityInfo(t),R);},_createCommands:function(s,t,u,v){var w=this.getDialog().getSelectedElements();w.sort(function(x,y){if(x.label>y.label){return-1;}if(x.label<y.label){return 1;}return 0;});if(w.length>0){return this.getCommandFactory().getCommandFor(s.parent,"composite").then(function(C){var x=Promise.resolve();w.forEach(function(y){switch(y.type){case"invisible":x=x.then(this._createCommandsForInvisibleElement.bind(this,C,y,s,t,u,v));break;case"delegate":x=x.then(this._createCommandsForAddViaDelegate.bind(this,C,y,s,t,u,v));break;case"custom":x=x.then(this._createCommandsForCustomElement.bind(this,C,y,s,t,u,v));break;default:L.error("Can't create command for untreated element.type "+y.type);}},this);return x.then(function(){return C;});}.bind(this)).then(function(C){this.fireElementModified({command:C});}.bind(this)).catch(function(M){throw D.propagateError(M,"AdditionalElementsPlugin#_createCommands","Error occured during _createCommands execution","sap.ui.rta.plugin");});}return Promise.resolve();},_createCommandsForInvisibleElement:function(C,s,t,u,v,w){return this._createRevealCommandForInvisible(s,v,t).then(function(R){C.addCommand(R);return this._createMoveCommandForInvisible(s,t,u,w);}.bind(this)).then(function(M){if(M){C.addCommand(M);}else{L.warning("No move action configured for "+t.parent.getMetadata().getName()+", aggregation: "+v.aggregation,"sap.ui.rta");}return C;});},_createCommandForAddLibrary:function(s,R,t){if(R){var C=b.getAppComponentForControl(s.relevantContainer);var u=p(C,R);if(u){var M=C.getManifest();var v=M["sap.app"].id;return this.getCommandFactory().getCommandFor(s.publicParent,"addLibrary",{reference:v,parameters:{libraries:R},appComponent:C},t);}}return Promise.resolve();},_createRevealCommandForInvisible:function(s,t,u){var R=E.getElementInstance(s.elementId);var v=O.getOverlay(R);var w=j(t,R);var x=w.designTimeMetadata;var y=w.action;var V;if(v){V=this.getVariantManagementReference(v);}if(y.changeOnRelevantContainer){return this.getCommandFactory().getCommandFor(R,"reveal",{revealedElementId:R.getId(),directParent:u.parent},x,V);}return this.getCommandFactory().getCommandFor(R,"reveal",{},x,V);},_createMoveCommandForInvisible:function(s,t,u,v){var R=E.getElementInstance(s.elementId);var w=O.getOverlay(R);var x=w.getParentAggregationOverlay().getAggregationName();var y=w.getParentElementOverlay().getElement()||t.parent;var T=t.parent;var z=U.getIndex(t.parent,u,x);var B=U.getIndex(y,R,x)-1;z=v!==undefined?v:E.adjustIndexForMove(y,T,B,z);if(z!==B||t.parent!==R.getParent()){var C=O.getOverlay(R)?O.getOverlay(R).getParentAggregationOverlay():t.relevantContainerOverlay;var G=C.getDesignTimeMetadata();var V=this.getVariantManagementReference(w);return this.getCommandFactory().getCommandFor(t.relevantContainer,"move",{movedElements:[{element:R,sourceIndex:B,targetIndex:z}],source:{parent:y,aggregation:x},target:{parent:T,aggregation:x}},G,V);}return Promise.resolve();},_createCommandsForCustomElement:function(C,s,t,u,v,w){var x=t.parent;var y=t.parentOverlay.getAggregationOverlay(v.aggregation).getDesignTimeMetadata();var z=Object.assign({changeOnRelevantContainer:s.changeSpecificData.changeOnRelevantContainer,aggregationName:v.aggregation,changeType:s.changeSpecificData.changeType,addElementInfo:s.changeSpecificData.content,index:w||U.getIndex(t.parent,u,v.aggregation)},s.itemId&&{customItemId:s.itemId});var V;if(t.relevantContainerOverlay){V=this.getVariantManagementReference(t.relevantContainerOverlay);}return this.getCommandFactory().getCommandFor(x,"customAdd",z,y,V).then(function(B){if(B){C.addCommand(B);}return C;});},_createCommandsForAddViaDelegate:function(C,s,t,u,v,w){var x=v.addViaDelegate.action;var R=x.delegateInfo.requiredLibraries;var y=t.parentOverlay.getAggregationOverlay(v.aggregation);var z=y.getDesignTimeMetadata();return this._createCommandForAddLibrary(t,R,z).then(function(B){if(B){C.addCommand(B);}return this._createAddViaDelegateCommand(s,t,z,u,v,w);}.bind(this)).then(function(B){if(B){C.addCommand(B);}return C;});},_createAddViaDelegateCommand:function(s,t,u,v,w,x){var y=w.addViaDelegate.action;var z=y.changeOnRelevantContainer?t.relevantContainer:t.parent;var B=y.changeOnRelevantContainer?t.relevantContainerOverlay:t.parentOverlay;var V=this.getVariantManagementReference(B);var C=U.getIndex(t.parent,v,w.aggregation,u.getData().getIndex);var G="addDelegateProperty";var M=b.getAppComponentForControl(t.parent).getManifest();var H=b.getODataServiceUriFromManifest(M);return this.getCommandFactory().getCommandFor(t.parent,G,{newControlId:U.createFieldLabelId(z,s.entityType,s.bindingPath),index:x!==undefined?x:C,bindingString:s.bindingPath,entityType:s.entityType,parentId:t.parent.getId(),propertyName:s.name,oDataServiceVersion:s.oDataServiceVersion,oDataServiceUri:H,modelType:y.delegateInfo.modelType,relevantContainerId:t.relevantContainer.getId()},u,V);},_isEditable:function(s,t){return Promise.all([this._isEditableCheck(t.sourceElementOverlay,true),this._isEditableCheck(t.sourceElementOverlay,false)]).then(function(u){return{asSibling:u[0],asChild:u[1]};}).catch(function(v){L.error(v);});},_isEditableCheck:function(s,t){return Promise.resolve().then(function(){var u=_(t,s,this);if(!u.relevantContainerOverlay){return false;}return this._getActions(t,s,true).then(function(v){return U.doIfAllControlsAreAvailable([s,u.parentOverlay],function(){var w=false;if(t){w=k(v,u);}return Object.keys(v).some(function(x){if(!w&&v[x].reveal){w=true;}if(!w&&!t){if(v[x].addViaDelegate){w=this.checkAggregationsOnSelf(u.parentOverlay,"add",undefined,"delegate");}}if(!w&&!t&&v[x].addViaCustom){w=true;}return w;}.bind(this));}.bind(this));}.bind(this)).then(function(v){if(v){v=this.hasStableId(s)&&this.hasStableId(u.parentOverlay);}return v;}.bind(this));}.bind(this));},getAllElements:function(s,t){var u=t[0];var v=_(s,u,this);var w;var x=[];var C=false;var y=this.getCachedElements(s);if(y){return y;}this.clearExtensibilityInfo(s);return this._getActions(s,u).then(function(z){e(z,function(B){w=z[B];w.aggregation=B;if(w.addViaDelegate){C=true;}x.push({aggregation:B,elementPromises:[w.reveal?this.getAnalyzer().enhanceInvisibleElements(v.parent,w):Promise.resolve([]),w.addViaDelegate?this.getAnalyzer().getUnrepresentedDelegateProperties(v.parent,w.addViaDelegate):Promise.resolve([]),w.addViaCustom?this.getAnalyzer().getCustomAddItems(v.parent,w.addViaCustom,w.aggregation):Promise.resolve([])]});}.bind(this));if(C){return r(v.parent);}}.bind(this)).then(function(z){this.setExtensibilityInfo(s,z);}.bind(this)).then(this._combineAnalyzerResults.bind(this,x)).then(function(z){this.setCachedElements(z,s);return z;}.bind(this)).catch(function(z){throw z;});},getMenuItems:function(s){var M=[];var t;this.clearCachedElements();return Promise.all([this.getAllElements(false,s),this.getAllElements(true,s)]).then(function(u){var H=u[0].length>0;var v=u[0].length>1;var w=u[1].length>0;var x=this.isAvailable(false,s);var y=this.isAvailable(true,s);if(y&&(!x||!H)){t=this._buildMenuItem("CTX_ADD_ELEMENTS_AS_SIBLING",true,s,u,false);}else if(!y&&x&&!v){t=this._buildMenuItem("CTX_ADD_ELEMENTS_AS_CHILD",false,s,u,false);}else if(!y&&x&&v){t=this._buildMenuItem("CTX_ADD_ELEMENTS_AS_CHILD",false,s,u,true);}else if(x&&y&&H&&w){t=this._buildMenuItem("CTX_ADD_ELEMENTS_CHILD_AND_SIBLING",false,s,u,true);}if(t){M.push(this.enhanceItemWithResponsibleElement(t,s,["addViaDelegate","reveal","custom"]));}return M;}.bind(this));},_buildMenuItem:function(s,t,u,v,H){var w;var x;var R=t?v[1]:v[0];var y=R[0]&&R[0].aggregation;if(H){w=this._buildSubmenuItems(false,u,v[0]);if(s==="CTX_ADD_ELEMENTS_CHILD_AND_SIBLING"){w=w.concat(this._buildSubmenuItems(true,u,v[1]));}}else{x=function(t,u){return this.showAvailableElements(t,y,u);}.bind(this,t);}var M={id:s,text:this.getContextMenuTitle.bind(this,t,u[0],y,H),enabled:H||function(t,u){return this.isEnabled(t,u,y);}.bind(this,t),rank:20,icon:"sap-icon://add",handler:x};if(H){M.submenu=w;}return M;},_buildSubmenuItems:function(s,t,u){var v=[];var w=s?"CTX_ADD_ELEMENTS_AS_SIBLING":"CTX_ADD_ELEMENTS_AS_CHILD";var x=0;I.registerFont({collectionName:"BusinessSuiteInAppSymbols",fontFamily:"BusinessSuiteInAppSymbols",fontURI:sap.ui.require.toUrl("sap/ushell/themes/base/fonts/"),lazy:true});function y(s,z,t){var B=s?t[0].getParentElementOverlay():t[0];var N=B.getDesignTimeMetadata().getAggregationDisplayName(z,B.getElement());return N?N.singular:z;}u.forEach(function(z){var B=z.aggregation;var C=y(s,B,t);var G={id:w+'_'+x,text:C,enabled:function(s,t){return this.isEnabled(s,t,B);}.bind(this,s),handler:function(s,t){return this.showAvailableElements(s,B,t,undefined,undefined,C);}.bind(this,s),icon:s?"sap-icon://BusinessSuiteInAppSymbols/icon-add-outside":"sap-icon://add"};v.push(this.enhanceItemWithResponsibleElement(G,t,["addViaDelegate","reveal","custom"]));x++;}.bind(this));return v;},_combineAnalyzerResults:function(s){var C=[];s.forEach(function(t){C.push(Promise.all(t.elementPromises).then(function(u){return{aggregation:t.aggregation,elements:this.getAnalyzer().getFilteredItemsList(u)};}.bind(this)));}.bind(this));return Promise.all(C).then(function(t){return t.filter(function(u){var v=u&&u.elements;return v.length>0;});});},clearCachedElements:function(){this._oCachedElements=undefined;},setCachedElements:function(s,t){this._oCachedElements=this._oCachedElements||{};this._oCachedElements[t?"asSibling":"asChild"]=s;},getCachedElements:function(s){if(this._oCachedElements){return this._oCachedElements[s?"asSibling":"asChild"];}},clearExtensibilityInfo:function(s){if(this._oExtensibilityInfo){this._oExtensibilityInfo[s?"asSibling":"asChild"]=undefined;}},setExtensibilityInfo:function(s,t){this._oExtensibilityInfo=this._oExtensibilityInfo||{};this._oExtensibilityInfo[s?"asSibling":"asChild"]=t;},getExtensibilityInfo:function(s){if(this._oExtensibilityInfo){return this._oExtensibilityInfo[s?"asSibling":"asChild"];}}});return A;});
